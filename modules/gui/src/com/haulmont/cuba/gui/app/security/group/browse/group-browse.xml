<!--
  ~ Copyright (c) 2011 Haulmont Technology Ltd. All Rights Reserved.
  ~ Haulmont Technology proprietary and confidential.
  ~ Use is subject to license terms.
  -->

<window
    xmlns="http://www.haulmont.com/schema/cuba/gui/window.xsd"
    messagesPack="com.haulmont.cuba.gui.app.security.group"
    class="com.haulmont.cuba.gui.app.security.group.browse.GroupBrowser"
    caption="msg://browser.caption"
>
    <dsContext>
        <hierarchicalDatasource
            id="groups"
            class="com.haulmont.cuba.security.entity.Group"
            view="group.browse"
            hierarchyProperty="parent"
        >
            <query>
                <![CDATA[select g from sec$Group g]]>
            </query>
        </hierarchicalDatasource>

        <collectionDatasource
            id="users"
            class="com.haulmont.cuba.security.entity.User"
            view="group.browse">
            <query>select u from sec$User u where u.group.id = :ds$groups</query>
        </collectionDatasource>

        <collectionDatasource
            id="constraints"
            class="com.haulmont.cuba.security.entity.Constraint"
            view="group.browse">
            <query>select c from sec$Constraint c where c.group.id = :ds$groups</query>
        </collectionDatasource>

        <collectionDatasource
            id="attributes"
            class="com.haulmont.cuba.security.entity.SessionAttribute"
            view="_local">
            <query>select a from sec$SessionAttribute a where a.group.id = :ds$groups</query>
        </collectionDatasource>
    </dsContext>

    <layout>
        <vbox>
            <split id="split" orientation="horizontal" pos="30">
                <vbox expand="groups" spacing="true" margin="false;true;false;false">
                    <buttonsPanel>
                        <button action="groups.create" icon="icons/create.png"/>
                        <button action="groups.edit" icon="icons/edit.png"/>
                        <button action="groups.remove" icon="icons/remove.png"/>
                        <button action="groups.refresh" icon="icons/refresh.png"/>
                    </buttonsPanel>
                    <tree id="groups">
                        <treechildren datasource="groups" captionProperty="name" hierarchyProperty="parent"/>
                    </tree>
                </vbox>
                <vbox expand="group-editor" margin="false;false;false;true">
                    <!--<hbox>-->
                        <!--<label value="msg://group.name"/>-->
                        <!--<textField id="group.name" datasource="groups" property="name"/>-->
                    <!--</hbox>-->
                    <tabsheet id="tabsheet">
                        <tab id="usersTab" caption="msg://tabsheet.users">
                            <vbox expand="users" spacing="true" margin="true">
                                <!--<hbox>-->
                                    <!--<checkBox id="showDescendants"/>-->
                                    <!--<label value="msg://showDescendants"/>-->
                                <!--</hbox>-->
                                <buttonsPanel>
                                    <button id="users.create" action="users.create" icon="icons/create.png"/>
                                    <button id="users.edit" action="users.edit" icon="icons/edit.png"/>
                                    <button id="users.moveToGroup" action="users.moveToGroup" icon="icons/move.png"/>
                                </buttonsPanel>
                                <table id="users">
                                    <columns>
                                        <column id="name" caption="msg://user.name"/>
                                        <column id="login" caption="msg://user.login"/>
                                    </columns>
                                    <rows datasource="users"/>
                                </table>
                            </vbox>
                        </tab>
                        <tab id="constraintsTab" caption="msg://tabsheet.constraints" lazy="true">
                            <vbox expand="constraints" spacing="true" margin="true">
                                <buttonsPanel>
                                    <button id="constraints.create" action="constraints.create" icon="icons/create.png"/>
                                    <button id="constraints.edit" action="constraints.edit" icon="icons/edit.png"/>
                                    <button id="constraints.remove" action="constraints.remove" icon="icons/remove.png"/>
                                </buttonsPanel>
                                <table id="constraints">
                                    <columns>
                                        <column id="entityName" caption="msg://entity"/>
                                        <column id="joinClause" caption="msg://join"/>
                                        <column id="whereClause" caption="msg://where"/>
                                    </columns>
                                    <rows datasource="constraints"/>
                                </table>
                            </vbox>
                        </tab>
                        <tab id="attributesTab" caption="msg://tabsheet.attributes" lazy="true">
                            <vbox expand="attributes" spacing="true" margin="true">
                                <buttonsPanel>
                                    <button id="attributes.create" action="attributes.create" icon="icons/create.png"/>
                                    <button id="attributes.edit" action="attributes.edit" icon="icons/edit.png"/>
                                    <button id="attributes.remove" action="attributes.remove" icon="icons/remove.png"/>
                                </buttonsPanel>
                                <table id="attributes">
                                    <columns>
                                        <column id="name" caption="msg://attribute.name"/>
                                        <column id="datatypeCaption" caption="msg://attribute.datatype"/>
                                        <column id="stringValue" caption="msg://attribute.stringValue"/>
                                    </columns>
                                    <rows datasource="attributes"/>
                                </table>
                            </vbox>
                        </tab>
                    </tabsheet>
                </vbox>
            </split>
        </vbox>
    </layout>
</window>
