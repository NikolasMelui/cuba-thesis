<!--
  ~ Copyright (c) 2011 Haulmont Technology Ltd. All Rights Reserved.
  ~ Haulmont Technology proprietary and confidential.
  ~ Use is subject to license terms.
  -->

<window
        xmlns="http://www.haulmont.com/schema/cuba/gui/window.xsd"
        datasource="userDs"
        caption="msg://caption"
        class="com.haulmont.cuba.gui.app.security.user.edit.UserEditor"
        messagesPack="com.haulmont.cuba.gui.app.security.user.edit"
        >

    <companions>
        <web class="com.haulmont.cuba.web.app.ui.security.user.UserEditorCompanion"/>
    </companions>

    <dsContext>
        <datasource
                id="userDs"
                class="com.haulmont.cuba.security.entity.User"
                view="user.edit">
            <collectionDatasource id="rolesDs" property="userRoles"/>
            <collectionDatasource id="substitutionsDs" property="substitutions"/>
        </datasource>
    </dsContext>

    <#assign width=250>
    <layout>
        <vbox expand="split" spacing="true">
            <fieldGroup id="fieldGroup" width="100%" datasource="userDs" collapsable="false" border="visible">
                <column flex="1" width="250px">
                    <field id="login" required="true" requiredMessage="msg://loginMsg"/>
                    <field id="passw" custom="true" visible="PersistenceHelper.isNew(param_item)"
                           caption="msg://password"/>
                    <field id="lastName"/>
                    <field id="middleName"/>
                    <field id="position"/>
                    <field id="email">
                        <validator class="com.haulmont.cuba.gui.components.validators.EmailValidator" message="msg://invalidValue"/>
                    </field>
                    <field id="ipMask"/>
                    <field id="permissionsLookupField" caption="msg://permissions" custom="true"/>
                </column>
                <column flex="3" width="250px">
                    <field id="group" required="true" requiredMessage="msg://groupMsg"/>
                    <field id="confirmPassw" custom="true" visible="PersistenceHelper.isNew(param_item)"
                           caption="msg://confirmPassword"/>
                    <field id="firstName"/>
                    <field id="name"/>
                    <field id="language" custom="true"/>
                    <field id="active"/>
                </column>
            </fieldGroup>

            <split id="split" orientation="horizontal" pos="50">
                <vbox id="roles-panel" expand="rolesTable" spacing="true" margin="false;true;false;false">
                    <label value="msg://roles" stylename="h2"/>
                    <buttonsPanel>
                        <button action="rolesTable.add" icon="icons/add.png"/>
                        <button action="rolesTable.edit" icon="icons/edit.png"/>
                        <button action="rolesTable.remove" icon="icons/remove.png"/>
                    </buttonsPanel>
                    <table id="rolesTable" editable="false">
                        <columns>
                            <column id="role" caption="msg://roleName" captionProperty="name"/>
                            <column id="role.locName" caption="msg://localizedRoleName"/>
                        </columns>
                        <rows datasource="rolesDs"/>
                    </table>
                </vbox>

                <vbox id="subst-panel" expand="substTable" spacing="true" margin="false;false;false;true">
                    <label value="msg://substUsers" stylename="h2"/>
                    <buttonsPanel>
                        <button action="substTable.add" icon="icons/add.png"/>
                        <button action="substTable.edit" icon="icons/edit.png"/>
                        <button action="substTable.remove" icon="icons/remove.png"/>
                    </buttonsPanel>
                    <table id="substTable" editable="false">
                        <columns>
                            <column id="substitutedUser.login" caption="msg://login"/>
                            <column id="substitutedUser.name" caption="msg://name"/>
                            <column id="endDate" caption="msg://endDate">
                                <formatter class="com.haulmont.cuba.gui.components.formatters.DateFormatter"
                                           format="dd/MM/yyyy"/>
                            </column>
                        </columns>
                        <rows datasource="substitutionsDs"/>
                    </table>
                </vbox>
            </split>

            <iframe id="windowActions" src="/com/haulmont/cuba/gui/edit-window.actions.xml"/>
        </vbox>
    </layout>
</window>
