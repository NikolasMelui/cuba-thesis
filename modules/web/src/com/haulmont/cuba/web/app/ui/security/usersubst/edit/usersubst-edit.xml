<window xmlns="http://www.haulmont.com/schema/cuba/gui/window.xsd"
        class="com.haulmont.cuba.web.app.ui.security.usersubst.edit.UsersubstEditor"
        messagesPack="com.haulmont.cuba.web.app.ui.security.usersubst"
        caption="msg://userSubstitution.caption"
        datasource="subst">

    <metadataContext>
        <view class="com.haulmont.cuba.security.entity.UserSubstitution" name="usersubst.edit">
            <property name="user" view="_minimal"/>
            <property name="substitutedUser" view="_minimal"/>
            <property name="endDate"/>
        </view>
    </metadataContext>

    <dsContext>
        <datasource id="subst"
                    class="com.haulmont.cuba.security.entity.UserSubstitution"
                    view="usersubst.edit"/>

        <collectionDatasource id="users" class="com.haulmont.cuba.security.entity.User" view="_minimal">
            <query>
                <![CDATA[
                select u from sec$User u where u.id <> :ds$subst.user
                ]]>
                <filter>
                    <c>u.id not in (:param$existingIds)</c>
                </filter>
            </query>

        </collectionDatasource>
    </dsContext>

    <layout expand="windowActions">
        <vbox stylename="edit-area" margin="true">
            <grid spacing="true" expandable="false">
                <columns>
                    <column flex="1"/>
                    <column flex="1"/>
                </columns>
                <rows>
                    <row>
                        <label value="msg://user"/>
                        <textField id="user" datasource="subst" property="user"
                                   required="true" editable="false" requiredMessage="msg://userMsg"/>
                    </row>
                    <row>
                        <label value="msg://substUser"/>
                        <lookupField id="substUser" datasource="subst" property="substitutedUser"
                                     required="true" optionsDatasource="users" requiredMessage="msg://substUserMsg" width="${167}"/>
                    </row>
                    <row>
                        <label value="msg://endDate"/>
                        <dateField id="endDate" datasource="subst" property="endDate" dateFormat="dd/MM/yyyy" 
                                   resolution="DAY"/>
                    </row>
                </rows>
            </grid>
        </vbox>
        <iframe id="windowActions" src="/com/haulmont/cuba/gui/edit-window.actions.xml"/>
    </layout>
</window>