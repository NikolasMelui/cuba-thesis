<window
        xmlns="http://www.haulmont.com/schema/cuba/gui/window.xsd"
        datasource="role"
        caption="msg://caption"
        class="com.haulmont.cuba.web.app.ui.security.role.edit.RoleEditor"
        messagesPack="com.haulmont.cuba.web.app.ui.security.role.edit"
        >
    <metadataContext>
        <deployViews name="/com/haulmont/cuba/web/app/ui/security/role/role.views.xml"/>
    </metadataContext>

    <dsContext>
        <datasource
                id="role"
                class="com.haulmont.cuba.security.entity.Role"
                view="_local"
                >
            <!--<collectionDatasource id="permissions" property="permissions"/>-->
        </datasource>

        <collectionDatasource
                id="entity-permissions"
                class="com.haulmont.cuba.security.entity.Permission"
                view="role.edit"
                >
            <query>select p from sec$Permission p where p.role.id = :ds$role and p.type = 20</query>
        </collectionDatasource>

        <collectionDatasource
                id="property-permissions"
                class="com.haulmont.cuba.security.entity.Permission"
                view="role.edit"
                >
            <query>select p from sec$Permission p where p.role.id = :ds$role and p.type = 30</query>
        </collectionDatasource>

        <collectionDatasource
                id="screen-permissions"
                class="com.haulmont.cuba.security.entity.Permission"
                view="role.edit"
                >
            <query>select p from sec$Permission p where p.role.id = :ds$role and p.type = 10</query>
        </collectionDatasource>

        <collectionDatasource
                id="specific-permissions"
                class="com.haulmont.cuba.security.entity.Permission"
                view="role.edit"
                >
            <query>select p from sec$Permission p where p.role.id = :ds$role and p.type = 40</query>
        </collectionDatasource>
    </dsContext>

    <layout expandLayout="true" expand="main">
        <vbox id="main" spacing="true" expand="permissions-types">
            <hbox spacing="true" margin="true" align="MIDDLE_LEFT" width="100%"  expand="spacer"
                  stylename="edit-area">
                <#assign width = 200>
                <#assign widthPPB = 120>
                <#assign widthPPBMenu = 100>
                <grid  spacing="true">
                    <columns>
                        <column/>
                        <column/>
                        <column/>
                    </columns>
                    <rows>
                        <row>
                            <label value="msg://name"/>
                            <textField id="name" datasource="role" property="name" width="${width}" required="true"
                                    requiredMessage="nameMsg"/>
                        </row>
                        <row>
                            <label value="msg://locName"/>
                            <textField id="locName" datasource="role" property="locName" width="${width}"/>
                        </row>
                    </rows>
                </grid>

                <grid  spacing="true">
                    <columns>
                        <column/>
                        <column/>
                        <column/>
                    </columns>
                    <rows>
                        <row>
                            <label value="msg://superRole"/>
                            <checkBox id="superRole" datasource="role" property="superRole"/>
                        </row>
                        <row>
                            <label value="msg://defaultRole"/>
                            <checkBox id="defaultRole" datasource="role" property="defaultRole"/>
                        </row>
                    </rows>
                </grid>

                <hbox spacing="true" id="descrBox">
                    <label value="msg://description"/>
                    <textField id="description" datasource="role" property="description" rows="4" width="300px"/>
                </hbox>

                <vbox id="spacer"/>
            </hbox>

            <tabsheet id="permissions-types">
                <tab id="screen-permissions-tab" caption="msg://screen-permissions">
                    <vbox expand="screen-permissions" margin="true">
                        <hbox margin="true" spacing="true">
                            <popupButton id="screen-permissions-grant" icon="icons/add.png" caption="msg://permissions.grant"
                                         width="${widthPPB}" menuWidth="${widthPPBMenu}"/>
                            <button id="screen-permissions-remove" action="screen-permissions.remove"
                                    caption="msg://permissions.remove" icon="icons/remove.png"/>
                        </hbox>
                        <table id="screen-permissions">
                            <columns>
                                <column id="target" caption="msg://target"/>
                                <column id="value" caption="msg://value"/>
                            </columns>
                            <rows datasource="screen-permissions"/>
                        </table>
                    </vbox>
                </tab>
                <tab id="entity-permissions-tab" caption="msg://entity-permissions" lazy="true">
                    <vbox expand="entity-permissions" margin="true">
                        <hbox margin="true" spacing="true">
                            <popupButton id="entity-permissions-grant" icon="icons/add.png" caption="msg://permissions.grant"
                                         width="${widthPPB}" menuWidth="${widthPPBMenu}"/>
                            <button id="entity-permissions-remove" action="entity-permissions.remove"
                                    caption="msg://permissions.remove" icon="icons/remove.png"/>
                        </hbox>
                        <table id="entity-permissions">
                            <columns>
                                <column id="target" caption="msg://target"/>
                                <column id="value" caption="msg://value"/>
                            </columns>
                            <rows datasource="entity-permissions"/>
                        </table>
                    </vbox>
                </tab>
                <tab id="property-permissions-tab" caption="msg://property-permissions" lazy="true">
                    <vbox expand="property-permissions" margin="true">
                        <hbox margin="true" spacing="true">
                            <popupButton id="property-permissions-grant" icon="icons/add.png" caption="msg://permissions.grant"
                                         width="${widthPPB}" menuWidth="${widthPPBMenu}"/>
                            <button id="property-permissions-remove" action="property-permissions.remove"
                                    caption="msg://permissions.remove" icon="icons/remove.png"/>
                        </hbox>
                        <table id="property-permissions">
                            <columns>
                                <column id="target" caption="msg://target"/>
                                <column id="value" caption="msg://value"/>
                            </columns>
                            <rows datasource="property-permissions"/>
                        </table>
                    </vbox>
                </tab>
                <tab id="specific-permissions-tab" caption="msg://specific-permissions" lazy="true">
                    <vbox expand="specific-permissions" margin="true">
                        <hbox margin="true" spacing="true">
                            <popupButton id="specific-permissions-grant" icon="icons/add.png" caption="msg://permissions.grant"
                                         width="${widthPPB}" menuWidth="${widthPPBMenu}"/>
                            <button id="specific-permissions-remove" action="specific-permissions.remove"
                                    caption="msg://permissions.remove" icon="icons/remove.png"/>
                        </hbox>
                        <table id="specific-permissions">
                            <columns>
                                <column id="target" caption="msg://target"/>
                                <column id="value" caption="msg://value"/>
                            </columns>
                            <rows datasource="specific-permissions"/>
                        </table>
                    </vbox>
                </tab>
            </tabsheet>
        </vbox>
        <iframe id="windowActions" src="/com/haulmont/cuba/gui/edit-window.actions.xml"/>
    </layout>
</window>
