<window
        xmlns="http://www.haulmont.com/schema/cuba/gui/window.xsd"
        class="com.haulmont.cuba.web.app.ui.security.user.browse.UserLookup"
        lookupComponent="users"
        caption="msg://caption"
        messagesPack="com.haulmont.cuba.web.app.ui.security.user.browse"
        >
    <dsContext>
        <collectionDatasource
                id="users"
                class="com.haulmont.cuba.security.entity.User"
                view="user.browse"
                >
            <query><![CDATA[
                select u from sec$User u
                ]]>
            </query>
        </collectionDatasource>
    </dsContext>

    <layout >
        <vbox expand="table-panel" spacing="true">
            <vbox expand="genericFilter" stylename="edit-area">
                <filter id="genericFilter" datasource="users">
                    <properties include=".*" exclude="(password)|(loginLowerCase)"/>
                    <custom name="customByGroup" caption="msg://genericFilter.customByGroup"
                            join="left join u.group.hierarchyList h" paramClass="com.haulmont.cuba.security.entity.Group">
                        (h.parent.id = ? or h.group.id = ?) or (u.group.id = ? and h.parent is null)
                    </custom>
                    <custom name="customByRole" caption="msg://genericFilter.customByRole"
                            join="left join u.userRoles ur" paramClass="com.haulmont.cuba.security.entity.Role">
                        (ur.role.id = ?)
                    </custom>
                </filter>
            </vbox>
            <vbox id="table-panel" expand="users" spacing="true">
                <table id="users" editable="false">
                    <columns>
                        <column id="login"/>
                        <column id="name"/>
                        <column id="position"/>
                        <column id="group"/>
                        <column id="email"/>
                        <column id="active"/>
                    </columns>
                    <rows datasource="users"/>
                </table>
            </vbox>
        </vbox>
    </layout>
</window>
