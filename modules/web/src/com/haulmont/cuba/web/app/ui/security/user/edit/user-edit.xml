<window
        xmlns="http://www.haulmont.com/schema/cuba/gui/window.xsd"
        datasource="user"
        caption="msg://caption"
        class="com.haulmont.cuba.web.app.ui.security.user.edit.UserEditor"
        messagesPack="com.haulmont.cuba.web.app.ui.security.user.edit"
        >
    <dsContext>
        <datasource
                id="user"
                class="com.haulmont.cuba.security.entity.User"
                view="user.edit">
            <collectionDatasource id="roles" property="userRoles"/>
            <collectionDatasource id="substitutions" property="substitutions"/>
        </datasource>

        <collectionDatasource
                id="groups"
                class="com.haulmont.cuba.security.entity.Group"
                view="group.lookup"
                >
            <query>select g from sec$Group g</query>
        </collectionDatasource>
    </dsContext>

    <#assign width=250>
    <layout>
        <vbox expand="split" spacing="true">
            <fieldGroup id="fields" width="100%" datasource="user" collapsable="false" stylename="edit-area">
                <column flex="1" width="250px">
                    <field id="login" required="true" requiredMessage="msg://loginMsg"/>
                    <field id="passw" custom="true" visible="PersistenceHelper.isNew(param_item)"
                           caption="msg://password"
                           requiredMessage="msg://passwMsg"/>
                    <field id="lastName"/>
                    <field id="middleName"/>
                    <field id="position"/>
                    <field id="email">
                        <validator class="com.haulmont.cuba.gui.components.validators.EmailValidator"/>
                    </field>
                    <field id="permissionsLookupField" caption="msg://permissions" custom="true"/>
                </column>
                <column flex="3" width="250px">
                    <field id="group" required="true" requiredMessage="msg://groupMsg"/>
                    <field id="confirmPassw" custom="true" visible="PersistenceHelper.isNew(param_item)"
                           caption="msg://confirmPassword"
                           requiredMessage="msg://confirmPasswMsg"/>
                    <field id="firstName"/>
                    <field id="name"/>
                    <field id="language" custom="true"/>
                    <field id="active"/>
                </column>
            </fieldGroup>

            <split id="split" orientation="horizontal" pos="50">
                <vbox id="roles-panel" expand="roles" spacing="true" margin="false;true;false;false">
                    <label value="msg://roles" stylename="h2"/>
                    <buttonsPanel>
                        <button action="roles.add" icon="icons/add.png"/>
                        <button action="roles.edit" icon="icons/edit.png"/>
                        <button action="roles.remove" icon="icons/remove.png"/>
                    </buttonsPanel>
                    <table id="roles" editable="false">
                        <columns>
                            <column id="role" caption="msg://roleName" captionProperty="name"/>
                            <column id="role.locName" caption="msg://localizedRoleName"/>
                        </columns>
                        <rows datasource="roles"/>
                    </table>
                </vbox>

                <vbox id="subst-panel" expand="subst" spacing="true" margin="false;false;false;true">
                    <label value="msg://substUsers" stylename="h2"/>
                    <buttonsPanel>
                        <button action="subst.add" icon="icons/add.png"/>
                        <button action="subst.edit" icon="icons/edit.png"/>
                        <button action="subst.remove" icon="icons/remove.png"/>
                    </buttonsPanel>
                    <table id="subst" editable="false">
                        <columns>
                            <column id="substitutedUser.login" caption="msg://login"/>
                            <column id="substitutedUser.name" caption="msg://name"/>
                            <column id="endDate" caption="msg://endDate">
                                <formatter class="com.haulmont.cuba.gui.components.formatters.DateFormatter"
                                           format="dd/MM/yyyy"/>
                            </column>
                        </columns>
                        <rows datasource="substitutions"/>
                    </table>
                </vbox>
            </split>

            <iframe id="windowActions" src="/com/haulmont/cuba/gui/edit-window.actions.xml"/>
        </vbox>
    </layout>
</window>
