<window
        xmlns="http://www.haulmont.com/schema/cuba/gui/window.xsd"
        datasource="user"
        caption="msg://caption"
        class="com.haulmont.cuba.web.app.ui.security.user.edit.UserEditor"
        messagesPack="com.haulmont.cuba.web.app.ui.security.user.edit"
        >
    <metadataContext>
        <deployViews name="/com/haulmont/cuba/web/app/ui/security/user/user.views.xml"/>
        <deployViews name="/com/haulmont/cuba/web/app/ui/security/group/group.views.xml"/>
    </metadataContext>

    <dsContext>
        <datasource
                id="user"
                class="com.haulmont.cuba.security.entity.User"
                view="user.edit">
            <collectionDatasource id="roles" property="userRoles"/>
        </datasource>

        <collectionDatasource
                id="groups"
                class="com.haulmont.cuba.security.entity.Group"
                view="group.lookup"
                >
            <query>select g from sec$Group g</query>
        </collectionDatasource>

        <!--<collectionDatasource-->
                <!--id="roles"-->
                <!--class="com.haulmont.cuba.security.entity.UserRole"-->
                <!--view="user.edit"-->
                <!-->-->
            <!--<query>select r from sec$UserRole r where r.user.id=:ds$user</query>-->
        <!--</collectionDatasource>-->
    </dsContext>

    <layout>
        <vbox expand="table-panel" spacing="true">
            <hbox stylename="edit-area" spacing="true" margin="true">
                <grid spacing="true">
                    <columns>
                        <column flex="1"/>
                        <column flex="1"/>
                    </columns>
                    <rows>
                        <row align="MIDDLE_RIGHT" spacing="true">
                            <vbox align="MIDDLE_RIGHT">
                                <label value="msg://login"/>
                            </vbox>
                            <textField id="login" datasource="user" property="login" width="300px"/>
                        </row>
                        <row visible="return PersistenceHelper.isNew(param$item)">
                            <vbox align="MIDDLE_RIGHT">
                                <label id="passwLab" value="msg://password" align="MIDDLE_RIGHT"/>
                            </vbox>
                            <textField id="passw" secret="true" width="300px"/>
                        </row>
                        <row visible="return PersistenceHelper.isNew(param$item)">
                            <vbox align="MIDDLE_RIGHT">
                                <label id="confirmPasswLab" value="msg://confirmPassword"/>
                            </vbox>
                            <textField id="confirmPassw" secret="true" width="300px"/>
                        </row>
                        <row>
                            <vbox align="MIDDLE_RIGHT">
                                <label value="msg://name" align="MIDDLE_RIGHT"/>
                            </vbox>
                            <textField id="name" datasource="user" property="name" width="300px"/>
                        </row>
                        <row>
                            <vbox align="MIDDLE_RIGHT">
                                <label value="msg://email" align="MIDDLE_RIGHT"/>
                            </vbox>
                            <textField id="email" datasource="user" property="email" width="300px">
                                <validator
                                        class="com.haulmont.cuba.gui.components.validators.EmailValidator"
                                        message="msg://com.haulmont.cuba.web.app.ui.security.user.edit/email.alert"/>
                            </textField>
                        </row>
                        <row>
                            <vbox align="MIDDLE_RIGHT">
                                <label value="msg://group" align="MIDDLE_RIGHT"/>
                            </vbox>
                            <lookupField id="group" datasource="user" property="group" captionProperty="name"
                                         optionsDatasource="groups" width="300px"/>
                        </row>
                    </rows>
                </grid>
            </hbox>

            <vbox id="table-panel" expand="roles" spacing="true">
            <hbox align="MIDDLE_LEFT">
                    <button action="roles.include"/>
                    <button action="roles.remove"/>
            </hbox>    
            <table id="roles" editable="false">
                <columns>
                    <column id="role" caption="Role" captionProperty="name" clickAction="open:sec$Role.edit"/>
                </columns>
                <rows datasource="roles"/>
            </table>
            </vbox>

            <iframe id="windowActions" src="/com/haulmont/cuba/gui/edit-window.actions.xml"/>
        </vbox>
    </layout>
</window>
