<window
        xmlns="http://www.haulmont.com/schema/cuba/gui/window.xsd"
        class="com.haulmont.cuba.web.app.ui.security.user.browse.UserBrowser"
        lookupComponent="users"
        caption="msg://caption"
        >
    <metadataContext>
        <deployViews name="/com/haulmont/cuba/web/app/ui/security/user/user.views.xml"/>
        <deployViews name="/com/haulmont/cuba/web/app/ui/security/group/group.views.xml"/>
    </metadataContext>

    <dsContext>
        <collectionDatasource
                id="users"
                class="com.haulmont.cuba.security.entity.User"
                view="user.browse"
                >
            <query><![CDATA[
                select u from sec$User u
                ]]>
                <filter>
                    <and>
                        <c>u.name like :(?i)component$filter.name</c>
                        <c>u.login like :component$filter.login</c>
                        <c>u.email = :component$filter.email</c>
                        <c join="left join u.group.hierarchyList h">
                            (h.parent.id = :component$filter.group or h.group.id = :component$filter.group)
                                or (u.group.id = :component$filter.group and h.parent is null)
                        </c>
                    </and>
                </filter>
            </query>
        </collectionDatasource>
    </dsContext>

    <layout >
        <vbox expand="table-panel" spacing="true">
            <iframe id="filter" src="/com/haulmont/cuba/web/app/ui/security/user/browse/user-browse-filter.xml"/>
            <vbox id="table-panel" expand="users" spacing="true">
                <hbox align="MIDDLE_LEFT" spacing="true" margin="true">
                    <button action="users.create" icon="icons/create.png"/>
                    <button action="users.edit" icon="icons/edit.png"/>
                    <button action="users.remove" icon="icons/remove.png"/>
                    <button action="users.changePassw"/>
                    <button action="users.print" icon="icons/print.png"/>
                    <button action="users.excel" icon="icons/excel.png"/>
                </hbox>
                <table id="users" editable="false">
                    <columns>
                        <column id="login" caption="msg://login" clickAction="open:sec$User.edit"/>
                        <column id="name" caption="msg://name"/>
                        <column id="email" caption="msg://email"/>
                    </columns>
                    <rows datasource="users"/>
                </table>
            </vbox>
        </vbox>
    </layout>
</window>
