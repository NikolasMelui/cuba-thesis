<?xml version='1.0' encoding='UTF-8'?>
<!-- This document was created with Syntext Serna Free. --><!DOCTYPE book PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN" "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" []>
<book id="platform" lang="ru">
  <bookinfo>
    <copyright>
      <year>2012</year>
      <holder>Haulmont (<ulink url="http://www.haulmont.ru/">www.haulmont.ru</ulink>)</holder>
    </copyright>
    <title>Платформа <trademark>CUBA</trademark>. Руководство по разработке приложений</title>
  </bookinfo>
  <preface lang="ru">
    <title>Предисловие</title>
    <section id="appointment_id">
      <title>Назначение</title>
      <para>Данное руководство содержит информацию, необходимую для разработки <firstterm>бизнес-приложений</firstterm> на  платформе <trademark>CUBA</trademark>. Под бизнес-приложениями здесь понимается широкий спектр информационных систем, предназначенных для поддержки деятельности предприятия, управления и принятия решений. </para>
    </section>
    <section>
      <title>Целевая аудитория</title>
      <para>Данное Руководство предназначено для разработчиков, создающих бизнес-приложения с помощью платформы <trademark>CUBA</trademark>. Для успешной работы требуется знание следующих технологий:

<itemizedlist>
          <listitem>
            <para>Java Standard Edition</para>
          </listitem>
          <listitem>
            <para>XML</para>
          </listitem>
          <listitem>
            <para>Реляционные базы данных (SQL, DDL)</para>
          </listitem>
        </itemizedlist></para>
      <para>Для глубокого понимания принципов работы платформы полезным является знакомство со  следующими технологиями и фреймворками:</para>
      <itemizedlist>
        <listitem>
          <para>Spring Framework</para>
        </listitem>
        <listitem>
          <para>Java Persistence API, Apache OpenJPA</para>
        </listitem>
        <listitem>
          <para>Vaadin Framework</para>
        </listitem>
        <listitem>
          <para>HTML / CSS / JavaScript</para>
        </listitem>
        <listitem>
          <para>Java Servlets</para>
        </listitem>
        <listitem>
          <para>Java Swing</para>
        </listitem>
      </itemizedlist>
    </section>
    <section>
      <title>Структура руководства</title>
      <para>Данное Руководство состоит из следующих глав.</para>
      <para><link linkend="chapter_introduction">
          <emphasis role="bold">Глава 1. Введение</emphasis>
        </link></para>
      <para>Во вводной главе приводятся  сведения о назначении и возможностях платформы <trademark>CUBA</trademark>.</para>
      <para><link linkend="chapter_setup">
          <emphasis role="bold">Глава 2. Установка и настройка инструментария</emphasis>
        </link></para>
      <para>В данной главе приводится список программного обеспечения, необходимого для создания приложений на основе платформы <trademark>CUBA</trademark>. Приведены инструкции по установке и настройке инструментов.</para>
      <para><link linkend="chapter_quickStart">
          <emphasis role="bold">Глава 3. Быстрый старт</emphasis>
        </link></para>
      <para>В данной главе приведен пример  создания простого приложения на основе платформы. Информация изложена в краткой форме.</para>
      <para><link linkend="chapter_framework">
          <emphasis role="bold">Глава 4. Устройство платформы</emphasis>
        </link></para>
      <para>Данная глава содержит подробное описание архитектуры, компонентов и механизмов платформы.</para>
      <para><link linkend="chapter_development">
          <emphasis role="bold">Глава 5. Разработка приложений</emphasis>
        </link></para>
      <para>Данная глава содержит практическую информацию по  созданию приложений на основе платформы.</para>
      <para><link linkend="chapter_deployment">
          <emphasis role="bold">Глава 6. Развертывание приложений</emphasis>
        </link></para>
      <para>В данной главе содержится информация о развертывании приложений в различной конфигурации.</para>
    </section>
    <section id="additional_info">
      <title>Дополнительные материалы</title>
      <para>Настоящее Руководство, а также другая документация по платформе <trademark>CUBA</trademark>, доступны по адресу <ulink url="http://docs.haulmont.com/cuba/">http://docs.haulmont.com/cuba/</ulink></para>
      <para>Ниже приведен список источников дополнительной информации по <application>Spring Framework</application>, <application>OpenJPA</application>, <application>Vaadin</application>: </para>
      <para><itemizedlist>
          <listitem>
            <para><ulink url="http://static.springsource.org/spring/docs/3.1.x/spring-framework-reference">http://static.springsource.org/spring/docs/3.1.x/spring-framework-reference</ulink></para>
          </listitem>
          <listitem>
            <para><ulink url="http://openjpa.apache.org/documentation.html">http://openjpa.apache.org/documentation.html</ulink></para>
          </listitem>
          <listitem>
            <para><ulink url="https://vaadin.com/book">https://vaadin.com/book</ulink></para>
          </listitem>
        </itemizedlist></para>
    </section>
    <section>
      <title>Обратная связь</title>
      <para>Если  у Вас имеются предложения по улучшению данного руководства, пожалуйста, обратитесь в службу поддержки по электронной почте <email>cuba@haulmont.com</email>. В теме письма укажите тег <code>[Documentation]</code>.</para>
      <para>Если Вы обнаружили ошибку, укажите, пожалуйста, номер главы и приведите небольшой участок окружающего текста для облегчения поиска. </para>
    </section>
  </preface>
  <xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="chapter_introduction.xml" encoding="UTF-8"/>
  <xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="chapter_setup.xml" encoding="UTF-8"/>
  <xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="chapter_quick_start.xml" encoding="UTF-8"/>
  <xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="chapter_framework.xml" encoding="UTF-8"/>
  <xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="chapter_development.xml" encoding="UTF-8"/>
  <xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="chapter_deployment.xml" encoding="UTF-8"/>
  <appendix>
    <title>Описание конфигурационных файлов</title>
    <section id="context.xml">
      <title>context.xml</title>
      <para>Файл <filename>context.xml</filename> является дескриптором развертывания приложения на сервере <application>Apache Tomcat</application>. В развернутом приложении этот файл располагается  в подкаталоге <filename>META-INF</filename> каталога веб-приложения или WAR-файла, например <filename>tomcat/webapps/app-core/META-INF/context.xml</filename>. В проекте файлы данного типа находятся в каталогах <filename>/web/META-INF</filename> модулей <structname>core</structname>, <structname>web</structname>, <structname>portal</structname>.</para>
      <para>Основное предназначение файла для блока <structname>Middleware</structname> - определить источник данных и поместить его в JNDI под именем, заданным свойством приложения <property>
          <link linkend="cuba.dataSourceJndiName">cuba.dataSourceJndiName</link>
        </property>.</para>
      <para>Пример определения источника данных для <application>PostgreSQL</application>:<programlisting>&lt;Resource
    name=&quot;jdbc/CubaDS&quot;
    type=&quot;javax.sql.DataSource&quot;
    maxActive=&quot;20&quot;
    maxIdle=&quot;2&quot;
    maxWait=&quot;5000&quot;
    driverClassName=&quot;org.postgresql.Driver&quot;
    username=&quot;cuba&quot;
    password=&quot;cuba&quot;
    url=&quot;jdbc:postgresql://localhost/sales&quot;/&gt;</programlisting></para>
      <para>Пример определения источника данных для <application>Microsoft SQL Server</application>:<programlisting>&lt;Resource
    name=&quot;jdbc/CubaDS&quot;
    type=&quot;javax.sql.DataSource&quot;
    maxActive=&quot;20&quot;
    maxIdle=&quot;2&quot;
    maxWait=&quot;5000&quot;
    driverClassName=&quot;net.sourceforge.jtds.jdbc.Driver&quot;
    username=&quot;sa&quot;
    password=&quot;saPass1&quot;
    url=&quot;jdbc:jtds:sqlserver://localhost/sales&quot;/&gt;</programlisting></para>
      <para>Для всех <link linkend="app_tiers">блоков</link>, являющихся веб-приложениями, данный файл может содержать код, отключающий сериализацию HTTP-сессий:<programlisting>&lt;Manager className=&quot;org.apache.catalina.session.PersistentManager&quot; debug=&quot;0&quot; distributable=&quot;false&quot;
         saveOnRestart=&quot;false&quot;&gt;
    &lt;Store className=&quot;org.apache.catalina.session.FileStore&quot;/&gt;
&lt;/Manager&gt;</programlisting></para>
    </section>
    <section id="datatypes.xml">
      <title>datatypes.xml</title>
      <para>Файл <filename>datatypes.xml</filename> определяет доступные типы данных атрибутов сущностей, см. <xref linkend="datatype"/></para>
      <para>Файл по умолчанию расположен в пакете <code>com.haulmont.chile.core.datatypes</code> <link linkend="base_projects">базового проекта</link> <structname>cuba</structname>. Если в прикладном проекте в <link linkend="app_modules">модуле</link> <structname>global</structname> создать аналогичный файл в корне CLASSPATH, то  типы данных будут загружены  из него.</para>
      <warning>
        <para>Механизм загрузки не поддерживает расширение, т.е. все типы данных загружаются из одного файла - либо из корня CLASSPATH, либо из пакета  <code>com.haulmont.chile.core.datatypes</code>.</para>
      </warning>
      <para>Доступные типы данных описываются в элементах <sgmltag>datatype</sgmltag>. Обязательным атрибутом является только class, в котором указывается класс типа данных, реализующий интерфейс <code>Datatype</code>. Набор остальных атрибутов зависит от класса, объекту которого при создании передается соответствующий XML элемент, и разбор атрибутов происходит в этом классе.</para>
      <para>Типичные атрибуты:<itemizedlist>
          <listitem>
            <para><sgmltag>format</sgmltag> - формат преобразования в строку без учета локали</para>
          </listitem>
          <listitem>
            <para><sgmltag>groupingSeparator</sgmltag> - символ-разделитель групп разрядов числа при форматировании без учета локали</para>
          </listitem>
          <listitem>
            <para><sgmltag>decimalSeparator</sgmltag> - символ-разделитель целой и дробной части числа при форматировании без учета локали</para>
          </listitem>
        </itemizedlist></para>
      <para>Пример:<programlisting>&lt;datatypes&gt;

    &lt;datatype class=&quot;com.haulmont.chile.core.datatypes.impl.BooleanDatatype&quot;/&gt;

    &lt;datatype class=&quot;com.haulmont.chile.core.datatypes.impl.IntegerDatatype&quot;
              format=&quot;0&quot; groupingSeparator=&quot;&quot;/&gt;

    &lt;datatype class=&quot;com.haulmont.chile.core.datatypes.impl.LongDatatype&quot;
              format=&quot;0&quot; groupingSeparator=&quot;&quot;/&gt;

    &lt;datatype class=&quot;com.haulmont.chile.core.datatypes.impl.DoubleDatatype&quot;
              format=&quot;0.###&quot; decimalSeparator=&quot;.&quot; groupingSeparator=&quot;&quot;/&gt;

    &lt;datatype class=&quot;com.haulmont.chile.core.datatypes.impl.BigDecimalDatatype&quot;
              format=&quot;0.####&quot; decimalSeparator=&quot;.&quot; groupingSeparator=&quot;&quot;/&gt;

    &lt;datatype class=&quot;com.haulmont.chile.core.datatypes.impl.StringDatatype&quot;/&gt;

    &lt;datatype class=&quot;com.haulmont.chile.core.datatypes.impl.DateTimeDatatype&quot;
              format=&quot;yyyy-MM-dd&apos;T&apos;HH:mm:ss.SSS&quot;/&gt;

    &lt;datatype class=&quot;com.haulmont.chile.core.datatypes.impl.DateDatatype&quot;
              format=&quot;yyyy-MM-dd&quot;/&gt;

    &lt;datatype class=&quot;com.haulmont.chile.core.datatypes.impl.TimeDatatype&quot;
              format=&quot;HH:mm:ss&quot;/&gt;

    &lt;datatype class=&quot;com.haulmont.chile.core.datatypes.impl.UUIDDatatype&quot;/&gt;

    &lt;datatype class=&quot;com.haulmont.chile.core.datatypes.impl.ByteArrayDatatype&quot;/&gt;

&lt;/datatypes&gt;</programlisting></para>
    </section>
    <section id="metadata.xml">
      <title>metadata.xml</title>
      <para>Файлы данного типа используются для регистрации неперсистентных сущностей и присвоения <link linkend="meta_annotations">мета-аннотаций</link>, см. <xref linkend="metadata_framework"/></para>
      <para>Схема XML доступна по адресу <ulink url="http://schemas.haulmont.com/cuba/4.0/metadata.xsd">http://schemas.haulmont.com/cuba/4.0/metadata.xsd</ulink></para>
      <para>Набор файлов <filename>metadata.xml</filename>, включая определенные в <link linkend="base_projects">базовых проектах</link>, задается в свойстве приложения <property>
          <link linkend="cuba.metadataConfig">cuba.metadataConfig</link>
        </property>. </para>
      <para>Рассмотрим структуру файла.</para>
      <para><sgmltag>metadata</sgmltag> - корневой элемент</para>
      <para>Элементы <sgmltag>metadata</sgmltag>:<itemizedlist>
          <listitem>
            <para><sgmltag>metadata-model</sgmltag> - корень элементов регистрации неперсистентных сущностей</para>
            <para>Элементы <sgmltag>
                <sgmltag>metadata-model</sgmltag>
              </sgmltag>:<itemizedlist>
                <listitem>
                  <para><sgmltag>class</sgmltag> - класс неперсистентной сущности</para>
                </listitem>
              </itemizedlist></para>
          </listitem>
          <listitem>
            <para><sgmltag>annotations</sgmltag> - корень элементов присвоения <link linkend="meta_annotations">мета-аннотаций</link> сущностей</para>
            <para>Элементы <sgmltag>annotations</sgmltag>:<itemizedlist>
                <listitem>
                  <para><sgmltag>entity</sgmltag> - элемент сущности, которой присваиваются мета-аннотации</para>
                  <para>Атрибуты entity:<itemizedlist>
                      <listitem>
                        <para><sgmltag>class</sgmltag> - класс сущности</para>
                      </listitem>
                    </itemizedlist></para>
                  <para>Элементы <sgmltag>entity</sgmltag>:<itemizedlist>
                      <listitem>
                        <para><sgmltag>annotation</sgmltag> - элемент мета-аннотации</para>
                        <para>Атрибуты <sgmltag>annotation</sgmltag>:<itemizedlist>
                            <listitem>
                              <para><sgmltag>name</sgmltag> - имя мета-аннотации</para>
                            </listitem>
                            <listitem>
                              <para><sgmltag>value</sgmltag> - значение мета-аннотации</para>
                            </listitem>
                          </itemizedlist></para>
                      </listitem>
                    </itemizedlist></para>
                </listitem>
              </itemizedlist></para>
          </listitem>
        </itemizedlist></para>
      <para>Пример:<programlisting>&lt;metadata xmlns=&quot;http://schemas.haulmont.com/cuba/4.0/metadata.xsd&quot;&gt;

    &lt;metadata-model&gt;
        &lt;class&gt;com.haulmont.refapp.core.entity.TransientDriver&lt;/class&gt;
        &lt;class&gt;com.haulmont.refapp.core.entity.UserContainer&lt;/class&gt;
    &lt;/metadata-model&gt;

    &lt;annotations&gt;
        &lt;entity class=&quot;com.haulmont.refapp.core.entity.Driver&quot;&gt;
            &lt;annotation name=&quot;com.haulmont.cuba.core.entity.annotation.TrackEditScreenHistory&quot; 
                        value=&quot;true&quot;/&gt;
            &lt;annotation name=&quot;com.haulmont.cuba.core.entity.annotation.EnableRestore&quot; 
                        value=&quot;true&quot;/&gt;
        &lt;/entity&gt;

        &lt;entity class=&quot;com.haulmont.refapp.core.entity.Doc&quot;&gt;
            &lt;annotation name=&quot;com.haulmont.cuba.core.entity.annotation.ExtendedBy&quot;
                        value=&quot;com.haulmont.refapp.core.entity.ExtDoc&quot;/&gt;
        &lt;/entity&gt;

        &lt;entity class=&quot;com.haulmont.refapp.core.entity.ExtDoc&quot;&gt;
            &lt;annotation name=&quot;com.haulmont.cuba.core.entity.annotation.Extends&quot;
                        value=&quot;com.haulmont.refapp.core.entity.Doc&quot;/&gt;
        &lt;/entity&gt;
    &lt;/annotations&gt;

&lt;/metadata&gt;</programlisting></para>
    </section>
    <section id="persistence.xml">
      <title>persistence.xml</title>
      <para>Файлы данного типа являются стандартными для JPA и используются для регистрации персистентных сущностей и задания параметров функционирования фреймворка <link linkend="orm">ORM</link>.</para>
      <para>Набор файлов <filename>persistence.xml</filename>, включая определенные в <link linkend="base_projects">базовых проектах</link>, задается в свойстве приложения <property>
          <link linkend="cuba.persistenceConfig">cuba.persistenceConfig</link>
        </property>. </para>
      <para>На старте блока <structname>Middleware</structname> из заданных файлов собирается один <filename>persistence.xml</filename> и сохраняется в <link linkend="work_dir">рабочем каталоге</link> приложения. Параметры ORM могут переопределяться каждым следующим файлом списка, поэтому порядок указания файлов важен. Существует несколько параметры, жестко определяемые типом используемой СУБД (заданным в <property>
          <link linkend="cuba.dbmsType">cuba.dbmsType</link>
        </property>), которые невозможно переопределить в <filename>persistence.xml</filename>, это:<itemizedlist>
          <listitem>
            <para><literal>openjpa.jdbc.DBDictionary</literal></para>
          </listitem>
          <listitem>
            <para><literal>openjpa.jdbc.MappingDefaults</literal></para>
          </listitem>
        </itemizedlist>Кроме того, при выключенном свойстве приложения <property>
          <link linkend="cuba.disableOrmXmlGeneration">cuba.disableOrmXmlGeneration</link>
        </property> и наличии <link linkend="extension">расширенных сущностей</link> на старте приложения в рабочем каталоге создается файл <filename>orm.xml</filename> и путь к нему записывается в параметр <literal>openjpa.MetaDataFactory</literal>. В этом случае параметр <literal>openjpa.MetaDataFactory</literal> также нельзя задать в <filename>persistence.xml</filename> заранее. </para>
      <para>Пример:<programlisting>&lt;persistence xmlns=&quot;http://java.sun.com/xml/ns/persistence&quot; version=&quot;1.0&quot;&gt;
    &lt;persistence-unit name=&quot;sales&quot; transaction-type=&quot;RESOURCE_LOCAL&quot;&gt;
        &lt;class&gt;com.sample.sales.entity.Customer&lt;/class&gt;
        &lt;class&gt;com.sample.sales.entity.Order&lt;/class&gt;
    &lt;/persistence-unit&gt;
&lt;/persistence&gt;</programlisting></para>
    </section>
    <section id="remoting-spring.xml">
      <title>remoting-spring.xml</title>
      <para>Файлы данного типа определяют конфигурацию дополнительного контейнера <application>Spring Framework</application> для блока <structname>Middleware</structname>, который предназначен для экспорта сервисов и других компонентов среднего слоя, доступных клиентскому уровню (далее <firstterm>контейнер удаленного доступа</firstterm>). </para>
      <para>Набор файлов <filename>remoting-spring.xml</filename>, включая определенные в <link linkend="base_projects">базовых проектах</link>, задается в свойстве приложения <property>
          <link linkend="cuba.remotingSpringContextConfig">cuba.remotingSpringContextConfig</link>
        </property>. Последовательность перечисления файлов важна, так как каждый последующий файл может переопределять конфигурацию бинов, заданную в предыдущих файлах.</para>
      <para>Контейнер удаленного доступа создается таким образом, что основной контейнер (конфигурируемый файлами <filename>
          <link linkend="spring.xml">spring.xml</link>
        </filename>) является родительским по отношению к нему. Это означает, что бины контейнера удаленного доступа могут обращаться к бинам основного контейнера, а бины основного контейнера &quot;не видят&quot; контейнер удаленного доступа.</para>
      <para>Основная задача контейнера удаленного доступа - сделать сервисы <structname>Middleware</structname> доступными клиентскому уровню с помощью механизма <application>Spring HttpInvoker</application>. Для этого в <filename>cuba-remoting-spring.xml</filename> базового проекта <structname>cuba</structname> определяется бин <literal>servicesExporter</literal> типа <code>RemoteServicesBeanCreator</code>, который получает из основного контейнера все классы сервисов и экспортирует их. В дополнение к обычным аннотированным сервисам контейнер удаленного доступа экспортирует некоторые специфические бины, такие как <code>LoginService</code>.</para>
      <para>Кроме того, <filename>cuba-remoting-spring.xml</filename> определяет базовый пакет, начиная с которого производится поиск аннотированных классов контроллеров <application>Spring MVC</application>, используемых для загрузки-выгрузки файлов.</para>
      <para>В прикладном проекте определять файл типа <filename>remoting-spring.xml</filename> необходимо только в том случае, если создаются специфические контроллеры <application>Spring MVC</application>. Сервисы прикладного проекта в любом случае будут импортированы стандартным бином <literal>servicesExporter</literal>, определенным в базовом проекте <structname>cuba</structname>.</para>
    </section>
    <section id="spring.xml">
      <title>spring.xml</title>
      <para>Файлы данного типа определяют конфигурацию основного контейнера <application>Spring Framework</application> для каждого <link linkend="app_tiers">блока приложения</link>. </para>
      <para>Набор файлов <filename>spring.xml</filename>, включая определенные в <link linkend="base_projects">базовых проектах</link>, задается в свойстве приложения <property>
          <link linkend="cuba.springContextConfig">cuba.springContextConfig</link>
        </property>. Последовательность перечисления файлов важна, так как каждый последующий файл может переопределять конфигурацию бинов, заданную в предыдущих файлах.</para>
      <para>Основная часть конфигурирования контейнера возложена на аннотации бинов (такие как <code>@ManagedBean</code>, <code>@Servic</code>e, <code>@Inject</code> и др.), поэтому обязательной частью <filename>spring.xml</filename> в прикладном проекте является только элемент <sgmltag>context:component-scan</sgmltag>, в котором задается базовый пакет Java, с которого начинается поиск аннотированных классов. Например:<programlisting>&lt;context:component-scan base-package=&quot;com.sample.sales&quot;/&gt;</programlisting></para>
      <para>Остальное содержимое зависит от того, для какого блока приложения конфигурируется контейнер: например, для <structname>Middleware</structname> это регистрация <link linkend="jmx_beans">JMX-бинов</link>, для блоков клиентского уровня - <link linkend="service_import">импорт сервисов</link>.</para>
    </section>
    <section id="views.xml">
      <title>views.xml</title>
      <para>Файлы данного типа используются для описания представлений, см. <xref linkend="views"/></para>
      <para>Схема XML доступна по адресу <ulink url="http://schemas.haulmont.com/cuba/4.0/view.xsd">http://schemas.haulmont.com/cuba/4.0/view.xsd</ulink></para>
      <para><sgmltag>views</sgmltag> - корневой элемент</para>
      <para>Элементы <sgmltag>views</sgmltag>:<itemizedlist>
          <listitem>
            <para><sgmltag>view</sgmltag> - описатель <code>View</code></para>
            <para>Атрибуты <sgmltag>view</sgmltag>:<itemizedlist>
                <listitem>
                  <para><sgmltag>class</sgmltag> - класс сущности</para>
                </listitem>
                <listitem>
                  <para><sgmltag>name</sgmltag> - имя представления, должно быть уникальным в пределах сущности</para>
                </listitem>
                <listitem>
                  <para><sgmltag>systemProperties</sgmltag> - признак включения системных атрибутов сущности (входящих в состав <link linkend="entity_base_classes">базовых интерфейсов</link> персистентных сущностей <code>BaseEntity</code> и  <code>Updatable</code>). Необязательный атрибут, по умолчанию <literal>false</literal>.</para>
                </listitem>
                <listitem>
                  <para><sgmltag>overwrite</sgmltag> - признак того, что данный описатель должен переопределить представление с таким же классом и именем, уже развернутое в репозитории. Необязательный атрибут, по умолчанию <literal>false</literal>.</para>
                </listitem>
                <listitem>
                  <para><sgmltag>extends</sgmltag> - указывает имя представления той же сущности, от которого нужно унаследовать атрибуты. Порядок следования описателей в файле при этом не важен. Например, при указании <literal>extends=&quot;_local&quot;</literal> в текущее представление будут включены все <link linkend="local_attribute">локальные атрибуты</link> сущности. Необязательный атрибут.</para>
                </listitem>
              </itemizedlist></para>
            <para>Элементы <sgmltag>view</sgmltag>:<itemizedlist>
                <listitem>
                  <para><sgmltag>property</sgmltag> - описатель <code>ViewProperty</code></para>
                  <para>Атрибуты <sgmltag>property</sgmltag>:<itemizedlist>
                      <listitem>
                        <para><sgmltag>name</sgmltag> - имя атрибута сущности</para>
                      </listitem>
                      <listitem>
                        <para><sgmltag>view</sgmltag> - для ссылочного атрибута указывает имя представления, с которым должна загружаться ассоциированная сущность. Порядок следования описателей в файле при этом не важен.</para>
                      </listitem>
                      <listitem>
                        <para><sgmltag>lazy</sgmltag> - для ссылочных атрибутов признак того, что данный атрибут нужно не  включать в Fetch Plan, а загружать отдельным SQL запросом, инициированным обращением к атрибуту. Необязательный атрибут, по умолчанию <literal>false</literal>.</para>
                        <para>Рекомендуется использовать <sgmltag>lazy</sgmltag> для атрибутов-коллекций, если таких атрибутов больше одного для данного графа представлениий. Т.е. устанавливайте  <literal>lazy = &quot;true&quot;</literal> для всех коллекций, кроме одной.</para>
                      </listitem>
                    </itemizedlist></para>
                  <para>Элементы <sgmltag>property</sgmltag>:<itemizedlist>
                      <listitem>
                        <para><sgmltag>property</sgmltag> - описатель атрибута связанной сущности. Таким способом можно определить неименованное представление для связанной сущности прямо внутри  текущего описателя (inline). </para>
                      </listitem>
                    </itemizedlist></para>
                </listitem>
              </itemizedlist></para>
          </listitem>
          <listitem>
            <para><sgmltag>include</sgmltag> - включение другого файла типа views.xml</para>
            <para>Атрибуты <sgmltag>include</sgmltag>:<itemizedlist>
                <listitem>
                  <para><sgmltag>file</sgmltag> - путь к файлу по правилам интерфейса <code>
                      <link linkend="resources">Resources</link>
                    </code></para>
                </listitem>
              </itemizedlist></para>
          </listitem>
        </itemizedlist></para>
      <para>Пример:<programlisting>&lt;views xmlns=&quot;http://schemas.haulmont.com/cuba/4.0/view.xsd&quot;&gt;

    &lt;view class=&quot;com.sample.sales.entity.Order&quot;
          name=&quot;orderWithCustomer&quot;
          extends=&quot;_local&quot;&gt;
        &lt;property name=&quot;customer&quot; view=&quot;_minimal&quot;/&gt;
    &lt;/view&gt;

    &lt;view class=&quot;com.sample.sales.entity.Item&quot;
          name=&quot;itemsInOrder&quot;&gt;
        &lt;property name=&quot;quantity&quot;/&gt;
        &lt;property name=&quot;product&quot; view=&quot;_minimal&quot;/&gt;
    &lt;/view&gt;

    &lt;view class=&quot;com.sample.sales.entity.Order&quot;
          name=&quot;orderWithCustomerDefinedInline&quot;
          extends=&quot;_local&quot;&gt;
        &lt;property name=&quot;customer&quot;&gt;
            &lt;property name=&quot;name&quot;/&gt;
            &lt;property name=&quot;email&quot;/&gt;
        &lt;/property&gt;
    &lt;/view&gt;

&lt;/views&gt;</programlisting></para>
      <para>См. также свойство приложения <property>
          <link linkend="cuba.viewsConfig">cuba.viewsConfig</link>
        </property></para>
    </section>
    <section id="web.xml">
      <title>web.xml</title>
      <para>Файл <filename>web.xml</filename> является стандартным дескриптором веб-приложения <application>Java EE</application>, и должен быть создан для блоков <structname>Middleware</structname>, <structname>Web Client</structname> и <structname>Web Portal</structname>.</para>
      <para>В проекте приложения файлы <filename>web.xml</filename> располагаются в каталогах <filename>web/WEB-INF</filename> соответствующих <link linkend="app_modules">модулей</link>.</para>
      <para>Рассмотрим содержимое <filename>web.xml</filename> блока <structname>Middleware</structname> (модуль <structname>core</structname> проекта):<programlisting>&lt;web-app xmlns=&quot;http://java.sun.com/xml/ns/javaee&quot;
           xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
           xsi:schemaLocation=&quot;http://java.sun.com/xml/ns/javaee
           http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd&quot;
           version=&quot;2.5&quot;&gt;

    &lt;!-- Application properties config files --&gt;
    &lt;context-param&gt;
        &lt;param-name&gt;appPropertiesConfig&lt;/param-name&gt;
        &lt;param-value&gt;
            classpath:cuba-app.properties
            classpath:sales-app.properties
            file:${catalina.home}/conf/app-core/local.app.properties
        &lt;/param-value&gt;
    &lt;/context-param&gt;

    &lt;listener&gt;
        &lt;listener-class&gt;com.haulmont.cuba.core.sys.AppContextLoader&lt;/listener-class&gt;
    &lt;/listener&gt;

    &lt;servlet&gt;
        &lt;servlet-name&gt;remoting&lt;/servlet-name&gt;
        &lt;servlet-class&gt;com.haulmont.cuba.core.sys.remoting.RemotingServlet&lt;/servlet-class&gt;
        &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;
    &lt;/servlet&gt;

    &lt;servlet-mapping&gt;
        &lt;servlet-name&gt;remoting&lt;/servlet-name&gt;
        &lt;url-pattern&gt;/remoting/*&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;

    &lt;servlet&gt;
        &lt;servlet-name&gt;restapi&lt;/servlet-name&gt;
        &lt;servlet-class&gt;com.haulmont.cuba.core.sys.restapi.RestApiServlet&lt;/servlet-class&gt;
        &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;
    &lt;/servlet&gt;

    &lt;servlet-mapping&gt;
        &lt;servlet-name&gt;restapi&lt;/servlet-name&gt;
        &lt;url-pattern&gt;/api/*&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;
&lt;/web-app&gt;</programlisting></para>
      <para>В элементах <sgmltag>context-param</sgmltag> задаются иницилизирующие параметры объекта <code>ServletContext</code> данного веб-приложения. Здесь определен параметр <literal>appPropertiesConfig</literal>, значением которого является список <link linkend="app_properties_files">файлов свойств приложения</link>.</para>
      <para>В элементе <sgmltag>listener</sgmltag> задается класс слушателя, реализующего интерфейс <code>ServletContextListener</code>. В блоке <structname>Middleware</structname> CUBA-приложения в качестве слушателя должен использоваться класс <code>AppContextLoader</code>, выполняющий инициализацию <code>
          <link linkend="appContext">AppContext</link>
        </code>.</para>
      <para>Далее следуют определения сервлетов, среди которых обязательным для <structname>Middleware</structname> является класс <code>RemotingServlet</code>, связанный с контейнером удаленного доступа (см. <xref linkend="remoting-spring.xml"/>). Данный сервлет отображен на URL <literal>/remoting/*</literal>.</para>
      <para>Рассмотрим содержимое <filename>web.xml</filename> блока <structname>Web Client</structname> (модуль <structname>web</structname> проекта):<programlisting>&lt;web-app xmlns=&quot;http://java.sun.com/xml/ns/javaee&quot;
           xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
           xsi:schemaLocation=&quot;http://java.sun.com/xml/ns/javaee
           http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd&quot;
           version=&quot;2.5&quot;&gt;

    &lt;context-param&gt;
        &lt;description&gt;Vaadin production mode&lt;/description&gt;
        &lt;param-name&gt;productionMode&lt;/param-name&gt;
        &lt;param-value&gt;false&lt;/param-value&gt;
    &lt;/context-param&gt;

    &lt;context-param&gt;
        &lt;param-name&gt;appPropertiesConfig&lt;/param-name&gt;
        &lt;param-value&gt;
            classpath:cuba-web-app.properties
            classpath:sales-web-app.properties
            file:${catalina.home}/conf/app/local.app.properties
        &lt;/param-value&gt;
    &lt;/context-param&gt;

    &lt;listener&gt;
        &lt;listener-class&gt;com.haulmont.cuba.web.sys.WebAppContextLoader&lt;/listener-class&gt;
    &lt;/listener&gt;

    &lt;servlet&gt;
        &lt;servlet-name&gt;app_servlet&lt;/servlet-name&gt;
        &lt;servlet-class&gt;com.haulmont.cuba.web.sys.CubaApplicationServlet&lt;/servlet-class&gt;
        &lt;init-param&gt;
            &lt;param-name&gt;application&lt;/param-name&gt;
            &lt;param-value&gt;com.haulmont.sales.web.App&lt;/param-value&gt;
        &lt;/init-param&gt;
        &lt;init-param&gt;
            &lt;param-name&gt;widgetset&lt;/param-name&gt;
            &lt;param-value&gt;com.haulmont.cuba.toolkit.gwt.WidgetSet&lt;/param-value&gt;
        &lt;/init-param&gt;
    &lt;/servlet&gt;

    &lt;servlet-mapping&gt;
        &lt;servlet-name&gt;app_servlet&lt;/servlet-name&gt;
        &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;

    &lt;filter&gt;
        &lt;filter-name&gt;cuba_filter&lt;/filter-name&gt;
        &lt;filter-class&gt;com.haulmont.cuba.web.sys.CubaHttpFilter&lt;/filter-class&gt;
    &lt;/filter&gt;

    &lt;filter-mapping&gt;
        &lt;filter-name&gt;cuba_filter&lt;/filter-name&gt;
        &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
    &lt;/filter-mapping&gt;

&lt;/web-app&gt;</programlisting></para>
      <para>В данном файле определены два параметра: <literal>appPropertiesConfig</literal>, значением которого является список <link linkend="app_properties_files">файлов свойств приложения</link>, и <literal>productionMode</literal>, отключающий режим отладки фреймворка <application>Vaadin</application>.</para>
      <para>В качестве <code>ServletContextListener</code> в блоке <structname>Web Client</structname> используется класс <code>WebAppContextLoader</code>.</para>
      <para>Далее определяется сервлет <code>CubaApplicationServlet</code>, входящий в состав основанной на фреймворке <application>Vaadin</application> реализации <link linkend="gui_framework">универсального пользовательского интерфейса</link>. Сервлет имеет два параметра:<itemizedlist>
          <listitem>
            <para><literal>application</literal> - задает специфический для проекта класс клиентского приложения, который должен быть наследником <code>com.haulmont.cuba.web.App</code></para>
          </listitem>
          <listitem>
            <para><literal>widgetset</literal> - задает набор <application>GWT</application> компонентов, используемых на стороне веб-браузера</para>
          </listitem>
        </itemizedlist></para>
      <para>После определения сервлетов  подключается фильтр <code>CubaHttpFilter</code>, необходимый для  функционирования блока <structname>Web Client</structname>.</para>
    </section>
  </appendix>
  <appendix id="app_properties_reference">
    <title>Описание свойств приложения</title>
    <variablelist>
      <varlistentry id="cuba.allowQueryFromSelected">
        <term>cuba.allowQueryFromSelected</term>
        <listitem>
          <para>Разрешает <link linkend="gui_Filter">универсальному фильтру</link> использовать режим последовательного наложения фильтров. См. также <xref linkend="query_from_selected"/></para>
          <para>Значение по умолчанию: <code>true</code></para>
          <para>Интерфейс: <code>GlobalConfig</code></para>
          <para>Используется в блоках <structname>Web Client</structname> и <structname>Middleware</structname>.</para>
        </listitem>
      </varlistentry>
      <varlistentry id="cuba.automaticDatabaseUpdate">
        <term>cuba.automaticDatabaseUpdate</term>
        <listitem>
          <para>Включает режим <link linkend="db_update">автоматического обновления базы данных</link> на старте приложения.</para>
          <para>Значение по умолчанию: <code>false</code></para>
          <para>Интерфейс: <code>ServerConfig</code></para>
          <para>Используется в блоке <structname>Middleware</structname>.</para>
        </listitem>
      </varlistentry>
      <varlistentry id="cuba.availableLocales">
        <term>cuba.availableLocales</term>
        <listitem>
          <para id="property_available_locales">Список поддерживаемых языков интерфейса. </para>
          <para id="property_available_locales_1">Формат свойства: <literal>{название_языка1}|{код_языка_1};{название_языка2}|{код_языка_2};</literal>... Пример: <programlisting>cuba.availableLocales=French|fr;English|en</programlisting></para>
          <para><code>{название_языка}</code> −  это название, которое будет отображаться в списках доступных языков. Например, в окне входа в систему, в экране редактирования пользователя. </para>
          <para><code>{код_языка}</code> − соответствует коду, возвращаемому методом <code>Locale.getLanguage()</code>. Используется как суффикс для формирования имен <link linkend="message_packs">файлов пакетов сообщений</link>. Например, <filename>messages_fr.properties.</filename></para>
          <para>Следует иметь в виду, что язык, который указан первым в списке языков  свойства <property>cuba.availableLocales</property>, будет отображаться первым в списке доступных языков в том случае, если среди языков данного свойства не будет найден текущий язык операционной системы пользователя. Если же язык операционной системы присутствует в списке доступных, то отображаться  первым будет он. </para>
          <para>Значение по умолчанию: <literal>English|en;Russian|ru;French|fr</literal></para>
          <para>Интерфейс: <code>GlobalConfig</code></para>
          <para>Используется во всех стандартных <link linkend="app_tiers">блоках</link>.</para>
        </listitem>
      </varlistentry>
      <varlistentry id="cuba.dataSourceJndiName">
        <term>cuba.dataSourceJndiName</term>
        <listitem>
          <para>Задает имя источника данных в JNDI.</para>
          <para>Значение по умолчанию: <literal>java:comp/env/jdbc/CubaDS</literal></para>
          <para>Используется в блоке <structname>Middleware</structname>.</para>
        </listitem>
      </varlistentry>
      <varlistentry id="cuba.dbDir">
        <term>cuba.dbDir</term>
        <listitem>
          <para>Конфигурационный параметр, задающий расположение <link linkend="db_dir">каталога скриптов базы данных</link>.</para>
          <para>Значение по умолчанию: <literal>${catalina.home}/webapps/${cuba.webContextName}/WEB-INF/db</literal>, что означает расположение в подкаталоге <filename>WEB-INF/db</filename> каталога текущего веб-приложения <application>Tomcat</application>.</para>
          <para>Интерфейс: <code>ServerConfig</code></para>
          <para>Используется в блоке <structname>Middleware</structname>.</para>
        </listitem>
      </varlistentry>
      <varlistentry id="cuba.dbmsType">
        <term>cuba.dbmsType</term>
        <listitem>
          <para>Задает тип используемой базы данных. Возможные значения соответствуют значениям перечисления <code>DbmsType</code> без учета регистра: <literal>hsql</literal>, <literal>postgres</literal>, <literal>mssql</literal>.</para>
          <para>Значение по умолчанию: <literal>hsql</literal></para>
          <para>Используется в блоке <structname>Middleware</structname>.</para>
        </listitem>
      </varlistentry>
      <varlistentry id="cuba.defaultQueryTimeoutSec">
        <term>cuba.defaultQueryTimeoutSec</term>
        <listitem>
          <para>Задает <link linkend="transaction_timeout">таймаут транзакции</link> по умолчанию.</para>
          <para>Значение по умолчанию: <literal>0</literal>, означает что таймаут отсутствует.</para>
          <para>Интерфейс: <code>ServerConfig</code></para>
          <para>Используется в блоке <structname>Middleware</structname>.</para>
        </listitem>
      </varlistentry>
      <varlistentry id="cuba.disableOrmXmlGeneration">
        <term>cuba.disableOrmXmlGeneration</term>
        <listitem>
          <para>Запрещает автоматическую генерацию файла <filename>orm.xml</filename> для <link linkend="extension">расширенных</link> сущностей. Дает возможность вручную создать такой файл и зарегистрировать в параметре <literal>openjpa.MetaDataFactory</literal> файла <filename>
              <link linkend="persistence.xml">persistence.xml</link>
            </filename>.</para>
          <para>Значение по умолчанию: <literal>false</literal>, означает что <filename>orm.xml</filename> будет создан автоматически при наличии расширенных сущностей.</para>
          <para>Используется в блоке <structname>Middleware</structname>.</para>
        </listitem>
      </varlistentry>
      <varlistentry id="cuba.groovyEvaluatorImport">
        <term>cuba.groovyEvaluatorImport</term>
        <listitem>
          <para>Задает список классов, импортируемых всеми выполняемыми через <code>
              <link linkend="scripting">Scripting</link>
            </code> выражениями на Groovy. </para>
          <para>Имена классов в списке разделяются запятой или точкой с запятой.</para>
          <para>Значение по умолчанию: <code>com.haulmont.cuba.core.global.PersistenceHelper</code></para>
          <para>Используется во всех стандартных <link linkend="app_tiers">блоках</link>.</para>
          <para>Пример:<programlisting>cuba.groovyEvaluatorImport=com.haulmont.cuba.core.global.PersistenceHelper,com.abc.sales.CommonUtils</programlisting></para>
        </listitem>
      </varlistentry>
      <varlistentry id="cuba.httpSessionExpirationTimeoutSec">
        <term>cuba.httpSessionExpirationTimeoutSec</term>
        <listitem>
          <para>Задает  таймаут бездействия HTTP-сессии
 в секундах.</para>
          <para>Значение по умолчанию: <literal>1800</literal></para>
          <para>Интерфейс: <code>WebConfig</code></para>
          <para>Используется в блоке <structname>Web Client</structname>.</para>
          <tip>
            <para>Рекомендуется выставлять параметры <link linkend="cuba.userSessionExpirationTimeoutSec">
                <property>cuba.userSessionExpirationTimeoutSec</property>
              </link> и  <property>cuba.httpSessionExpirationTimeoutSec</property>  в одинаковое значение.</para>
          </tip>
        </listitem>
      </varlistentry>
      <varlistentry id="cuba.inMemoryDistinct">
        <term>cuba.inMemoryDistinct</term>
        <listitem>
          <para>Включает режим фильтрации дубликатов записей в памяти, вместо <literal>select distinct</literal> на уровне базы данных. Используется в <link linkend="dataService">
              <code>DataWorker</code>
            </link>. </para>
          <para>Значение по умолчанию: <code>false</code></para>
          <para>Интерфейс: <code>ServerConfig</code></para>
          <para>Используется в блоке <structname>Middleware</structname>.</para>
        </listitem>
      </varlistentry>
      <varlistentry id="cuba.jmxUserLogin">
        <term>cuba.jmxUserLogin</term>
        <listitem>
          <para>Логин пользователя, под которым выполняется вход в систему при  <link linkend="system_authentication">системной аутентификации</link>. </para>
          <para>Значение по умолчанию: <literal>admin</literal></para>
          <para>Используется в блоке <structname>Middleware</structname>.</para>
        </listitem>
      </varlistentry>
      <varlistentry id="cuba.lazyLoadServerViews">
        <term>cuba.lazyLoadServerViews</term>
        <listitem>
          <para>Указывает, что глобальные представления c <structname>Middleware</structname> нужно загружать на клиентский уровень не все сразу, а по необходимости. См. <xref linkend="views"/></para>
          <para>Значение по умолчанию: <code>false</code></para>
          <para>Интерфейс: <code>ClientConfig</code></para>
          <para>Используется в блоках клиентского уровня: <structname>Web Client</structname>, <structname>Web Portal</structname>, <structname>Desktop Client</structname>.</para>
        </listitem>
      </varlistentry>
      <varlistentry id="cuba.localeSelectVisible">
        <term>cuba.localeSelectVisible</term>
        <listitem>
          <para>Включает или отключает возможность пользователя выбирать язык
интерфейса при входе в систему. </para>
          <para>Если <literal>cuba.localeSelectVisible=false</literal>, то локаль пользовательской сессии выбирается следующим образом:<itemizedlist>
              <listitem>
                <para>если для данного экземпляра сущности <code>User</code> установлен атрибут <code>language</code>, то устанавливается локаль для этого языка;</para>
              </listitem>
              <listitem>
                <para>если язык операционной системы пользователя присутствует в списке доступных (заданных свойством <property>
                    <link linkend="cuba.availableLocales">cuba.availableLocales</link>
                  </property>), то выбирается он;</para>
              </listitem>
              <listitem>
                <para>в противном случае выбирается язык, заданный первым в свойстве <property>
                    <link linkend="cuba.availableLocales">cuba.availableLocales</link>
                  </property>.</para>
              </listitem>
            </itemizedlist></para>
          <para>Значение по умолчанию: <literal>true</literal></para>
          <para>Интерфейс: <code>GlobalConfig</code></para>
          <para>Используется во всех стандартных <link linkend="app_tiers">блоках</link>.</para>
        </listitem>
      </varlistentry>
      <varlistentry id="cuba.mainMessagePack">
        <term>cuba.mainMessagePack</term>
        <listitem>
          <para>Задает <link linkend="main_message_pack">главный пакет сообщений</link> данного блока приложения. </para>
          <para>Значением свойства может быть либо один пакет, либо список пакетов, разделенный пробелами. </para>
          <para>Используется во всех стандартных <link linkend="app_tiers">блоках</link>.</para>
          <para>Пример:<programlisting>cuba.mainMessagePack=com.haulmont.cuba.web com.sample.sales.web</programlisting></para>
        </listitem>
      </varlistentry>
      <varlistentry id="cuba.metadataConfig">
        <term>cuba.metadataConfig</term>
        <listitem>
          <para>Конфигурационный параметр, задает набор файлов <filename>
              <link linkend="metadata.xml">metadata.xml</link>
            </filename>. </para>
          <para>Значением свойства должен быть список имен файлов, разделенный пробелами. Файлы загружаются по правилам интерфейса <code>
              <link linkend="resources">Resources</link>
            </code>.</para>
          <para>Используется в блоке <structname>Middleware</structname>.</para>
          <para>Пример:<programlisting>cuba.metadataConfig=cuba-metadata.xml sales-metadata.xml</programlisting></para>
        </listitem>
      </varlistentry>
      <varlistentry id="cuba.passwordEncryptionModule">
        <term>cuba.passwordEncryptionModule</term>
        <listitem>
          <para>Задает имя бина, используемого для хэширования паролей пользователей.</para>
          <para>Значение по умолчанию: <literal>cuba_Sha1EncryptionModule</literal></para>
          <para>Используется во всех стандартных <link linkend="app_tiers">блоках</link>.</para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term>cuba.passwordPolicyEnabled</term>
        <listitem>
          <para>Определяет, нужно ли применять политику проверки пароля. Если свойство имеет значение <code>true</code>, то все новые задаваемые пользователями пароли будут проверяться в соответствии со свойством <property>
              <link linkend="cuba.passwordPolicyRegExp">cuba.passwordPolicyRegExp</link>
            </property>.</para>
          <para>Значение по умолчанию: <literal>false</literal></para>
          <para>Интерфейс: <code>ClientConfig</code></para>
          <para>Используется в блоках клиентского уровня: <structname>Web Client</structname>, <structname>Web Portal</structname>, <structname>Desktop Client</structname>.</para>
        </listitem>
      </varlistentry>
      <varlistentry id="cuba.passwordPolicyRegExp">
        <term>cuba.passwordPolicyRegExp</term>
        <listitem>
          <para>В данном свойстве задается регулярное выражение, которое используется в политике проверки пароля.</para>
          <para>Значение по умолчанию:</para>
          <para><prompt>((?=.*\\d)(?=.*\\p{javaLowerCase}) (?=.*\\p{javaUpperCase}).{6,20})</prompt></para>
          <para>Это означает, что в пароль должен содержать от 6 до 20 символов, в нем можно использоваться цифры, символы и буквы латинского алфавита. При этом обязательно в пароле должна  быть хотя бы одна цифра, одна буква в нижнем регистре и одна буква в верхнем регистре. Более подробная информация о синтаксисе регулярных выражений можно найти на сайтах: <ulink url="http://ru.wikipedia.org/wiki/%D0%A0%D0%B5%D0%B3%D1%83%D0%BB%D1%8F%D1%80%D0%BD%D1%8B%D0%B5_%D0%B2%D1%8B%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D1%8F">http://ru.wikipedia.org/wiki/Регулярные_выражения</ulink> и <ulink url="http://docs.oracle.com/javase/6/docs/api/java/util/regex/Pattern.html">http://docs.oracle.com/javase/6/docs/api/java/util/regex/Pattern.html</ulink></para>
          <para>Интерфейс: <code>ClientConfig</code></para>
          <para>Используется в блоках клиентского уровня: <structname>Web Client</structname>, <structname>Web Portal</structname>, <structname>Desktop Client</structname>.</para>
        </listitem>
      </varlistentry>
      <varlistentry id="cuba.persistenceConfig">
        <term>cuba.persistenceConfig</term>
        <listitem>
          <para>Конфигурационный параметр, задает набор файлов <filename>
              <link linkend="persistence.xml">persistence.xml</link>
            </filename> блока <structname>Middleware</structname>. </para>
          <para>Значением свойства должен быть список имен файлов, разделенный пробелами. Файлы загружаются по правилам интерфейса <code>
              <link linkend="resources">Resources</link>
            </code>.</para>
          <para>Используется в блоке <structname>Middleware</structname>.</para>
          <para>Пример:<programlisting>cuba.persistenceConfig=cuba-persistence.xml sales-persistence.xml</programlisting></para>
        </listitem>
      </varlistentry>
      <varlistentry id="cuba.remotingSpringContextConfig">
        <term>cuba.remotingSpringContextConfig</term>
        <listitem>
          <para>Конфигурационный параметр, задает набор файлов <filename>
              <link linkend="remoting-spring.xml">remoting-spring.xml</link>
            </filename> в  блоке <structname>Middleware</structname>.  </para>
          <para>Значением свойства должен быть список имен файлов, разделенный пробелами. Файлы загружаются по правилам интерфейса <code>
              <link linkend="resources">Resources</link>
            </code>.</para>
          <para>Используется в блоке <structname>Middleware</structname>.</para>
          <para>Пример:<programlisting>cuba.remotingSpringContextConfig=cuba-remoting-spring.xml sales-remoting-spring.xml</programlisting></para>
        </listitem>
      </varlistentry>
      <varlistentry id="cuba.springContextConfig">
        <term>cuba.springContextConfig</term>
        <listitem>
          <para>Конфигурационный параметр, задает набор файлов <filename>
              <link linkend="spring.xml">spring.xml</link>
            </filename> в каждом стандартном блоке приложения.  </para>
          <para>Значением свойства должен быть список имен файлов, разделенный пробелами. Файлы загружаются по правилам интерфейса <code>
              <link linkend="resources">Resources</link>
            </code>.</para>
          <para>Используется во всех стандартных <link linkend="app_tiers">блоках</link>.</para>
          <para>Пример:<programlisting>cuba.springContextConfig=cuba-spring.xml sales-spring.xml</programlisting></para>
        </listitem>
      </varlistentry>
      <varlistentry id="cuba.trustedClientPassword">
        <term>cuba.trustedClientPassword</term>
        <listitem>
          <para>Пароль, используемый методом <code>LoginService.loginTrusted()</code>. Средний слой может аутентифицировать пользователей, подключающихся через доверенный клиентский <link linkend="app_tiers">блок</link>, без проверки пользовательского пароля. </para>
          <para>Это свойство используется в случае, если пароли пользователей не хранятся в БД, и реальную аутентификацию выполняет сам клиентский блок, например,  путем интеграции с <application>Active Directory</application>.</para>
          <para>Интерфейсы: <code> ServerConfig</code>, <code>WebConfig</code></para>
          <para>Используется в блоках: <structname>Middleware</structname>, <structname>Web Client</structname>, <structname>Web Portal</structname>.</para>
        </listitem>
      </varlistentry>
      <varlistentry id="cuba.trustedClientPermittedIpMask">
        <term>cuba.trustedClientPermittedIpMask</term>
        <listitem>
          <para>Маска IP адресов, с которых возможен вызов метода <code>LoginService.loginTrusted()</code>, в формате регулярного выражения.</para>
          <para>Значение по умолчанию: <literal>127\.0\.0\.1</literal></para>
          <para>Интерфейсы: <code> ServerConfig</code>, <code>WebConfig</code></para>
          <para>Используется в блоках: <structname>Middleware</structname>, <structname>Web Client</structname>, <structname>Web Portal</structname>.</para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term>cuba.user.fullNamePattern</term>
        <listitem>
          <para>Задает шаблон формирования полного имени пользователя. </para>
          <para>Значение по умолчанию: <literal>{LL| }{F|. }{M|.}</literal></para>
          <para>Полное имя можно сформировать по  шаблону из имени, отчества и фамилии  пользователя. В шаблоне  используются следующие правила:</para>
          <itemizedlist>
            <listitem>
              <para>Фигурными скобками <literal>{}</literal> разделяются части шаблона между собой</para>
            </listitem>
            <listitem>
              <para>Правила формирования шаблона внутри фигурных скобок: один из следующих символов и далее, без пробела, символ <literal> |</literal>.</para>
              <para><literal>LL</literal> означает фамилию пользователя, написанную в полном варианте (Иванов)</para>
              <para><literal>L</literal> означает фамилию пользователя, написанную в кратком варианте (И)</para>
              <para><literal>FF</literal> означает имя пользователя, написанного в полном варианте (Петр)</para>
              <para><literal>F</literal> означает фамилию пользователя, написанную в кратком варианте (П)</para>
              <para><literal>MM</literal> означает отчество пользователя, написанное в полном варианте (Сергеевич)</para>
              <para><literal>M</literal> означает отчество пользователя, написанное в кратком варианте (С)</para>
            </listitem>
            <listitem>
              <para>После символа <literal>|</literal> могут идти любые символы, в том числе, и пробел.</para>
            </listitem>
          </itemizedlist>
        </listitem>
      </varlistentry>
      <varlistentry id="cuba.userSessionExpirationTimeoutSec">
        <term>cuba.userSessionExpirationTimeoutSec</term>
        <listitem>
          <para>Задает  таймаут неактивности сессии пользователя
 в секундах.</para>
          <para>Значение по умолчанию: <literal>1800</literal></para>
          <para>Интерфейс: <code>ServerConfig</code></para>
          <para>Используется в блоке <structname>Middleware</structname>.</para>
          <tip>
            <para>Рекомендуется выставлять параметры <property>cuba.userSessionExpirationTimeoutSec</property> и  <link linkend="cuba.httpSessionExpirationTimeoutSec">
                <property>cuba.httpSessionExpirationTimeoutSec</property>
              </link>  в одинаковое значение.</para>
          </tip>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term>cuba.userSessionProviderUrl</term>
        <listitem>
          <para>URL для соединения с <link linkend="app_tiers">блоком</link> <structname>Middleware</structname>, через который выполняется вход пользователей в систему. </para>
          <para>Этот параметр необходимо устанавливать  в дополнительных блоках среднего слоя, которые выполняют запросы клиентов, но не содержат общего кэша пользовательских сессий. Тогда в начале выполнения запроса при отсутствии требуемой сессии в локальном кэше данный блок вызовет метод <code>LoginService.getSession()</code> по указанному URL, и в случае успеха закэширует полученную сессию у себя.</para>
          <para>Интерфейс: <code>ServerConfig</code></para>
          <para>Используется в блоке <structname>Middleware</structname>.</para>
        </listitem>
      </varlistentry>
      <varlistentry id="cuba.viewsConfig">
        <term>cuba.viewsConfig</term>
        <listitem>
          <para>Конфигурационный параметр, задающий набор файлов <link linkend="views.xml">views.xml</link>, автоматически развертываемых на старте приложения. См. <xref linkend="views"/></para>
          <para>Используется во всех стандартных <link linkend="app_tiers">блоках</link>.</para>
          <para>Пример:<programlisting>cuba.viewsConfig=cuba-views.xml reports-views.xml sales-views.xml</programlisting></para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term>cuba.web.loginDialogDefaultUser</term>
        <listitem>
          <para>Задает имя пользователя по умолчанию. Оно будет автоматически подставляться в экране входа в систему, что удобно в процессе разработки приложения. В режиме эксплуатации приложения в данном свойстве необходимо задать  значение <literal> &lt;disabled&gt;</literal>.</para>
          <para>Значение по умолчанию: <literal>admin</literal></para>
          <para>Интерфейс: <code>WebConfig</code></para>
          <para>Используется в блоке   <structname>Web Client</structname>.</para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term>cuba.web.loginDialogDefaultPassword</term>
        <listitem>
          <para>Задает пароль пользователя по умолчанию. Он будет автоматически подставляться в экране входа в систему, что удобно в процессе разработки приложения. В режиме эксплуатации приложения в данном свойстве необходимо задать  значение <literal> &lt;disabled&gt;</literal>.</para>
          <para>Значение по умолчанию: <literal>admin</literal></para>
          <para>Интерфейс: <code>WebConfig</code></para>
          <para>Используется в блоке   <structname>Web Client</structname>.</para>
        </listitem>
      </varlistentry>
    </variablelist>
  </appendix>
  <appendix>
    <title>Схема базы данных</title>
    <figure>
      <title>Схема базы данных</title>
      <mediaobject>
        <imageobject>
          <imagedata align="center" fileref="img/dbStructure.png"/>
        </imageobject>
      </mediaobject>
    </figure>
  </appendix>
  <xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="glossary.xml" encoding="UTF-8"/>
</book>
