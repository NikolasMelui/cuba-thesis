<?xml version='1.0' encoding='UTF-8'?>
<!-- This document was created with Syntext Serna Free. --><!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN" "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" []>
<chapter id="chapter_framework" lang="ru">
  <title>Устройство платформы</title>
  <para>Данная глава содержит подробное описание архитектуры, компонентов и механизмов платформы CUBA.</para>
  <section>
    <title>Архитектура</title>
    <para>В данной главе рассмотрена архитектура CUBA-приложений в различных разрезах: по уровням, блокам, модулям, и по используемым базовым проектам.</para>
    <section id="app_tiers">
      <title>Уровни и блоки приложения</title>
      <para>Платформа позволяет строить приложения по классической трехуровневой схеме:  клиентский уровень, средний слой, база данных. <firstterm>Уровень</firstterm> отражает степень &quot;удаленности&quot; пользователя от хранимых данных. </para>
      <para>В дальнейшем речь пойдет в основном о среднем слое и клиентах, поэтому для краткости выражение &quot;все уровни&quot; означает два этих уровня.</para>
      <para>На каждом уровне возможно создание одного или нескольких <firstterm>блоков</firstterm> (units) приложения. Блок представляет собой обособленную исполняемую программу, взаимодействующую с другими блоками приложения. Средства платформы <productname>CUBA</productname> позволяют создавать блоки в виде веб-приложений и десктопных приложений. Разработка блоков для мобильных платформ на данный момент остается за рамками  CUBA, однако такие блоки, созданные другими средствами, могут быть интегрированы со стандартными блоками приложения. </para>
      <figure>
        <title>Уровни и блоки приложения</title>
        <mediaobject>
          <imageobject>
            <imagedata contentwidth="80%" align="center" fileref="img/AppTiers.png"/>
          </imageobject>
        </mediaobject>
      </figure>
      <variablelist>
        <varlistentry>
          <term>Middleware</term>
          <listitem>
            <para>Средний слой, содержащий основную бизнес-логику приложения и выполняющий обращения к базе данных. Представляет собой отдельное веб-приложение под управлением стандартного контейнера <glossterm linkend="javaee_web_profile">Java EE Web Profile</glossterm>. См. <xref linkend="middleware"/></para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term>Web Client</term>
          <listitem>
            <para>Основной блок клиентского уровня. Содержит  интерфейс, предназначенный, как правило, для внутренних пользователей организации. Представляет собой отдельное веб-приложение под управлением стандартного контейнера <application>Java EE Web Profile</application>. Реализация <link linkend="gui_framework">пользовательского интерфейса</link> основана на фреймворке <application>Vaadin</application>. См. <xref linkend="client"/></para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term>Desktop Client</term>
          <listitem>
            <para>Дополнительный блок клиентского уровня. Содержит  интерфейс, предназначенный, как правило, для внутренних пользователей организации. Представляет собой десктопное Java-приложение, реализация пользовательского интерфейса основана на фреймворке <application>Java Swing</application>. См. <xref linkend="client"/></para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term>Web Portal</term>
          <listitem>
            <para>Дополнительный блок клиентского уровня. Содержит  интерфейс для внешних пользователей. Может использоваться для интеграции с мобильными устройствами или сторонними приложениями. Представляет собой отдельное веб-приложение под управлением стандартного контейнера <application>Java EE Web Profile</application>. Реализация пользовательского интерфейса основана на фреймворке <application>Spring MVC</application>. См. <xref linkend="portal"/></para>
          </listitem>
        </varlistentry>
      </variablelist>
      <para>Обязательным блоком любого приложения является средний слой - <structname>Middleware</structname>. Для реализации пользовательского интерфейса как правило используется один или несколько клиентских блоков, например <structname>Web Client</structname> и <structname>Web Portal</structname>. </para>
      <para>Вышеперечисленные блоки являются стандартными, однако в комплексном приложении для разделения функциональности можно без труда создать произвольное количество как клиентских блоков, так и блоков среднего слоя.</para>
      <para>Все клиентские блоки  взаимодействуют со средним слоем одинаковым образом посредством протокола <application>HTTP</application>, что позволяет размещать средний слой произвольным образом, в том числе за сетевым экраном. Следует отметить, что при развертывании в простейшем случае среднего слоя и веб-клиента на одном сервере между ними организуется локальное взаимодействие в обход сетевого стека для снижения накладных расходов.</para>
    </section>
    <section id="app_modules">
      <title>Модули приложения</title>
      <para>Модуль – наименьшая структурная единица CUBA-приложения. Представляет собой один модуль проекта приложения и соответствующий ему JAR файл с исполняемым кодом.</para>
      <para>Стандартные модули: <itemizedlist>
          <listitem>
            <para><structname>global</structname> – включает в себя классы сущностей, интерфейсы сервисов и другие общие для всех уровней классы. Используется во всех <link linkend="app_tiers">блоках приложения</link>.</para>
          </listitem>
          <listitem>
            <para><structname>core</structname> – реализация сервисов и всех остальных компонентов среднего слоя. Используется только на <structname>Middleware</structname>.</para>
          </listitem>
          <listitem>
            <para><structname>gui</structname> – общие компоненты <link linkend="gui_framework">универсального пользовательского интерфейса</link>. Используется в <structname>Web Client</structname> и <structname>Desktop Client</structname>.</para>
          </listitem>
          <listitem>
            <para><structname>web</structname> – реализация универсального пользовательского интерфейса на <application>Vaadin</application>, а также другие специфичные для веб-клиента классы. Используется в блоке <structname>Web Client</structname>.</para>
          </listitem>
          <listitem>
            <para><structname>desktop</structname> – опциональный модуль – реализация универсального пользовательского интерфейса на <application>Java Swing</application>, а также другие специфичные для десктоп-клиента классы. Используется в блоке <structname>Desktop Client</structname>.</para>
          </listitem>
          <listitem>
            <para><structname>portal</structname> – опциональный модуль – реализация веб-портала на <application>Spring MVC</application>.</para>
          </listitem>
        </itemizedlist>  </para>
      <figure>
        <title>Модули приложения</title>
        <mediaobject>
          <imageobject>
            <imagedata contentwidth="80%" align="center" fileref="img/AppModules.png"/>
          </imageobject>
        </mediaobject>
      </figure>
    </section>
    <section id="base_projects">
      <title>Базовые проекты</title>
      <para>Функциональность платформы разделена на несколько так называемых <firstterm>базовых проектов</firstterm>: <itemizedlist>
          <listitem>
            <para><structname>cuba</structname> – основной базовый проект, содержит всю функциональность, описанную в данном руководстве, плюс подсистему безопасности (управление пользователями и их доступом к данным)</para>
          </listitem>
          <listitem>
            <para><structname>reports</structname> – подсистема генерации отчетов</para>
          </listitem>
          <listitem>
            <para><structname>workflow</structname> – подсистема управления потоками работ со встроенным визуальным редактором бизнес-процессов</para>
          </listitem>
          <listitem>
            <para><structname>fts</structname> – подсистема полнотекстового поиска</para>
          </listitem>
          <listitem>
            <para><structname>charts</structname> – подсистема вывода диаграмм</para>
          </listitem>
          <listitem>
            <para><structname>ccpayments</structname> – подсистема работы с кредитными картами</para>
          </listitem>
          <listitem>
            <para><structname>bpmn</structname> – механизм исполнения бизнес-процессов по стандарту <application>BPMN 2.0</application></para>
          </listitem>
        </itemizedlist></para>
      <para>Создаваемое на основе платформы приложение может включать в себя функциональность базовых проектов путем объявления зависимостей от их <glossterm linkend="artifact"> артефактов</glossterm>. Зависимость от артефактов <structname>cuba</structname> является обязательной. Опциональные базовые проекты в свою очередь также зависят от <structname>cuba</structname>, и в принципе могут содержать зависимости между собой.</para>
      <figure>
        <title>Зависимости между проектами</title>
        <mediaobject>
          <imageobject>
            <imagedata contentwidth="80%" align="center" fileref="img/BaseProjects.png"/>
          </imageobject>
        </mediaobject>
      </figure>
      <para>Сплошными линиями изображены обязательные зависимости, пунктирными − опциональные.</para>
    </section>
    <section>
      <title>Состав приложения</title>
      <para>Вышеописанные архитектурные принципы напрямую отражаются на составе собранного приложения. Рассмотрим его на примере простого приложения  <application>sales</application>, которое имеет 2 блока – <structname>Middleware</structname> и <structname>Web Client</structname>; и включает в себя функциональность базовых проектов <structname>cuba</structname> и <structname>reports</structname>.</para>
      <figure>
        <title>Состав простого приложения</title>
        <mediaobject>
          <imageobject>
            <imagedata align="center" fileref="img/SampleAppArtifacts.png"/>
          </imageobject>
        </mediaobject>
      </figure>
      <para>На рисунке изображено содержимое некоторых каталогов сервера <application>Tomcat</application> с развернутым в нем приложением <application>sales</application>. </para>
      <para><link linkend="app_tiers">Блок</link><structname> Middleware</structname> реализован веб-приложением <filename>app-core</filename>, блок <structname>Web Client</structname> – веб-приложением <filename>app</filename>. Исполняемый код веб-приложений содержится в каталогах <filename>WEB-INF/lib</filename> в наборе JAR-файлов. Каждый JAR представляет собой результат сборки (<glossterm linkend="artifact">артефакт</glossterm>) одного из <link linkend="app_modules">модулей</link> приложения или <link linkend="base_projects">базового проекта</link>.</para>
      <para>Например, состав JAR-файлов веб-приложения среднего слоя <filename>app-core</filename> определяется тем, что блок <structname>Middleware</structname> состоит из модулей <structname>global</structname> и <structname>core</structname>, и приложение использует базовые проекты <structname>cuba</structname> и <structname>reports</structname> (в данном случае версии 4.0.0). </para>
    </section>
  </section>
  <section>
    <title>Общие компоненты</title>
    <para>В данной главе рассмотрены компоненты платформы, общие для всех <link linkend="app_tiers">уровней</link> приложения.</para>
    <section id="data_model">
      <title>Модель данных</title>
      <para>Предметная область моделируется в системе с помощью взаимосвязанных классов Java, называемых классами сущностей или просто сущностями. </para>
      <para>Сущности подразделяются на две категории:<itemizedlist>
          <listitem>
            <para>персистентные – экземпляры таких сущностей хранятся в таблицах базы данных</para>
          </listitem>
          <listitem>
            <para>неперсистентные – экземпляры существуют только в оперативной памяти</para>
          </listitem>
        </itemizedlist></para>
      <para>Сущности характеризуются своими атрибутами. Атрибут соответствует полю класса и паре методов доступа (get / set) к полю. Чтобы атрибут был  неизменяемым (read only), достаточно не создавать метод set. </para>
      <para>Персистентные сущности могут включать в себя атрибуты, не хранящиеся в БД. В случае неперсистентного атрибута можно не создавать поле класса, ограничившись методами доступа.</para>
      <para>Класс сущности должен удовлетворять следующим требованиям: <itemizedlist>
          <listitem>
            <para>наследоваться от одного из базовых классов, предоставляемых платформой (см. ниже)</para>
          </listitem>
          <listitem>
            <para>иметь набор полей и методов доступа, соответствующих атрибутам сущностей</para>
          </listitem>
          <listitem>
            <para>класс и его поля (или методы доступа при отсутствии для атрибута соответствующего поля)  должны быть определенным образом <link linkend="entity_annotations">аннотированы</link> для работы <glossterm linkend="jpa">JPA</glossterm> (в случае персистентной сущности) и <link linkend="metadata_framework">фреймворка метаданных</link> </para>
          </listitem>
          <listitem>
            <para>для поддержки возможного <link linkend="extension">расширения</link> сущностей поля класса необходимо объявлять с модификатором <code>protected</code>, а не <code>private</code></para>
          </listitem>
        </itemizedlist></para>
      <para>Поддерживаются следующие типы атрибутов сущностей:<itemizedlist>
          <listitem>
            <para><code>java.lang.String</code></para>
          </listitem>
          <listitem>
            <para><code>java.lang.Boolean</code></para>
          </listitem>
          <listitem>
            <para><code>java.lang.Integer</code></para>
          </listitem>
          <listitem>
            <para><code>java.lang.Long</code></para>
          </listitem>
          <listitem>
            <para><code>java.lang.Double</code></para>
          </listitem>
          <listitem>
            <para><code>java.math.BigDecimal</code></para>
          </listitem>
          <listitem>
            <para><code>java.util.Date</code></para>
          </listitem>
          <listitem>
            <para><code>java.sql.Date</code></para>
          </listitem>
          <listitem>
            <para><code>java.sql.Time</code></para>
          </listitem>
          <listitem>
            <para><code>java.util.UUID</code></para>
          </listitem>
          <listitem>
            <para><code>byte[]</code></para>
          </listitem>
          <listitem>
            <para><code>enum</code></para>
          </listitem>
          <listitem>
            <para>сущность</para>
          </listitem>
        </itemizedlist></para>
      <figure id="entity_base_classes">
        <title>Базовые классы сущностей</title>
        <mediaobject>
          <imageobject>
            <imagedata align="center" fileref="img/EntityClasses.png"/>
          </imageobject>
        </mediaobject>
      </figure>
      <para>Рассмотрим базовые классы и интерфейсы сущностей более подробно. <itemizedlist>
          <listitem>
            <para><code>Instance</code> – декларирует базовые методы работы с объектами предметной области: <itemizedlist>
                <listitem>
                  <para>получение ссылки на мета-класс объекта</para>
                </listitem>
                <listitem>
                  <para>генерация имени экземпляра</para>
                </listitem>
                <listitem>
                  <para>чтение/установка значений атрибутов по имени</para>
                </listitem>
                <listitem>
                  <para>добавление слушателей, получающих уведомления об изменениях атрибутов</para>
                </listitem>
              </itemizedlist></para>
          </listitem>
          <listitem>
            <para><code>Entity</code> – дополняет <code>Instance</code> понятием идентификатора сущности, причем <code>Entity</code> не определяет тип идентификатора, оставляя эту возможность наследникам</para>
          </listitem>
          <listitem>
            <para><code>AbstractInstance</code> – реализует логику работы со слушателями изменения атрибутов</para>
          </listitem>
          <listitem>
            <para><code>AbstractNotPersistentEntity</code> – базовый класс неперсистентных сущностей с идентификаторами типа <code>UUID</code>.</para>
          </listitem>
          <listitem>
            <para><code>BaseEntity</code> – декларирует присущие всем персистентным сущностям методы работы с информацией о том, кто и когда создал экземпляр сущности в базе данных </para>
          </listitem>
          <listitem>
            <para><code>BaseUuidEntity</code> - реализует <code>BaseEntity</code> с типом идентификатора <code>UUID</code> и поддержкой <glossterm linkend="jpa">JPA</glossterm></para>
          </listitem>
          <listitem>
            <para><code>Versioned</code> – интерфейс сущностей, поддерживающих <glossterm linkend="optimistic_locking">оптимистичную блокировку</glossterm></para>
          </listitem>
          <listitem>
            <para><code>Updatable</code> – интерфейс сущностей, для которых требуется сохранять информацию о том, кто и когда изменял экземпляр в последний раз</para>
          </listitem>
          <listitem>
            <para><code>SoftDelete</code> – интерфейс сущностей, поддерживающих <link linkend="soft_deletion">мягкое удаление</link></para>
          </listitem>
          <listitem>
            <para><code>StandardEntity</code> – наиболее часто используемый базовый класс персистентных сущностей, реализующий вышеперечисленные интерфейсы</para>
          </listitem>
        </itemizedlist></para>
      <para>При создании классов сущностей рекомендуется выбирать базовый класс по следующим правилам:<itemizedlist>
          <listitem>
            <para>если сущность не хранится в БД, наследуйте ее от <code>AbstractNotPersistentEntity</code></para>
          </listitem>
          <listitem>
            <para>если сущность встраиваемая - наследуйте ее от <code>EmbeddableEntity</code></para>
          </listitem>
          <listitem>
            <para>если сущность только создается в БД, никогда не изменяется, и мягкое удаление не требуется - наследуйте ее от <code>BaseUuidEntity</code></para>
          </listitem>
          <listitem>
            <para>если сущность ведет себя стандартным образом: изменяется в БД, требует оптимистичной блокировки и мягкого удаления   − наследуйте ее от <code>StandardEntity</code></para>
          </listitem>
          <listitem>
            <para>в противном случае наследуйте сущность от <code>BaseUuidEntity</code> и реализуйте в классе тот набор интерфейсов <code>Versioned</code>, <code>Updatable</code>, <code>SoftDelete</code>, который требуется</para>
          </listitem>
        </itemizedlist></para>
      <section id="entity_annotations">
        <title>Аннотации сущностей</title>
        <para>В данном разделе описаны все поддерживаемые платформой аннотации классов и атрибутов сущностей. </para>
        <para>Аннотации пакета <code>javax.persistence</code> обеспечивают работу <glossterm linkend="jpa">JPA</glossterm>, аннотации пакетов <code>com.haulmont.*</code> предназначены для управления <link linkend="metadata_framework">метаданными</link> и другими механизмами платформы. Если указано только простое имя класса, подразумевается что это класс платформы, расположенный в одном  из пакетов <code>com.haulmont.*</code></para>
        <section>
          <title>Аннотации класса</title>
          <variablelist>
            <varlistentry>
              <term>
                <code>
                  <ulink url="http://docs.oracle.com/javaee/5/api/javax/persistence/Entity.html">@javax.persistence.Entity</ulink>
                </code>
              </term>
              <listitem>
                <para>Объявляет класс сущностью модели данных. </para>
                <para>Параметры:<itemizedlist>
                    <listitem>
                      <para><code>name</code> - имя сущности, обязательно должно начинаться с префикса, отделенного знаком <literal>$</literal>. Желательно использовать в качестве префикса короткое имя проекта для формирования отдельного пространства имен. </para>
                    </listitem>
                  </itemizedlist></para>
                <para>Пример:<programlisting>@Entity(name = &quot;sales$Customer&quot;)</programlisting></para>
              </listitem>
            </varlistentry>
            <varlistentry>
              <term>
                <code>
                  <ulink url="http://docs.oracle.com/javaee/5/api/javax/persistence/MappedSuperclass.html">@javax.persistence.MappedSuperclass</ulink>
                </code>
              </term>
              <listitem>
                <para>Определяет, что данный класс является предком некоторых сущностей, и его атрибуты должны быть использованы в составе сущностей-наследников. Такой класс не сопоставляется никакой отдельной таблице БД.</para>
              </listitem>
            </varlistentry>
            <varlistentry>
              <term>
                <code>@<ulink url="http://docs.oracle.com/javaee/5/api/javax/persistence/Table.html">javax.persistence.Table</ulink></code>
              </term>
              <listitem>
                <para>Определяет таблицу базы данных для данной сущности. </para>
                <para>Параметры:<itemizedlist>
                    <listitem>
                      <para><code>name</code> - имя таблицы</para>
                    </listitem>
                  </itemizedlist></para>
                <para>Пример:<programlisting>@Table(name = &quot;SALES_CUSTOMER&quot;)</programlisting></para>
              </listitem>
            </varlistentry>
            <varlistentry id="embeddable_annotation">
              <term>
                <code>
                  <ulink url="http://docs.oracle.com/javaee/5/api/javax/persistence/Embeddable.html">@javax.persistence.Embeddable</ulink>
                </code>
              </term>
              <listitem>
                <para>Определяет встраиваемую сущность, экземпляры которой хранятся вместе с владеющей сущностью в той же таблице. </para>
                <para>Для задания имени сущности тебуется применение аннотации <link linkend="metaclass_annotation">
                    <code>@MetaClass</code>
                  </link>.</para>
              </listitem>
            </varlistentry>
            <varlistentry>
              <term>
                <code>
                  <ulink url="http://docs.oracle.com/javaee/5/api/javax/persistence/Inheritance.html">@javax.persistence.Inheritance</ulink>
                </code>
              </term>
              <listitem>
                <para>Определяет стратегию наследования для иерархии классов сущностей. Данная аннотация должна быть помещена на корневом классе иерархии. </para>
                <para>Параметры:<itemizedlist>
                    <listitem>
                      <para><code>strategy</code> - стратегия, по умолчанию <code>SINGLE_TABLE</code></para>
                    </listitem>
                  </itemizedlist></para>
              </listitem>
            </varlistentry>
            <varlistentry>
              <term>
                <code>@<ulink url="http://docs.oracle.com/javaee/5/api/javax/persistence/DiscriminatorColumn.html">javax.persistence.DiscriminatorColumn</ulink></code>
              </term>
              <listitem>
                <para>Используется для определения колонки БД, отвечающей за различение типов сущностей в случае стратегий наследования <code>SINGLE_TABLE</code> и <code>JOINED</code>. </para>
                <para>Параметры:<itemizedlist>
                    <listitem>
                      <para><code>name</code> - имя колонки-дискриминатора</para>
                    </listitem>
                    <listitem>
                      <para><code>discriminatorType</code> - тип данных колонки-дискриминатора</para>
                    </listitem>
                  </itemizedlist></para>
                <para>Пример:<programlisting>@DiscriminatorColumn(name = &quot;TYPE&quot;, discriminatorType = DiscriminatorType.INTEGER)</programlisting></para>
              </listitem>
            </varlistentry>
            <varlistentry>
              <term>
                <code>
                  <ulink url="http://docs.oracle.com/javaee/5/api/javax/persistence/DiscriminatorValue.html">@javax.persistence.DiscriminatorValue</ulink>
                </code>
              </term>
              <listitem>
                <para>Определяет значение колонки-дискриминатора для данной сущности. Эта аннотация должна быть помещена на конкретном классе сущности. </para>
                <para>Пример:<programlisting>@DiscriminatorValue(&quot;0&quot;)</programlisting></para>
              </listitem>
            </varlistentry>
            <varlistentry>
              <term>
                <code>
                  <ulink url="http://docs.oracle.com/javaee/5/api/javax/persistence/PrimaryKeyJoinColumn.html">@javax.persistence.PrimaryKeyJoinColumn</ulink>
                </code>
              </term>
              <listitem>
                <para>Используется в случае стратегии наследования <code>JOINED</code> для указания колонки внешнего ключа данной сущности, ссылающегося на первичный ключ сущности-предка.  </para>
                <para>Параметры:<itemizedlist>
                    <listitem>
                      <para><code>name</code> - имя колонки внешнего ключа данной сущности</para>
                    </listitem>
                    <listitem>
                      <para><code>referencedColumnName</code> - имя колонки первичного ключа сущности предка</para>
                    </listitem>
                  </itemizedlist></para>
                <para>Пример:<programlisting>@PrimaryKeyJoinColumn(name = &quot;CARD_ID&quot;, referencedColumnName = &quot;ID&quot;)</programlisting></para>
              </listitem>
            </varlistentry>
            <varlistentry id="namePattern">
              <term>
                <code>@NamePattern</code>
              </term>
              <listitem>
                <para>Определяет способ получения имени экземпляра, возвращаемого методом <code>Instance.getInstanceName()</code>.</para>
                <para>Значением аннотации должна быть строка вида <literal>{0}|{1}</literal>, где <itemizedlist>
                    <listitem>
                      <para><literal>{0}</literal> - строка форматирования по правилам  <code>String.format()</code>, или имя метода данного объекта с префиксом <literal>#</literal>. Метод должен возвращать <code>String</code> и не иметь параметров.</para>
                    </listitem>
                    <listitem>
                      <para><literal>{1}</literal> - разделенный запятыми список имен полей класса, соответствующий формату <literal>{0}</literal>. В случае использования в <literal>{0}</literal> метода список полей все равно необходим, так как по нему формируется <link linkend="views">представление</link> <literal>_minimal</literal>.</para>
                    </listitem>
                  </itemizedlist></para>
                <para>Примеры:<programlisting>@NamePattern(&quot;%s|name&quot;)</programlisting><programlisting>@NamePattern(&quot;#getCaption|login,name&quot;)</programlisting></para>
              </listitem>
            </varlistentry>
            <varlistentry id="listeners_annotation">
              <term>
                <code>@Listeners</code>
              </term>
              <listitem>
                <para>Определяет список слушателей, предназначенных для реакции на события жизненного цикла экземпляров сущности на <link linkend="app_tiers">уровне</link><structname> Middleware</structname>. </para>
                <para>Значением аннотации должна быть строка или массив строк с именами классов слушателей - см. <xref linkend="entity_listeners"/></para>
                <para>Строки используются здесь вместо ссылок на классы потому, что классы слушателей находятся только на уровне <structname>Middleware</structname> и не доступны клиентскому коду, в то время как классы самих сущностей используются на всех уровнях.</para>
                <para>Примеры:<programlisting>@Listeners(&quot;com.haulmont.cuba.security.listener.UserEntityListener&quot;)</programlisting><programlisting>@Listeners({&quot;com.abc.sales.entity.FooListener&quot;,&quot;com.abc.sales.entity.BarListener&quot;})</programlisting></para>
              </listitem>
            </varlistentry>
            <varlistentry id="metaclass_annotation">
              <term>
                <code>@MetaClass</code>
              </term>
              <listitem>
                <para>Используется для объявления неперсистентной или <link linkend="embeddable_annotation">встраиваемой</link> сущности (т.е. когда аннотация <code>@javax.persistence.Entity</code> не применима)  </para>
                <para>Параметры:<itemizedlist>
                    <listitem>
                      <para><code>name</code> - имя сущности, обязательно должно начинаться с префикса, отделенного знаком <literal>$</literal>. Желательно использовать в качестве префикса короткое имя проекта для формирования отдельного пространства имен.</para>
                    </listitem>
                  </itemizedlist></para>
                <para>Пример:<programlisting>@MetaClass(name = &quot;sys$LockInfo&quot;)</programlisting></para>
              </listitem>
            </varlistentry>
            <varlistentry>
              <term>
                <code>@SystemLevel</code>
              </term>
              <listitem>
                <para>Указывает, что данная сущность является системной и не должна быть доступна для выбора пользователем в различных списках сущностей, например как тип параметра универсального фильтра или тип <link linkend="runtime_properties">динамического атрибута</link>.  </para>
              </listitem>
            </varlistentry>
            <varlistentry>
              <term>
                <code>@EnableRestore</code>
              </term>
              <listitem>
                <para>Указывает, что экземпляры данной сущности доступны для восстановления после <link linkend="soft_deletion">мягкого удаления</link> в специальном экране <literal>core$Entity.restore</literal>. </para>
              </listitem>
            </varlistentry>
            <varlistentry>
              <term>
                <code>@TrackEditScreenHistory</code>
              </term>
              <listitem>
                <para>Указывает, что для данной сущности будет запоминаться история открытия экранов редактирования (<literal>{имя_сущности}.edit</literal>) с возможностью отображения в специальном экране <literal>sec$ScreenHistory.browse</literal>.  </para>
              </listitem>
            </varlistentry>
            <varlistentry>
              <term>
                <code>@Extends</code>
              </term>
              <listitem>
                <para>Указывает, что  данная сущность является расширением и должна повсеместно использоваться вместо базовой. См. <xref linkend="extension"/>  </para>
              </listitem>
            </varlistentry>
          </variablelist>
        </section>
        <section>
          <title>Аннотации атрибутов</title>
          <para>Аннотации атрибутов устанавливаются на соответствующие поля класса, за одним исключением: если требуется объявить неизменяемый (read only) неперсистентный атрибут <literal>foo</literal>, то достаточно создать метод доступа <code>getFoo()</code> и поместить на этот метод аннотацию <code>@MetaProperty</code>.</para>
          <variablelist>
            <varlistentry>
              <term>
                <code>
                  <ulink url="http://docs.oracle.com/javaee/5/api/javax/persistence/Transient.html">@javax.persistence.Transient</ulink>
                </code>
              </term>
              <listitem>
                <para>Указывает, что данное поле не хранится в БД, т.е. является неперсистентным. </para>
                <para>Поля поддерживаемых <glossterm linkend="jpa">JPA</glossterm> типов (см. <ulink url="http://docs.oracle.com/javaee/5/api/javax/persistence/Basic.html">http://docs.oracle.com/javaee/5/api/javax/persistence/Basic.html</ulink>) <emphasis>по умолчанию являются персистентными</emphasis>, поэтому аннотация <code>@Transient</code> обязательна для объявления неперсистентного атрибута такого типа. </para>
              </listitem>
            </varlistentry>
            <varlistentry>
              <term>
                <code>@org.apache.openjpa.persistence.Persistent</code>
              </term>
              <listitem>
                <para>Указывает, что данное поле хранится в БД, т.е. является персистентным.</para>
                <para>Данная аннотация требуется только для нестандартного для <glossterm linkend="jpa">JPA</glossterm> типа поля, платформа на данный момент поддерживает  один такой тип - <code>java.util.UUID</code>. Таким образом, <code>@Persistent</code> требуется только в одном случае - при объявлении персистентного поля типа <code>UUID</code>.</para>
              </listitem>
            </varlistentry>
            <varlistentry>
              <term>
                <code>
                  <ulink url="http://docs.oracle.com/javaee/5/api/javax/persistence/Column.html">@javax.persistence.Column</ulink>
                </code>
              </term>
              <listitem>
                <para>Определяет колонку БД, в которой будут храниться значения данного атрибута. </para>
                <para>Параметры:<itemizedlist>
                    <listitem>
                      <para><code>name</code> - имя колонки</para>
                    </listitem>
                    <listitem>
                      <para><code>length</code> - (необязательный параметр, по умолчанию <literal>255</literal>) - длина колонки. Используется также при формировании <link linkend="metadata_framework">метаданных</link> и в конечном счете может ограничивать максимальныю длину вводимого текста в визуальных компонентах, работающих с данным атрибутом.</para>
                    </listitem>
                    <listitem>
                      <para><code>nullable</code> - (необязательный параметр, по умолчанию <code>true</code>) - может ли атрибут содержать  <code>null</code>. При указании <code>nullable = false</code> <glossterm linkend="jpa">JPA</glossterm> контролирует наличие значения поля при сохранении, кроме того, визуальные компоненты, работающих с данным атрибутом, могут сигнализировать пользователю о необходимости ввода значения.</para>
                    </listitem>
                  </itemizedlist></para>
              </listitem>
            </varlistentry>
            <varlistentry>
              <term>
                <code>
                  <ulink url="http://docs.oracle.com/javaee/5/api/javax/persistence/ManyToOne.html">@javax.persistence.ManyToOne</ulink>
                </code>
              </term>
              <listitem>
                <para>Определяет атрибут-ссылку на сущность с типом ассоциации много-к-одному. </para>
                <para>Параметры:<itemizedlist>
                    <listitem>
                      <para><code>fetch</code> - (по умолчанию <code>EAGER</code>) параметр, определяющий, будет ли JPA <glossterm linkend="eager_fetching">энергично</glossterm> загружать ассоциированную сущность. Данный параметр всегда должен быть установлен в значение <code>LAZY</code>, так как в CUBA-приложении политика загрузки связей определяется динамически на основе механизма <link linkend="views">представлений</link>.</para>
                    </listitem>
                    <listitem>
                      <para><code>optional</code> - (необязательный параметр, по умолчанию <code>true</code>) - может ли атрибут содержать  <code>null</code>. При указании <code>optional = false</code> <glossterm linkend="jpa">JPA</glossterm> контролирует наличие ссылки при сохранении, кроме того, визуальные компоненты, работающих с данным атрибутом, могут сигнализировать пользователю о необходимости ввода значения.</para>
                    </listitem>
                  </itemizedlist></para>
                <para>Например, несколько экземпляров <code>Order</code> (заказов) ссылаются на один экземпляр <code>Customer</code> (покупателя), в этом случае класс <code>Order</code> должен содержать следующее объявление:<programlisting>@ManyToOne(fetch = FetchType.LAZY)
@JoinColumn(name = &quot;CUSTOMER_ID&quot;)
protected Customer customer;</programlisting></para>
              </listitem>
            </varlistentry>
            <varlistentry>
              <term>
                <code>
                  <ulink url="http://docs.oracle.com/javaee/5/api/javax/persistence/OneToMany.html">@javax.persistence.OneToMany</ulink>
                </code>
              </term>
              <listitem>
                <para>Определяет атрибут-коллекцию ссылок на сущность с типом ассоциации один-ко-многим. </para>
                <para>Параметры:<itemizedlist>
                    <listitem>
                      <para><code>mappedBy</code> - поле связанной сущности, определяющее ассоциацию </para>
                    </listitem>
                    <listitem>
                      <para><code>targetEntity</code> - тип связанной сущности. Необязательный параметр, если коллекция объявлена с использованием <application>Java generics</application>. </para>
                    </listitem>
                    <listitem>
                      <para><code>fetch</code> - (необязательный параметр, по умолчанию <code>LAZY</code>) - определяет, будет ли JPA <glossterm linkend="eager_fetching">энергично</glossterm> загружать коллекцию связанных сущностей. Необходимо всегда оставлять значение по умолчанию <code>LAZY</code>, так как в CUBA-приложении политика загрузки связей определяется динамически на основе механизма <link linkend="views">представлений</link>.</para>
                    </listitem>
                    <listitem>
                      <para><code>cascade</code> - (необязательный параметр, по умолчанию <code>{}</code>) - каскадирование операций определяет, какие операции над сущностью должны быть применены к ассоциированным сущностям. Каскадирование на данном уровне не рекомендуется использовать.</para>
                    </listitem>
                  </itemizedlist></para>
                <para>Например, несколько экземпляров <code>Item</code> (пунктов заказа) ссылаются на один экземпляр <code>Order</code> (заказ) с помощью <code>@ManyToOne</code> поля <code>Item.order</code>, в этом случае класс <code>Order</code> может содержать коллекцию экземпляров <code>Item</code>:<programlisting>@OneToMany(mappedBy = &quot;order&quot;)
protected Set&lt;Item&gt; items;</programlisting></para>
              </listitem>
            </varlistentry>
            <varlistentry>
              <term>
                <code>
                  <ulink url="http://docs.oracle.com/javaee/5/api/javax/persistence/OneToOne.html">@javax.persistence.OneToOne</ulink>
                </code>
              </term>
              <listitem>
                <para>Определяет атрибут-ссылку на сущность с типом ассоциации один-к-одному. </para>
                <para>Параметры:<itemizedlist>
                    <listitem>
                      <para><code>fetch</code> - (по умолчанию <code>EAGER</code>) параметр, определяющий, будет ли JPA <glossterm linkend="eager_fetching">энергично</glossterm> загружать ассоциированную сущность. Данный параметр всегда должен быть установлен в значение <code>LAZY</code>, так как в CUBA-приложении политика загрузки связей определяется динамически на основе механизма <link linkend="views">представлений</link>.</para>
                    </listitem>
                    <listitem>
                      <para><code>mappedBy</code> - поле связанной сущности, определяющее ассоциацию. Требуется устанавливать только на ведомой стороне ассоциации. </para>
                    </listitem>
                    <listitem>
                      <para><code>optional</code> - (необязательный параметр, по умолчанию <code>true</code>) - может ли атрибут содержать  <code>null</code>. При указании <code>optional = false</code> <glossterm linkend="jpa">JPA</glossterm> контролирует наличие ссылки при сохранении, кроме того, визуальные компоненты, работающих с данным атрибутом, могут сигнализировать пользователю о необходимости ввода значения.</para>
                    </listitem>
                  </itemizedlist></para>
                <para>Пример ведущей стороны ассоциации, класс <code>Driver</code>:<programlisting>@OneToOne(fetch = FetchType.LAZY)
@JoinColumn(name = &quot;CALLSIGN_ID&quot;)
protected DriverCallsign callsign;</programlisting></para>
                <para>Пример ведомой стороны ассоциации, класс <code>DriverCallsign</code>:<programlisting>@OneToOne(fetch = FetchType.LAZY, mappedBy = &quot;callsign&quot;)
protected Driver driver;</programlisting></para>
              </listitem>
            </varlistentry>
            <varlistentry>
              <term>
                <code>
                  <ulink url="http://docs.oracle.com/javaee/5/api/javax/persistence/ManyToMany.html">@javax.persistence.ManyToMany</ulink>
                </code>
              </term>
              <listitem>
                <para>Определяет атрибут-коллекцию ссылок на сущность с типом ассоциации много-ко-многим.</para>
                <para>Ассоциация много-ко-многим всегда имеет ведущую сторону и может иметь обратную сторону - ведомую. На ведущей строне указывается дополнительная аннотация <code>@JoinTable</code>, на ведомой стороне - параметр <code>mappedBy</code>.</para>
                <para>Параметры:<itemizedlist>
                    <listitem>
                      <para><code>mappedBy</code> - поле связанной сущности, определяющее ассоциацию с ведущей стороны. Необходимо указывать только на ведомой стороне.</para>
                    </listitem>
                    <listitem>
                      <para><code>targetEntity</code> - тип связанной сущности. Необязательный параметр, если коллекция объявлена с использованием <application>Java generics</application>. </para>
                    </listitem>
                    <listitem>
                      <para><code>fetch</code> - (необязательный параметр, по умолчанию <code>LAZY</code>) - определяет, будет ли JPA <glossterm linkend="eager_fetching">энергично</glossterm> загружать коллекцию связанных сущностей. Необходимо всегда оставлять значение по умолчанию <code>LAZY</code>, так как в CUBA-приложении политика загрузки связей определяется динамически на основе механизма <link linkend="views">представлений</link>.</para>
                    </listitem>
                  </itemizedlist></para>
                <para>Пример:<programlisting>TODO</programlisting></para>
              </listitem>
            </varlistentry>
            <varlistentry>
              <term>
                <code>
                  <ulink url="http://docs.oracle.com/javaee/5/api/javax/persistence/JoinColumn.html">@javax.persistence.JoinColumn</ulink>
                </code>
              </term>
              <listitem>
                <para>Используется для указания колонки БД, определяющей ассоциацию между сущностями.  </para>
                <para>Параметры:<itemizedlist>
                    <listitem>
                      <para><code>name</code> - имя колонки</para>
                    </listitem>
                  </itemizedlist></para>
                <para>Пример:<programlisting>@ManyToOne(fetch = FetchType.LAZY)
@JoinColumn(name = &quot;CUSTOMER_ID&quot;)
protected Customer customer;</programlisting></para>
              </listitem>
            </varlistentry>
            <varlistentry>
              <term>
                <code>
                  <ulink url="http://docs.oracle.com/javaee/5/api/javax/persistence/JoinTable.html">@javax.persistence.JoinTable</ulink>
                </code>
              </term>
              <listitem>
                <para>Используется для указания таблицы связи на ведущей стороне <code>@ManyToMany</code> ассоциации. </para>
                <para>Параметры:<itemizedlist>
                    <listitem>
                      <para><code>name</code> - имя таблицы связи</para>
                    </listitem>
                    <listitem>
                      <para><code>joinColumns</code> - элемент <code>@JoinColumn</code>, определяющий колонку таблицы связей, соответствующую первичному ключу ведущей стороны ассоциации (т.е. содержащей аннотацию <code>@JoinTable</code>)</para>
                    </listitem>
                    <listitem>
                      <para><code>inverseJoinColumns</code> - элемент <code>@JoinColumn</code>, определяющий колонку таблицы связей, соответствующую первичному ключу ведомой стороны ассоциации</para>
                    </listitem>
                  </itemizedlist></para>
                <para>Пример атрибута <code>customers</code> класса <code>Group</code>, являющегося ведущей стороной ассоциации:<programlisting>@ManyToMany
@JoinTable(name = &quot;SALES_CUSTOMER_GROUP_LINK&quot;,
    joinColumns = @JoinColumn(name = &quot;GROUP_ID&quot;),
    inverseJoinColumns = @JoinColumn(name = &quot;CUSTOMER_ID&quot;))
protected Set&lt;Customer&gt; customers;</programlisting></para>
                <para>Пример атрибута <code>groups</code> класса <code>Customer</code>, являющегося ведомой стороной этой же ассоциации:<programlisting>@ManyToMany(mappedBy = &quot;customers&quot;)
protected Set&lt;Group&gt; groups;</programlisting></para>
              </listitem>
            </varlistentry>
            <varlistentry>
              <term>
                <code>
                  <ulink url="http://docs.oracle.com/javaee/5/api/javax/persistence/OrderBy.html">@javax.persistence.OrderBy</ulink>
                </code>
              </term>
              <listitem>
                <para>Определяет порядок элементов в атрибуте-коллекции на момент извлечения из базы данных. Данную аннотацию необходимо задавать для упорядоченных коллекций, таких как <code>List</code> или <code>LinkedHashSet</code> для получения предсказуемого порядка следования элементов.</para>
                <para>Параметры:<itemizedlist>
                    <listitem>
                      <para><code>value</code> - строка, определяющая порядок, в формате:<programlisting>orderby_list::= orderby_item [,orderby_item]*
orderby_item::= property_or_field_name [ASC | DESC]</programlisting></para>
                    </listitem>
                  </itemizedlist></para>
                <para>Пример:<programlisting>@OneToMany(mappedBy = &quot;user&quot;)
@OrderBy(&quot;createTs&quot;)
protected List&lt;UserRole&gt; userRoles;</programlisting></para>
              </listitem>
            </varlistentry>
            <varlistentry>
              <term>
                <code>
                  <ulink url="http://docs.oracle.com/javaee/5/api/javax/persistence/Embedded.html">@javax.persistence.Embedded</ulink>
                </code>
              </term>
              <listitem>
                <para>Определяет атрибут типа встраиваемой сущности, в свою очередь аннотированной <code>@Embeddable</code>. </para>
                <para>Пример:<programlisting>@Embedded
protected Address address;</programlisting></para>
              </listitem>
            </varlistentry>
            <varlistentry>
              <term>
                <code>
                  <ulink url="http://docs.oracle.com/javaee/5/api/javax/persistence/Temporal.html">@javax.persistence.Temporal</ulink>
                </code>
              </term>
              <listitem>
                <para>Для атрибута типа <code>java.util.Date</code> уточняет тип хранимого значения: дата, время или дата+время. </para>
                <para>Параметры:<itemizedlist>
                    <listitem>
                      <para><code>value</code> - тип хранимого значения: <code>DATE</code>, <code>TIME</code>, <code> TIMESTAMP</code></para>
                    </listitem>
                  </itemizedlist></para>
                <para>Пример:<programlisting>@Column(name = &quot;START_DATE&quot;)
@Temporal(TemporalType.DATE)
protected Date startDate;</programlisting></para>
              </listitem>
            </varlistentry>
            <varlistentry>
              <term>
                <code>
                  <ulink url="http://docs.oracle.com/javaee/5/api/javax/persistence/Version.html">@javax.persistence.Version</ulink>
                </code>
              </term>
              <listitem>
                <para>Указывает, что данное поле хранит версию для поддержки <glossterm linkend="optimistic_locking">оптимистичной блокировки</glossterm> сущностей. </para>
                <para>Применение такого поля необходимо при реализации классом сущности интерфейса <code>Versioned</code> (базовый класс <code>StandardEntity</code> уже содержит такое поле).</para>
                <para>Пример:<programlisting>@Version
@Column(name = &quot;VERSION&quot;)
private Integer version;</programlisting></para>
              </listitem>
            </varlistentry>
            <varlistentry>
              <term>
                <code>@MetaProperty</code>
              </term>
              <listitem>
                <para>Определяет неперсистентный атрибут сущности. Данная аннотация может быть установлена как на поле класса, так и на метод доступа, в случае отсутствия соответствующего атрибуту поля.</para>
                <para>Параметры:<itemizedlist>
                    <listitem>
                      <para><code>mandatory</code> - (необязательный параметр, по умолчанию <code>false</code>) - может ли атрибут содержать  <code>null</code>. При указании <code>mandatory = true</code> визуальные компоненты, работающих с данным атрибутом, могут сигнализировать пользователю о необходимости ввода значения.</para>
                    </listitem>
                  </itemizedlist></para>
                <para>Пример использования для поля:<programlisting>@Transient
@MetaProperty
protected String token;</programlisting></para>
                <para>Пример использования для метода:<programlisting>@MetaProperty
public String getLocValue() {
    if (!StringUtils.isBlank(messagesPack)) {
        return AppBeans.get(Messsages.class).getMessage(messagesPack, value);
    } else {
        return value;
    }
}</programlisting></para>
              </listitem>
            </varlistentry>
            <varlistentry id="onDelete_annotation">
              <term>
                <code>@OnDelete</code>
              </term>
              <listitem>
                <para>Определяет политику обработки связи в случае мягкого удаления сущности, содержащей данный атрибут. См. <xref linkend="soft_deletion"/></para>
                <para>Пример:<programlisting>@OneToMany(mappedBy = &quot;group&quot;)
@OnDelete(DeletePolicy.CASCADE)
private Set&lt;Constraint&gt; constraints;</programlisting></para>
              </listitem>
            </varlistentry>
            <varlistentry id="onDeleteInverse_annotation">
              <term>
                <code>@OnDeleteInverse</code>
              </term>
              <listitem>
                <para>Определяет политику обработки связи в случае мягкого удаления сущности с обратной стороны ассоциации. См. <xref linkend="soft_deletion"/> </para>
                <para>Пример:<programlisting>@ManyToOne
@JoinColumn(name = &quot;DRIVER_ID&quot;)
@OnDeleteInverse(DeletePolicy.DENY)
private Driver driver;</programlisting></para>
              </listitem>
            </varlistentry>
            <varlistentry>
              <term>
                <code>@Composition</code>
              </term>
              <listitem>
                <para>Указывает на то, что связь является композицией - более тесным вариантом ассоциации. Это означает, что связанная сущность имеет смысл только как часть владеющей сущности, т.е. создается и удаляется вместе с ней. </para>
                <para>Например список пунктов в заказе (класс <code>Order</code> содержит коллекцию экземпляров <code>Item</code>):<programlisting>@OneToMany(mappedBy = &quot;order&quot;)
@Composition
protected List&lt;Item&gt; items;</programlisting></para>
              </listitem>
            </varlistentry>
            <varlistentry id="localizedValue_annotation">
              <term>
                <code>@LocalizedValue</code>
              </term>
              <listitem>
                <para>Служит для описания способа получения локализованного значения некоторого изменяющегося атрибута, которое возвращает метод <code><link linkend="messageTools">MessageTools</link>.getLocValue()</code>. </para>
                <para>Параметры:<itemizedlist>
                    <listitem>
                      <para><code>messagePack</code> - явное указание пакета, из которого будет взято локализованное сообщение, например <code>com.haulmont.cuba.core.entity</code></para>
                    </listitem>
                    <listitem>
                      <para><code>messagePackExpr</code> - выражение в терминах пути к атрибуту, хранящему имя пакета, из которого будет взято локализованное сообщение, например <code>proc.messagesPack</code>. Путь начинается с атрибута текущей сущности. </para>
                    </listitem>
                  </itemizedlist></para>
                <para>Пример аннотации, означающей, что локализованное значение атрибута <code>state</code> будет взято из пакета, имя которого хранится в атрибуте <code>messagesPack</code> связанной сущности <code>proc</code>:<programlisting>@Column(name = &quot;STATE&quot;)
@LocalizedValue(messagePackExpr = &quot;proc.messagesPack&quot;)
protected String state;

@ManyToOne(fetch = FetchType.LAZY)
@JoinColumn(name = &quot;PROC_ID&quot;)
protected Proc proc;</programlisting></para>
              </listitem>
            </varlistentry>
          </variablelist>
        </section>
      </section>
      <section id="soft_deletion">
        <title>Мягкое удаление</title>
        <para>Платформа <productname>CUBA</productname> поддерживает режим &quot;мягкого удаления&quot; данных - когда вместо удаления записей из базы данных они только помечаются определенным образом и становятся недоступными для обычного использования. В дальнейшем такие записи можно либо совсем удалить из БД с помощью отдельной регламентной процедуры, либо восстановить.</para>
        <para>Механизм мягкого удаления является &quot;прозрачным&quot; для прикладного программиста - достаточно убедиться что класс сущности реализует интерфейс <code>SoftDelete</code>, и платформа сама нужным образом будет  модифицировать запросы и операции с данными.</para>
        <para>Режим мягкого удаления имеет следующие преимущества:<itemizedlist>
            <listitem>
              <para>значительно снижается риск потери данных вследствие неверных действий пользователей</para>
            </listitem>
            <listitem>
              <para>позволяет быстро сделать некоторые  записи недоступными, даже если на них имеются ссылки. </para>
              <para>Возьмем для примера  модель данных Заказы - Покупатели. Допустим, на некоторого покупателя оформлено несколько заказов, однако нам нужно сделать его недоступным для  дальнейшей работы. Традиционным &quot;жестким&quot; удалением сделать это невозможно, так как для удаления покупателя нам нужно либо удалить все его заказы, либо обнулить в этих заказах ссылки на него (т.е. потерять информацию). При мягком удалении покупателя он становится недоступным для поиска и изменения, однако при просмотре заказов пользователь видит на экране название покупателя, так как при загрузке связей признак удаления намеренно игнорируется.</para>
              <para>Описанное поведение является стандартным, но может быть модифицировано с помощью <link linkend="delete_policy">политики обработки связей</link> при удалении.</para>
            </listitem>
          </itemizedlist></para>
        <para>Отрицательной стороной мягкого удаления является увеличение объема базы данных и потенциальная необходимость дополнительных процедур ее очистки.</para>
        <section>
          <title>Использование</title>
          <para>Для того, чтобы экземпляры сущности удалялись мягко, класс сущности должен реализовывать интерфейс <code>SoftDelete</code>,  а соответствующая таблица БД должна содержать колонки: <itemizedlist>
              <listitem>
                <para><database>DELETE_TS</database> - когда удалена запись</para>
              </listitem>
              <listitem>
                <para><database>DELETED_BY</database> - логин пользователя, который удалил запись</para>
              </listitem>
            </itemizedlist></para>
          <para>Поведение системы по умолчанию - сущности, реализующие <code>SoftDelete</code>, удаляются мягко, удаленные сущности не возвращаются запросами и поиском по идентификатору. При необходимости такое поведение можно динамически отключить следующими способами:<itemizedlist>
              <listitem>
                <para>для текущего экземпляра <link linkend="entityManager">EntityManager</link> - вызовом <code>setSoftDeletion(false)</code></para>
              </listitem>
              <listitem>
                <para>при запросе данных через <code>
                    <link linkend="dataService">DataService</link>
                  </code> или <code>
                    <link linkend="dataService">DataWorker</link>
                  </code> - вызовом у передаваемого объекта <code>LoadContext</code> метода <code>setSoftDeletion(false)</code></para>
              </listitem>
              <listitem>
                <para>на уровне <link linkend="datasources">источников данных</link> - используя метод <code>CollectionDatasource.setSoftDeletion(false)</code> или атрибут <literal>softDeletion=&quot;false&quot;</literal> элемента <sgmltag>collectionDatasource</sgmltag> в <link linkend="screen_xml">XML-дескрипторе</link> экрана.</para>
              </listitem>
            </itemizedlist></para>
          <para>В режиме мягкого удаления платформа автоматически отфильтровывает  удаленные экземпляры при загрузке по идентификатору и по <glossterm linkend="jpql">JPQL-запросу</glossterm>, а также удаленные элементы связанных сущностей в атрибутах-коллекциях. Однако связанные сущности в единичных атрибутах загружаются независимо от того, удален связанный экземпляр или нет.</para>
        </section>
        <section id="delete_policy">
          <title>Политика обработки связей</title>
          <para>Платформа предоставляет средство обработки связей при удалении сущностей, во многом аналогичное правилам <database>ON DELETE</database> внешних ключей в базе данных. Это средство работает на <link linkend="app_tiers">уровне</link><structname> Middleware</structname> и использует аннотации <link linkend="onDelete_annotation">@OnDelete</link>, <link linkend="onDeleteInverse_annotation">@OnDeleteInverse</link> атрибутов сущности.</para>
          <para>Аннотация <code>@OnDelete</code> обрабатывается при удалении той сущности, в которой она встретилась, а не той, на которую указывает аннотированный атрибут (в этом отличие от каскадных удалений на уровне БД).
</para>
          <para>
Аннотация <code>@OnDeleteInverse</code> обрабатывается при удалении той сущности, на которую указывает аннотированный атрибут, (т.е. аналогично каскадному удалению на уровне внешних ключей в БД). Эта аннотация полезна при отсутствии в удаляемом объекте атрибута, который нужно проверять при удалении. При этом, как правило, в проверяемом объекте существует ссылка на удаляемый, на этот атрибут и устанавливается аннотация <code>@OnDeleteInverse</code>. </para>
          <para>Значением аннотации может быть: <itemizedlist>
              <listitem>
                <para><code>DeletePolicy.DENY</code> - запретить удаление сущности, если аннотированный атрибут не <code>null</code> или не пустая коллекция </para>
              </listitem>
              <listitem>
                <para><code>DeletePolicy.CASCADE</code> - каскадно удалить аннотированный атрибут </para>
              </listitem>
              <listitem>
                <para><code>DeletePolicy.UNLINK</code> - разорвать связь с аннотированным атрибутом. Разрыв связи имеет смысл указывать только на ведущей стороне ассоциации - той, которая в  классе сущности аннотирована <code>@JoinColumn</code>. </para>
              </listitem>
            </itemizedlist></para>
          <para>Примеры: <orderedlist>
              <listitem>
                <para>Запрет удаления при наличии ссылки: при попытке удаления экземпляра <code>Customer</code>, на который ссылается хотя бы один <code>Order</code>, будет выброшено исключение <code>DeletePolicyException</code>.</para>
                <para><filename>Order.java</filename><programlisting>@ManyToOne(fetch = FetchType.LAZY)
@JoinColumn(name = &quot;CUSTOMER_ID&quot;)
@OnDeleteInverse(DeletePolicy.DENY)
protected Customer customer;</programlisting></para>
                <para><filename>Customer.java</filename><programlisting>@OneToMany(mappedBy = &quot;customer&quot;)
protected List&lt;Order&gt; orders;</programlisting></para>
              </listitem>
              <listitem>
                <para>Каскадное удаление элементов коллекции: при удалении экземпляра <code>Role</code> все экземпляры <code>Permission</code> также будут удалены.</para>
                <para><filename>Role.java</filename><programlisting>@OneToMany(mappedBy = &quot;role&quot;)
@OnDelete(DeletePolicy.CASCADE)
protected Set&lt;Permission&gt; permissions;</programlisting></para>
                <para><filename>Permission.java</filename><programlisting>@ManyToOne(fetch = FetchType.LAZY)
@JoinColumn(name = &quot;ROLE_ID&quot;)
protected Role role;</programlisting></para>
              </listitem>
              <listitem>
                <para>Разрыв связи с элементами коллекции: удаление экземпляра <code>Role</code> приведет к установке в <code>null</code> ссылок со стороны всех входивших в коллекцию экземпляров <code>Permission</code>.</para>
                <para><filename>Role.java</filename><programlisting>@OneToMany(mappedBy = &quot;role&quot;)
@OnDelete(DeletePolicy.UNLINK)
protected Set&lt;Permission&gt; permissions;</programlisting></para>
                <para><filename>Permission.java</filename><programlisting>@ManyToOne(fetch = FetchType.LAZY)
@JoinColumn(name = &quot;ROLE_ID&quot;)
protected Role role;</programlisting></para>
              </listitem>
            </orderedlist></para>
          <para>Особенности реализации:<orderedlist>
              <listitem>
                <para>Нужно быть  осторожным при использовании <code>@OnDeleteInverse</code> с политиками <code>CASCADE</code> и <code>UNLINK</code>, так как при этом происходит извлечение из БД на сервер приложения всех экземпляров ссылающихся объектов, изменение и затем сохранение. </para>
                <para>Например, в случае ассоциации <code>Customer</code> - <code>Job</code> и большого количества работ для одного заказчика, если поставить на атрибут <code>Job.customer</code> политику <code>@OnDeleteInverse(CASCADE)</code>, то при удалении экземпляра заказчика будет предпринята попытка извлечь и изменить все его работы. Это может привести  к перегрузке сервера приложения и  БД.</para>
                <para>С другой стороны, использование <code>@OnDeleteInverse(DENY)</code> безопасно, так как при этом производится только подсчет количества ссылающихся объектов, и если оно больше <literal>0</literal>, выбрасывается исключение. Поэтому <code>@OnDeleteInverse(DENY)</code> для атрибута <code>Job.customer</code> вполне допустимо. </para>
              </listitem>
              <listitem>
                <para>Политика обработки связей реализуется   с помощью <link linkend="entity_listeners">Entity Listeners</link>, то есть при сохранении данных в БД  на <link linkend="app_tiers">уровне</link> Middleware.</para>
              </listitem>
            </orderedlist> </para>
        </section>
        <section>
          <title>Ограничение уникальности на уровне БД</title>
          <para>В режиме мягкого удаления для ограничения уникальности некоторого значения необходимо обеспечить существование единственной неудаленной записи с этим значением, и произвольного количества удаленных записей с этим же значением.</para>
          <para>Реализуется данная логика путем, специфичным для используемого сервера базы данных:<itemizedlist>
              <listitem>
                <para>Если сервер БД поддерживает частичные (partial) индексы (например <application>PostgreSQL</application>), то ограничение уникальности можно создать следующим образом:<programlisting>create unique index IDX_SEC_USER_UNIQ_LOGIN on SEC_USER (LOGIN_LC) where DELETE_TS is null</programlisting></para>
              </listitem>
              <listitem>
                <para>Если сервер БД не поддерживает частичные индексы (например <application>Microsoft SQL Server 2005</application>), то в уникальный индекс можно включить поле <database>DELETE_TS</database>:<programlisting>create unique index IDX_SEC_USER_UNIQ_LOGIN on SEC_USER (LOGIN_LC, DELETE_TS)</programlisting></para>
              </listitem>
            </itemizedlist></para>
        </section>
      </section>
      <section id="entity_listeners">
        <title>Entity Listeners</title>
        <para><firstterm>Entity Listeners</firstterm> предназначены для реакции на события жизненного цикла экземпляров сущностей на <link linkend="app_tiers">уровне</link><structname> Middleware</structname>.</para>
        <para>Слушатель представляет собой класс, реализующий один или несколько интерфейсов пакета <code>com.haulmont.cuba.core.listener</code>. Слушатель будет реагировать на события  типов, соответствующих реализуемым интерфейсам.</para>
        <variablelist>
          <varlistentry>
            <term>
              <code>BeforeDetachEntityListener</code>
            </term>
            <listitem>
              <para>Метод <code>onBeforeDetach()</code> вызывается  перед отделением объекта от <code>
                  <link linkend="entityManager">EntityManager</link>
                </code> при коммите транзакции.</para>
              <para>Данный слушатель можно использовать например для заполнения неперсистентных атрибутов сущности перед отправкой ее на клиентский уровень.</para>
            </listitem>
          </varlistentry>
          <varlistentry>
            <term>
              <code>BeforeInsertEntityListener</code>
            </term>
            <listitem>
              <para>Метод <code>onBeforeInsert()</code> вызывается перед выполнением вставки записи в БД. В данном методе возможны любые операции с текущим <code>
                  <link linkend="entityManager">EntityManager</link>
                </code>.</para>
            </listitem>
          </varlistentry>
          <varlistentry>
            <term>
              <code>AfterInsertEntityListener</code>
            </term>
            <listitem>
              <para>Метод <code>onAfterInsert()</code> вызывается после выполнения вставки записи в БД, но до коммита транзакции. В данном методе нельзя модифицировать текущий персистентный контекст, однако можно производить изменения в БД с помощью <link linkend="queryRunner">
                  <code>QueryRunner</code>
                </link>.</para>
            </listitem>
          </varlistentry>
          <varlistentry>
            <term>
              <code>BeforeUpdateEntityListener</code>
            </term>
            <listitem>
              <para>Метод <code>onBeforeUpdate()</code> вызывается перед изменением записи в БД. В данном методе возможны любые операции с текущим <code>
                  <link linkend="entityManager">EntityManager</link>
                </code>.</para>
            </listitem>
          </varlistentry>
          <varlistentry>
            <term>
              <code>AfterUpdateEntityListener</code>
            </term>
            <listitem>
              <para>Метод <code>onAfterUpdate()</code> вызывается после изменения записи в БД, но до коммита транзакции. В данном методе нельзя модифицировать текущий персистентный контекст, однако можно производить изменения в БД с помощью <link linkend="queryRunner">
                  <code>QueryRunner</code>
                </link>.</para>
            </listitem>
          </varlistentry>
          <varlistentry>
            <term>
              <code>BeforeDeleteEntityListener</code>
            </term>
            <listitem>
              <para>Метод <code>onBeforeDelete()</code> вызывается перед удалением записи из БД (или в случае <link linkend="soft_deletion">мягкого удаления</link> - перед изменением записи). В данном методе возможны любые операции с текущим <code>
                  <link linkend="entityManager">EntityManager</link>
                </code>.</para>
            </listitem>
          </varlistentry>
          <varlistentry>
            <term>
              <code>AfterDeleteEntityListener</code>
            </term>
            <listitem>
              <para>Метод <code>onAfterDelete()</code> вызывается после удаления записи из БД (или в случае <link linkend="soft_deletion">мягкого удаления</link> - после изменения записи), но до коммита транзакции. В данном методе нельзя модифицировать текущий персистентный контекст, однако можно производить изменения в БД с помощью <link linkend="queryRunner">
                  <code>QueryRunner</code>
                </link>.</para>
            </listitem>
          </varlistentry>
        </variablelist>
        <para>Entity Listener  может быть задан 2-мя способами: <itemizedlist>
            <listitem>
              <para>Статически - имена классов слушателей указываются в аннотации <link linkend="listeners_annotation">
                  <code>@Listeners</code>
                </link> на классе сущности</para>
            </listitem>
            <listitem>
              <para>Динамически - класс сущности и слушателя передаются в метод <code>addListener()</code> бина <code>EntityListenerManager</code>, например: <programlisting>@ManagedBean
public class MyBean implements AppContext.Listener {

    @Inject
    private EntityListenerManager entityListenerManager;

    public ClusterManager() {
        AppContext.addListener(this);
    }

    @Override
    public void applicationStarted() {
        entityListenerManager.addListener(User.class, MyUserListener.class);
    }

    @Override
    public void applicationStopped() {
    }
}</programlisting></para>
            </listitem>
          </itemizedlist></para>
        <para>Для всех экземпляров некоторого класса сущности создается и кэшируется <emphasis>один</emphasis> экземпляр слушателя определенного типа, поэтому слушатель <emphasis>не должен иметь состояния</emphasis>.</para>
        <para>Если для сущности объявлены несколько слушателей одного типа (например аннотациями класса сущности и его предков, плюс динамически), то их вызов будет выполняться в следующем порядке:<orderedlist>
            <listitem>
              <para>Для каждого предка начиная с самого дальнего вызываются его динамически добавленные слушатели, затем статически назначенные.</para>
            </listitem>
            <listitem>
              <para>После всех предков вызываются  динамически добавленные слушатели  данного класса, затем статически назначенные.</para>
            </listitem>
          </orderedlist></para>
      </section>
    </section>
    <section id="metadata_framework">
      <title>Metadata Framework</title>
      <para>Для эффективной работы с <link linkend="data_model">моделью данных</link> в CUBA-приложениях используется фреймворк метаданных, который:</para>
      <itemizedlist>
        <listitem>
          <para>предоставляет удобный интерфейс для получения информации о <glossterm linkend="entity">сущностях</glossterm>, их атрибутах и отношениях между сущностями; а также для навигации по ссылкам</para>
        </listitem>
        <listitem>
          <para>служит специализированной и более удобной в использовании альтернативой <application>Java Reflection API</application></para>
        </listitem>
        <listitem>
          <para>регламентирует допустимые типы данных и отношений между сущностями</para>
        </listitem>
        <listitem>
          <para>позволяет создавать универсальные механизмы работы с данными</para>
        </listitem>
      </itemizedlist>
      <section>
        <title>Интерфейсы метаданных</title>
        <para>Рассмотрим основные интерфейсы метаданных.</para>
        <figure>
          <title>Интерфейсы фреймворка метаданных</title>
          <mediaobject>
            <imageobject>
              <imagedata contentwidth="80%" align="center" fileref="img/MetadataFramework.png"/>
            </imageobject>
          </mediaobject>
        </figure>
        <variablelist>
          <varlistentry>
            <term>
              <code>Session</code>
            </term>
            <listitem>
              <para>Точка входа в фреймворк метаданных. Позволяет получать экземпляры <code>MetaClass</code> по имени и по соответствующему классу Java. Обратите внимание на различие методов <code>getClass()</code> и <code>getClassNN()</code> - первые могут возвращать <code>null</code>, вторые нет (NonNull).</para>
              <para>Объект <code>Session</code> может быть получен через интерфейс инфраструктуры <code>
                  <link linkend="metadata">Metadata</link>
                </code>.</para>
              <para>Пример:<programlisting>@Inject
protected Metadata metadata;
...
Session session = metadata.getSession();
MetaClass metaClass1 = session.getClassNN(&quot;sec$User&quot;);
MetaClass metaClass2 = session.getClassNN(User.class);
assert metaClass1 == metaClass2;</programlisting></para>
            </listitem>
          </varlistentry>
          <varlistentry>
            <term>
              <code>MetaModel</code>
            </term>
            <listitem>
              <para>Редко используемый интерфейс, служит для группировки мета-классов. </para>
              <para>Группировка осуществляется по первым  трем частям имени пакета Java класса сущности. Например, мета-класс сущности <code>com.abc.sales.entity.Customer</code> принадлежит мета-модели с именем <code>com.abc.sales</code></para>
            </listitem>
          </varlistentry>
          <varlistentry id="metaClass">
            <term>
              <code>MetaClass</code>
            </term>
            <listitem>
              <para>Интерфейс метаданных класса сущности. <code>MetaClass</code> всегда ассоциирован с классом Java, которого он представляет.</para>
              <para>Основные методы:</para>
              <itemizedlist>
                <listitem>
                  <para><code>getName()</code> – имя сущности, по соглашению первой частью имени до знака <code>$</code> является код пространства имен, например, <code>sales$Customer</code></para>
                </listitem>
                <listitem>
                  <para><code>getProperties()</code> – список мета-свойств (<code>MetaProperty</code>)</para>
                </listitem>
                <listitem>
                  <para><code>getProperty()</code>, <code>getPropertyNN()</code> - получение мета-свойства по имени. Первый метод в случае отсутствия атрибута с указанным именем возвращает <code>null</code>, второй выбрасывает исключение.</para>
                  <para>Пример:<programlisting>MetaClass userClass = session.getClassNN(User.class);
MetaProperty groupProperty = userClass.getPropertyNN(&quot;group&quot;);</programlisting></para>
                </listitem>
                <listitem>
                  <para><code>getPropertyPath()</code> - позволяет перемещаться по ссылкам. Данный метод принимает строковый параметр - путь из имен атрибутов, разделенных точкой. Возвращаемый объект <code>MetaPropertyPath</code> позволяет обратиться к искомому (последнему в пути) атрибуту вызовом <code>getMetaProperty()</code>. </para>
                  <para>Пример:<programlisting>MetaClass userClass = session.getClassNN(User.class);
MetaProperty groupNameProp = userClass.getPropertyPath(&quot;group.name&quot;).getMetaProperty();
assert groupNameProp.getDomain().getName().equals(&quot;sec$Group&quot;);</programlisting></para>
                </listitem>
                <listitem>
                  <para><code>getJavaClass()</code> – класс сущности, которому соответствует данный <code>MetaClass</code></para>
                </listitem>
                <listitem>
                  <para><code>getAnnotations()</code> – коллекция <link linkend="meta_annotations">мета-аннотаций</link> </para>
                </listitem>
              </itemizedlist>
            </listitem>
          </varlistentry>
          <varlistentry id="metaProperty">
            <term>
              <code>MetaProperty</code>
            </term>
            <listitem>
              <para>Интерфейс метаданных атрибута сущности. </para>
              <para>Основные методы:</para>
              <itemizedlist>
                <listitem>
                  <para><code>getName()</code> – имя свойства, соответствует имени атрибута сущности</para>
                </listitem>
                <listitem>
                  <para><code>getDomain()</code> – мета-класс, которому принадлежит данное свойство</para>
                </listitem>
                <listitem id="metaProperty.getType">
                  <para><code>getType() </code>– тип свойства:<itemizedlist>
                      <listitem>
                        <para>простой тип: <code>DATATYPE</code></para>
                      </listitem>
                      <listitem>
                        <para>перечисление: <code>ENUM</code></para>
                      </listitem>
                      <listitem>
                        <para>ссылочный тип двух видов:</para>
                        <itemizedlist>
                          <listitem>
                            <para><code>ASSOCIATION</code> − простая ссылка на другую сущность. Например, отношение заказа и покупателя − ассоциация.</para>
                          </listitem>
                          <listitem>
                            <para><code>COMPOSITION</code> − ссылка на сущность, которая не имеет самостоятельного значения без владеющей сущности. <code>COMPOSITION</code> можно считать &quot;более тесным&quot; отношением, чем <code>ASSOCIATION</code>. Например, отношение заказа и пункта этого заказа − <code>COMPOSITION</code>, т.к. пункт не может существовать без заказа, которому он принадлежит.</para>
                          </listitem>
                        </itemizedlist>
                        <para>Вид ссылочного атрибута <code>ASSOCIATION</code> или <code>COMPOSITION</code> влияет на режим редактирования сущности: в первом случае сохранение связанной сущности в базу данных происходит независимо, а во втором − связанная сущность сохраняется в БД только вместе с владеющей сущностью.</para>
                      </listitem>
                    </itemizedlist></para>
                </listitem>
                <listitem>
                  <para><code>getRange()</code> –  интерфейс <code>Range</code>, детально описывающий тип данного атрибута</para>
                </listitem>
                <listitem>
                  <para><code>isMandatory()</code> – признак обязательности атрибута. Используется, например, визуальными компонентами для сигнализации пользователю о необходимости ввода значения.</para>
                </listitem>
                <listitem>
                  <para><code>isReadOnly()</code> – признак неизменности атрибута</para>
                </listitem>
                <listitem>
                  <para><code>getInverse()</code> – для ссылочного атрибута возвращает мета-свойство с обратной стороны ассоциации, если таковое имеется</para>
                </listitem>
                <listitem>
                  <para><code>getAnnotatedElement()</code> – поле (<code>java.lang.reflect.Field</code>) или метод (<code>java.lang.reflect.Method</code>), соответствующие данному атрибуту сущности</para>
                </listitem>
                <listitem>
                  <para><code>getJavaType()</code> – класс Java данного атрибута сущности. Это либо тип поля класса, либо тип возвращаемого значения метода.</para>
                </listitem>
                <listitem>
                  <para><code>getDeclaringClass()</code> – класс Java, содержащий данный атрибут</para>
                </listitem>
              </itemizedlist>
            </listitem>
          </varlistentry>
          <varlistentry>
            <term>
              <code>Range</code>
            </term>
            <listitem>
              <para>Интерфейс, детально описывающий тип атрибута сущности.</para>
              <para>Основные методы:</para>
              <itemizedlist>
                <listitem>
                  <para><code>isDatatype()</code> – возвращает <code>true</code> для атрибута простого  <link linkend="metaProperty.getType">типа</link></para>
                </listitem>
                <listitem>
                  <para><code>asDatatype()</code> - возвращает <link linkend="datatype">
                      <code>Datatype</code>
                    </link> для атрибута простого <link linkend="metaProperty.getType">типа</link></para>
                </listitem>
                <listitem>
                  <para><code>isEnum()</code> – возвращает <code>true</code> для атрибута <link linkend="metaProperty.getType">типа</link> перечисления</para>
                </listitem>
                <listitem>
                  <para><code>asEnumeration()</code> - возвращает <link linkend="datatype">
                      <code>Enumeration</code>
                    </link> для атрибута  <link linkend="metaProperty.getType">типа</link> перечисления</para>
                </listitem>
                <listitem>
                  <para><code>isClass()</code> – возвращает <code>true</code> для ссылочного атрибута <link linkend="metaProperty.getType"> типа</link>  <code>ASSOCIATION</code> или <code>COMPOSITION</code></para>
                </listitem>
                <listitem>
                  <para><code>asClass()</code> - возвращает <link linkend="metaClass">мета-класс</link> ассоциированной сущности для ссылочного атрибута</para>
                </listitem>
                <listitem>
                  <para><code>isOrdered()</code> – возвращает <code>true</code>  если атрибут представляет собой упорядоченную коллекцию (например <code>List</code>)</para>
                </listitem>
                <listitem>
                  <para><code>getCardinality()</code> – вид отношения для ссылочного атрибута: <code>ONE_TO_ONE</code>, <code>MANY_TO_ONE</code>, <code>ONE_TO_MANY</code>, <code>MANY_TO_MANY</code></para>
                </listitem>
              </itemizedlist>
            </listitem>
          </varlistentry>
        </variablelist>
      </section>
      <section>
        <title>Формирование метаданных</title>
        <para>Основной источник формирования структуры метаданных - <link linkend="entity_annotations">аннотированные</link> классы сущностей. </para>
        <para>Класс сущности отражается в метаданные в следующих случаях: <itemizedlist>
            <listitem>
              <para>Класс персистентной сущности аннотирован <code>@Entity</code>, <code>@Embeddable</code>, <code>@MappedSuperclass</code> и зарегистрирован в файле <filename>
                  <link linkend="persistence.xml">persistence.xml</link>
                </filename></para>
            </listitem>
            <listitem>
              <para>Класс неперсистентной сущности аннотирован <code>@MetaClass</code> и зарегистрирован в файле <filename>
                  <link linkend="metadata.xml">metadata.xml</link>
                </filename></para>
            </listitem>
          </itemizedlist></para>
        <para>Атрибут сущности отражается в метаданных, если: <itemizedlist>
            <listitem>
              <para>поле класса аннотировано <code>@Column</code>, <code>@OneToOne</code>, <code>@OneToMany</code>, <code>@ManyToOne</code>, <code>@ManyToMany</code>, <code>@Embedded</code></para>
            </listitem>
            <listitem>
              <para>поле класса или метод доступа на чтение (getter) аннотирован <code>@MetaProperty</code></para>
            </listitem>
          </itemizedlist></para>
        <para>Параметры мета-класса и мета-свойств формируются на основе параметров перечисленных <link linkend="entity_annotations">аннотаций</link>, а также типов полей и методов класса. Кроме того, если у атрибута отсутствует метод доступа на запись (setter), атрибут становится неизменяемым (read only). </para>
        <warning>
          <title>Внимание</title>
          <para>Текущая реализация сборки метаданных имеет следующие ограничения:<itemizedlist>
              <listitem>
                <para>Классы сущностей должны размещаться в пакетах, имеющих не менее 3-х уровней иерархии, например <code>com.abc.sales</code>, <code>com.abc.sales.entity</code></para>
              </listitem>
              <listitem>
                <para>Персистентные сущности не могут ссылаться на неперсистентные. Обратное возможно, т.е. неперсистентная сущность может иметь атрибут типа некоторой персистентной сущности.</para>
              </listitem>
            </itemizedlist> </para>
        </warning>
      </section>
      <section>
        <title id="datatype">Datatype</title>
        <para>Интерфейс <code>Datatype</code> описывает тип данных, допустимый для  атрибута сущности, не являющегося ассоциацией. Каждый экземпляр реализации <code>Datatype</code> соответствует одному классу Java, для работы с которым он предназначен.</para>
        <para>Все экземпляры зарегистрированы в репозитории - классе <code>Datatypes</code>, который выполняет загрузку и инициализацию классов реализации <code>Datatype</code> следующим образом:<itemizedlist>
            <listitem>
              <para>в корне <literal>CLASSPATH</literal> ищется файл <filename>
                  <link linkend="datatypes.xml">datatypes.xml</link>
                </filename>, и если он найден, репозиторий <code>Datatypes</code> инициализируется из него</para>
            </listitem>
            <listitem>
              <para>в противном случае инициализация <code>Datatypes</code> производится из файла <filename>/com/haulmont/chile/core/datatypes/<link linkend="datatypes.xml">datatypes.xml</link></filename></para>
            </listitem>
          </itemizedlist></para>
        <para>Экземпляр <code>Datatype</code> может быть получен двумя способами:<itemizedlist>
            <listitem>
              <para>из мета-свойства типа <code>
                  <link linkend="metaProperty.getType">DATATYPE</link>
                </code>, вызовом <code>getRange().asDatatype()</code></para>
            </listitem>
            <listitem>
              <para>статическим методом <code>Datatypes.get()</code>, передавая в него имя реализации <code>Datatype</code> или класс Java, для которого он создан.</para>
            </listitem>
          </itemizedlist></para>
        <para>Основные методы интерфейса <code>Datatype</code>:<itemizedlist>
            <listitem>
              <para><code>getName()</code> - возвращает уникальное имя данной реализации</para>
            </listitem>
            <listitem>
              <para><code>format()</code> - преобразовывает переданное значение в строку</para>
            </listitem>
            <listitem>
              <para><code>parse()</code> - преобразовывает строку в значение нужного типа </para>
            </listitem>
          </itemizedlist></para>
        <para><code>Datatype</code> определяет два набора методов для форматирования/парсинга: с учетом локали и без учета локали. Преобразование с учетом локали используется повсеместно в пользовательском интерфейсе, преобразование без учета локали используется в системных механизмах, например для сериализации в <link linkend="rest_api">REST API</link>. </para>
        <para>Форматы для преобразований без учета локали задаются в вышеупомянутом файле <filename>
            <link linkend="datatypes.xml">datatypes.xml</link>
          </filename>.</para>
        <para>Форматы для преобразований с учетом локали задаются в <glossterm linkend="main_message_pack_glossentry">главных пакетах локализованных сообщений</glossterm>, в  строках со следующими ключами:<itemizedlist>
            <listitem>
              <para><literal>numberDecimalSeparator</literal></para>
            </listitem>
            <listitem>
              <para><literal>numberGroupingSeparator</literal></para>
            </listitem>
            <listitem>
              <para><literal>integerFormat</literal></para>
            </listitem>
            <listitem>
              <para><literal>doubleFormat</literal></para>
            </listitem>
            <listitem>
              <para><literal>dateTimeFormat</literal></para>
            </listitem>
            <listitem>
              <para><literal>dateFormat</literal></para>
            </listitem>
            <listitem>
              <para><literal>timeFormat</literal></para>
            </listitem>
            <listitem>
              <para><literal>trueString</literal></para>
            </listitem>
            <listitem>
              <para><literal>falseString</literal></para>
            </listitem>
          </itemizedlist>Все перечисленные форматы по умолчанию заданы в <glossterm linkend="main_message_pack_glossentry">главных пакетах локализованных сообщений</glossterm> <link linkend="base_projects">базового проекта</link> <structname>cuba</structname>, и могут быть переопределены в аналогичных файлах проекта приложения.</para>
        <section>
          <title>Пример форматирования даты в UI</title>
          <para>Рассмотрим отображение атрибута <code>Order.date</code> в таблице браузера заказов.</para>
          <para>order-browse.xml<programlisting>&lt;table id=&quot;ordersTable&quot;&gt;
    ...
    &lt;columns&gt;
        &lt;column id=&quot;date&quot;/&gt;
        ...</programlisting></para>
          <para>Атрибут <code>date</code>  в классе <code>Order</code> определен с типом &quot;дата&quot;:<programlisting>@Column(name = &quot;DATE&quot;, nullable = false)
@Temporal(TemporalType.DATE)
private Date date;</programlisting></para>
          <para>Если текущий пользователь зарегистрирован c русской локалью, то из <glossterm linkend="main_message_pack_glossentry">главного пакета</glossterm> локализованных сообщений клиентского <link linkend="app_tiers">уровня</link>, из файла <filename>messages_ru.properties</filename> извлекается строка:<programlisting>dateFormat=dd.MM.yyyy</programlisting></para>
          <para>Результат: дата &quot;6 августа 2012 года&quot; конвертируется в строку &quot;06.08.2012&quot; для отображения в ячейке таблицы.</para>
        </section>
        <section>
          <title>Примеры форматирования дат и чисел в коде приложения</title>
          <itemizedlist>
            <listitem>
              <para>Пример форматирования даты<programlisting>@Inject
protected UserSessionSource userSessionSource;
...
Date date = ...;
String dateStr = Datatypes.get(Date.class).format(date, userSessionSource.getLocale());</programlisting></para>
            </listitem>
            <listitem>
              <para>Пример форматирования числового значения с повышенной точностью  (5 знаков после запятой) в <link linkend="app_tiers">блоке</link> <structname>Web Client</structname></para>
              <para><filename>/com/abc/sales/web/messages_ru.properties</filename><programlisting>coordinateFormat = #,##0.00000</programlisting></para>
              <para><filename>SomeClass.java</filename><programlisting>@Inject
protected Messages messages;
@Inject
protected UserSessionSource userSessionSource;
...
String coordinateFormat = messages.getMainMessage(&quot;coordinateFormat&quot;);
FormatStrings formatStrings = Datatypes.getFormatStrings(userSessionSource.getLocale());
NumberFormat format = new DecimalFormat(coordinateFormat, formatStrings.getFormatSymbols());

String formattedValue = format.format(value);</programlisting></para>
            </listitem>
          </itemizedlist>
        </section>
      </section>
      <section id="meta_annotations">
        <title>Мета-аннотации</title>
        <para>Мета-аннотации сущностей - набор пар ключ/значение, содержащих дополнительную информацию о сущностей.</para>
        <para>Обращение к мета-аннотациям  производится с помощью метода <link linkend="metaClass">мета-класса</link> <code>getAnnotations()</code>.</para>
        <para>Источниками мета-аннотаций сущности являются:<itemizedlist>
            <listitem>
              <para><link linkend="entity_annotations">Аннотации</link>  <code>@OnDelete</code>, <code>@OnDeleteInverse</code>, <code>@Extends</code>. При этом в мета-аннотациях создаются служебные объекты связей между сущностями. </para>
            </listitem>
            <listitem>
              <para><link linkend="entity_annotations">Аннотации</link>  <code>@SystemLevel</code>, <code>@EnableRestore</code>, <code>@TrackEditScreenHistory</code>. При этом создаются  мета-аннотации с ключами, соответствующими полному имени класса Java аннотации. </para>
            </listitem>
            <listitem>
              <para>Опционально: в прикладном проекте могут быть определены свои аннотации для сущностей, и в <link linkend="extension">переопределенном</link> методе <code>MetadataImpl.initMetaAnnotations()</code> отображены в соответствующие мета-аннотации. </para>
            </listitem>
            <listitem>
              <para>Опционально: в файлах <filename>
                  <link linkend="metadata.xml">metadata.xml</link>
                </filename> также могут быть определены мета-аннотации сущностей. Если мета-аннотация в XML имеет то же имя, что и мета-аннотация, созданная по Java аннотации класса сущности, первая переопределит значение второй. </para>
              <para>Пример определения мета-аннотаций в <filename>
                  <link linkend="metadata.xml">metadata.xml</link>
                </filename>:<programlisting>&lt;annotations&gt;
    &lt;entity class=&quot;com.haulmont.cuba.security.entity.User&quot;&gt;
        &lt;annotation name=&quot;com.haulmont.cuba.core.entity.annotation.TrackEditScreenHistory&quot; value=&quot;false&quot;/&gt;
        &lt;annotation name=&quot;com.haulmont.cuba.core.entity.annotation.EnableRestore&quot; value=&quot;true&quot;/&gt;
    &lt;/entity&gt;
&lt;/annotations&gt;</programlisting></para>
            </listitem>
          </itemizedlist></para>
      </section>
    </section>
    <section id="views">
      <title>Представления</title>
      <section>
        <title>Общие сведения</title>
        <para>При извлечении сущностей из базы данных обычно встает вопрос - как обеспечить загрузку связанных сущностей на нужную глубину? </para>
        <para>Например,  для браузера Заказов нужно отобразить дату и сумму заказа совместно с названием Покупателя, т.е. загрузить связанный экземпляр Покупателя. А для экрана редактирования Заказа необходимо загрузить еще и коллекцию Пунктов заказа, причем каждый Пункт заказа должен содержать связанный экземпляр Товара для отображения его наименования. </para>
        <para><glossterm linkend="lazy_loading">Загрузка по требованию</glossterm> в большинстве случаев не может помочь, так как обработка данных как правило происходит не в транзакции, в которой загружаются сущности, а, например, на клиентском <link linkend="app_tiers">уровне</link> в пользовательском интерфейсе. В то же время задание <glossterm linkend="eager_fetching">энергичной загрузки</glossterm> в <link linkend="entity_annotations">аннотациях сущностей</link> недопустимо, так как приводит к постоянному извлечению всего графа связанных сущностей, который может быть очень большим.</para>
        <para>Другой похожей проблемой является ограничение набора <glossterm linkend="local_attribute">локальных</glossterm> атрибутов сущностей загружаемого графа: например, некоторая сущность имеет 50 атрибутов, в том числе BLOB, а в экране отображается только 10 атрибутов. Зачем загружать из БД, затем сериализовать и передавать клиенту 40 атрибутов, которые ему в данный момент не нужны?</para>
        <para>Механизм <firstterm>представлений</firstterm> (views)  решает эти проблемы, обеспечивая извлечение из базы данных и передачу клиенту графов сущностей, ограниченных в глубину и по атрибутам. <firstterm>Представление</firstterm> является описателем графа объектов, который требуется в некотором экране UI или другом процессе обработки данных.</para>
        <para>Обработка представлений производится следующим образом:<itemizedlist>
            <listitem>
              <para>все связи в модели данных объявляются с признаком <glossterm linkend="lazy_loading">загрузки по требованию</glossterm> (<code>fetch = FetchType.LAZY</code>, см. <xref linkend="entity_annotations"/>)</para>
            </listitem>
            <listitem>
              <para>в процессе загрузки данных через <link linkend="dataService">DataService</link> клиентский код помимо <glossterm linkend="jpql">JPQL</glossterm> запроса указывает нужное  представление</para>
            </listitem>
            <listitem>
              <para>на основе представления формируется так называемый <firstterm>Fetch Plan</firstterm> - особенность лежащего в основе <link linkend="orm">слоя ORM</link> фреймворка <application>Apache OpenJPA</application>. Fetch Plan влияет на формирование SQL запроса к базе данных: как на список возвращаемых полей, так и на соединения с другими таблицами, содержащими связанные сущности.</para>
            </listitem>
            <listitem>
              <para>ссылки, не включенные в Fetch Plan (иногда это полезно  для упрощения основного SQL запроса), загружаются отдельными SQL запросами, для чего механизм обработки представлений просто обращается к соответствующим методам чтения атрибутов</para>
            </listitem>
            <listitem>
              <para>в результате на момент завершения <link linkend="transactions">транзакции</link>, загружающей данные, в памяти <structname>Middleware</structname> содержится граф объектов, заданный  JPQL запросом и представлением.</para>
            </listitem>
          </itemizedlist></para>
        <figure>
          <title>Классы представления</title>
          <mediaobject>
            <imageobject>
              <imagedata align="center" fileref="img/View.png"/>
            </imageobject>
          </mediaobject>
        </figure>
        <para>Представление определяется экземпляром класса <code>View</code>, в котором:<itemizedlist>
            <listitem>
              <para><code>entityClass</code> - класс сущности, для  которого определено представление. Другими словами, &quot;корень&quot; дерева загружаемых сущностей.</para>
            </listitem>
            <listitem>
              <para><code>name</code> - имя представления. Должно быть либо <code>null</code>, либо уникальным в пределах данной сущности.</para>
            </listitem>
            <listitem>
              <para><code>properties</code> - коллекция экземпляров класса ViewProperty, соответствующих загружаемым атрибутам сущности.</para>
            </listitem>
            <listitem>
              <para><code>includeSystemProperties</code> - признак включения системных атрибутов (входящих в состав <link linkend="entity_base_classes">базовых интерфейсов</link> персистентных сущностей <code>BaseEntity</code> и  <code>Updatable</code>). Системные атрибуты не перечисляются в <code>properties</code>  явно, а учитываются механизмом обработки представлений в зависимости от того, какие интерфейсы реализует данная сущность.</para>
            </listitem>
          </itemizedlist></para>
        <para>Класс <code>ViewProperty</code> имеет следующие свойства:<itemizedlist>
            <listitem>
              <para><code>name</code> - имя атрибута сущности</para>
            </listitem>
            <listitem>
              <para><code>view</code> - для ссылочных атрибутов задает представление, с которым необходимо загружать связанную сущность</para>
            </listitem>
            <listitem>
              <para><code>lazy</code> - для ссылочных атрибутов признак того, что данный атрибут нужно не  включать в Fetch Plan, а загружать отдельным SQL запросом, инициированным обращением к атрибуту. Следует иметь в виду, что атрибут в любом случае будет загружен на момент окончания транзакции, данный признак влияет только на способ загрузки. </para>
            </listitem>
          </itemizedlist></para>
        <warning>
          <para>Независимо от набора атрибутов, определенного в представлении, всегда загружаются следующие атрибуты:<itemizedlist>
              <listitem>
                <para><code>id</code> - идентификатор сущности</para>
              </listitem>
              <listitem>
                <para><code>version</code> - для оптимистично блокируемых сущностей, реализующих <code>Versioned</code></para>
              </listitem>
              <listitem>
                <para><code>deleteTs</code>, <code>deletedBy</code> - для сущностей, реализующих <code>
                    <link linkend="soft_deletion">SoftDelete</link>
                  </code></para>
              </listitem>
            </itemizedlist></para>
        </warning>
      </section>
      <section>
        <title>Создание представлений</title>
        <para>Представление может быть создано двумя путями:<itemizedlist>
            <listitem>
              <para><emphasis role="bold">программно</emphasis> - созданием экземпляра <code>View</code>, например:<programlisting>View view = new View(Order.class)
        .addProperty(&quot;date&quot;)
        .addProperty(&quot;amount&quot;)
        .addProperty(&quot;customer&quot;, new View(Customer.class)
            .addProperty(&quot;name&quot;)
        );</programlisting></para>
              <para>Как правило, таким способом создаются представления, используемые только в каком-то одном месте бизнес-логики.</para>
              <warning>
                <para>Механизм обработки представлений кэширует создаваемые для <emphasis>именованных</emphasis> представлений объекты Fetch Plan. Это означает, что если Вы <emphasis>программно</emphasis> создадите два представления для одной сущности с одинаковыми именами, но с разным набором атрибутов, то выборка со вторым представлением окажется неверной.</para>
                <para>Поэтому никогда не задавайте имен для &quot;одноразовых&quot; представлений, создаваемых программно.</para>
              </warning>
            </listitem>
            <listitem>
              <para><emphasis role="bold">декларативно</emphasis> - путем создания описателя на XML и его развертывания в репозитории представлений <code>ViewRepository</code>. При развертывании на основе XML-описателя создаются и кэшируются экземпляры <code>View</code>. В дальнейшем в любом месте кода приложения требуемое представление можно получить вызовом репозитория с указанием класса сущности и имени представления.</para>
            </listitem>
          </itemizedlist></para>
        <para>Рассмотрим подробнее декларативный способ создания и работы с представлениями.</para>
        <para>Ссылка на <code>ViewRepository</code> может быть получена через интерфейс инфраструктуры <code>
            <link linkend="metadata">Metadata</link>
          </code>. Для получения экземпляра <code>View</code>, содержащегося в репозитории, используются методы <code>getView()</code>. Для развертывания XML-описателей представлений в репозитории используются методы  <code>deployViews()</code>.</para>
        <para>В репозитории для каждой сущности по умолчанию доступны два  представления с именами <filename>_local</filename> и <filename>_minimal</filename>:<itemizedlist>
            <listitem>
              <para><filename>_local</filename> включает в себя все <glossterm linkend="local_attribute">локальные</glossterm> атрибуты сущности</para>
            </listitem>
            <listitem>
              <para><filename>_minimal</filename> включает в себя атрибуты, входящие в имя экземпляра сущности, и задаваемые аннотацией <code>
                  <link linkend="namePattern">@NamePattern</link>
                </code>. Если аннотация <code>@NamePattern</code>  для сущности не указана, данное представление не включает никаких атрибутов.</para>
            </listitem>
          </itemizedlist></para>
        <para>Подробная структура XML-описателей изложена в <xref linkend="views.xml"/></para>
        <para>Пример описателя представления для сущности Заказ, которое должно обеспечить загрузку всех локальных атрибутов, ассоциированного Покупателя и коллекции Пунктов заказа:<programlisting>&lt;view class=&quot;com.haulmont.sales.entity.Order&quot;
      name=&quot;orderWithCustomer&quot;
      extends=&quot;_local&quot;&gt;
    &lt;property name=&quot;customer&quot; view=&quot;_minimal&quot;/&gt;
    &lt;property name=&quot;items&quot; view=&quot;itemsInOrder&quot;/&gt;
&lt;/view&gt;</programlisting></para>
        <para>Рекомендуемый способ группировки и развертывания описателей представлений:<itemizedlist>
            <listitem>
              <para>В <link linkend="app_modules">модуле</link> <structname>core</structname>  в корне <filename>src</filename>  создать файл <filename>{имя_проекта}-views.xml</filename> и поместить в него все описатели представлений, которые должны быть доступны глобально, т.е. на всех <link linkend="app_tiers">уровнях приложения</link>.</para>
            </listitem>
            <listitem>
              <para>Зарегистрировать данный файл в свойстве <property>
                  <link linkend="cuba.viewsConfig">cuba.viewsConfig</link>
                </property> блока <structname>Middleware</structname>, т.е. в файле <filename>{имя_проекта}-app.properties</filename> модуля <structname>core</structname>. Это обеспечит автоматическое развертывание представлений на старте приложения в репозитории <structname>Middleware</structname> (см. метод <code>MetadataImpl.initViews()</code>). Развернутые представления будут доступны и для <structname>Middleware</structname>, и для  клиентских <link linkend="app_tiers">блоков</link>, которые получат соответствующие экземпляры <code>View</code> при подключении к среднему слою.</para>
            </listitem>
            <listitem>
              <para>Если существуют представления, которые необходимы только какому-то одному клиентскому блоку приложения, то можно определить их в аналогичном файле этого блока, например <filename>{имя_проекта}-web-views.xml</filename>, и зарегистрировать в свойстве <property>
                  <link linkend="cuba.viewsConfig">cuba.viewsConfig</link>
                </property> этого блока, т.е. в данном случае в  файле <filename>{имя_проекта}-web-app.properties</filename>. Тогда клиентский блок сначала загрузит все имеющиеся представления с <structname>Middleware</structname>,  а затем развернет свои собственные (см. <code>MetadataClientImpl.initViews()</code>).</para>
              <para>Возможна также ситуация, когда некоторому клиентскому блоку не нужны глобальные представления, зарегистрированные на среднем слое, или нужны редко. В этом случае имеет смысл объявить в этом клиентском блоке свойство <link linkend="cuba.lazyLoadServerViews">
                  <property>cuba.lazyLoadServerViews</property>
                </link>, тогда глобальные представления будут загружаться на клиентский уровень не все сразу, а по необходимости.</para>
            </listitem>
          </itemizedlist></para>
        <para>Если на момент развертывания некоторого представления в репозитории уже есть представление для этого же класса сущности и с таким же именем, то новое будет проигнорировано. Для того, чтобы представление заменило имеющееся в репозитории и гарантированно было развернуто, в XML-описателе должен быть явно указан атрибут <literal>overwrite = &quot;true&quot;</literal>. В частности, развертывание представлений клиентского уровня производится после загрузки представлений со среднего слоя, поэтому некоторое клиентское представление может оказаться &quot;замаскированным&quot; одноименным представлением <structname>Middleware</structname>.</para>
        <tip>
          <para>Рекомендуется давать представлениям &quot;описательные&quot; имена. Например, не &quot;browse&quot;, а &quot;customerBrowse&quot;. Это упрощает поиск XML-описателей представлений по имени в процессе разработки приложения.</para>
        </tip>
      </section>
    </section>
    <section id="infrastructure_interfaces">
      <title>Интерфейсы инфраструктуры</title>
      <para>Интерфейсы инфраструктуры обеспечивают доступ к часто используемой функциональности платформы. Большинство из этих интерфейсов расположены в <link linkend="app_modules">модуле</link> <structname>global</structname> и могут быть использованы как на среднем слое, так и в <link linkend="app_tiers">блоках</link> клиентского уровня, но некоторые доступны только коду среднего слоя.</para>
      <para>Интерфейсы инфраструктуры реализуются бинами <application>Spring Framework</application>, поэтому они могут быть инжектированы в любые другие управляемые компоненты (<link linkend="managed_beans">Managed Beans</link>, <link linkend="services">сервисы среднего слоя</link>, <link linkend="screen_controller">контроллеры</link> экранов универсального пользовательского интерфейса.</para>
      <para>Кроме того, как и любые другие бины, интерфейсы инфраструктуры могут быть получены с помощью статических методов класса <code>AppBeans</code>, и использоваться в неуправляемых компонентах (<glossterm linkend="pojo">POJO</glossterm>, вспомогательных классах и пр.).</para>
      <section>
        <title>Configuration</title>
        <para>Позволяет получать ссылки на <link linkend="config_interfaces">конфигурационные интерфейсы</link>.</para>
        <para>Примеры:<programlisting>@Inject
protected Configuration configuration;
...
String tempDir = configuration.getConfig(GlobalConfig.class).getTempDir();</programlisting><programlisting>protected GlobalConfig globalConfig;

@Inject
public void setConfiguration(Configuration configuration) {
    this.globalConfig = configuration.getConfig(GlobalConfig.class);
}</programlisting><programlisting>String tempDir = AppBeans.get(Configuration.class).getConfig(GlobalConfig.class).getTempDir();</programlisting></para>
      </section>
      <section>
        <title>Messages</title>
        <para>Интерфейс <code>Messages</code> обеспечивает получение <link linkend="localization">локализованных строк сообщений</link>.</para>
        <para>Рассмотрим методы интерфейса подробнее.</para>
        <itemizedlist>
          <listitem>
            <para><code>getMessage()</code> - возвращает локализованное сообщение по ключу, имени пакета сообщений и требуемой локали. Существует несколько модификаций данного метода в зависимости от набора параметров. Если локаль не указана в параметре метода, используется локаль текущего пользователя. </para>
            <para>Примеры:<programlisting>@Inject
protected Messages messages;
...
String message1 = messages.getMessage(getClass(), &quot;someMessage&quot;);
String message2 = messages.getMessage(&quot;com.abc.sales.web.customer&quot;, &quot;someMessage&quot;);
String message3 = messages.getMessage(RoleType.STANDARD);</programlisting></para>
          </listitem>
          <listitem>
            <para><code>formatMessage()</code> - находит локализованное сообщение по ключу, имени пакета сообщений и требуемой локали, и использует его для форматирования переданных параметров. Формат задается по правилам метода <code>String.format()</code>. Существует несколько модификаций данного метода в зависимости от набора параметров. Если локаль не указана в параметре метода, используется локаль текущего пользователя.</para>
            <para>Пример:<programlisting>String formattedValue = messages.formatMessage(getClass(), &quot;someFormat&quot;, someValue);</programlisting></para>
          </listitem>
          <listitem>
            <para><code>getMainMessage()</code> - возвращает локализованное сообщение из главного пакета данного <link linkend="app_tiers">блока</link> приложения.</para>
            <para>Пример:<programlisting>protected Messages messages = AppBeans.get(Messages.class);
...
messages.getMainMessage(&quot;actions.Ok&quot;);</programlisting></para>
          </listitem>
          <listitem>
            <para><code>getMainMessagePack()</code> - возвращает имя главного пакета сообщений данного блока приложения.</para>
            <para>Пример:<programlisting>String formattedValue = messages.formatMessage(messages.getMainMessagePack(), &quot;someFormat&quot;, someValue);</programlisting></para>
          </listitem>
          <listitem>
            <para><code>getTools()</code> - возвращает экземпляр интерфейса  <code>MessageTools</code> </para>
          </listitem>
        </itemizedlist>
        <section id="messageTools">
          <title>MessageTools</title>
          <para><link linkend="managed_beans">ManagedBean</link>, содержащий вспомогательные методы работы с <link linkend="localization">локализованными сообщениями</link>. Интерфейс <code>MessageTools</code> можно получить либо методом <code>Messages.getTools()</code>, либо как любой другой бин - инжекцией или через класс <code>AppBeans</code>. </para>
          <para>Методы <code>MessageTools</code>:<itemizedlist>
              <listitem id="loadString">
                <para><code>loadString()</code> - возвращает локализованное сообщение, заданное ссылкой вида <literal>msg://{messagePack}/{key}</literal></para>
                <para>Составные части ссылки:<itemizedlist>
                    <listitem>
                      <para><literal>msg://</literal> - обязательный префикс</para>
                    </listitem>
                    <listitem>
                      <para><literal>{messagePack}</literal> - необязательное имя пакета сообщения. Если не указано, предполагается, что имя пакета передается в loadString() отдельным параметром</para>
                    </listitem>
                    <listitem>
                      <para><literal>{key}</literal> - ключ сообщения в пакете</para>
                    </listitem>
                  </itemizedlist></para>
                <para>Примеры ссылок на сообщения:<programlisting>msg://someMessage
msg://com.abc.sales.web.customer/someMessage</programlisting></para>
              </listitem>
              <listitem>
                <para><code>getEntityCaption()</code> - возвращает локализованное название сущности</para>
              </listitem>
              <listitem>
                <para><code>getPropertyCaption()</code> - возвращает локализованное название атрибута сущности</para>
              </listitem>
              <listitem>
                <para><code>hasPropertyCaption()</code> - определяет, задано ли для атрибута сущности локализованное название </para>
              </listitem>
              <listitem>
                <para><code>getLocValue()</code> - возвращает локализованное значение атрибута сущности, основываясь на определении аннотации <code>
                    <link linkend="localizedValue_annotation">@LocalizedValue</link>
                  </code></para>
              </listitem>
              <listitem>
                <para><code>getMessageRef()</code> - формирует для <link linkend="metaProperty">мета-свойства</link> <link linkend="loadString">ссылку на сообщение</link>, по которой  можно получить локализованное название атрибута сущности</para>
              </listitem>
            </itemizedlist></para>
          <para>Для расширения набора вспомогательных методов в конкретном приложении бин <code>MessageTools</code> можно <link linkend="extension">переопределить</link>. Примеры работы с  расширенным интерфейсом:<programlisting>MyMessageTools tools = messages.getTools();
tools.foo();</programlisting><programlisting>((MyMessageTools) messages.getTools()).foo();</programlisting> </para>
        </section>
      </section>
      <section id="metadata">
        <title>Metadata</title>
        <para>Интерфейс <code>Metadata</code> обеспечивает доступ к сессии <link linkend="metadata_framework">метаданных</link> и репозиторию <link linkend="views">представлений</link>.</para>
        <para>Методы интерфейса:<itemizedlist>
            <listitem>
              <para><code>getSession()</code> - возвращает экземпляр сессии <link linkend="metadata_framework">метаданных</link> </para>
            </listitem>
            <listitem>
              <para><code>getViewRepository()</code> - возвращает экземпляр репозитория <link linkend="views">представлений</link></para>
            </listitem>
            <listitem>
              <para><code>getExtendedEntities()</code> - возвращает экземпляр <code>ExtendedEntities</code>, предназначенный для работы с расширенными сущностями. Подробнее см. <xref linkend="entity_extension"/></para>
            </listitem>
            <listitem>
              <para><code>create()</code> - создать экземпляр сущности, учитывая возможность расширения. Подробнее см. <xref linkend="entity_extension"/> </para>
            </listitem>
          </itemizedlist></para>
      </section>
      <section>
        <title>Persistence</title>
        <para>Обеспечивает доступ к интерфейсам <interface>Transaction</interface>, <interface>EntityManager</interface>, и некоторые сервисные функции, относящиеся к хранению данных. </para>
        <para>TODO</para>
      </section>
      <section id="resources">
        <title>Resources</title>
        <para>Обеспечивает загрузку ресурсов из конфигурационного каталога приложения или из <code>classpath</code>, а также по явно указанному URL.</para>
        <para>TODO</para>
      </section>
      <section id="scripting">
        <title>Scripting</title>
        <para><code>Scripting</code> − глобальный интерфейс инфраструктуры, решающий следующие задачи:</para>
        <itemizedlist>
          <listitem>
            <para>Выполнение выражений и скриптов Groovy</para>
          </listitem>
          <listitem>
            <para>Компиляция и загрузка классов Groovy</para>
          </listitem>
          <listitem>
            <para>Компиляция и загрузка классов Java, поставляемых в исходниках в каталоге конфигурации приложения conf</para>
          </listitem>
          <listitem>
            <para>Загрузка ресурсов из каталога конфигурации приложения conf или из classpath.</para>
          </listitem>
        </itemizedlist>
        <para>Общий принцип действия таков: если запрашиваемый класс или ресурс имеется в каталоге conf, будет использован он, в противном случае будет произведен поиск по данному пути в classpath. Это дает возможность в production или в процессе разработки динамически подменять и дополнять приложение нужными классами и ресурсами.</para>
        <para><emphasis role="bold">Выполнение выражений (evaluate)</emphasis></para>
        <para><emphasis role="bold">Выполнение скриптов</emphasis><itemizedlist>
            <listitem>
              <para>При инициализации приложения могут быть заданы классы для импорта, автоматически добавляемые всем выражениям.</para>
            </listitem>
            <listitem>
              <para>Скомпилированные выражения сохраняются в кэше, что значительно ускоряет повторное выполнение.</para>
            </listitem>
          </itemizedlist></para>
        <para>Запуск скриптов выполняется методом runGroovyScript(). Имя скрипта должно содержать путь с корнем в conf (каталог конфигурации приложения).</para>
      </section>
      <section>
        <title>Security</title>
        <para>Обеспечивает авторизацию - проверку прав пользователя на различные объекты системы. Большинство методов просто получают текущую пользовательскую сессию через <link linkend="userSessionSource">UserSessionSource</link> и делегируют ей выполнение авторизации. Подробнее см. <xref linkend="authentication"/></para>
      </section>
      <section>
        <title>TimeSource</title>
        <para>Обеспечивает получение текущего времени. Применение <code>new Date()</code> и т.п. в прикладном коде не рекомендуется.</para>
        <para>Примеры:<programlisting>@Inject
protected TimeSource timeSource;
...
Date date = timeSource.currentTimestamp();</programlisting><programlisting>long startTime = AppBeans.get(TimeSource.class).currentTimeMillis();</programlisting></para>
      </section>
      <section id="userSessionSource">
        <title>UserSessionSource</title>
        <para>Обеспечивает получение объекта сессии текущего пользователя. Подробнее см. <xref linkend="authentication"/></para>
      </section>
      <section>
        <title>UuidSource</title>
        <para>Обеспечивает получение значений <code>UUID</code>, в том числе для идентификаторов сущностей. Применение <code>UUID.randomUUID()</code> в прикладном коде не рекомендуется.</para>
      </section>
    </section>
    <section>
      <title>AppContext</title>
      <para>TODO</para>
    </section>
    <section id="appProperties">
      <title>Свойства приложения</title>
      <para wordsize="20"><emphasis role="bold">Основные понятия</emphasis></para>
      <para>Свойства приложения − именованные данные различных типов, определяющие всевозможные аспекты конфигурации и функционирования приложения.</para>
      <para>По назначению свойства приложения можно классифицировать следующим образом:</para>
      <itemizedlist>
        <listitem>
          <para>Конфигурационные параметры: определяют наборы конфигурационных файлов и некоторые параметры пользовательского интерфейса. Например: <parameter>cuba.springContextConfig</parameter>, <parameter>cuba.web.useLightHeader</parameter>.</para>
        </listitem>
        <listitem>
          <para>Параметры развертывания: различные URL для соединения уровней приложения, тип используемой БД, настройки подсистемы безопасности и т.д. Например: <parameter>cuba.connectionUrl</parameter>, <parameter>cuba.dbmsType,</parameter> <parameter>cuba.userSessionExpirationTimeoutSec</parameter>.</para>
        </listitem>
        <listitem>
          <para>Параметры времени выполнения: активность аудита, параметры отсылки email и т.д. Например, <parameter>cuba.security.EntityLog.enabled</parameter>, <parameter>cuba.email.smtpHost</parameter>.</para>
        </listitem>
      </itemizedlist>
      <para><emphasis role="bold">Работа со свойствами приложения</emphasis></para>
      <formalpara>
        <title>Программный доступ к свойствам</title>
        <para>Основной способ доступа к свойствам приложения из программного кода − использование механизма <link linkend="config_interfaces">конфигурационных интерфейсов</link>. Кроме того, все свойства конфигурации и развертывания доступны через методы класса <code>com.haulmont.cuba.core.sys.AppContext</code>.</para>
      </formalpara>
      <formalpara>
        <title>Принадлежность уровням</title>
        <para>Как правило, некоторое свойство принадлежит только одному или нескольким уровням приложения. Например, <parameter>cuba.persistenceConfig</parameter> имеет смысл только дляMiddleware,  <parameter>cuba.web.useLightHeader</parameter> − только для Web Client, а <parameter>cuba.springContextConfig </parameter>− для всех уровней. </para>
        <para>Принадлежность к уровню означает, что если Вы хотите задать значение некоторому свойству, это необходимо сделать на всех уровнях, которым данное свойство принадлежит (смотрите <link linkend="properties_storage_para">Хранение значений свойств</link>). </para>
        <para>Принадлежность можно выяснить следующими способами:<itemizedlist>
            <listitem>
              <para>Из документации</para>
            </listitem>
            <listitem>
              <para>Проследив использование свойства в коде приложения</para>
            </listitem>
            <listitem>
              <para>Если к свойству есть доступ через Java-интерфейс, то по принадлежности интерфейса модулю проекта. Ниже приведено соответствие модуля объявления интерфейса и принадлежности свойства уровням приложения:</para>
              <itemizedlist>
                <listitem>
                  <para><structname>global</structname> − свойство принадлежит всем уровням</para>
                </listitem>
                <listitem>
                  <para><structname>core</structname> − <glossterm>Middleware</glossterm></para>
                </listitem>
                <listitem>
                  <para><structname>client</structname> − Web Client, Web Portal, Desktop Client</para>
                </listitem>
                <listitem>
                  <para><structname>web</structname> − Web Client</para>
                </listitem>
                <listitem>
                  <para><structname>web-portal</structname> − Web Portal</para>
                </listitem>
                <listitem>
                  <para><structname>desktop</structname> − Desktop Client</para>
                </listitem>
              </itemizedlist>
            </listitem>
          </itemizedlist></para>
      </formalpara>
      <formalpara>
        <title>JMX-интерфейс</title>
        <para>Некоторые уровни приложения определяют JMX-интерфейсы для доступа к свойствам приложения. В частности, на уровне Middleware имеется JMX-интерфейс <code>ConfigStorageMBean</code> с именем <code>app-core.cuba:service=ConfigStorage</code>, а на уровне Web Client − <code>ConfigurationMBean</code> с именем <code>app.cuba:service=Configuration</code>. Методы этих интерфейсов работают по отдельности со свойствами конфигурации и развертывания (<parameter>*AppProperties</parameter>) и со свойствами времени выполнения (<parameter>*DbProperties</parameter>). Это обусловлено различием механизмов <link linkend="properties_storage_para">хранения</link> этих категорий свойств.</para>
      </formalpara>
      <para id="properties_storage_para"><emphasis role="bold">Хранение значений свойств</emphasis></para>
      <formalpara id="text_properties_files_1">
        <title>Файлы свойств</title>
        <para>Свойства, определяющие конфигурацию и параметры развертывания, задаются в специальных файлах свойств, имеющих имя вида <filename>*-app.properties</filename>. Каждый уровень приложения имеет набор таких файлов, включающий в себя файлы из базовых проектов платформы и файл текущего приложения. Набор файлов свойств различен для разных уровней приложения и определяется следующим образом:</para>
      </formalpara>
      <itemizedlist>
        <listitem>
          <para>Для уровней, являющихся веб-приложениями (Middleware, Web Client, Web Portal) набор файлов свойств задается в <filename>web.xml</filename> в параметре <parameter>appPropertiesConfig</parameter>.</para>
        </listitem>
        <listitem>
          <para>Для уровня Desktop Client основной способ задания набора файлов свойств − переопределение в приложении метода <methodname>getDefaultAppPropertiesConfig</methodname> в классе-наследнике <code>com.haulmont.cuba.desktop.App</code>.</para>
        </listitem>
      </itemizedlist>
      <para>Например, набор файлов свойств уровня Middleware проекта <application>shop</application> − <filename>web.xml</filename> − выглядит следующим образом:</para>
      <programlisting>classpath:cuba-app.properties
classpath:shop-app.properties
file:${catalina.home}/conf/app-core/local.app.properties</programlisting>
      <para>Здесь префикс <code>classpath:</code> означает, что данный файл нужно искать в Java classpath, префикс <code>file:</code> − в файловой системе. Возможно использование системных свойств Java, в данном случае это <code>catalina.home</code> − путь к корню <application>Tomcat</application>.</para>
      <para>Порядок перечисления файлов важен, так как значения, указанные в каждом последующем файле заменяют значения одноименных свойств, заданные в предыдущих файлах. Этим достигается переопределение свойств платформы в конкретном приложении.</para>
      <para>Последний файл в приведенном наборе − <filename>local.app.properties</filename>.</para>
      <para><emphasis role="bold">Синтаксис</emphasis></para>
      <para><warning>
          <para>Обратите внимание на синтаксис ключей и значений в *.properties файлах.</para>
          <itemizedlist>
            <listitem>
              <para>Ключ состоит из латинских букв и цифр, разделенных точкой</para>
            </listitem>
            <listitem>
              <para>Значение пишется после знака равно (=)</para>
            </listitem>
            <listitem>
              <para>Значение <emphasis role="bold">никогда</emphasis> не берется в кавычки &quot;&quot; или &apos;&apos;</para>
            </listitem>
            <listitem>
              <para>Файловые пути записываются либо в UNIX виде (/opt/haulmont/), либо в Windows виде (c:\\haulmont\\)</para>
            </listitem>
            <listitem>
              <para>Для различных спецсимволов используются коды (\n \t \r). \  является зарезервированным символом, для вставки в значение экранируется сам собой (\\).
Подробнее: <ulink url="http://docs.oracle.com/javase/tutorial/java/data/characters.html">http://docs.oracle.com/javase/tutorial/java/data/characters.html</ulink></para>
            </listitem>
            <listitem>
              <para>В значениях могут присутствовать спецсимволы (пробелы, табуляции).     Внимательно проверяйте значения, скопированные в файл из других программ</para>
            </listitem>
          </itemizedlist>
        </warning></para>
      <formalpara>
        <title>Таблица базы данных</title>
        <para>Параметры времени выполнения хранятся в БД в таблице <database>SYS_CONFIG</database>. Хранящиеся в БД свойства кэшируются на уровне Middleware. Очистить кэш можно через JMX-интерфейсы <code>app-core.cuba:service=ConfigStorage</code> методом <methodname>clearCache</methodname> или <code>app-core.cuba:service=CachingFacade</code> методом <methodname>clearConfigStorageCache</methodname>.</para>
      </formalpara>
      <para><emphasis role="bold">Значения по умолчанию</emphasis></para>
      <para>Если обращение к свойству производится через Java-интерфейс механизма Configuration Parameters и если значение свойства не задано в месте его хранения (файлы <filename>*-app.properties</filename> или БД), то будет возвращено значение по умолчанию, если оно задано в аннотации соответствующего метода Java-интерфейса.</para>
      <para>Подробное описание свойств подсистемы безопасности содержится в <link linkend="appendix_security_properties">Приложении А</link>.</para>
      <section id="config_interfaces">
        <title>Конфигурационные интерфейсы</title>
        <para>Подсистема работы с конфигурационными параметрами позволяет сохранять/извлекать пары имя-значение с помощью стандартных Java-интерфейсов. При этом хранилищем параметров может быть база данных, системные свойства Java, и свойства приложения, задаваемые в файлах app.properties.</para>
        <para>Рекомендуется использовать только для хранения системных настроек, доступных администратору системы. Для хранения настроек пользователя лучше создавать отдельную сущность для их хранения и использовать стандартный эдитор для редактирования.</para>
        <para><emphasis role="bold">Использование</emphasis></para>
        <para>Для создания конфигурационного параметра необходимо:</para>
        <itemizedlist>
          <listitem>
            <para>Создать интерфейс, унаследованный от <interface>com.haulmont.cuba.core.config.Config</interface></para>
          </listitem>
          <listitem>
            <para>Создать методы доступа к параметру (getXXX/setXXX). Возможный тип параметра обсуждается ниже.</para>
          </listitem>
          <listitem>
            <para>Добавить интерфейсу аннотацию <literal>@Prefix</literal> для указания префикса имен входящих в интерфейс параметров</para>
          </listitem>
          <listitem>
            <para>Добавить интерфейсу и/или параметру аннотацию <literal>@Source</literal> для указания источника (места хранения) параметров</para>
          </listitem>
        </itemizedlist>
        <para>Например:</para>
        <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/section_architecture/configurationParameters/example1.txt" encoding="UTF-8" parse="text"/></programlisting>
        <para>Реализовывать интерфейс не нужно.</para>
        <para>Для получения доступа к параметрам используется интерфейс инфраструктуры <interface>Configuration</interface> или его статический фасад <interface>ConfigProvider</interface>.</para>
        <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/section_architecture/configurationParameters/example2.txt" encoding="UTF-8" parse="text"/></programlisting>
        <para>Стандартный UI для доступа к параметрам, хранящимся в базе данных, предоставляет МБин haulmont.cuba:service=ConfigStorage. Он содержит следующие методы:</para>
        <itemizedlist>
          <listitem>
            <para>setProperty(p1, p2) − установить параметр с именем p1 в значение p2</para>
          </listitem>
          <listitem>
            <para>getProperty(p1) − показать параметр с именем p1</para>
          </listitem>
          <listitem>
            <para>removeProperty(p1) − удалить параметр с именем p1</para>
          </listitem>
          <listitem>
            <para>printProperties(p1) − показать все параметры с фильтром на имя p1 по правилам SQL like</para>
          </listitem>
          <listitem>
            <para>printProperties − показать все параметры</para>
          </listitem>
          <listitem>
            <para>loadSystemProperties − загрузить в System.properties параметры из файла conf/system.properties</para>
          </listitem>
        </itemizedlist>
        <para><emphasis role="bold">Возможности</emphasis></para>
        <para><emphasis role="bold">Имена параметров</emphasis></para>
        <para>Имя параметра в БД или в app.properties формируется по следующему принципу:</para>
        <itemizedlist>
          <listitem>
            <para>Если на параметре есть аннотация <literal>@Property</literal>, то берется ее значение</para>
          </listitem>
          <listitem>
            <para>Иначе:</para>
            <itemizedlist>
              <listitem>
                <para>Если есть аннотация <literal>@Prefix</literal>, берется ее значение</para>
              </listitem>
              <listitem>
                <para>Если нет аннотации <literal>@Prefix</literal>, то</para>
                <itemizedlist>
                  <listitem>
                    <para>Если интерфейс является внутренним, то берется полное имя включающего класса и добавляется &quot;.&quot;</para>
                  </listitem>
                  <listitem>
                    <para>Иначе берется полное имя пакета и добавляется &quot;.&quot;</para>
                  </listitem>
                </itemizedlist>
              </listitem>
              <listitem>
                <para>Добавляется декапитализированное имя метода доступа без get/set/is (см. комментарии к методу <methodname>com.haulmont.cuba.core.config.ConfigUtil#extendedUncapitalize</methodname>)</para>
              </listitem>
            </itemizedlist>
          </listitem>
        </itemizedlist>
        <para><emphasis role="bold">Источники параметров</emphasis></para>
        <para>В соответствии со значениями <code>com.haulmont.cuba.core.config.SourceType</code> на данный момент возможны 3 источника параметров: app.propperties, System.properties или база данных.</para>
        <para>В случае базы данных параметры хранятся в таблице <database>SYS_CONFIG</database>.</para>
        <para>Аннотация <literal>@Source</literal> может быть задана как на весь интерфейс, так и на отдельный параметр. В первом случае она определяет источник всех параметров данного интерфейса. Во втором случае она переопределяет источник для данного параметра, если он отличен от указанного для интерфейса.</para>
        <para><emphasis role="bold">Типы параметров</emphasis></para>
        <para>Без дополнительных усилий параметр может быть любого простого типа либо его объектного аналога (String, int, Integer, etc.) либо сущностью, реализующей интерфейс Entity.</para>
        <para>Для произвольного типа необходимо реализовать классы TypeStringify и TypeFactory для преобразования значения в строку и из нее, и указать эти классы для параметра с помощью аннотаций @Stringify и @Factory.</para>
        <para>Рассмотрим этот процесс на примере типа UUID.</para>
        <itemizedlist>
          <listitem>
            <para>Создаем класс com.haulmont.cuba.core.config.type.UuidTypeFactory унаследованный от com.haulmont.cuba.core.config.type.TypeFactory и реализуем в нем метод:</para>
            <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/section_architecture/configurationParameters/example3.txt" encoding="UTF-8" parse="text"/></programlisting>
          </listitem>
          <listitem>
            <para>TypeStringify создавать не нужно, т.к. по умолчанию будет использован Object.toString() − в данном случае он нам подходит.</para>
          </listitem>
          <listitem>
            <para>Аннотируем параметр:</para>
            <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/section_architecture/configurationParameters/example4.txt" encoding="UTF-8" parse="text"/></programlisting>
          </listitem>
        </itemizedlist>
        <para><emphasis role="bold">Значения по умолчанию</emphasis></para>
        <para>Для параметров могут быть заданы значения по умолчанию. Эти значения будут возвращаться, если данный параметр не задан (не существует в БД или в app.properties).</para>
        <para>Дефолтное значение может быть задано в виде строки с помощью аннотации @com.haulmont.cuba.core.config.defaults.Default, либо в виде конкретного типа с помощью других аннотаций пакета com.haulmont.cuba.core.config.defaults.</para>
        <para>Для сущностей дефолтное значение задается в виде имя_сущности-id-имя_представления, например</para>
        <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/section_architecture/configurationParameters/example5.txt" encoding="UTF-8" parse="text"/></programlisting>
        <para>имя представления необязательно.</para>
      </section>
    </section>
    <section id="localization">
      <title>Локализация сообщений</title>
      <para>Содержит файлы локализованных сообщений  для задания названий сущностей, атрибутов сущностей, папок, заголовков закладок и так далее. Правила создания файлов локализованных сообщений:</para>
      <itemizedlist>
        <listitem>
          <para>Файл по умолчанию имеет имя <filename>messages.properties</filename>, для конкретного языка − <filename>messages_ru.properties</filename> и т.д. При отсутствии файла конкретного языка или при отсутствии искомого ключа в файле конкретного языка будет использовано сообщение из файла по умолчанию.</para>
        </listitem>
        <listitem>
          <para>Кодировка <code>UTF-8</code>.</para>
        </listitem>
        <listitem>
          <para>Можно включать другие файлы сообщений с помощью ключа <literal>@include</literal>. При этом если некоторый ключ встречается и во включаемом файле, и в текущем, будет использовано сообщение из текущего (переопределение). Пример включения файла:<programlisting>@include=com.haulmont.cuba.web

actions.Create=Create
actions.Edit=Edit
...</programlisting></para>
        </listitem>
        <listitem>
          <para>Полным именем пакета сообщений считается имя Java-пакета, содержащего языковые файлы. Например, именем пакета сообщений, расположенного в <filename>/com/haulmont/cuba/web/app/ui/security/user/messages.properties</filename> является строка <package>com.haulmont.cuba.web.app.ui.security.user</package></para>
        </listitem>
      </itemizedlist>
    </section>
    <section id="authentication">
      <title>Аутентификация и авторизация пользователей</title>
      <para>TODO</para>
    </section>
  </section>
  <section id="middleware">
    <title>Компоненты среднего слоя</title>
    <para>На следующем рисунке приведены основные компоненты среднего слоя CUBA-приложения.</para>
    <figure>
      <title>Архитектура среднего слоя</title>
      <mediaobject>
        <imageobject>
          <imagedata align="center" fileref="img/Middleware.png"/>
        </imageobject>
      </mediaobject>
    </figure>
    <para>Компоненты сгруппированы по двум <link linkend="text_modules">модулям</link>: <structname>core</structname> и <structname>global</structname>. В <structname>global</structname> расположены компоненты, доступные как коду Middleware, так и клиентскому коду. В <structname>core</structname> расположены компоненты ядра Middleware.</para>
    <para>Рассмотрим элементы диаграммы более подробно.</para>
    <para><link linkend="services">Services</link> – управляемые <glossterm linkend="container">контейнером</glossterm> компоненты, формирующие границу приложения и предоставляющие интерфейс клиентам Middleware. Сервисы могут содержать бизнес-логику сами, либо делегировать выполнение <link linkend="managed_beans">Managed Beans</link>.</para>
    <para><link linkend="managed_beans">Managed Beans</link> – управляемые <glossterm linkend="container">контейнером</glossterm> компоненты, содержащие бизнес-логику приложения. Вызываются <link linkend="services">сервисами</link>, другими бинами или через опциональный <glossterm linkend="jmx">JMX</glossterm> интерфейс.</para>
    <para>Entity Classes – классы, моделирующие предметную область приложения.  Представляют собой аннотированные <glossterm linkend="pojo">POJO</glossterm>. Аннотации используются для задания соответствий между столбцами таблицы базы данных и полями объектов с помощью OpenJPA, а также для формирования метаданных в <link linkend="metadata_framework">Metadata Framework</link>.</para>
    <para><emphasis role="bold">Persistence</emphasis> −  центральный интерфейс для доступа к функциональности хранения данных. Позволяет получать ссылки на интерфейсы <code>EntityManager</code> и <code>Transaction</code>.</para>
    <para><emphasis role="bold">Transaction</emphasis> − интерфейс управления <link linkend="transactions">транзакциями</link> Middleware.</para>
    <para><emphasis role="bold">Entity Manager</emphasis> − интерфейс для работы с данными на уровне Middleware. Позволяет извлекать <glossterm linkend="entity">сущности</glossterm> из базы данных по идентификатору и по запросу, а также сохранять и удалять их.</para>
    <para><link linkend="metadata_framework">Metadata Framework</link> позволяет создавать описание предметной области в терминах классов, атрибутов и отношений между классами. Метаданные (модель данных) существенно упрощают создание универсальных механизмов работы с данными. Исходной информацией для построения модели являются аннотированные классы сущностей.</para>
    <para><link linkend="infrastructure_interfaces">Global Infrastructure Interfaces</link> (интерфейсы инфраструктуры) предоставляют доступ к общей часто используемой функциональности. Реализованы в платформе аналогично <link linkend="managed_beans">Managed Beans</link>.

Все интерфейсы инфраструктуры имеют соответствующие <firstterm>статические фасады</firstterm> − классы со статическими методами, позволяющие иметь доступ к нужной функциональности из статического контекста (при невозможности использовать <link linkend="middleware">dependency injection</link>). Статические фасады имеют имена, заканчивающиеся на <code>*Provider</code>.</para>
    <para>Spring Framework − основа среднего слоя. Используются следующие возможности Spring Framework: </para>
    <itemizedlist>
      <listitem>
        <para>Инверсия управления (IoC container)</para>
      </listitem>
      <listitem>
        <para>Аспектно-ориентированное программирование (AOP)</para>
      </listitem>
      <listitem>
        <para>Управление транзакциями</para>
      </listitem>
      <listitem>
        <para>Remoting − доступ к сервисам среднего слоя по протоколу HTTP</para>
      </listitem>
      <listitem>
        <para>Реализация веб-сервисов и <link linkend="rest_api">REST API</link></para>
      </listitem>
    </itemizedlist>
    <para>OpenJPA Framework − реализация ORM по стандарту JPA. Позволяет работать с таблицами базы данных как с объектами Java и создавать запросы на языке <link linkend="middleware">JPQL</link>.</para>
    <section id="services">
      <title>Services</title>
      <para>Сервисы представляют собой слой  компонентов, формирующих границу приложения. Сервисы определяют множество операций, предоставляемых ими для интерфейсных клиентских слоев кода. Сервисы инкапсулируют бизнес-логику приложения, управляют транзакциями и координируют реакции на действия.</para>
      <para>Основные задачи сервисов:</para>
      <itemizedlist>
        <listitem>
          <para>Обеспечить выполнение каждого метода в отдельной <link linkend="transactions">транзакции</link>. </para>
        </listitem>
        <listitem>
          <para>Обеспечивать запись исключений в журнал.</para>
        </listitem>
        <listitem>
          <para>Обеспечивать отказоустойчивость (failover) в кластере для удаленных клиентов.</para>
        </listitem>
        <listitem>
          <para>В бизнес-методах сервисов могут проверяться права пользователя на доступ к данным</para>
        </listitem>
      </itemizedlist>
      <para>Диаграмма классов, входящих в состав сервиса:</para>
      <figure>
        <title>Диаграмма классов, входящих в состав сервиса</title>
        <mediaobject>
          <imageobject>
            <imagedata contentwidth="80%" align="center" fileref="img/MiddlewareServices.png"/>
          </imageobject>
        </mediaobject>
      </figure>
      <para>Каждый вызов сервиса перехватывается с помощью Spring AOP  и обрамляется вызовом <code>ServiceInterceptor.aroundInvoke()</code>.</para>
    </section>
    <section id="managed_beans">
      <title>Managed Beans</title>
      <para><firstterm>Управляемые бины (Managed Beans)</firstterm> − это программные компоненты, реализующие бизнес-логику приложения и создаваемые в соответствии с принципами Inversion of Control. <glossterm linkend="container">Контейнером</glossterm> для бинов служит Spring Framework.</para>
      <para>Managed Bean представляет собой <firstterm>singleton</firstterm>, то есть всегда используется один экземпляр данного класса. Соответственно, если создаваемый Вами бин содержит изменяемые данные в полях (имеет состояние), то необходимо синхронизировать обращение к таким данным.</para>
      <para>В простейшем случае Managed Bean может быть просто Java-классом, аннотированным как <literal>@ManagedBean</literal>.</para>
    </section>
    <section id="mbeans">
      <title>JMX Beans</title>
      <para><firstterm>МБин</firstterm> − программный компонент, реализующий бизнес-логику, и имеющий <glossterm linkend="jmx">JMX</glossterm>-интерфейс. Как правило, имеет внутреннее состояние (например, кэш, конфигурационные данные или статистику), к которому нужно обеспечить доступ через JMX.</para>
      <para>МБин является расширенным вариантом <link linkend="managed_beans">управляемого бина</link>.</para>
      <figure>
        <title/>
        <mediaobject>
          <imageobject>
            <imagedata align="center" fileref="img/MBeans.png"/>
          </imageobject>
        </mediaobject>
      </figure>
      <para>Как видно из диаграммы, МБин имеет два набора методов, разделенных по интерфейсам <code>...MBean</code> и <code>...API</code>. Первый из них служит для управления через JMX, а второй − для вызова из программного кода.</para>
      <para>Вызовы JMX-интерфейса МБина перехватываются специальным классом − <glossterm linkend="interceptor">интерцептором</glossterm> <methodname>MBeanInterceptor.aroundInvoke()</methodname> (с помощью Spring AOP), который обеспечивает журналирование неперехваченных исключений и установку правильного контекстного <code>ClassLoader</code>.</para>
    </section>
    <section id="orm">
      <title>Слой ORM</title>
      <section>
        <title>Общие сведения</title>
        <para>Object-Relational Mapping - объектно-реляционное отображение - технология связывания таблиц реляционной базы данных с объектами языка программирования. </para>
        <variablelist>
          <varlistentry>
            <term>Преимущества</term>
            <listitem>
              <itemizedlist>
                <listitem>
                  <para>Позволяет работать с  данными реляционной СУБД, манипулируя простыми объектами Java (<glossterm linkend="pojo">POJO</glossterm>)</para>
                </listitem>
                <listitem>
                  <para>Упрощает программирование, избавляя от рутины написания тривиальных SQL-запросов</para>
                </listitem>
                <listitem>
                  <para>Упрощает программирование, позволяя извлекать и сохранять целые графы объектов одной командой</para>
                </listitem>
                <listitem>
                  <para>Обеспечивает легкое портирование приложения на различные СУБД</para>
                </listitem>
                <listitem>
                  <para>Использует лаконичный язык запросов <glossterm linkend="jpql">JPQL</glossterm></para>
                </listitem>
                <listitem>
                  <para>Оптимизирует количество выполняемых SQL-запросов на команды insert и update</para>
                </listitem>
              </itemizedlist>
            </listitem>
          </varlistentry>
          <varlistentry>
            <term>Недостатки</term>
            <listitem>
              <itemizedlist>
                <listitem>
                  <para>Требует понимания особенностей работы с ORM</para>
                </listitem>
                <listitem>
                  <para>Не позволяет напрямую оптимизировать SQL или использовать особенности СУБД, что приводит к снижению производительности</para>
                </listitem>
              </itemizedlist>
            </listitem>
          </varlistentry>
          <varlistentry>
            <term>Реализация</term>
            <listitem>
              <itemizedlist>
                <listitem>
                  <para>JPA – Java Persistence API</para>
                </listitem>
                <listitem>
                  <para>OpenJPA – фреймворк, реализующий JPA.  На данный момент в платформе используется версия 2.x.</para>
                </listitem>
              </itemizedlist>
            </listitem>
          </varlistentry>
        </variablelist>
      </section>
      <section id="entityManager">
        <title>EntityManager</title>
        <para>EntityManager - основной интерфейс ORM, служит для управления персистентными <link linkend="data_model">сущностями</link>.
Его можно получить с помощью   вызова метода  <code>PersistenceProvider.getEntityManager()</code>.
Экземпляр <code>EntityManager</code> всегда привязан к одной <link linkend="transactions">транзакции</link>. Более того, все вызовы <code>PersistenceProvider.getEntityManager()</code> в рамках одной транзакции возвращают один и тот же экземпляр <code>EntityManager</code>. После завершения транзакции обращения к данному экземпляру невозможны.
Экземпляр <code>EntityManager</code> содержит в себе &quot;персистентный контекст&quot; – набор экземпляров сущностей, загруженных из БД или только что созданных. Персистентный контекст является кэшем данных в рамках данной транзакции.
<code>EntityManager</code> автоматически сбрасывает в БД все изменения, сделанные в своем персистентном контексте, в момент коммита транзакции, либо явным вызовом метода  <code>flush()</code>.</para>
      </section>
      <section>
        <title>Состояния сущности</title>
        <para><variablelist>
            <varlistentry>
              <term>New</term>
              <listitem>
                <para>Только что созданный экземпляр, например: <code>Car car = new Car()</code>;
может быть передан в <methodname>EntityManager.persist()</methodname> для сохранения в БД. При этом переходит в состояние <firstterm>Managed</firstterm></para>
              </listitem>
            </varlistentry>
            <varlistentry>
              <term>Managed</term>
              <listitem>
                <para>Загруженный из БД или новый, переданный в <methodname>EntityManager.persist()</methodname>, экземпляр;
принадлежит некоторому экземпляру <code>EntityManager</code>, другими словами, находится в его персистентном контексте;
любые изменения  экземпляра в состоянии <firstterm>Managed</firstterm> будут сохранены в БД в случае коммита транзакции, к которой принадлежит данный <code>EntityManager</code></para>
              </listitem>
            </varlistentry>
            <varlistentry>
              <term>Detached</term>
              <listitem>
                <para>Экземпляр, загруженный из БД и отсоединенный от своего персистентного контекста (вследствие закрытия транзакции или сериализации);
изменения, вносимые в <firstterm>Detached</firstterm> экземпляр, запоминаются в самом этом экземпляре (с помощью полей, добавленных с помощью Enhancing);
изменения в <firstterm>Detached</firstterm> экземпляре будут сохранены в БД, только если он будет снова переведен в состояние <firstterm>Managed</firstterm> путем передачи в метод <methodname>EntityManager.merge()</methodname>; <methodname>EntityManager.merge()</methodname> выполняет следующее – загружает из БД экземпляр с тем же идентификатором, переносит в него состояние переданного <firstterm>Detached</firstterm> экземпляра и возвращает загруженный <firstterm>Managed</firstterm> экземпляр. Далее надо работать именно с возвращенным <firstterm>Managed</firstterm> экземпляром!</para>
              </listitem>
            </varlistentry>
          </variablelist></para>
      </section>
      <section>
        <title>Загрузка по требованию</title>
        <para><itemizedlist>
            <listitem>
              <para>Позволяет загружать связанные сущности по требованию, т.е. только в момент первого обращения к их свойствам</para>
            </listitem>
            <listitem>
              <para>Работает только для экземпляра в состоянии <firstterm>Managed</firstterm>, то есть внутри транзакции, загрузившей данный экземпляр</para>
            </listitem>
            <listitem>
              <para>Загрузка по требованию (lazy loading)  в сумме порождает больше запросов к БД, чем <glossterm linkend="eager_fetching">энергичная загрузка (Eager Fetching)</glossterm>, однако нагрузка при этом растянута во времени</para>
              <itemizedlist>
                <listitem>
                  <para>Например, при извлечении списка N экземпляров сущности A, содержащих ссылку на экземпляр сущности B, в случае загрузки по требованию будет выполнено N+1 запросов к БД.</para>
                </listitem>
                <listitem>
                  <para>Для минимизации времени отклика и снижения нагрузки необходимо стремиться к меньшему количеству обращений к БД. Для этого  в платформе  используется механизм <link linkend="views">представлений</link>, с помощью которого в вышеописанном случае ORM сформирует один  запрос к БД с объединением таблиц.</para>
                </listitem>
                <listitem>
                  <para>Если A содержит коллекцию B, в случае энергичной загрузки  ORM сформирует SQL запрос, возвращающий произведение строк A и B. </para>
                </listitem>
                <listitem>
                  <para>Иногда загрузка по требованию с точки зрения производительности предпочтительнее, чем энергичная загрузка. Например, когда работает асинхронный процесс, выполняющий некоторую бизнес-логику, общее время выполнения некритично и желательно распределить во времени  нагрузку на БД.</para>
                </listitem>
              </itemizedlist>
            </listitem>
          </itemizedlist></para>
      </section>
      <section>
        <title>Макросы в JPQL</title>
        <para>TODO</para>
      </section>
      <section>
        <title>Запросы с distinct</title>
        <para>TODO</para>
      </section>
    </section>
    <section id="transactions">
      <title>Управление транзакциями</title>
      <para>Транзакция Middleware напрямую отображается на транзакцию БД.</para>
      <para>Управление транзакциями производится только  на уровне сервисов или ниже.
</para>
      <para>Любой клиент, вызывая методы сервиса, должен понимать, что каждый метод будет выполняться в отдельной транзакции.
Используется только ручное (не декларативное) управление транзакциями.</para>
      <para>Управление транзакциями является частью бизнес-логики.
При использовании ORM изменения в БД производятся при коммите транзакции, который в случае декларативного управления происходит за рамками прикладного кода (в интерцепторах контейнера), что крайне неудобно при отладке приложения.</para>
      <para>При использовании ORM доменные объекты ведут себя принципиально по-разному внутри и вне транзакции</para>
    </section>
    <section id="dataService">
      <title>DataService и DataWorker</title>
      <para>TODO</para>
    </section>
    <section id="dbms_types">
      <title>Поддерживаемые СУБД</title>
      <para>Тип используемой СУБД определяется <glossterm linkend="app_properties_glossentry">параметром</glossterm> среднего слоя <parameter>cuba.dbmsType</parameter> и настройкой источника данных в <application>Tomcat</application>.</para>
      <variablelist>
        <varlistentry>
          <term>PostgreSQL</term>
          <listitem>
            <para>Поддерживается всеми проектами платформы: CUBA, Workflow, FTS, Charts, CCPayments, RefApp.</para>
            <para><emphasis role="bold">Настройка</emphasis></para>
            <para>Параметр среднего слоя:</para>
            <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/cuba_dbmstype_postgres.txt" encoding="UTF-8" parse="text"/></programlisting>
            <para>Источник данных в context.xml:</para>
            <programlisting language="xml"><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/context_postgres.xml" encoding="UTF-8" parse="text"/></programlisting>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term>Microsoft SQL Server</term>
          <listitem>
            <para>Поддерживается проектами: CUBA, Workflow, FTS, RefApp.</para>
            <para><emphasis role="bold">Настройка</emphasis></para>
            <para>Параметр среднего слоя:</para>
            <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/cuba_dbmstype_mssql.txt" encoding="UTF-8" parse="text"/></programlisting>
            <para>Источник данных в context.xml:</para>
            <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/context_mssql.xml" encoding="UTF-8" parse="text"/></programlisting>
            <para>В настройках MS SQL надо включить возможность логина для пользователя sa и задать для него пароль из context.xml. Это можно сделать из MS SQL Management Studio, в окне Object Explorer.

Instance − ваш SQL Server.</para>
            <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/instance_mssql.txt" encoding="UTF-8" parse="text"/></programlisting>
            <para>Включить сетевую аутентификацию:</para>
            <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/instance1_mssql.txt" encoding="UTF-8" parse="text"/></programlisting>
            <para>Разрешить доступ по TCP/IP можно из Sql Server Configuration Manager</para>
            <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/instance2_mssql.txt" encoding="UTF-8" parse="text"/></programlisting>
          </listitem>
        </varlistentry>
      </variablelist>
    </section>
  </section>
  <section id="client">
    <title>Компоненты клиента</title>
    <figure>
      <title/>
      <mediaobject>
        <imageobject>
          <imagedata align="center" fileref="img/ClientStructure.png"/>
        </imageobject>
      </mediaobject>
    </figure>
    <para>TODO</para>
  </section>
  <section id="portal">
    <title>Компоненты портала</title>
    <para>TODO</para>
  </section>
  <section id="gui_framework">
    <title>Универсальный пользовательский интерфейс</title>
    <section>
      <title>Экраны</title>
      <section id="screen_controller">
        <title>Контроллер экрана</title>
        <para><code>Java</code> или <code>Groovy</code> класс,  в котором можно реализовывать бизнес-логику и управлять поведением компонентов, описанных в <glossterm linkend="screen_xml_glossentry">xml-дескрипторе</glossterm>, с помощью различных событий. Контроллер должен быть унаследован от одного из следующих базовых классов:</para>
        <itemizedlist>
          <listitem>
            <para><code>AbstractFrame</code> − реализует интерфейс <code>IFrame</code> и предназначен для реализации фреймов − многократно используемых компонентов экранов.</para>
          </listitem>
          <listitem>
            <para><code>AbstractWindow</code> − реализует интерфейc <code>Window</code> и предназначен для реализации любых экранов.</para>
          </listitem>
          <listitem>
            <para><code>AbstractLookup</code> − реализует интерфейс <code>Lookup</code> и предназначен для реализации <glossterm linkend="browser_glossentry">браузеров</glossterm> с возможностью выбора элемента списка для использования его в вызывающем экране.</para>
          </listitem>
          <listitem>
            <para><code>AbstractEditor</code> − реализует интерфейс <code>Editor</code> и предназначен для реализации экранов редактирования экземпляра сущности.</para>
          </listitem>
        </itemizedlist>
        <para>Основной метод контроллера − <methodname>init()</methodname>. Этот метод вызывается после создания класса окна и всего дерева компонентов, описанного XML-дескриптором. Контроллер может в этом методе произвести инициализацию экрана перед его открытием (например, создать обработчики нажатий на кнопки и пр.).</para>
        <para>В метод <methodname>init()</methodname> из вызывающего кода передается коллекция параметров, состоящая из пар «ключ − значение». Вызывающим кодом может быть как контроллер другого экрана, так и пункт главного меню, либо прямая ссылка на экран извне приложения. Каждый параметр передается в коллекции в двух экземплярах − с простым именем и с тем же именем с префиксом param$.</para>
        <para>Класс контроллера должен быть зарегистрирован в XML-дескрипторе экрана в атрибуте <parameter>class</parameter> корневого элемента.</para>
        <section id="abstractEditor">
          <title>AbstractEditor</title>
          <para><code>AbstractEditor</code> − базовый класс контроллеров экранов редактирования экземпляра сущности.</para>
          <para>При создании конкретного класса контроллера рекомендуется параметризовать <code>AbstractEditor</code> типом редактируемой сущности. При этом методы <methodname>getItem</methodname> и <methodname>initItem</methodname> будут работать с конкретным типом сущности и прикладному коду не потребуется дополнительных приведений типов. Например:</para>
          <programlisting>public class UserEditor extends AbstractEditor&lt;User&gt; {
...
    @Override
    protected void initItem(User item) {
    ...</programlisting>
          <para>Помимо общего для всех <glossterm linkend="screen_controller_glossentry">контроллеров</glossterm> метода <methodname>init</methodname> в контроллере экрана редактирования можно переопределить следующие:</para>
          <itemizedlist>
            <listitem>
              <para>Методы инициализации:</para>
              <itemizedlist>
                <listitem>
                  <para><methodname>initItem</methodname></para>
                </listitem>
                <listitem>
                  <para><methodname>postInit</methodname></para>
                </listitem>
              </itemizedlist>
            </listitem>
            <listitem>
              <para>Методы завершения:</para>
              <itemizedlist>
                <listitem>
                  <para><methodname>postValidate</methodname></para>
                </listitem>
                <listitem>
                  <para><methodname>preCommit</methodname></para>
                </listitem>
                <listitem>
                  <para><methodname>postCommit</methodname></para>
                </listitem>
              </itemizedlist>
            </listitem>
          </itemizedlist>
          <para><emphasis role="bold">Диаграммы последовательностей</emphasis></para>
          <figure>
            <title>Инициализация экрана</title>
            <mediaobject>
              <imageobject>
                <imagedata align="center" fileref="img/EditorInit.png"/>
              </imageobject>
            </mediaobject>
          </figure>
          <figure>
            <title>Коммит и закрытие экрана с фреймом editWindowActions</title>
            <mediaobject>
              <imageobject>
                <imagedata align="center" fileref="img/EditorCommit.png"/>
              </imageobject>
            </mediaobject>
          </figure>
          <figure>
            <title>Коммит экрана с фреймом extendedEditWindowActions</title>
            <mediaobject>
              <imageobject>
                <imagedata align="center" fileref="img/ExtendedEditorCommit.png"/>
              </imageobject>
            </mediaobject>
          </figure>
          <figure>
            <title>Коммит и закрытие экрана с фреймом extendedEditWindowActions</title>
            <mediaobject>
              <imageobject>
                <imagedata align="center" fileref="img/ExtendedEditorCommitAndClose.png"/>
              </imageobject>
            </mediaobject>
          </figure>
        </section>
      </section>
      <section id="screen_xml">
        <title>XML-дескриптор</title>
        <para>Описывает <link linkend="datasources">источники данных</link> и расположение визуальных компонентов экрана.</para>
        <para>XML-дескриптор содержит следующие элементы:</para>
        <itemizedlist>
          <listitem>
            <para><parameter>window</parameter> − корневой элемент. Атрибуты:</para>
            <orderedlist>
              <listitem>
                <para><property>xmlns</property>=&quot;http://www.haulmont.com/schema/cuba/gui/window.xsd&quot; − схема XML</para>
              </listitem>
              <listitem>
                <para><property>class</property> − имя класса <glossterm linkend="screen_controller_glossentry">контроллера</glossterm></para>
              </listitem>
              <listitem>
                <para><property>messagesPack</property> − имя <glossterm linkend="message_pack_glossentry">пакета сообщений</glossterm>. Фактически это имя Java-пакета, содержащего файл  <filename>messages.properties</filename></para>
              </listitem>
              <listitem>
                <para><property>caption</property> − заголовок экрана, должен содержать ссылку на сообщение из вышеуказанного пакета, например, <programlisting>caption=&quot;msg://caption&quot;</programlisting></para>
              </listitem>
              <listitem>
                <para><property>focusComponent</property> − идентификатор компонента, который получит фокус ввода при отображениее экрана (необязательно).</para>
              </listitem>
            </orderedlist>
          </listitem>
          <listitem>
            <para><parameter>metadataContext</parameter> − опциональный элемент для инициализации <link linkend="views">представлений</link> (views). Предпочтительным является определение всех представлений в одном общем файле <filename>ext-views.xml</filename>  модуля <structname>core</structname>. </para>
          </listitem>
          <listitem>
            <para><parameter>dsContext</parameter> − элемент, определяющий <link linkend="datasources">источники данных</link> данного экрана. Источники данных предназначены для реализации связанных с данными  компонентов.</para>
          </listitem>
          <listitem>
            <para><parameter>layout</parameter> − элемент, определяющий компоновку экрана.</para>
          </listitem>
        </itemizedlist>
      </section>
      <section id="screen_registration">
        <title>Регистрация экранов</title>
        <para>Все экраны, доступные в приложении, регистрируются в  файлах <filename>*-screens.xml</filename>.</para>
        <para>Набор файлов <filename>*-screens.xml</filename> конкретного проекта указывается в <glossterm linkend="app_properties_glossentry">свойстве приложения</glossterm> <parameter>cuba.windowConfig</parameter>.</para>
        <itemizedlist>
          <title>Элементы XML</title>
          <listitem>
            <para><emphasis role="bold">screen-config</emphasis> − корневой элемент</para>
          </listitem>
          <listitem>
            <para><emphasis role="bold">include</emphasis> − включение другого <filename>*-screens.xml</filename>. Вместо включения рекомендуется использовать комбинацию файлов в <glossterm linkend="app_properties_glossentry">свойстве приложения</glossterm> <parameter>cuba.windowConfig</parameter>. Атрибуты:</para>
            <itemizedlist>
              <listitem>
                <para><emphasis role="bold">file</emphasis> − путь к файлу, начиная от каталога конфигурации приложения <filename>WEB-INF/conf</filename></para>
              </listitem>
            </itemizedlist>
          </listitem>
          <listitem>
            <para><emphasis role="bold">screen</emphasis> − регистрация экрана. Атрибуты:</para>
            <itemizedlist>
              <listitem>
                <para><emphasis role="bold">id</emphasis> − идентификатор  экрана, по которому   производится обращение</para>
              </listitem>
              <listitem>
                <para><emphasis role="bold">template</emphasis> − путь к <glossterm linkend="screen_xml_glossentry">дескриптору</glossterm> экрана. Сначала будет произведена попытка найти дескриптор в каталоге конфигурации приложения <filename>WEB-INF/conf</filename>. Если его там нет, то будет произведен поиск в <filename>classpath</filename>.</para>
              </listitem>
              <listitem>
                <para><emphasis role="bold">class</emphasis> − имя класса. Элемент может быть использован вместо <emphasis role="bold">template</emphasis>. Класс должен реализовывать либо интерфейс <interface>Callable</interface>, либо интерфейс <interface>Runnable</interface>. В случае реализации интерфейса <interface>Callable</interface> метод <methodname>call()</methodname> должен возвращать экземпляр созданного <code>Window</code>, который будет возвращен как результат вызова <methodname>WindowManager.openWindow()</methodname>. Класс может содержать конструктор с параметрами для передачи ему строковых значений, заданных атрибутом <emphasis role="bold">param</emphasis>.</para>
              </listitem>
            </itemizedlist>
          </listitem>
          <listitem>
            <para><emphasis role="bold">params</emphasis> − задает параметры вызова экрана. Элемент используется внутри элемента <emphasis role="bold">screen</emphasis>. Параметры вызова позволяют задать несколько идентификаторов одному дескриптору экрана. Параметры будут переданы <glossterm linkend="screen_controller_glossentry">контроллеру</glossterm> экрана в мапе на входе <methodname>init()</methodname>, либо в конструктор класса, если задан <emphasis role="bold">class</emphasis>.</para>
          </listitem>
          <listitem>
            <para><emphasis role="bold">param</emphasis> − задает параметр внутри элемента <emphasis role="bold">params</emphasis>. Атрибуты:</para>
            <itemizedlist>
              <listitem>
                <para><emphasis role="bold">name</emphasis> − имя параметра</para>
              </listitem>
              <listitem>
                <para><emphasis role="bold">value</emphasis> − значение параметра. Если значение содержит строку &quot;true&quot; или &quot;false&quot;, в параметры экрана будет передано соответствующее значение типа <code>Boolean</code>.</para>
              </listitem>
            </itemizedlist>
          </listitem>
        </itemizedlist>
      </section>
      <section>
        <title>Главное меню</title>
        <para>TODO</para>
      </section>
    </section>
    <section id="gui_vcl">
      <title>Библиотека визуальных компонентов</title>
      <para><link linkend="gui_components">Компоненты</link></para>
      <para><link linkend="gui_layouts">Контейнеры</link></para>
      <section id="gui_components">
        <title>Компоненты</title>
        <figure>
          <title>Диаграмма компонентов</title>
          <mediaobject>
            <imageobject>
              <imagedata align="center" fileref="img/Components_new.png"/>
            </imageobject>
          </mediaobject>
        </figure>
        <para><code>Component</code> − предок всех визуальных компонентов. Он содержит базовые атрибуты, позволяющие идентифицировать компонент и располагать его на экране.</para>
        <informaltable frame="none" pgwide="0">
          <tgroup cols="2" colsep="1">
            <colspec colnum="1" colname="c0" colwidth="1*"/>
            <colspec colnum="2" colname="c1" colwidth="4*"/>
            <tbody valign="middle">
              <row>
                <entry align="left">
                  <link linkend="gui_Button">Button</link>
                </entry>
                <entry align="left">
                  <mediaobject>
                    <imageobject>
                      <imagedata fileref="img/Button.png"/>
                    </imageobject>
                  </mediaobject>
                </entry>
              </row>
              <row valign="middle">
                <entry align="left">
                  <link linkend="gui_PopupButton">PopupButton</link>
                </entry>
                <entry align="left">
                  <mediaobject>
                    <imageobject>
                      <imagedata fileref="img/PopupButton.png"/>
                    </imageobject>
                  </mediaobject>
                </entry>
              </row>
              <row>
                <entry align="left">
                  <link linkend="gui_LinkButton">LinkButton</link>
                </entry>
                <entry align="left">
                  <mediaobject>
                    <imageobject>
                      <imagedata fileref="img/LinkButton.png"/>
                    </imageobject>
                  </mediaobject>
                </entry>
              </row>
              <row>
                <entry align="left">
                  <link linkend="gui_Label">Label</link>
                </entry>
                <entry align="left">
                  <mediaobject>
                    <imageobject>
                      <imagedata fileref="img/gui_label.png"/>
                    </imageobject>
                  </mediaobject>
                </entry>
              </row>
              <row>
                <entry align="left">
                  <link linkend="gui_TextField">TextField</link>
                </entry>
                <entry align="left">
                  <mediaobject>
                    <imageobject>
                      <imagedata fileref="img/gui_textField.png"/>
                    </imageobject>
                  </mediaobject>
                </entry>
              </row>
              <row>
                <entry align="left">
                  <link linkend="gui_TextArea">TextArea</link>
                </entry>
                <entry align="left">
                  <mediaobject>
                    <imageobject>
                      <imagedata fileref="img/gui_textArea.png"/>
                    </imageobject>
                  </mediaobject>
                </entry>
              </row>
              <row>
                <entry align="left">
                  <link linkend="gui_DateField">DateField</link>
                </entry>
                <entry align="left">
                  <mediaobject>
                    <imageobject>
                      <imagedata fileref="img/gui_dateField.png"/>
                    </imageobject>
                  </mediaobject>
                </entry>
              </row>
              <row>
                <entry align="left">
                  <link linkend="gui_TimeField">TimeField</link>
                </entry>
                <entry align="left">
                  <mediaobject>
                    <imageobject>
                      <imagedata fileref="img/gui_timeField1.png"/>
                    </imageobject>
                  </mediaobject>
                </entry>
              </row>
              <row>
                <entry align="left">
                  <link linkend="gui_CheckBox">CheckBox</link>
                </entry>
                <entry align="left">
                  <mediaobject>
                    <imageobject>
                      <imagedata fileref="img/CheckBox.png"/>
                    </imageobject>
                  </mediaobject>
                </entry>
              </row>
              <row>
                <entry align="left">
                  <link linkend="gui_PickerField">PickerField</link>
                </entry>
                <entry align="left">
                  <mediaobject>
                    <imageobject>
                      <imagedata fileref="img/PickerField.png"/>
                    </imageobject>
                  </mediaobject>
                </entry>
              </row>
              <row>
                <entry align="left">
                  <link linkend="gui_OptionsGroup">OptionsGroup</link>
                </entry>
                <entry align="left">
                  <mediaobject>
                    <imageobject>
                      <imagedata fileref="img/gui_optionsGroup.png"/>
                    </imageobject>
                  </mediaobject>
                </entry>
              </row>
              <row>
                <entry align="left">
                  <link linkend="gui_LookupField">LookupField</link>
                </entry>
                <entry align="left">
                  <mediaobject>
                    <imageobject>
                      <imagedata fileref="img/LookupField.png"/>
                    </imageobject>
                  </mediaobject>
                </entry>
              </row>
              <row>
                <entry align="left">
                  <link linkend="gui_LookupPickerField">LookupPickerField</link>
                </entry>
                <entry align="left">
                  <mediaobject>
                    <imageobject>
                      <imagedata fileref="img/LookupPickerField.png"/>
                    </imageobject>
                  </mediaobject>
                </entry>
              </row>
              <row>
                <entry align="left">
                  <link linkend="gui_SearchField">SearchField</link>
                </entry>
                <entry align="left">
                  <mediaobject>
                    <imageobject>
                      <imagedata fileref="img/gui_searchField.png"/>
                    </imageobject>
                  </mediaobject>
                </entry>
              </row>
              <row>
                <entry align="left">
                  <link linkend="gui_SearchPickerField">SearchPickerField</link>
                </entry>
                <entry align="left">
                  <mediaobject>
                    <imageobject>
                      <imagedata fileref="img/gui_searchPickerField.png"/>
                    </imageobject>
                  </mediaobject>
                </entry>
              </row>
              <row>
                <entry align="left">
                  <link linkend="gui_TwinColumn">TwinColumn</link>
                </entry>
                <entry align="left">
                  <mediaobject>
                    <imageobject>
                      <imagedata fileref="img/TwinColumn.png"/>
                    </imageobject>
                  </mediaobject>
                </entry>
              </row>
              <row>
                <entry align="left">
                  <link linkend="gui_FileUploadField">FileUploadField</link>
                </entry>
                <entry align="left">
                  <mediaobject>
                    <imageobject>
                      <imagedata fileref="img/Upload.png"/>
                    </imageobject>
                  </mediaobject>
                </entry>
              </row>
              <row>
                <entry align="left">
                  <link linkend="gui_Table">Table</link>
                </entry>
                <entry align="left">
                  <mediaobject>
                    <imageobject>
                      <imagedata fileref="img/gui_table.png"/>
                    </imageobject>
                  </mediaobject>
                </entry>
              </row>
              <row>
                <entry align="left">
                  <link linkend="gui_TreeTable">TreeTable</link>
                </entry>
                <entry align="left">
                  <mediaobject>
                    <imageobject>
                      <imagedata fileref="img/gui_treeTable.png"/>
                    </imageobject>
                  </mediaobject>
                </entry>
              </row>
              <row>
                <entry align="left">
                  <link linkend="gui_GroupTable">GroupTable</link>
                </entry>
                <entry align="left">
                  <mediaobject>
                    <imageobject>
                      <imagedata fileref="img/GroupTable.png"/>
                    </imageobject>
                  </mediaobject>
                </entry>
              </row>
              <row>
                <entry align="left">
                  <link linkend="gui_Tree">Tree</link>
                </entry>
                <entry align="left">
                  <mediaobject>
                    <imageobject>
                      <imagedata fileref="img/Tree.png"/>
                    </imageobject>
                  </mediaobject>
                </entry>
              </row>
              <row>
                <entry align="left">
                  <link linkend="gui_FieldGroup">FieldGroup</link>
                </entry>
                <entry align="left">
                  <mediaobject>
                    <imageobject>
                      <imagedata fileref="img/gui_fieldGroup.png"/>
                    </imageobject>
                  </mediaobject>
                </entry>
              </row>
              <row>
                <entry align="left">
                  <link linkend="gui_TokenList">TokenList</link>
                </entry>
                <entry align="left">
                  <mediaobject>
                    <imageobject>
                      <imagedata fileref="img/gui_tokenList.png"/>
                    </imageobject>
                  </mediaobject>
                </entry>
              </row>
              <row>
                <entry align="left">
                  <link linkend="gui_Filter">GenericFilter</link>
                </entry>
                <entry align="left">
                  <mediaobject>
                    <imageobject>
                      <imagedata fileref="img/gui_filter_mini.png"/>
                    </imageobject>
                  </mediaobject>
                </entry>
              </row>
            </tbody>
          </tgroup>
        </informaltable>
        <section id="gui_Label">
          <title>Label</title>
          <para>Надпись (<code>Label</code>) − текстовый компонент, отображающий  статический текст либо значение атрибута <glossterm linkend="entity">сущности</glossterm>.</para>
          <para>XML-имя компонента: <sgmltag>label</sgmltag></para>
          <figure>
            <title/>
            <mediaobject>
              <imageobject>
                <imagedata contentwidth="80%" align="center" fileref="img/gui_label_dia.png"/>
              </imageobject>
            </mediaobject>
          </figure>
          <para>Существует два класса компонента <code>Label</code>: для веб-приложений  и для десктоп-приложений. </para>
          <figure>
            <title>Типы надписей</title>
            <mediaobject>
              <imageobject>
                <imagedata contentwidth="40%" align="center" fileref="img/gui_labelTypes.png"/>
              </imageobject>
            </mediaobject>
          </figure>
          <para>Для того чтобы создать компонент надписи, создайте в <glossterm linkend="screen_xml_glossentry">xml-дескрипторе</glossterm> следующий код:</para>
          <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/section_gui/label/label.txt" encoding="UTF-8" parse="text"/></programlisting>
          <para>Атрибут <sgmltag id="attr_value">value</sgmltag> предназначен для отображения текста надписи. Обычно значение атрибута задается с помощью ключа <glossterm linkend="message_pack_glossentry">пакета сообщений</glossterm>.</para>
          <para>Текст, содержащийся в атрибуте <sgmltag>value</sgmltag>, будет перенесен на следующую строку, если по длине он превысит значение атрибута <link linkend="attr_width">width</link>. Поэтому если Вам нужно использовать многострочную надпись, укажите требуемое значение атрибута <link linkend="attr_width">width</link> (применимо только для веб-приложений). Если текст надписи слишком длинный, и значение атрибута <link linkend="attr_width">width</link> не определено, то текст будет урезан.</para>
          <figure>
            <title/>
            <mediaobject>
              <imageobject>
                <imagedata contentwidth="142" contentdepth="24" align="center" fileref="img/gui_label_truncated.png"/>
              </imageobject>
            </mediaobject>
          </figure>
          <para>В компоненте надписи есть возможность отображать значение атрибута сущности. Для этого используются атрибуты <link linkend="attr_datasource">datasource</link> и <link linkend="attr_property">property</link>.</para>
          <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/section_gui/label/labelWithDatasource.txt" encoding="UTF-8" parse="text"/></programlisting>
          <para>Атрибуты <sgmltag>label</sgmltag>:</para>
          <informaltable frame="none" pgwide="0" align="left">
            <tgroup cols="4" colsep="1" rowsep="1" align="left"><colspec colname="c1"/><colspec colname="c2"/><colspec colname="c3"/><colspec colname="c4"/>c <tbody>
                <row>
                  <entry align="left">
                    <link linkend="attr_align">align</link>
                  </entry>
                  <entry align="left">
                    <link linkend="attr_property">property</link>
                  </entry>
                  <entry align="left">
                    <link linkend="attr_width">width</link>
                  </entry>
                </row>
                <row>
                  <entry>
                    <link linkend="attr_datasource">datasource</link>
                  </entry>
                  <entry align="left">
                    <link linkend="attr_stylename">stylename</link>
                  </entry>
                </row>
                <row>
                  <entry align="left">
                    <link linkend="attr_height">height</link>
                  </entry>
                  <entry align="left">
                    <link linkend="attr_value">value</link>
                  </entry>
                  <entry/>
                </row>
                <row>
                  <entry align="left">
                    <link linkend="attr_id">id</link>
                  </entry>
                  <entry align="left">
                    <link linkend="attr_visible">visible</link>
                  </entry>
                </row>
              </tbody></tgroup>
          </informaltable>
          <para>Элементы <sgmltag>label</sgmltag>:</para>
          <informaltable frame="none" pgwide="0" align="left">
            <tgroup cols="1" colsep="1" rowsep="1" align="left">
              <colspec colname="c1"/>
              <tbody>
                <row>
                  <entry align="left">
                    <link linkend="element_formatter">formatter</link>
                  </entry>
                </row>
              </tbody>
            </tgroup>
          </informaltable>
        </section>
        <section id="gui_Button">
          <title>Button</title>
          <para>Кнопка (<code>Button</code>) −  компонент,  обеспечивающий  выполнение некоторых действий при нажатии на нее пользователем.</para>
          <para>XML-имя компонента: <sgmltag>button</sgmltag></para>
          <figure>
            <title/>
            <mediaobject>
              <imageobject>
                <imagedata contentwidth="80%" align="center" fileref="img/gui_Button_dia.png"/>
              </imageobject>
            </mediaobject>
          </figure>
          <para>Классы кнопок существуют как для веб-приложений, так и для десктоп-приложений.</para>
          <para>Кнопка может содержать  текст или пиктограмму (или и то и другое). На рисунке ниже отражены разные виды кнопок.</para>
          <figure>
            <title>Типы кнопок</title>
            <mediaobject>
              <imageobject>
                <imagedata contentwidth="233" contentdepth="128" align="center" fileref="img/gui_buttonTypes.png"/>
              </imageobject>
            </mediaobject>
          </figure>
          <para>Для создания кнопки с текстом достаточно написать в <glossterm linkend="screen_xml_glossentry">xml-дескрипторе</glossterm> следующий код: </para>
          <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/section_gui/button/textButton.txt" encoding="UTF-8" parse="text"/></programlisting>
          <para>Для создания кнопки с пиктограммой:</para>
          <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/section_gui/button/iconButton.txt" encoding="UTF-8" parse="text"/></programlisting>
          <para>Атрибут <link linkend="attr_icon">icon</link> указывает на местоположение пиктограммы. Подробную информацию о том, где следует располагать файлы пиктограмм, Вы можете прочитать в <xref linkend="gui_themes"/></para>
          <para>Для создания кнопки с пользовательским стилем необходимо указать атрибут <sgmltag>stylename</sgmltag>, а также задать стиль компонента в файле <filename>CSS</filename>.</para>
          <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/section_gui/button/userButton.txt" encoding="UTF-8" parse="text"/></programlisting>
          <para>Определение стиля:</para>
          <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/section_gui/button/cssButton.txt" encoding="UTF-8" parse="text"/></programlisting>
          <para>Подробную информацию о том, как создавать пользовательский стиль, Вы можете прочитать в <xref linkend="gui_themes"/></para>
          <para>Основная функция кнопки −  выполнить некоторое действие при нажатии на нее. Определить метод <glossterm linkend="screen_controller_glossentry">контроллера</glossterm>, который будет вызываться при нажатии на кнопку, можно с помощью атрибута <sgmltag id="attr_invoke">invoke</sgmltag>. Значением атрибута должно быть    имя  метода контроллера, вызываемого в ответ на событие нажатия кнопки. Метод должен:</para>
          <itemizedlist>
            <listitem>
              <para>Быть <code>public</code></para>
            </listitem>
            <listitem>
              <para>Возвращать <code>void</code></para>
            </listitem>
            <listitem>
              <para>Не иметь аргументов или иметь один аргумент типа <code>Component</code>. Если метод имеет аргумент <code>Component</code>, то при вызове в него будет передан экземпляр вызвавшей кнопки.</para>
            </listitem>
          </itemizedlist>
          <para>В качестве примера показано описание кнопки, вызывающей метод <code>lockButton:</code></para>
          <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/section_gui/button/invokeButton.txt" encoding="UTF-8" parse="text"/></programlisting>
          <para>В <glossterm linkend="screen_controller_glossentry">контроллере</glossterm> экрана необходимо определить метод <code>lockButton</code>:</para>
          <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/section_gui/button/methodButton.txt" encoding="UTF-8" parse="text"/></programlisting>
          <para>Атрибут <sgmltag>invoke</sgmltag> игнорируется, если для кнопки задан атрибут <sgmltag>action</sgmltag>. Атрибут <sgmltag id="attr_action">action</sgmltag> содержит имя <link linkend="gui_Action">Action</link>, соответствующего данной кнопке.</para>
          <para>Пример кнопки с атрибутом <sgmltag>action</sgmltag>:</para>
          <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/section_gui/button/actionButton.txt" encoding="UTF-8" parse="text"/></programlisting>
          <para><link linkend="gui_Action">Action</link> для кнопки можно создавать программно, в <glossterm linkend="screen_controller_glossentry">контроллере</glossterm> экрана.</para>
          <para>В качестве примера создадим кнопку, имеющую в <glossterm linkend="screen_xml_glossentry">xml-дескрипторе</glossterm> только атрибут <link linkend="attr_id">id</link>:</para>
          <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/section_gui/button/withoutActionButton.txt" encoding="UTF-8" parse="text"/></programlisting>
          <para>В контроллере  в методе <code>init()</code> экрана определим действие и название для кнопки.</para>
          <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/section_gui/button/withoutActionButtonContr.txt" encoding="UTF-8" parse="text"/></programlisting>
          <para>Атрибуты <sgmltag>button</sgmltag>:</para>
          <informaltable frame="none" pgwide="0" align="left">
            <tgroup cols="4" colsep="1" rowsep="1" align="left"><colspec colname="c1"/><colspec colname="c2"/><colspec colname="c3"/><colspec colname="c4"/>c <tbody>
                <row>
                  <entry align="left">
                    <link linkend="attr_action">action</link>
                  </entry>
                  <entry align="left">
                    <link linkend="attr_enable">enable</link>
                  </entry>
                  <entry align="left">
                    <link linkend="attr_stylename">stylename</link>
                  </entry>
                </row>
                <row>
                  <entry>
                    <link linkend="attr_align">align</link>
                  </entry>
                  <entry align="left">
                    <link linkend="attr_icon">icon</link>
                  </entry>
                  <entry align="left">
                    <link linkend="attr_visible">visible</link>
                  </entry>
                </row>
                <row>
                  <entry align="left">
                    <link linkend="attr_caption">caption</link>
                  </entry>
                  <entry align="left">
                    <link linkend="attr_id">id</link>
                  </entry>
                  <entry>
                    <link linkend="attr_width">width</link>
                  </entry>
                </row>
                <row>
                  <entry align="left">
                    <link linkend="attr_description">description</link>
                  </entry>
                  <entry align="left">
                    <link linkend="attr_invoke">invoke</link>
                  </entry>
                </row>
              </tbody></tgroup>
          </informaltable>
        </section>
        <section id="gui_PopupButton">
          <title>PopupButton</title>
          <para>Кнопка с выпадающим списком действий.</para>
          <para>XML-имя компонента: <sgmltag>popupButton</sgmltag>.</para>
          <figure>
            <title/>
            <mediaobject>
              <imageobject>
                <imagedata contentwidth="80%" align="center" fileref="img/gui_popupButton_dia.png"/>
              </imageobject>
            </mediaobject>
          </figure>
          <para>Существует два класса кнопок: для веб-приложений  и для десктоп-приложений.</para>
          <para>Кнопка с выпадающим списком действий может содержать  текст или пиктограмму (или и то и другое). На рисунке ниже отражены разные виды кнопок.</para>
          <figure>
            <title>Типы кнопок</title>
            <mediaobject>
              <imageobject>
                <imagedata contentwidth="154" contentdepth="125" align="center" fileref="img/gui_popupButtonTypes.png"/>
              </imageobject>
            </mediaobject>
          </figure>
          <para>Для создания кнопки с текстом достаточно написать в <glossterm linkend="screen_xml_glossentry">xml-дескрипторе</glossterm> следующий код: </para>
          <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/section_gui/popupButton/textPopupButton.txt" encoding="UTF-8" parse="text"/></programlisting>
          <para>Для создания кнопки с пиктограммой:</para>
          <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/section_gui/popupButton/iconPopupButton.txt" encoding="UTF-8" parse="text"/></programlisting>
          <para>Кнопка <sgmltag>popupButton</sgmltag> содержит выпадающий список действий,  которые задаются в элементе <link linkend="gui_Action">actions</link>.</para>
          <figure>
            <title>Кнопка с выпадающим списком действий</title>
            <mediaobject>
              <imageobject>
                <imagedata contentwidth="107" contentdepth="73" align="center" fileref="img/PopupButton.png"/>
              </imageobject>
            </mediaobject>
          </figure>
          <para>Атрибуты <sgmltag>popupButton</sgmltag>:</para>
          <informaltable frame="none" pgwide="0" align="left">
            <tgroup cols="4" colsep="1" rowsep="1" align="left"><colspec colname="c1"/><colspec colname="c2"/><colspec colname="c3"/><colspec colname="c4"/>c <tbody>
                <row>
                  <entry align="left">
                    <link linkend="attr_align">align</link>
                  </entry>
                  <entry align="left">
                    <link linkend="attr_icon">icon</link>
                  </entry>
                  <entry align="left">
                    <link linkend="attr_width">width</link>
                  </entry>
                </row>
                <row>
                  <entry>
                    <link linkend="attr_caption">caption</link>
                  </entry>
                  <entry align="left">
                    <link linkend="attr_id">id</link>
                  </entry>
                </row>
                <row>
                  <entry align="left">
                    <link linkend="attr_description">description</link>
                  </entry>
                  <entry align="left">
                    <link linkend="attr_stylename">stylename</link>
                  </entry>
                </row>
                <row>
                  <entry align="left">
                    <link linkend="attr_enable">enable</link>
                  </entry>
                  <entry align="left">
                    <link linkend="attr_visible">visible</link>
                  </entry>
                </row>
              </tbody></tgroup>
          </informaltable>
          <para>Элементы <sgmltag>popupButton</sgmltag>:</para>
          <informaltable frame="none" pgwide="0" align="left">
            <tgroup cols="1" colsep="1" rowsep="1" align="left">
              <colspec colname="c1"/>
              <tbody>
                <row>
                  <entry align="left">
                    <link linkend="gui_Action">actions</link>
                  </entry>
                </row>
              </tbody>
            </tgroup>
          </informaltable>
        </section>
        <section id="gui_LinkButton">
          <title>LinkButton</title>
          <para>Кнопка-ссылка (<code>LinkButton</code>) − кнопка, выглядящая как гиперссылка.</para>
          <para>XML-имя компонента: <sgmltag>linkButton</sgmltag></para>
          <figure>
            <title/>
            <mediaobject>
              <imageobject>
                <imagedata contentwidth="70%" align="center" fileref="img/gui_linkButton_dia.png"/>
              </imageobject>
            </mediaobject>
          </figure>
          <para>Существует два класса кнопок-ссылок: для веб-приложений  и для десктоп-приложений.</para>
          <para>Кнопка-ссылка  может содержать  текст или пиктограмму (или и то и другое). На рисунке ниже отражены разные виды кнопок.</para>
          <figure>
            <title>Типы кнопок-ссылок</title>
            <mediaobject>
              <imageobject>
                <imagedata contentwidth="130" contentdepth="127" align="center" fileref="img/gui_linkButtonTypes.png"/>
              </imageobject>
            </mediaobject>
          </figure>
          <para>Для создания кнопки с текстом достаточно написать в <glossterm linkend="screen_xml_glossentry">xml-дескрипторе</glossterm> следующий код: </para>
          <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/section_gui/linkButton/textLinkButton.txt" encoding="UTF-8" parse="text"/></programlisting>
          <para>Для создания кнопки с пиктограммой:</para>
          <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/section_gui/linkButton/iconLinkButton.txt" encoding="UTF-8" parse="text"/></programlisting>
          <para>Для кнопки-ссылки, также как и для обычной кнопки (<link linkend="gui_Button">Button</link>), можно в атрибуте <link linkend="attr_invoke">invoke</link> задать метод <glossterm linkend="screen_controller_glossentry">контроллера</glossterm>, который будет вызываться при нажатии на нее.</para>
          <para>В качестве примера показано описание кнопки, вызывающей метод <code>saveActionTest:</code></para>
          <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/section_gui/linkButton/invokeLinkButton.txt" encoding="UTF-8" parse="text"/></programlisting>
          <para>В <glossterm linkend="screen_controller_glossentry">контроллере</glossterm> экрана необходимо определить метод <code>saveActionTest</code>:</para>
          <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/section_gui/linkButton/methodLinkButton.txt" encoding="UTF-8" parse="text"/></programlisting>
          <para>Атрибуты <sgmltag>linkButton</sgmltag>:</para>
          <informaltable frame="none" pgwide="0" align="left">
            <tgroup cols="4" colsep="1" rowsep="1" align="left"><colspec colname="c1"/><colspec colname="c2"/><colspec colname="c3"/><colspec colname="c4"/>c <tbody>
                <row>
                  <entry align="left">
                    <link linkend="attr_action">action</link>
                  </entry>
                  <entry align="left">
                    <link linkend="attr_enable">enable</link>
                  </entry>
                  <entry align="left">
                    <link linkend="attr_stylename">stylename</link>
                  </entry>
                </row>
                <row>
                  <entry>
                    <link linkend="attr_align">align</link>
                  </entry>
                  <entry align="left">
                    <link linkend="attr_icon">icon</link>
                  </entry>
                  <entry align="left">
                    <link linkend="attr_visible">visible</link>
                  </entry>
                </row>
                <row>
                  <entry align="left">
                    <link linkend="attr_caption">caption</link>
                  </entry>
                  <entry align="left">
                    <link linkend="attr_id">id</link>
                  </entry>
                  <entry>
                    <link linkend="attr_width">width</link>
                  </entry>
                </row>
                <row>
                  <entry align="left">
                    <link linkend="attr_description">description</link>
                  </entry>
                  <entry align="left">
                    <link linkend="attr_invoke">invoke</link>
                  </entry>
                </row>
              </tbody></tgroup>
          </informaltable>
        </section>
        <section id="gui_TextField">
          <title>TextField</title>
          <para>Поле для редактирования текста.</para>
          <para>XML-имя компонента: <sgmltag>textField</sgmltag></para>
          <figure>
            <title/>
            <mediaobject>
              <imageobject>
                <imagedata contentwidth="80%" align="center" fileref="img/gui_textField_dia.png"/>
              </imageobject>
            </mediaobject>
          </figure>
          <para>Классы текстовых полей существуют как для веб-приложений, так  и для десктоп-приложений.</para>
          <para>Текстовое поле служит для обеспечения возможности получить текстовую информацию от пользователя, а также для отображения атрибутов <glossterm linkend="entity">сущности</glossterm>.</para>
          <para>Для создания простого текстового поля достаточно в <glossterm linkend="screen_xml_glossentry">xml-дескрипторе</glossterm> написать следующий код:</para>
          <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/section_gui/textField/textField.txt" encoding="UTF-8" parse="text"/></programlisting>
          <para>На рисунке ниже показан вид простого текстового поля.</para>
          <figure>
            <title/>
            <mediaobject>
              <imageobject>
                <imagedata contentwidth="180" align="center" fileref="img/gui_textField.png"/>
              </imageobject>
            </mediaobject>
          </figure>
          <para>Для создания текстового поля, связанного с данными, необходимо использовать атрибуты <link linkend="attr_datasource">datasource</link> и <link linkend="attr_property">property</link>.</para>
          <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/section_gui/textField/textFieldDatasource.txt" encoding="UTF-8" parse="text"/></programlisting>
          <figure>
            <title/>
            <mediaobject>
              <imageobject>
                <imagedata contentwidth="350" align="center" fileref="img/gui_textField_data.png"/>
              </imageobject>
            </mediaobject>
          </figure>
          <para>Если поле не связано с источником данных (то есть не указан источник данных и название атрибута), можно связать текстовое поле  с типом данных с помощью атрибута <property id="attr_datatype_1">datatype</property>. Атрибут используется  для форматирования значения поля. Значением атрибута <property>datatype</property> является имя типа данных из списка:</para>
          <itemizedlist>
            <listitem>
              <para><literal>boolean</literal></para>
            </listitem>
            <listitem>
              <para><literal>byte array</literal></para>
            </listitem>
            <listitem>
              <para><literal>date</literal></para>
            </listitem>
            <listitem>
              <para><literal>decimal</literal></para>
            </listitem>
            <listitem>
              <para><literal>double</literal></para>
            </listitem>
            <listitem>
              <para><literal>int</literal></para>
            </listitem>
            <listitem>
              <para><literal>long</literal></para>
            </listitem>
            <listitem>
              <para><literal>string</literal></para>
            </listitem>
            <listitem>
              <para><literal>uuid</literal></para>
            </listitem>
          </itemizedlist>
          <para>В качестве примера рассмотрим текстовое поле, связанное с типом данных <literal>Integer</literal>. </para>
          <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/section_gui/textField/textFieldInt.txt" encoding="UTF-8" parse="text"/></programlisting>
          <para>При переходе из  текстового поля, в котором введено  значение, не  являющееся типом данных <literal>Integer</literal>, приложение выдаст сообщение об ошибке и очистит текстовое поле.</para>
          <figure>
            <title/>
            <mediaobject>
              <imageobject>
                <imagedata contentwidth="452" contentdepth="133" align="center" fileref="img/gui_textField_int.png"/>
              </imageobject>
            </mediaobject>
          </figure>
          <para>Текстовому полю можно задавать количество строк и столбцов текста с помощью атрибутов <sgmltag id="attr_cols">cols</sgmltag> и <sgmltag id="attr_rows">rows</sgmltag>.</para>
          <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/section_gui/textField/textFieldColsRows.txt" encoding="UTF-8" parse="text"/></programlisting>
          <figure>
            <title/>
            <mediaobject>
              <imageobject>
                <imagedata contentwidth="450" contentdepth="96" align="center" fileref="img/gui_textFieldColsRows.png"/>
              </imageobject>
            </mediaobject>
          </figure>
          <para>Вы можете связать текстовое поле с типом данных с помощью атрибута <sgmltag id="attr_datatype">datatype</sgmltag>. Атрибут используется  для форматирования значения поля в том случае, если поле не связано с данными (то есть не указан источник данных и название атрибута). Значением атрибута <sgmltag>datatype</sgmltag> является имя типа данных из списка:</para>
          <para>Для текстового компонента можно ограничить максимальную длину вводимого текста с помощью атрибута <sgmltag id="attr_maxLength">maxLength</sgmltag>. Значение атрибута устанавливается по умолчанию на основании длины строкового атрибута <glossterm linkend="entity">сущности</glossterm>, если этот параметр указан в аннотации сущности. Значение &quot;-1&quot; означает отсутствие ограничения.</para>
          <para>Ниже показан пример, ограничивающий длину вводимого текста в 10 символов.</para>
          <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/section_gui/textField/textFieldMaxLength.txt" encoding="UTF-8" parse="text"/></programlisting>
          <para>Для компонента <code>TextField</code> существует атрибут <sgmltag id="attr_resizable">resizable</sgmltag>. При задании атрибуту значения <literal>true</literal> и установке количества строк, больших одной, у пользователя появляется возможность  изменять размеры компонента.</para>
          <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/section_gui/textField/textFieldResizable.txt" encoding="UTF-8" parse="text"/></programlisting>
          <figure>
            <title/>
            <mediaobject>
              <imageobject>
                <imagedata contentwidth="330" align="center" fileref="img/gui_textField_resizable.png"/>
              </imageobject>
            </mediaobject>
          </figure>
          <para>Для отсечения лишних пробелов в начале и конце значения используется атрибут <sgmltag id="attr_trim">trim</sgmltag>. По умолчанию значение атрибута равно <literal>true</literal>. Пробелы отсекаются в момент получения значения поля с помощью метода доступа.</para>
          <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/section_gui/textField/textFieldTrim.txt" encoding="UTF-8" parse="text"/></programlisting>
          <para>В <glossterm linkend="screen_controller_glossentry">контроллере</glossterm> экрана определяем метод, который будет вызываться при нажатии на <link linkend="gui_Button">кнопку</link>.</para>
          <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/section_gui/textField/textFieldTrimContr.txt" encoding="UTF-8" parse="text"/></programlisting>
          <para>Атрибут <sgmltag id="attr_secret">secret</sgmltag> позволяет преобразовать текстовое поле в  поле, которое не показывает символы, введенные пользователем. Вместо этого поле отображает эхо-символы, отличные от введенных. </para>
          <para>Текстовое поле с атрибутом <code>secret=&quot;true&quot;</code>  скрывает введенные данные только в визуальном представлении. При получении значения поля с помощью метода доступа это значение представляется в текстовой форме.</para>
          <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/section_gui/textField/textFieldSecret.txt" encoding="UTF-8" parse="text"/></programlisting>
          <para>В <glossterm linkend="screen_controller_glossentry">контроллере</glossterm> экрана определяем метод, который будет вызываться при нажатии на <link linkend="gui_Button">кнопку</link>.</para>
          <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/section_gui/textField/textFieldSecretContr.txt" encoding="UTF-8" parse="text"/></programlisting>
          <figure>
            <title/>
            <mediaobject>
              <imageobject>
                <imagedata align="center" fileref="img/gui_textField_secret.png"/>
              </imageobject>
            </mediaobject>
          </figure>
          <para>Атрибуты <sgmltag>textField</sgmltag>:</para>
          <informaltable frame="none" pgwide="0" align="left">
            <tgroup cols="4" colsep="1" rowsep="1" align="left"><colspec colname="c1"/><colspec colname="c2"/><colspec colname="c3"/><colspec colname="c4"/>c <tbody>
                <row><entry align="left">
                    <link linkend="attr_caption">caption</link>
                  </entry>editable<entry align="left">
                    <link linkend="attr_editable">editable</link>
                  </entry><entry align="left">
                    <link linkend="attr_property">property</link>
                  </entry><entry>
                    <link linkend="attr_secret">secret</link>
                  </entry></row>
                <row>
                  <entry>
                    <link linkend="attr_cols">cols</link>
                  </entry>
                  <entry align="left">
                    <link linkend="attr_enable">enable</link>
                  </entry>
                  <entry>
                    <link linkend="attr_resizable">resizable</link>
                  </entry>
                  <entry>
                    <link linkend="attr_stylename">stylename</link>
                  </entry>
                </row>
                <row>
                  <entry align="left">
                    <link linkend="attr_datasource">datasource</link>
                  </entry>
                  <entry align="left">
                    <link linkend="attr_height">height</link>
                  </entry>
                  <entry>
                    <link linkend="attr_required">required</link>
                  </entry>
                  <entry>
                    <link linkend="attr_trim">trim</link>
                  </entry>
                </row>
                <row>
                  <entry align="left">
                    <link linkend="attr_datatype">datatype</link>
                  </entry>
                  <entry align="left">
                    <link linkend="attr_id">id</link>
                  </entry>
                  <entry>
                    <link linkend="attr_requiredMessage">requiredMessage</link>
                  </entry>
                  <entry>
                    <link linkend="attr_visible">visible</link>
                  </entry>
                </row>
                <row>
                  <entry>
                    <link linkend="attr_description">description</link>
                  </entry>
                  <entry>
                    <link linkend="attr_maxLength">maxLength</link>
                  </entry>
                  <entry>
                    <link linkend="attr_rows">rows</link>
                  </entry>
                  <entry>
                    <link linkend="attr_width">width</link>
                  </entry>
                </row>
              </tbody></tgroup>
          </informaltable>
          <para>Элементы <sgmltag>textField</sgmltag>:</para>
          <informaltable frame="none" pgwide="0" align="left">
            <tgroup cols="1" colsep="1" rowsep="1" align="left">
              <colspec colname="c1"/>
              <tbody>
                <row>
                  <entry align="left">
                    <link linkend="element_formatter">formatter</link>
                  </entry>
                </row>
                <row>
                  <entry>
                    <link linkend="element_validator">validator</link>
                  </entry>
                </row>
              </tbody>
            </tgroup>
          </informaltable>
        </section>
        <section id="gui_TextArea">
          <title>TextArea</title>
          <para>Текстовая область (<code>TextArea</code>) − многострочное текстовое поле для редактирования текста. Содержит элементы управления для форматирования текста.</para>
          <para>XML-имя компонента: <sgmltag>textArea</sgmltag></para>
          <figure>
            <title/>
            <mediaobject>
              <imageobject>
                <imagedata contentwidth="180" align="center" fileref="img/gui_textArea_dia.png"/>
              </imageobject>
            </mediaobject>
          </figure>
          <para>Класс текстовой области существует только для веб-приложений.</para>
          <para>К тексту, вводимому в компоненте <code>TextArea</code>, можно применять средства для форматирования: изменять начертание шрифта, его размер, гарнитуру − с помощью элементов управления, расположенных в верхней части компонента.</para>
          <figure>
            <title/>
            <mediaobject>
              <imageobject>
                <imagedata contentwidth="473" align="center" fileref="img/gui_textAreaInfo.png"/>
              </imageobject>
            </mediaobject>
          </figure>
          <para>Атрибуты <sgmltag>textArea</sgmltag>:</para>
          <informaltable frame="none" pgwide="0" align="left">
            <tgroup cols="4" colsep="1" rowsep="1" align="left"><colspec colname="c1"/><colspec colname="c2"/><colspec colname="c3"/><colspec colname="c4"/>c <tbody>
                <row><entry align="left">
                    <link linkend="attr_caption">caption</link>
                  </entry>editable<entry align="left">
                    <link linkend="attr_editable">editable</link>
                  </entry><entry align="left">
                    <link linkend="attr_property">property</link>
                  </entry><entry>
                    <link linkend="attr_stylename">stylename</link>
                  </entry></row>
                <row>
                  <entry>
                    <link linkend="attr_cols">cols</link>
                  </entry>
                  <entry align="left">
                    <link linkend="attr_enable">enable</link>
                  </entry>
                  <entry>
                    <link linkend="attr_required">required</link>
                  </entry>
                  <entry>
                    <link linkend="attr_visible">visible</link>
                  </entry>
                </row>
                <row>
                  <entry align="left">
                    <link linkend="attr_datasource">datasource</link>
                  </entry>
                  <entry align="left">
                    <link linkend="attr_height">height</link>
                  </entry>
                  <entry>
                    <link linkend="attr_requiredMessage">requiredMessage</link>
                  </entry>
                  <entry>
                    <link linkend="attr_width">width</link>
                  </entry>
                </row>
                <row>
                  <entry align="left">
                    <link linkend="attr_description">description</link>
                  </entry>
                  <entry align="left">
                    <link linkend="attr_id">id</link>
                  </entry>
                  <entry>
                    <link linkend="attr_rows">rows</link>
                  </entry>
                  <entry/>
                </row>
              </tbody></tgroup>
          </informaltable>
          <para>Элементы <sgmltag>textArea</sgmltag>:</para>
          <informaltable frame="none" pgwide="0" align="left">
            <tgroup cols="1" colsep="1" rowsep="1" align="left">
              <colspec colname="c1"/>
              <tbody>
                <row>
                  <entry align="left">
                    <link linkend="element_formatter">formatter</link>
                  </entry>
                </row>
                <row>
                  <entry>
                    <link linkend="element_validator">validator</link>
                  </entry>
                </row>
              </tbody>
            </tgroup>
          </informaltable>
        </section>
        <section id="gui_DateField">
          <title>DateField</title>
          <para>Поле для отображения или ввода даты и времени. В самом простом варианте представляет собой поле для отображения даты, справа от него находится кнопка с выпадающим календарем, правее находится поле для ввода времени.</para>
          <figure>
            <title/>
            <mediaobject>
              <imageobject>
                <imagedata contentwidth="80%" align="center" fileref="img/gui_dateFieldSimple.png"/>
              </imageobject>
            </mediaobject>
          </figure>
          <para>Дата и время по умолчанию отображаются в формате, соответствующем выбранной локали.</para>
          <para>XML-имя компонента: <sgmltag>dateField</sgmltag>.</para>
          <figure>
            <title/>
            <mediaobject>
              <imageobject>
                <imagedata contentwidth="80%" align="center" fileref="img/gui_dateField_dia.png"/>
              </imageobject>
            </mediaobject>
          </figure>
          <para>Существует два класса полей для ввода даты и времени: для веб-приложений  и для десктоп-приложений.</para>
          <para>Для создания  поля даты, связанного с <link linkend="datasources">источником данных</link>, необходимо определить его описание в <glossterm linkend="screen_xml_glossentry">xml-дескрипторе</glossterm> следующим образом:</para>
          <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/section_gui/dateField/dateField.txt" encoding="UTF-8" parse="text"/></programlisting>
          <para>Возможно изменить формат представления даты и времени с помощью атрибута  <sgmltag id="attr_dateFormat">dateFormat</sgmltag> по правилам  SimpleDateFormat (<ulink url="http://docs.oracle.com/javase/6/docs/api/java/text/SimpleDateFormat.html">http://docs.oracle.com/javase/6/docs/ api/java/text/SimpleDateFormat.html</ulink>). Значением атрибута может быть либо строка формата, либо ключ в пакете сообщений (если строка начинается с msg://)</para>
          <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/section_gui/dateField/dateFieldFormat.txt" encoding="UTF-8" parse="text"/></programlisting>
          <figure>
            <title/>
            <mediaobject>
              <imageobject>
                <imagedata contentwidth="210" align="center" fileref="img/gui_dateField_format.png"/>
              </imageobject>
            </mediaobject>
          </figure>
          <para>В большинстве бизнес-приложений нет необходимости отображать милисекунды или даже время.  Точность представления даты или времени контролируется атрибутом <sgmltag id="attr_resolution">resolution</sgmltag>.  Значение атрибута должно соответствовать перечислению <code>DateField.Resolution</code> − <literal>SEC</literal>, <literal>MIN</literal>, <literal>HOUR</literal>, <literal>DAY</literal>, <literal>MONTH</literal>, <literal>YEAR</literal>. По умолчанию точность определяется по аннотации <code>javax.persistence.Temporal</code> соответствующего атрибута <glossterm linkend="entity">сущности</glossterm>.</para>
          <para>Если <code>resolution=&quot;DAY&quot;</code> и не указан атрибут <sgmltag>dateFormat</sgmltag>, то в качестве формата будет взят формат, указанный в <glossterm linkend="main_message_pack_glossentry">главном пакете сообщений</glossterm> с ключом <sgmltag>dateFormat</sgmltag>.</para>
          <para>Если <code>resolution=&quot;MIN&quot;</code> и не указан атрибут <sgmltag>dateFormat</sgmltag>, то в качестве формата будет взят формат, указанный в <glossterm linkend="main_message_pack_glossentry">главном пакете сообщений</glossterm> с ключом <sgmltag>dateTimeFormat</sgmltag>.</para>
          <para>Ниже показано определения поля для ввода даты с точностью до месяца.</para>
          <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/section_gui/dateField/dateFieldResolution.txt" encoding="UTF-8" parse="text"/></programlisting>
          <figure>
            <title/>
            <mediaobject>
              <imageobject>
                <imagedata contentwidth="350" align="center" fileref="img/gui_dateField_resolution.png"/>
              </imageobject>
            </mediaobject>
          </figure>
          <para>Атрибуты <sgmltag>dateField</sgmltag>:</para>
          <informaltable frame="none" pgwide="0" align="left">
            <tgroup cols="4" colsep="1" rowsep="1" align="left"><colspec colname="c1"/><colspec colname="c2"/><colspec colname="c3"/><colspec colname="c4"/>c <tbody>
                <row><entry align="left">
                    <link linkend="attr_caption">caption</link>
                  </entry>editable<entry align="left">
                    <link linkend="attr_editable">editable</link>
                  </entry><entry align="left">
                    <link linkend="attr_property">property</link>
                  </entry><entry>
                    <link linkend="attr_stylename">stylename</link>
                  </entry></row>
                <row>
                  <entry>
                    <link linkend="attr_datasource">datasource</link>
                  </entry>
                  <entry align="left">
                    <link linkend="attr_enable">enable</link>
                  </entry>
                  <entry>
                    <link linkend="attr_required">required</link>
                  </entry>
                  <entry>
                    <link linkend="attr_visible">visible</link>
                  </entry>
                </row>
                <row>
                  <entry align="left">
                    <link linkend="attr_dateFormat">dateFormat</link>
                  </entry>
                  <entry align="left">
                    <link linkend="attr_height">height</link>
                  </entry>
                  <entry>
                    <link linkend="attr_requiredMessage">requiredMessage</link>
                  </entry>
                  <entry>
                    <link linkend="attr_width">width</link>
                  </entry>
                </row>
                <row>
                  <entry align="left">
                    <link linkend="attr_description">description</link>
                  </entry>
                  <entry align="left">
                    <link linkend="attr_id">id</link>
                  </entry>
                  <entry>
                    <link linkend="attr_resolution">resolution</link>
                  </entry>
                  <entry/>
                </row>
              </tbody></tgroup>
          </informaltable>
          <para>Элементы <sgmltag>dateField</sgmltag>:</para>
          <informaltable frame="none" pgwide="0" align="left">
            <tgroup cols="1" colsep="1" rowsep="1" align="left">
              <colspec colname="c1"/>
              <tbody>
                <row>
                  <entry>
                    <link linkend="element_validator">validator</link>
                  </entry>
                </row>
              </tbody>
            </tgroup>
          </informaltable>
        </section>
        <section id="gui_TimeField">
          <title>TimeField</title>
          <para>Поле для отображения или ввода времени. В самом простом варианте представляет собой поле для отображения или ввода времени в часах и минутах.</para>
          <figure>
            <title/>
            <mediaobject>
              <imageobject>
                <imagedata contentwidth="142" align="center" fileref="img/gui_timeField.png"/>
              </imageobject>
            </mediaobject>
          </figure>
          <para>XML-имя компонента: <sgmltag>timeField</sgmltag>.</para>
          <figure>
            <title/>
            <mediaobject>
              <imageobject>
                <imagedata contentwidth="80%" align="center" fileref="img/gui_timeField_dia.png"/>
              </imageobject>
            </mediaobject>
          </figure>
          <para>Существует два класса полей для ввода времени: для веб-приложений и для десктоп-приложений.</para>
          <para>Для создания поля времени, связанного с <link linkend="datasources">источником данных</link>, необходимо указать атрибуты <link linkend="attr_datasource">datasource</link> и <link linkend="attr_property">property</link> в определении поля:</para>
          <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/section_gui/timeField/timeFieldDs.txt" encoding="UTF-8" parse="text"/></programlisting>
          <para>Для создания простого  поля для ввода времени необходимо определить его в <glossterm linkend="screen_xml_glossentry">xml-дескрипторе</glossterm> следующим образом:</para>
          <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/section_gui/timeField/timeField.txt" encoding="UTF-8" parse="text"/></programlisting>
          <para>С помощью установки атрибута <sgmltag id="attr_showSeconds">showSeconds</sgmltag> в значение <literal>true</literal> можно настроить отображение секунд.</para>
          <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/section_gui/timeField/timeFieldSec.txt" encoding="UTF-8" parse="text"/></programlisting>
          <figure>
            <title/>
            <mediaobject>
              <imageobject>
                <imagedata contentwidth="235" align="center" fileref="img/gui_timeFieldSec.png"/>
              </imageobject>
            </mediaobject>
          </figure>
          <para>Атрибуты <sgmltag>timeField</sgmltag>:</para>
          <informaltable frame="none" pgwide="0" align="left">
            <tgroup cols="4" colsep="1" rowsep="1" align="left"><colspec colname="c1"/><colspec colname="c2"/><colspec colname="c3"/><colspec colname="c4"/>c <tbody>
                <row><entry align="left">
                    <link linkend="attr_caption">caption</link>
                  </entry>editable<entry align="left">
                    <link linkend="attr_enable">enable</link>
                  </entry><entry align="left">
                    <link linkend="attr_required">required</link>
                  </entry><entry>
                    <link linkend="attr_visible">visible</link>
                  </entry></row>
                <row>
                  <entry>
                    <link linkend="attr_datasource">datasource</link>
                  </entry>
                  <entry align="left">
                    <link linkend="attr_height">height</link>
                  </entry>
                  <entry>
                    <link linkend="attr_requiredMessage">requiredMessage</link>
                  </entry>
                  <entry>
                    <link linkend="attr_width">width</link>
                  </entry>
                </row>
                <row>
                  <entry align="left">
                    <link linkend="attr_description">description</link>
                  </entry>
                  <entry align="left">
                    <link linkend="attr_id">id</link>
                  </entry>
                  <entry>
                    <link linkend="attr_showSeconds">showSeconds</link>
                  </entry>
                  <entry/>
                </row>
                <row>
                  <entry align="left">
                    <link linkend="attr_editable">editable</link>
                  </entry>
                  <entry align="left">
                    <link linkend="attr_property">property</link>
                  </entry>
                  <entry>
                    <link linkend="attr_stylename">stylename</link>
                  </entry>
                  <entry/>
                </row>
              </tbody></tgroup>
          </informaltable>
          <para>Элементы <sgmltag>timeField</sgmltag>:</para>
          <informaltable frame="none" pgwide="0" align="left">
            <tgroup cols="1" colsep="1" rowsep="1" align="left">
              <colspec colname="c1"/>
              <tbody>
                <row>
                  <entry>
                    <link linkend="element_validator">validator</link>
                  </entry>
                </row>
              </tbody>
            </tgroup>
          </informaltable>
        </section>
        <section id="gui_FieldGroup">
          <title>FieldGroup</title>
          <para>Группа полей (<code>FieldGroup</code>) генерализует представление атрибутов одного или более <link linkend="datasources">источника данных</link>. Представление поля зависит от типа соответствующего атрибута. Для отображения <glossterm linkend="entity">сущностей</glossterm> может использоваться как <link linkend="gui_LookupField">LookupField</link>, так и <link linkend="gui_PickerField">PickerField</link>.</para>
          <figure>
            <title/>
            <mediaobject>
              <imageobject>
                <imagedata contentwidth="80%" align="center" fileref="img/gui_fieldGroup.png"/>
              </imageobject>
            </mediaobject>
          </figure>
          <para>XML-имя компонента: <sgmltag>fieldGroup</sgmltag></para>
          <figure>
            <title/>
            <mediaobject>
              <imageobject>
                <imagedata contentwidth="80%" align="center" fileref="img/gui_FieldGroup_dia.png"/>
              </imageobject>
            </mediaobject>
          </figure>
          <para>Существует два класса групп полей: для веб-приложений  и для десктоп-приложений.</para>
          <para>Ниже представлено описание группы полей в <glossterm linkend="screen_xml_glossentry">xml-дескрипторе</glossterm> экрана:</para>
          <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/section_gui/fieldGroup/fieldGroup.txt" encoding="UTF-8" parse="text"/></programlisting>
          <para><link linkend="datasources">Источник данных</link> (атрибут <link linkend="attr_datasource" id="attr_fG_datasource">datasource</link>) можно задать как для всего компонента целиком, так и для каждого поля в отдельности. Если для компонента <sgmltag>fieldGroup</sgmltag> атрибут не задан, то атрибут <sgmltag>datasource</sgmltag> должен быть задан для каждого <link linkend="attr_field">поля</link> в отдельности, либо представление полей должно задаваться разработчиком.</para>
          <para>При установке  атрибута <sgmltag id="attr_collapsable">collapsable</sgmltag>   в значение <literal>true</literal> компонент может сворачивать свое содержимое.</para>
          <figure>
            <title/>
            <mediaobject>
              <imageobject>
                <imagedata contentwidth="80%" align="center" fileref="img/gui_fieldGroup_collapsable.png"/>
              </imageobject>
            </mediaobject>
          </figure>
          <para id="attr_captionAlignment"><sgmltag>captionAlignment</sgmltag> − необязательный атрибут, задает позицию отображения заголовков полей. Может принимать два значения: <literal>LEFT</literal>, <literal>TOP</literal>.</para>
          <figure>
            <title/>
            <mediaobject>
              <imageobject>
                <imagedata align="center" fileref="img/gui_FieldGroup_captionAlignment.png"/>
              </imageobject>
            </mediaobject>
          </figure>
          <para>Компонент <sgmltag>fieldGroup</sgmltag> состоит из списков <link linkend="attr_field">полей</link>, сгруппированных в элементе <sgmltag id="attr_fG_column">column</sgmltag>. </para>
          <itemizedlist>
            <listitem>
              <para>С помощью атрибута <sgmltag id="attr_fG_width">width</sgmltag> задается ширину всех полей (без учета заголовка) в колонке. Это значение может быть перекрыто в каждом отдельном поле.</para>
            </listitem>
            <listitem>
              <para>Атрибут <sgmltag id="attr_fG_flex">flex</sgmltag> определяет  соотношение ширин колонок.</para>
            </listitem>
          </itemizedlist>
          <para>Элементами <link linkend="attr_fG_column">column</link> служат поля (<property>field</property>).</para>
          <para id="attr_field"><sgmltag>field</sgmltag> − элемент, содержащий описание выводимого поля. Может содержать описание формата выводимого значения (<link linkend="element_formatter">formatter</link>) и описание валидаторов, применяемых к соответствующему полю (<link linkend="element_validator">validator</link>). Рассмотрим более подробно некоторые атрибуты элемента <sgmltag>field</sgmltag>. </para>
          <itemizedlist>
            <listitem>
              <para><link linkend="attr_id" id="attr_field_id">id</link> − обязательный атрибут, идентификатор поля. Имеет физический смысл: в случае, если задан <link linkend="datasources">источник данных</link>, то идентификатором поля должно быть имя атрибута, иначе − просто идентификатор поля.</para>
            </listitem>
            <listitem>
              <para><link linkend="attr_caption" id="attr_field_caption">caption</link> − необязательный атрибут, содержащий заголовок поля.</para>
            </listitem>
            <listitem>
              <para><link linkend="attr_visible" id="attr_field_visible">visible</link> − необязательный атрибут, отвечает за сокрытие поля.</para>
            </listitem>
            <listitem>
              <para><link linkend="attr_optionsDatasource" id="attr_field_optionsDatasource">optionsDatasource</link> − необязательный атрибут, определяющий список возможных значений поля.</para>
            </listitem>
            <listitem>
              <para><link linkend="attr_datasource" id="attr_field_datasource">datasource</link> − необязательный атрибут, содержит имя <link linkend="datasources">источника данных</link> для конкретного поля.</para>
            </listitem>
            <listitem>
              <para>Есть возможность самостоятельно задать представление поля с помощью атрибута <sgmltag id="attr_custom">custom</sgmltag>. Значение атрибута в этом случае должно быть равно  <literal>true</literal>. Представление пользовательского поля необходимо определить в контроллере экрана. Компонент представления должен реализовывать интерфейс <code>Field</code>. Ниже представлен пример представления пользовательского поля:</para>
              <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/section_gui/fieldGroup/fieldGroupCustom.txt" encoding="UTF-8" parse="text"/></programlisting>
            </listitem>
            <listitem>
              <para><link linkend="attr_width" id="attr_field_width">width</link> − необязательный атрибут, содержит ширину поля (без учета заголовка)</para>
            </listitem>
            <listitem>
              <para>Если значение атрибута <sgmltag id="attr_field_rows">rows</sgmltag> больше <literal>1</literal>, то в ячейке будет компонент <link linkend="gui_TextArea">TextArea</link>.</para>
            </listitem>
          </itemizedlist>
          <para>Атрибуты <sgmltag>fieldGroup</sgmltag>:</para>
          <informaltable frame="none" pgwide="0" align="left">
            <tgroup cols="4" colsep="1" rowsep="1" align="left"><colspec colname="c1"/><colspec colname="c2"/><colspec colname="c3"/><colspec colname="c4"/>c <tbody>
                <row><entry align="left">border</entry>editable<entry align="left">
                    <link linkend="attr_fG_datasource">datasource</link>
                  </entry><entry align="left">
                    <link linkend="attr_id">id</link>
                  </entry><entry/></row>
                <row>
                  <entry>
                    <link linkend="attr_caption">caption</link>
                  </entry>
                  <entry align="left">
                    <link linkend="attr_editable">editable</link>
                  </entry>
                  <entry>
                    <link linkend="attr_stylename">stylename</link>
                  </entry>
                  <entry/>
                </row>
                <row>
                  <entry align="left">
                    <link linkend="attr_captionAlignment">captionAlignment</link>
                  </entry>
                  <entry align="left">
                    <link linkend="attr_enable">enable</link>
                  </entry>
                  <entry>
                    <link linkend="attr_visible">visible</link>
                  </entry>
                  <entry/>
                </row>
                <row>
                  <entry align="left">
                    <link linkend="attr_collapsable">collapsable</link>
                  </entry>
                  <entry align="left">
                    <link linkend="attr_height">height</link>
                  </entry>
                  <entry>
                    <link linkend="attr_width">width</link>
                  </entry>
                  <entry/>
                </row>
              </tbody></tgroup>
          </informaltable>
          <para>Элементы <sgmltag>fieldGroup</sgmltag>:</para>
          <informaltable frame="none" pgwide="0" align="left">
            <tgroup cols="1" colsep="1" rowsep="1" align="left">
              <colspec colname="c1"/>
              <tbody>
                <row>
                  <entry>
                    <link linkend="element_fG_field">field</link>
                  </entry>
                </row>
                <row>
                  <entry>
                    <link linkend="element_fG_column">column</link>
                  </entry>
                </row>
              </tbody>
            </tgroup>
          </informaltable>
          <para>Атрибуты <link linkend="attr_field" id="element_fG_field">field</link>:</para>
          <informaltable frame="none" pgwide="0" align="left">
            <tgroup cols="4" colsep="1" rowsep="1" align="left"><colspec colname="c1"/><colspec colname="c2"/><colspec colname="c3"/><colspec colname="c4"/>c <tbody>
                <row><entry align="left">
                    <link linkend="attr_field_caption">caption</link>
                  </entry>editable<entry align="left">
                    <link linkend="attr_dateFormat">dateFormat</link>
                  </entry><entry align="left">
                    <link linkend="attr_field_id">id</link>
                  </entry><entry>
                    <link linkend="attr_field_rows">rows</link>
                  </entry></row>
                <row>
                  <entry>
                    <link linkend="attr_captionProperty">captionProperty</link>
                  </entry>
                  <entry align="left">
                    <link linkend="attr_description">description</link>
                  </entry>
                  <entry>
                    <link linkend="attr_maxLength">maxLength</link>
                  </entry>
                  <entry>
                    <link linkend="attr_showSeconds">showSeconds</link>
                  </entry>
                </row>
                <row>
                  <entry align="left">
                    <link linkend="attr_clickAction">clickAction</link>
                  </entry>
                  <entry align="left">
                    <sgmltag>descriptionProperty</sgmltag>
                  </entry>
                  <entry>
                    <link linkend="attr_field_optionsDatasource">optionsDatasource</link>
                  </entry>
                  <entry>
                    <link linkend="attr_field_visible">visible</link>
                  </entry>
                </row>
                <row>
                  <entry align="left">
                    <link linkend="attr_cols">cols</link>
                  </entry>
                  <entry align="left">
                    <link linkend="attr_editable">editable</link>
                  </entry>
                  <entry>
                    <link linkend="attr_required">required</link>
                  </entry>
                  <entry>
                    <link linkend="attr_field_width">width</link>
                  </entry>
                </row>
                <row>
                  <entry align="left">
                    <link linkend="attr_custom">custom</link>
                  </entry>
                  <entry align="left">
                    <link linkend="attr_enable">enable</link>
                  </entry>
                  <entry>
                    <link linkend="attr_requiredMessage">requiredMessage</link>
                  </entry>
                  <entry/>
                </row>
                <row>
                  <entry align="left">
                    <link linkend="attr_field_datasource">datasource</link>
                  </entry>
                  <entry align="left">field</entry>
                  <entry>
                    <link linkend="attr_resolution">resolution</link>
                  </entry>
                  <entry/>
                </row>
              </tbody></tgroup>
          </informaltable>
          <para>Атрибуты <link linkend="attr_fG_column" id="element_fG_column">column</link>:</para>
          <informaltable frame="none" pgwide="0" align="left">
            <tgroup cols="4" colsep="1" rowsep="1" align="left"><colspec colname="c1"/><colspec colname="c2"/><colspec colname="c3"/><colspec colname="c4"/>c <tbody>
                <row><entry align="left">
                    <link linkend="attr_fG_flex">flex</link>
                  </entry>editable</row>
                <row>
                  <entry>
                    <link linkend="attr_fG_width">width</link>
                  </entry>
                </row>
              </tbody></tgroup>
          </informaltable>
        </section>
        <section id="gui_CheckBox">
          <title>CheckBox</title>
          <para>Флажок (<code>CheckBox</code>) − компонент, имеющий два состояния: выбран, не выбран. Флажки используются
там, где нужно предоставить пользователю возможность что-то включить или
выключить.</para>
          <figure>
            <title/>
            <mediaobject>
              <imageobject>
                <imagedata contentwidth="170" align="center" fileref="img/CheckBox.png"/>
              </imageobject>
            </mediaobject>
          </figure>
          <para>XML-имя компонента: <sgmltag>checkBox</sgmltag>.</para>
          <figure>
            <title/>
            <mediaobject>
              <imageobject>
                <imagedata contentwidth="70%" align="center" fileref="img/gui_checkBox_dia.png"/>
              </imageobject>
            </mediaobject>
          </figure>
          <para>Классы флажков существуют как для веб-приложений, так  и для десктоп-приложений.</para>
          <para>Для создания флажка достаточно в <glossterm linkend="screen_xml_glossentry">xml-дескрипторе</glossterm> написать следующий код:</para>
          <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/section_gui/checkBox/checkBox.txt" encoding="UTF-8" parse="text"/></programlisting>
          <para>Сброс или установка флажка изменяет его состояние. Состояние − это свойство типа <code>Boolean</code>, может быть получено с помощью метода  <code>getValue()</code> и установлено с помощью метода <code>setValue()</code>. </para>
          <para>При каждом изменении состояния флажка генерируется событие элемента, которое может быть обработано с помощью <code>ValueListener</code>.</para>
          <para>Ниже приведен код <glossterm linkend="screen_controller_glossentry">контроллера</glossterm>, демонстрирующий работу с флажком. При установке флажка на экране возникает сообщение <quote>Разрешить создание нового документа</quote>, при сбросе флажка − <quote>Не разрешать создание нового документа</quote>.</para>
          <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/section_gui/checkBox/checkBoxContr.txt" encoding="UTF-8" parse="text"/></programlisting>
          <para>Атрибуты <sgmltag>checkBox</sgmltag>:</para>
          <informaltable frame="none" pgwide="0" align="left">
            <tgroup cols="4" colsep="1" rowsep="1" align="left"><colspec colname="c1"/><colspec colname="c2"/><colspec colname="c3"/><colspec colname="c4"/>c <tbody>
                <row><entry align="left">
                    <link linkend="attr_align">align</link>
                  </entry>editable<entry align="left">
                    <link linkend="attr_editable">editable</link>
                  </entry><entry align="left">
                    <link linkend="attr_property">property</link>
                  </entry><entry/></row>
                <row>
                  <entry>
                    <link linkend="attr_caption">caption</link>
                  </entry>
                  <entry align="left">
                    <link linkend="attr_enable">enable</link>
                  </entry>
                  <entry>
                    <link linkend="attr_stylename">stylename</link>
                  </entry>
                  <entry/>
                </row>
                <row>
                  <entry align="left">
                    <link linkend="attr_datasource">datasource</link>
                  </entry>
                  <entry align="left">
                    <link linkend="attr_height">height</link>
                  </entry>
                  <entry>
                    <link linkend="attr_visible">visible</link>
                  </entry>
                  <entry/>
                </row>
                <row>
                  <entry align="left">
                    <link linkend="attr_description">description</link>
                  </entry>
                  <entry align="left">
                    <link linkend="attr_id">id</link>
                  </entry>
                  <entry>
                    <link linkend="attr_width">width</link>
                  </entry>
                  <entry/>
                </row>
              </tbody></tgroup>
          </informaltable>
          <para>Элементы <sgmltag>checkBox</sgmltag>:</para>
          <informaltable frame="none" pgwide="0" align="left">
            <tgroup cols="1" colsep="1" rowsep="1" align="left">
              <colspec colname="c1"/>
              <tbody>
                <row>
                  <entry>
                    <link linkend="element_validator">validator</link>
                  </entry>
                </row>
              </tbody>
            </tgroup>
          </informaltable>
        </section>
        <section id="gui_PickerField">
          <title>PickerField</title>
          <para>Поле ввода с дополнительными кнопками действий (<code>PickerField</code>) позволяет отображать экземпляр <glossterm linkend="entity">сущности</glossterm> в текстовом поле и выполнять действия нажатием на кнопки справа.</para>
          <para>XML-имя компонента: <sgmltag>pickerField</sgmltag>.</para>
          <figure>
            <title/>
            <mediaobject>
              <imageobject>
                <imagedata contentwidth="80%" align="center" fileref="img/gui_pickerField_dia.png"/>
              </imageobject>
            </mediaobject>
          </figure>
          <para>Существует два класса полей ввода с дополнительными кнопками действий: для веб-приложений  и для десктоп-приложений.</para>
          <para>Для того чтобы создать компонент <code>PickerField</code>, создайте в <glossterm linkend="screen_xml_glossentry">xml-дескрипторе</glossterm> следующий код:</para>
          <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/section_gui/pickerField/pickerFieldMetaClass.txt" encoding="UTF-8" parse="text"/></programlisting>
          <para>Атрибут <sgmltag id="attr_metaclass">metaClass</sgmltag> задает тип <glossterm linkend="entity">сущности</glossterm>, экземпляр которой будет выбираться с помощью действия поиска (<literal>lookup</literal>). Для заданной сущности должен быть определен экран <literal>Название_сущности.lookup</literal> либо в атрибуте <sgmltag >lookupScreen</sgmltag> указан идентификатор экрана, который нужно открыть для выбора экземпляра сущности.</para>
          <para>Определить компонент можно также следующим образом:</para>
          <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/section_gui/pickerField/pickerFieldProperty.txt" encoding="UTF-8" parse="text"/></programlisting>
          <warning>
            <para>Для правильной работы компонента <code>PickerField</code> необходима установка атрибута <link linkend="attr_metaclass">metaClass</link> либо одновременная установка атрибутов <link linkend="attr_datasource">datasource</link> и <link linkend="attr_property">property</link>.</para>
          </warning>
          <caution>
            <title>Подсказка</title>
            <para>Если при объявлении компонента никаких <link linkend="gui_Action">действий</link> не задано, загрузчик XML определит для него действия <literal>lookup</literal> и <literal>clear</literal>. </para>
          </caution>
          <para>Поэтому если требуются все стандартные действия, их нужно определить с помощью элемента <sgmltag id="attr_actions_picker">actions</sgmltag>. <sgmltag>actions</sgmltag> − необязательный элемент, определяющий набор действий (<link linkend="gui_Action">action</link>) (кнопок справа). В элементе <link linkend="gui_Action">action</link> можно описывать как стандартные действия, так и произвольные.</para>
          <para>Стандартные действия определяются перечислением <code>PickerField.ActionType</code>: <code>lookup</code>, <code>clear</code>, <code>open</code>.</para>
          <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/section_gui/pickerField/pickerFieldStandartActions.txt" encoding="UTF-8" parse="text"/></programlisting>
          <figure>
            <title/>
            <mediaobject>
              <imageobject>
                <imagedata contentwidth="326" align="center" fileref="img/gui_pickerFieldActionsSt.png"/>
              </imageobject>
            </mediaobject>
          </figure>
          <para>Ниже показано описание <code>PickerField</code>, имеющего произвольные действия.</para>
          <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/section_gui/pickerField/pickerFieldUserActions.txt" encoding="UTF-8" parse="text"/></programlisting>
          <para>Действия необходимо определить в <glossterm linkend="screen_controller_glossentry">контроллере</glossterm> экрана:</para>
          <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/section_gui/pickerField/pickerFieldUserActionsContr.txt" encoding="UTF-8" parse="text"/></programlisting>
          <figure>
            <title/>
            <mediaobject>
              <imageobject>
                <imagedata contentwidth="286" align="center" fileref="img/gui_pickerField_custom.png"/>
              </imageobject>
            </mediaobject>
          </figure>
          <para>Для компонента определены горячие клавиши. Для стандартных действий:</para>
          <itemizedlist>
            <listitem>
              <para><code>Lookup</code> − <keycombo>
                  <keycap>CTRL</keycap>
                  <keycap>ALT</keycap>
                  <keycap>L</keycap>
                </keycombo></para>
            </listitem>
            <listitem>
              <para><code>Open</code> − <keycombo>
                  <keycap>CTRL</keycap>
                  <keycap>ALT</keycap>
                  <keycap>O</keycap>
                </keycombo></para>
            </listitem>
            <listitem>
              <para><code>Clear</code> − <keycombo>
                  <keycap>CTRL</keycap>
                  <keycap>ALT</keycap>
                  <keycap>C</keycap>
                </keycombo></para>
            </listitem>
          </itemizedlist>
          <para>Чтобы добавить пользовательскую горячую клавишу, необходимо чтобы класс <link linkend="gui_Action">действия</link> реализовывал интерфейс <code>com.haulmont.cuba.gui.components.ShortcutAction</code></para>
          <para>Также поддерживается вызов действий сочетанием <keycombo>
              <keycap>CTRL</keycap>
              <keycap>ALT</keycap>
              <keycap>1</keycap>
            </keycombo>, <keycombo>
              <keycap>CTRL</keycap>
              <keycap>ALT</keycap>
              <keycap>2</keycap>
            </keycombo> и так далее.</para>
          <para>Сочетания клавиш можно переназначить в ClientConfig</para>
          <itemizedlist>
            <listitem>
              <para><property>cuba.gui.pickerShortcut.modifiers</property> − модификаторы для вызова <link linkend="gui_Action">действий</link> по порядковому номеру</para>
            </listitem>
            <listitem>
              <para><property>cuba.gui.pickerShortcut.lookup</property> − Lookup Action</para>
            </listitem>
            <listitem>
              <para><property>cuba.gui.pickerShortcut.open</property> − Open Action</para>
            </listitem>
            <listitem>
              <para><property>cuba.gui.pickerShortcut.clear</property> − Clear Action</para>
            </listitem>
          </itemizedlist>
          <para>Атрибуты <sgmltag>pickerField</sgmltag>:</para>
          <informaltable frame="none" pgwide="0" align="left">
            <tgroup cols="4" colsep="1" rowsep="1" align="left"><colspec colname="c1"/><colspec colname="c2"/><colspec colname="c3"/><colspec colname="c4"/>c <tbody>
                <row><entry align="left">
                    <link linkend="attr_caption">caption</link>
                  </entry>editable<entry align="left">
                    <link linkend="attr_enable">enable</link>
                  </entry><entry align="left">
                    <link linkend="attr_property">property</link>
                  </entry><entry>
                    <link linkend="attr_width">width</link>
                  </entry></row>
                <row><entry>
                    <link linkend="attr_captionProperty">captionProperty</link>
                  </entry><entry align="left">
                    <link linkend="attr_height">height</link>
                  </entry>required<entry>
                    <link linkend="attr_required">required</link>
                  </entry><entry/></row>
                <row>
                  <entry align="left">
                    <link linkend="attr_datasource">datasource</link>
                  </entry>
                  <entry align="left">
                    <link linkend="attr_id">id</link>
                  </entry>
                  <entry>
                    <link linkend="attr_requiredMessage">requiredMessage</link>
                  </entry>
                  <entry/>
                </row>
                <row>
                  <entry align="left">
                    <link linkend="attr_description">description</link>
                  </entry>
                  <entry align="left">
                    <link linkend="attr_lookupScreen">lookupScreen</link>
                  </entry>
                  <entry>
                    <link linkend="attr_stylename">stylename</link>
                  </entry>
                  <entry/>
                </row>
                <row>
                  <entry>
                    <link linkend="attr_editable">editable</link>
                  </entry>
                  <entry>
                    <link linkend="attr_metaclass">metaClass</link>
                  </entry>
                  <entry>
                    <link linkend="attr_visible">visible</link>
                  </entry>
                  <entry/>
                </row>
              </tbody></tgroup>
          </informaltable>
        </section>
        <section id="gui_OptionsGroup">
          <title>OptionsGroup</title>
          <para>Компонент, который обеспечивает выбор из альтернатив, используя группу переключателей для выбора единственного значения из списка или используя группу флажков для выбора нескольких значений из списка.</para>
          <figure>
            <title/>
            <mediaobject>
              <imageobject>
                <imagedata contentwidth="265" align="center" fileref="img/gui_optionsGroup.png"/>
              </imageobject>
            </mediaobject>
          </figure>
          <para>XML-имя компонента: <sgmltag>optionsGroup</sgmltag>.</para>
          <figure>
            <title/>
            <mediaobject>
              <imageobject>
                <imagedata contentwidth="80%" align="center" fileref="img/gui_OptionsGroup_dia.png"/>
              </imageobject>
            </mediaobject>
          </figure>
          <para>Существует два класса групп опций: для веб-приложений  и для десктоп-приложений.</para>
          <para>Если в качестве значений списка используются экземпляры <glossterm linkend="entity">сущностей</glossterm>, нужно использовать атрибут <link linkend="attr_optionsDatasource">optionsDatasource</link> при описании компонента.</para>
          <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/section_gui/optionsGroup/optionsGroupOptDs.txt" encoding="UTF-8" parse="text"/></programlisting>
          <para>Если в качестве значений списка используются, например, значения перечисления (enum), то следует использовать атрибуты <link linkend="attr_datasource">datasource</link> и <link linkend="attr_property">property</link>. </para>
          <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/section_gui/optionsGroup/optionsGroupDatasource.txt" encoding="UTF-8" parse="text"/></programlisting>
          <para>Значения списка можно создать программно, в <glossterm linkend="screen_controller_glossentry">контроллере</glossterm> экрана.</para>
          <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/section_gui/optionsGroup/optionsGroup.txt" encoding="UTF-8" parse="text"/></programlisting>
          <para>Атрибут <sgmltag id="attr_orientation">orientation</sgmltag> задает расположение элементов группы. По умолчанию элементы располагаются по вертикали. Значение <literal>&quot;horizontal&quot;</literal> служит для горизонтального расположения.</para>
          <para>Для задания режима выбора значений служит атрибут <sgmltag id="attr_multiselect">multiselect</sgmltag>. Если <code>&quot;multiselect=false&quot;</code>, то компонент будет представлен как группа переключателей, иначе − как группа флажков. По умолчанию значение атрибута равно <literal>false</literal>.</para>
          <para>Атрибуты <sgmltag>optionsGroup</sgmltag>:</para>
          <informaltable frame="none" pgwide="0" align="left">
            <tgroup cols="4" colsep="1" rowsep="1" align="left"><colspec colname="c1"/><colspec colname="c2"/><colspec colname="c3"/><colspec colname="c4"/>c <tbody>
                <row><entry align="left">
                    <link linkend="attr_caption">caption</link>
                  </entry>editable<entry align="left">
                    <link linkend="attr_enable">enable</link>
                  </entry><entry align="left">
                    <link linkend="attr_orientation">orientation</link>
                  </entry><entry>
                    <link linkend="attr_visible">visible</link>
                  </entry></row>
                <row><entry>
                    <link linkend="attr_captionProperty">captionProperty</link>
                  </entry><entry align="left">
                    <link linkend="attr_height">height</link>
                  </entry>required<entry>
                    <link linkend="attr_property">property</link>
                  </entry><entry>
                    <link linkend="attr_width">width</link>
                  </entry></row>
                <row>
                  <entry align="left">
                    <link linkend="attr_datasource">datasource</link>
                  </entry>
                  <entry align="left">
                    <link linkend="attr_id">id</link>
                  </entry>
                  <entry>
                    <link linkend="attr_required">required</link>
                  </entry>
                  <entry/>
                </row>
                <row>
                  <entry align="left">
                    <link linkend="attr_description">description</link>
                  </entry>
                  <entry align="left">
                    <link linkend="attr_multiselect">multiselect</link>
                  </entry>
                  <entry>
                    <link linkend="attr_requiredMessage">requiredMessage</link>
                  </entry>
                  <entry/>
                </row>
                <row>
                  <entry>
                    <link linkend="attr_editable">editable</link>
                  </entry>
                  <entry>
                    <link linkend="attr_optionsDatasource">optionsDatasource</link>
                  </entry>
                  <entry>
                    <link linkend="attr_stylename">stylename</link>
                  </entry>
                  <entry/>
                </row>
              </tbody></tgroup>
          </informaltable>
          <para>Элементы <sgmltag>optionsGroup</sgmltag>:</para>
          <informaltable frame="none" pgwide="0" align="left">
            <tgroup cols="1" colsep="1" rowsep="1" align="left">
              <colspec colname="c1"/>
              <tbody>
                <row>
                  <entry align="left">
                    <link linkend="element_validator">validator</link>
                  </entry>
                </row>
              </tbody>
            </tgroup>
          </informaltable>
        </section>
        <section id="gui_LookupField">
          <title>LookupField</title>
          <para>Компонент, реализующий раскрывающийся список. Раскрывающийся список  служит для выбора одного из множества
доступных вариантов. В составе такого списка присутствует активизирующая его кнопка и поле редактирования. Раскрывающийся список реализует фильтрацию значений в реальном времени (по мере ввода значения пользователем) и постраничный вывод доступных значений.</para>
          <figure>
            <title/>
            <mediaobject>
              <imageobject>
                <imagedata contentwidth="165" align="center" fileref="img/gui_lookupField.png"/>
              </imageobject>
            </mediaobject>
          </figure>
          <para>XML-имя компонента: <sgmltag>lookupField</sgmltag>.</para>
          <figure>
            <title/>
            <mediaobject>
              <imageobject>
                <imagedata contentwidth="80%" align="center" fileref="img/gui_LookupField_dia.png"/>
              </imageobject>
            </mediaobject>
          </figure>
          <para>Существует два класса раскрывающегося списка: для веб-приложений и для десктоп-приложений.</para>
          <para>Если в качестве значений списка используются экземпляры <glossterm linkend="entity">сущностей</glossterm>, нужно использовать атрибут <link linkend="attr_optionsDatasource">optionsDatasource</link> при описании компонента.</para>
          <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/section_gui/lookupField/lookupFieldOptDs.txt" encoding="UTF-8" parse="text"/></programlisting>
          <para>Ниже представлено описание раскрывающегося списка, значения которого заданы с помощью установки <link linkend="datasources">источника данных</link> и имени атрибута <glossterm linkend="entity">сущности</glossterm>. Атрибут сущности является перечислением (enum).</para>
          <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/section_gui/lookupField/lookupField.txt" encoding="UTF-8" parse="text"/></programlisting>
          <para>С помощью атрибута <sgmltag id="attr_filterMode">filterMode</sgmltag> можно задать тип фильтрации значений:</para>
          <itemizedlist>
            <listitem>
              <para><literal>NO</literal> − нет фильтрации</para>
            </listitem>
            <listitem>
              <para><literal>STARTS_WITH</literal> − по началу фразы</para>
            </listitem>
            <listitem>
              <para><literal>CONTAINS</literal> − по любому вхождению</para>
            </listitem>
          </itemizedlist>
          <para>Атрибуты <sgmltag>lookupField</sgmltag>: </para>
          <informaltable frame="none" pgwide="0" align="left">
            <tgroup cols="4" colsep="1" rowsep="1" align="left"><colspec colname="c1"/><colspec colname="c2"/><colspec colname="c3"/><colspec colname="c4"/>c <tbody>
                <row><entry align="left">
                    <link linkend="attr_caption">caption</link>
                  </entry>editable<entry align="left">
                    <link linkend="attr_enable">enable</link>
                  </entry><entry align="left">
                    <link linkend="attr_optionsDatasource">optionsDatasource</link>
                  </entry><entry>
                    <link linkend="attr_visible">visible</link>
                  </entry></row>
                <row><entry>
                    <link linkend="attr_captionProperty">captionProperty</link>
                  </entry><entry align="left">
                    <link linkend="attr_filterMode">filterMode</link>
                  </entry>required<entry>
                    <link linkend="attr_property">property</link>
                  </entry><entry>
                    <link linkend="attr_width">width</link>
                  </entry></row>
                <row>
                  <entry align="left">
                    <link linkend="attr_datasource">datasource</link>
                  </entry>
                  <entry align="left">
                    <link linkend="attr_height">height</link>
                  </entry>
                  <entry>
                    <link linkend="attr_required">required</link>
                  </entry>
                  <entry/>
                </row>
                <row>
                  <entry align="left">
                    <link linkend="attr_description">description</link>
                  </entry>
                  <entry align="left">
                    <link linkend="attr_id">id</link>
                  </entry>
                  <entry>
                    <link linkend="attr_requiredMessage">requiredMessage</link>
                  </entry>
                  <entry/>
                </row>
                <row>
                  <entry>
                    <link linkend="attr_editable">editable</link>
                  </entry>
                  <entry>nullName</entry>
                  <entry>
                    <link linkend="attr_stylename">stylename</link>
                  </entry>
                  <entry/>
                </row>
              </tbody></tgroup>
          </informaltable>
          <para>Элементы <sgmltag>lookupField</sgmltag>:</para>
          <informaltable frame="none" pgwide="0" align="left">
            <tgroup cols="1" colsep="1" rowsep="1" align="left">
              <colspec colname="c1"/>
              <tbody>
                <row>
                  <entry align="left">
                    <link linkend="element_validator">validator</link>
                  </entry>
                </row>
              </tbody>
            </tgroup>
          </informaltable>
        </section>
        <section id="gui_LookupPickerField">
          <title>LookupPickerField</title>
          <para>Раскрывающийся список с расширенной функциональностью (<code>LookupPickerField</code>) позволяет отображать экземпляр сущности в текстовом поле, выбирать экземпляр в раскрывающемся списке и выполнять действия нажатием на кнопки справа.</para>
          <figure>
            <title/>
            <mediaobject>
              <imageobject>
                <imagedata contentwidth="260" align="center" fileref="img/gui_lookupPickerField.png"/>
              </imageobject>
            </mediaobject>
          </figure>
          <para>XML-имя компонента: <sgmltag>lookupPickerField</sgmltag>.</para>
          <figure>
            <title/>
            <mediaobject>
              <imageobject>
                <imagedata contentwidth="80%" align="center" fileref="img/gui_LookupPickerField_dia.png"/>
              </imageobject>
            </mediaobject>
          </figure>
          <para>Существует два класса раскрывающегося списка c расширенной  функциональностью: для веб-приложений  и для десктоп-приложений. </para>
          <para>Ниже представлено описание раскрывающегося списка с расширенной функциональностью.</para>
          <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/section_gui/lookupPickerField/lookupPickerField.txt" encoding="UTF-8" parse="text"/></programlisting>
          <para>Атрибуты <sgmltag>lookupPickerField</sgmltag>: </para>
          <informaltable frame="none" pgwide="0" align="left">
            <tgroup cols="4" colsep="1" rowsep="1" align="left"><colspec colname="c1"/><colspec colname="c2"/><colspec colname="c3"/><colspec colname="c4"/>c <tbody>
                <row><entry align="left">
                    <link linkend="attr_caption">caption</link>
                  </entry>editable<entry align="left">
                    <link linkend="attr_enable">enable</link>
                  </entry><entry align="left">nullName</entry><entry>
                    <link linkend="attr_stylename">stylename</link>
                  </entry></row>
                <row><entry>
                    <link linkend="attr_captionProperty">captionProperty</link>
                  </entry><entry align="left">
                    <link linkend="attr_filterMode">filterMode</link>
                  </entry>required<entry>
                    <link linkend="attr_optionsDatasource">optionsDatasource</link>
                  </entry><entry>
                    <link linkend="attr_visible">visible</link>
                  </entry></row>
                <row>
                  <entry align="left">
                    <link linkend="attr_datasource">datasource</link>
                  </entry>
                  <entry align="left">
                    <link linkend="attr_height">height</link>
                  </entry>
                  <entry>
                    <link linkend="attr_property">property</link>
                  </entry>
                  <entry>
                    <link linkend="attr_width">width</link>
                  </entry>
                </row>
                <row>
                  <entry align="left">
                    <link linkend="attr_description">description</link>
                  </entry>
                  <entry align="left">
                    <link linkend="attr_id">id</link>
                  </entry>
                  <entry>
                    <link linkend="attr_required">required</link>
                  </entry>
                  <entry/>
                </row>
                <row>
                  <entry>
                    <link linkend="attr_editable">editable</link>
                  </entry>
                  <entry>
                    <link linkend="attr_metaclass">metaClass</link>
                  </entry>
                  <entry>
                    <link linkend="attr_requiredMessage">requiredMessage</link>
                  </entry>
                  <entry/>
                </row>
              </tbody></tgroup>
          </informaltable>
          <para>Элементы <sgmltag>lookupPickerField</sgmltag>:</para>
          <informaltable frame="none" pgwide="0" align="left">
            <tgroup cols="1" colsep="1" rowsep="1" align="left">
              <colspec colname="c1"/>
              <tbody>
                <row>
                  <entry align="left">
                    <link linkend="element_validator">validator</link>
                  </entry>
                </row>
                <row>
                  <entry>
                    <link linkend="attr_action">actions</link>
                  </entry>
                </row>
              </tbody>
            </tgroup>
          </informaltable>
        </section>
        <section id="gui_SearchField">
          <title>SearchField</title>
          <para>Поле поиска (<code>SearchField</code>) служит для поиска значения по заранее определенному условию. Для работы с полем достаточно ввести хотя бы один символ и нажать клавишу <keycap>Enter</keycap>. Если будут найдены несколько совпадений, значения будут отображены  в виде списка. </para>
          <figure>
            <title/>
            <mediaobject>
              <imageobject>
                <imagedata contentwidth="190" align="center" fileref="img/gui_searchFieldOverlap.png"/>
              </imageobject>
            </mediaobject>
          </figure>
          <para>XML-имя компонента: <sgmltag>searchField</sgmltag>.</para>
          <figure>
            <title/>
            <mediaobject>
              <imageobject>
                <imagedata contentwidth="180" align="center" fileref="img/gui_SearchField_dia.png"/>
              </imageobject>
            </mediaobject>
          </figure>
          <para>Класс поля поиска существует только для веб-приложений.</para>
          <para>Для компонента <sgmltag>searchField</sgmltag> необходимо предварительно создать <link linkend="datasources">источник данных</link>, предназначенный для работы с коллекцией <glossterm linkend="entity">сущностей</glossterm>, и задать в нем запрос, содержащий условия поиска. Например:</para>
          <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/section_gui/searchField/searchFieldDs.txt" encoding="UTF-8" parse="text"/></programlisting>
          <para>При описании компонента в <glossterm linkend="screen_xml_glossentry">XML-дескрипторе</glossterm> используйте атрибут <link linkend="attr_optionsDatasource">optionsDatasource</link>. </para>
          <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/section_gui/searchField/searchField.txt" encoding="UTF-8" parse="text"/></programlisting>
          <para>Значение атрибута <sgmltag id="minSearchStringLength_attr">minSearchStringLength</sgmltag> − это минимальное количество символов, необходимых для поиска значения.</para>
          <para>В <glossterm linkend="screen_controller_glossentry">контроллере</glossterm> экрана можно указать содержание нотификаций, которые будут выводиться на экран в двух случаях:</para>
          <itemizedlist>
            <listitem>
              <para>если количество введенных символов меньше значения атрибута <link linkend="minSearchStringLength_attr">minSearchStringLength</link></para>
            </listitem>
            <listitem>
              <para>если не найдено совпадений существующих в источнике данных значений и введенных символов.</para>
            </listitem>
          </itemizedlist>
          <para>Пример задания нотификаций в <glossterm linkend="screen_controller_glossentry">контроллере</glossterm> экрана:</para>
          <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/section_gui/searchField/searchFieldContr.txt" encoding="UTF-8" parse="text"/></programlisting>
          <para>Атрибуты <sgmltag>searchField</sgmltag>: </para>
          <informaltable frame="none" pgwide="0" align="left">
            <tgroup cols="4" colsep="1" rowsep="1" align="left"><colspec colname="c1"/><colspec colname="c2"/><colspec colname="c3"/><colspec colname="c4"/>c <tbody>
                <row><entry align="left">
                    <link linkend="attr_caption">caption</link>
                  </entry>editable<entry align="left">
                    <link linkend="attr_enable">enable</link>
                  </entry><entry align="left">nullName</entry><entry>
                    <link linkend="attr_stylename">stylename</link>
                  </entry></row>
                <row><entry>
                    <link linkend="attr_captionProperty">captionProperty</link>
                  </entry><entry align="left">
                    <link linkend="attr_filterMode">filterMode</link>
                  </entry>required<entry>
                    <link linkend="attr_optionsDatasource">optionsDatasource</link>
                  </entry><entry>
                    <link linkend="attr_visible">visible</link>
                  </entry></row>
                <row>
                  <entry align="left">
                    <link linkend="attr_datasource">datasource</link>
                  </entry>
                  <entry align="left">
                    <link linkend="attr_height">height</link>
                  </entry>
                  <entry>
                    <link linkend="attr_property">property</link>
                  </entry>
                  <entry>
                    <link linkend="attr_width">width</link>
                  </entry>
                </row>
                <row>
                  <entry align="left">
                    <link linkend="attr_description">description</link>
                  </entry>
                  <entry align="left">
                    <link linkend="attr_id">id</link>
                  </entry>
                  <entry>
                    <link linkend="attr_required">required</link>
                  </entry>
                  <entry/>
                </row>
                <row>
                  <entry>
                    <link linkend="attr_editable">editable</link>
                  </entry>
                  <entry>
                    <link linkend="minSearchStringLength_attr">minSearchStringLength</link>
                  </entry>
                  <entry>
                    <link linkend="attr_requiredMessage">requiredMessage</link>
                  </entry>
                  <entry/>
                </row>
              </tbody></tgroup>
          </informaltable>
        </section>
        <section id="gui_SearchPickerField">
          <title>SearchPickerField</title>
          <para>Поле поиска с расширенной функциональностью (<code>SearchPickerField</code>) отличается от простого <link linkend="gui_SearchField">поля поиска</link> тем, что содержит дополнительные кнопки справа. С помощью кнопок можно открывать экземпляр выбранной в поле <glossterm linkend="entity">сущности</glossterm>, удалять экземпляр или выбирать экземпляр из экрана списка сущностей.</para>
          <figure>
            <title/>
            <mediaobject>
              <imageobject>
                <imagedata contentwidth="308" contentdepth="96" align="center" fileref="img/gui_searchPickerFieldOverlap.png"/>
              </imageobject>
            </mediaobject>
          </figure>
          <para>XML-имя компонента: <sgmltag>searchPickerField</sgmltag>.</para>
          <figure>
            <title/>
            <mediaobject>
              <imageobject>
                <imagedata contentwidth="90%" align="center" fileref="img/gui_SearchPickerField_dia.png"/>
              </imageobject>
            </mediaobject>
          </figure>
          <para>Класса поля поиска c расширенной функциональностью существует только для веб-приложений.</para>
          <para>Ниже представлено описание поля поиска с расширенной функциональностью в <glossterm linkend="screen_xml_glossentry">xml-дескрипторе</glossterm>.</para>
          <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/section_gui/searchPickerField/searchPickerField.txt" encoding="UTF-8" parse="text"/></programlisting>
          <para>Если при объявлении компонента никаких <link linkend="gui_Action">действий</link> не задано,  загрузчик XML определит для него действия <literal>lookup</literal> и <literal>open</literal>.</para>
          <para>Стандартные действия определяются перечислением <code>PickerField.ActionType</code>: <literal>lookup</literal>, <literal>clear</literal>, <literal>open</literal>.</para>
          <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/section_gui/searchPickerField/searchPickerFieldActions.txt" encoding="UTF-8" parse="text"/></programlisting>
          <figure>
            <title/>
            <mediaobject>
              <imageobject>
                <imagedata contentwidth="257" contentdepth="97" align="center" fileref="img/gui_searchPickerFieldAllActions.png"/>
              </imageobject>
            </mediaobject>
          </figure>
          <para>Атрибуты <sgmltag>searchPickerField</sgmltag>: </para>
          <informaltable frame="none" pgwide="0" align="left">
            <tgroup cols="4" colsep="1" rowsep="1" align="left"><colspec colname="c1"/><colspec colname="c2"/><colspec colname="c3"/><colspec colname="c4"/>c <tbody>
                <row><entry align="left">
                    <link linkend="attr_caption">caption</link>
                  </entry>editable<entry align="left">
                    <link linkend="attr_enable">enable</link>
                  </entry><entry align="left">
                    <link linkend="minSearchStringLength_attr">minSearchStringLength</link>
                  </entry><entry>
                    <link linkend="attr_requiredMessage">requiredMessage</link>
                  </entry></row>
                <row><entry>
                    <link linkend="attr_captionProperty">captionProperty</link>
                  </entry><entry align="left">
                    <link linkend="attr_filterMode">filterMode</link>
                  </entry>required<entry>nullName</entry><entry>
                    <link linkend="attr_stylename">stylename</link>
                  </entry></row>
                <row>
                  <entry align="left">
                    <link linkend="attr_datasource">datasource</link>
                  </entry>
                  <entry align="left">
                    <link linkend="attr_height">height</link>
                  </entry>
                  <entry>
                    <link linkend="attr_optionsDatasource">optionsDatasource</link>
                  </entry>
                  <entry>
                    <link linkend="attr_visible">visible</link>
                  </entry>
                </row>
                <row>
                  <entry align="left">
                    <link linkend="attr_description">description</link>
                  </entry>
                  <entry align="left">
                    <link linkend="attr_id">id</link>
                  </entry>
                  <entry>
                    <link linkend="attr_property">property</link>
                  </entry>
                  <entry>
                    <link linkend="attr_width">width</link>
                  </entry>
                </row>
                <row>
                  <entry>
                    <link linkend="attr_editable">editable</link>
                  </entry>
                  <entry>
                    <link linkend="attr_metaclass">metaClass</link>
                  </entry>
                  <entry>
                    <link linkend="attr_required">required</link>
                  </entry>
                  <entry/>
                </row>
              </tbody></tgroup>
          </informaltable>
          <para>Элементы <sgmltag>searchPickerField</sgmltag>:</para>
          <informaltable frame="none" pgwide="0" align="left">
            <tgroup cols="1" colsep="1" rowsep="1" align="left">
              <colspec colname="c1"/>
              <tbody>
                <row>
                  <entry>
                    <link linkend="gui_Action">actions</link>
                  </entry>
                </row>
              </tbody>
            </tgroup>
          </informaltable>
        </section>
        <section id="gui_TwinColumn">
          <title>TwinColumn</title>
          <para>Сдвоенный список (<code>TwinColumn</code>)  представляет собой компонент множественного выбора, имеющий  два находящихся рядом списка: доступных и выбранных опций. В левом списке содержатся доступные невыбранные значения, в правом списке содержатся выбранные значения. Пользователь может выбрать значения из левого списка и нажать на кнопку <inlinemediaobject>
              <imageobject>
                <imagedata fileref="img/gui_teinColumnRight.png"/>
              </imageobject>
            </inlinemediaobject>, переместив их таким образом в правый список. Значения могут быть отменены для выбора путем выделения их в правом списке и нажатия на кнопку <inlinemediaobject>
              <imageobject>
                <imagedata fileref="img/gui_teinColumnLeft.png"/>
              </imageobject>
            </inlinemediaobject>. Для каждого значения можно задать уникальный стиль отображения и пиктограмму.</para>
          <figure>
            <title/>
            <mediaobject>
              <imageobject>
                <imagedata contentwidth="235" align="center" fileref="img/TwinColumn.png"/>
              </imageobject>
            </mediaobject>
          </figure>
          <para>XML-имя компонента: <sgmltag>twinColumn</sgmltag></para>
          <figure>
            <title/>
            <mediaobject>
              <imageobject>
                <imagedata contentwidth="173" contentdepth="389" align="center" fileref="img/gui_TwinColumn_dia.png"/>
              </imageobject>
            </mediaobject>
          </figure>
          <para>Класс сдвоенного списка существует только для веб-приложений.</para>
          <para>Ниже представлено описание сдвоенного списка в <glossterm linkend="screen_xml_glossentry">xml-дескрипторе</glossterm>:</para>
          <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/section_gui/twinColumn/twinColumnOptDs.txt" encoding="UTF-8" parse="text"/></programlisting>
          <para>В данном примере используется атрибут <sgmltag id="attr_columns_twin">columns</sgmltag> для задания количества колонок текста в списке и атрибут <sgmltag id="attr_rows_twin">rows</sgmltag> для задания количества строк текста в списке.</para>
          <para>Атрибуты <sgmltag>twinColumn</sgmltag>:</para>
          <informaltable frame="none" pgwide="0" align="left">
            <tgroup cols="4" colsep="1" rowsep="1" align="left"><colspec colname="c1"/><colspec colname="c2"/><colspec colname="c3"/><colspec colname="c4"/>c <tbody>
                <row><entry align="left">
                    <link linkend="attr_caption">caption</link>
                  </entry>editable<entry align="left">
                    <link linkend="attr_editable">editable</link>
                  </entry><entry align="left">
                    <link linkend="attr_optionsDatasource">optionsDatasource</link>
                  </entry><entry>
                    <link linkend="attr_stylename">stylename</link>
                  </entry></row>
                <row><entry>
                    <link linkend="attr_captionProperty">captionProperty</link>
                  </entry><entry align="left">
                    <link linkend="attr_enable">enable</link>
                  </entry>required<entry>
                    <link linkend="attr_property">property</link>
                  </entry><entry>
                    <link linkend="attr_visible">visible</link>
                  </entry></row>
                <row>
                  <entry align="left">
                    <link linkend="attr_columns_twin">columns</link>
                  </entry>
                  <entry align="left">
                    <link linkend="attr_height">height</link>
                  </entry>
                  <entry>
                    <link linkend="attr_required">required</link>
                  </entry>
                  <entry>
                    <link linkend="attr_width">width</link>
                  </entry>
                </row>
                <row>
                  <entry align="left">
                    <link linkend="attr_datasource">datasource</link>
                  </entry>
                  <entry align="left">
                    <link linkend="attr_id">id</link>
                  </entry>
                  <entry>
                    <link linkend="attr_requiredMessage">requiredMessage</link>
                  </entry>
                  <entry/>
                </row>
                <row>
                  <entry>
                    <link linkend="attr_description">description</link>
                  </entry>
                  <entry>nullName</entry>
                  <entry>
                    <link linkend="attr_rows">rows</link>
                  </entry>
                  <entry/>
                </row>
              </tbody></tgroup>
          </informaltable>
          <para>Элементы <sgmltag>twinColumn</sgmltag>:</para>
          <informaltable frame="none" pgwide="0" align="left">
            <tgroup cols="1" colsep="1" rowsep="1" align="left">
              <colspec colname="c1"/>
              <tbody>
                <row>
                  <entry align="left">
                    <link linkend="element_validator">validator</link>
                  </entry>
                </row>
              </tbody>
            </tgroup>
          </informaltable>
          <para>Для задания внешнего вида опций нужно реализовать интерфейс <code>com.haulmont.cuba.gui.components.StyleProvider</code> как показано в следующем примере:</para>
          <programlisting>TwinColumn twinColumn = getComponent(&quot;groups&quot;);
        twinColumn.setStyleProvider(new TwinColumn.StyleProvider() {
            public String getStyleName(Entity item, Object property, boolean selected) {
                if (((Group) item).getName().equals(&quot;Company&quot;)) {
                    return &quot;companyStyle&quot;;
                } else {
                    return null;
                }
            }

            public String getItemIcon(Entity item, boolean selected) {
                if (((Group) item).getName().equals(&quot;Company&quot;)) {
                    return &quot;theme:icons/company.png&quot;;
                } else {
                    return null;
                }
            }
        });</programlisting>
        </section>
        <section id="gui_TokenList">
          <title>TokenList</title>
          <para>Список маркеров (<code>TokenList</code>) представляет собой компонент, имеющий упрощенный вариант отображения и формирования списка <glossterm linkend="entity">сущностей</glossterm>.</para>
          <para>Для выбора значений используется компонент, подобный <link linkend="gui_LookupPickerField">LookupPickerField</link> </para>
          <figure>
            <title/>
            <mediaobject>
              <imageobject>
                <imagedata contentwidth="310" align="center" fileref="img/gui_tokenList.png"/>
              </imageobject>
            </mediaobject>
          </figure>
          <para>XML-имя компонента: <sgmltag>tokenList</sgmltag></para>
          <figure>
            <title/>
            <mediaobject>
              <imageobject>
                <imagedata contentwidth="80%" align="center" fileref="img/gui_TokenList_dia.png"/>
              </imageobject>
            </mediaobject>
          </figure>
          <para>Существует два класса списка маркеров: для веб-приложений  и для десктоп-приложений. </para>
          <para>Для создания списка маркеров необходимо задать описание в <glossterm linkend="screen_xml_glossentry">xml-дескрипторе</glossterm>:</para>
          <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/section_gui/tokenList/tokenList.txt" encoding="UTF-8" parse="text"/></programlisting>
          <para>С помощью атрибута <sgmltag id="attr_position">position</sgmltag> можно задавать позиционирование раскрывающегося списка. Атрибут может принимать два  значения:</para>
          <itemizedlist>
            <listitem>
              <para><literal>TOP</literal></para>
            </listitem>
            <listitem>
              <para><literal>BOTTOM</literal></para>
            </listitem>
          </itemizedlist>
          <figure>
            <title>Список маркеров со значением атрибута position=&quot;BOTTOM&quot;</title>
            <mediaobject>
              <imageobject>
                <imagedata contentwidth="310" align="center" fileref="img/gui_tokenListBottom.png"/>
              </imageobject>
            </mediaobject>
          </figure>
          <para>Атрибут <sgmltag id="attr_inline">inline</sgmltag> задает отображение списка выбранных значений: вертикально или горизонтально. Значение <literal>true</literal> соответствует горизонтальному расположению, значение <literal>false</literal> − вертикальному.</para>
          <figure>
            <title>Список маркеров с горизонтальным расположением выбранных значений</title>
            <mediaobject>
              <imageobject>
                <imagedata contentwidth="409" align="center" fileref="img/gui_tokenListInline.png"/>
              </imageobject>
            </mediaobject>
          </figure>
          <para>Установка атрибута <sgmltag id="attr_simple">simple</sgmltag> в значение <literal>true</literal> позволяет сворачивать компонент, оставляя только кнопку добавления. При нажатии на кнопку добавления сразу показывается экран списка экземпляров <glossterm linkend="entity">сущности</glossterm>, для которой задан <link linkend="datasources">источник данных</link>.</para>
          <figure>
            <title>Список маркеров со значением атрибута simple=&quot;true&quot;</title>
            <mediaobject>
              <imageobject>
                <imagedata contentwidth="234" align="center" fileref="img/gui_tokenListSimple.png"/>
              </imageobject>
            </mediaobject>
          </figure>
          <para>Элемент <sgmltag>tokenList</sgmltag> должен содержать следующие элементы:</para>
          <itemizedlist>
            <listitem>
              <para id="element_lookup"><sgmltag>lookup</sgmltag> − описатель компонента выбора значений.</para>
              <para>Атрибут <sgmltag id="attr_lookup">lookup</sgmltag> задает вид списка.</para>
              <figure>
                <title/>
                <mediaobject>
                  <imageobject>
                    <imagedata align="center" fileref="img/gui_tokenListLookup.png"/>
                  </imageobject>
                </mediaobject>
              </figure>
              <para>Атрибут <sgmltag id="attr_lookupScreen">lookupScreen</sgmltag>  задает идентификатор экрана для выбора значений в режиме <link linkend="attr_lookup">lookup</link>.</para>
              <para>С помощью атрибута <sgmltag id="attr_openType">openType</sgmltag> можно задать способ открытия окна списка экземпляров сущности:</para>
              <itemizedlist>
                <listitem>
                  <para><literal>NEW_TAB</literal> − открытие экрана в новой вкладке</para>
                </listitem>
                <listitem>
                  <para><literal>DIALOG</literal> − открытие экрана в диалоговом окне</para>
                </listitem>
                <listitem>
                  <para><literal>NEW_WINDOW</literal> − открытие экрана в новом окне</para>
                </listitem>
                <listitem>
                  <para><literal>THIS_TAB</literal> − открытие экрана в текущей вкладке</para>
                </listitem>
              </itemizedlist>
            </listitem>
            <listitem>
              <para id="element_button"><sgmltag>button</sgmltag> − описатель кнопки добавления значений</para>
            </listitem>
          </itemizedlist>
          <para>Ниже расположен пример <glossterm linkend="screen_controller_glossentry">контроллера</glossterm>, в котором задаются обработчики добавления нового значения и удаления значения:</para>
          <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/section_gui/tokenList/tokenListContr.txt" encoding="UTF-8" parse="text"/></programlisting>
          <para>Атрибуты <sgmltag>tokenList</sgmltag>:</para>
          <informaltable frame="none" pgwide="0" align="left">
            <tgroup cols="4" colsep="1" rowsep="1" align="left"><colspec colname="c1"/><colspec colname="c2"/><colspec colname="c3"/><colspec colname="c4"/>c <tbody>
                <row><entry align="left">
                    <link linkend="attr_caption">caption</link>
                  </entry>editable<entry align="left">
                    <link linkend="attr_editable">editable</link>
                  </entry><entry align="left">
                    <link linkend="attr_inline">inline</link>
                  </entry><entry>
                    <link linkend="attr_visible">visible</link>
                  </entry></row>
                <row><entry>
                    <link linkend="attr_captionProperty">captionProperty</link>
                  </entry><entry align="left">
                    <link linkend="attr_enable">enable</link>
                  </entry>required<entry>
                    <link linkend="attr_position">position</link>
                  </entry><entry>
                    <link linkend="attr_width">width</link>
                  </entry></row>
                <row>
                  <entry align="left">
                    <link linkend="attr_datasource">datasource</link>
                  </entry>
                  <entry align="left">
                    <link linkend="attr_height">height</link>
                  </entry>
                  <entry>
                    <link linkend="attr_simple">simple</link>
                  </entry>
                  <entry/>
                </row>
                <row>
                  <entry align="left">
                    <link linkend="attr_description">description</link>
                  </entry>
                  <entry align="left">
                    <link linkend="attr_id">id</link>
                  </entry>
                  <entry>
                    <link linkend="attr_stylename">stylename</link>
                  </entry>
                  <entry/>
                </row>
              </tbody></tgroup>
          </informaltable>
          <para>Элементы <sgmltag>tokenList</sgmltag>:</para>
          <informaltable frame="none" pgwide="0" align="left">
            <tgroup cols="1" colsep="1" rowsep="1" align="left">
              <colspec colname="c1"/>
              <tbody>
                <row>
                  <entry align="left">
                    <link linkend="element_tL_lookup">lookup</link>
                  </entry>
                </row>
                <row>
                  <entry>
                    <link linkend="element_tL_button">button</link>
                  </entry>
                </row>
              </tbody>
            </tgroup>
          </informaltable>
          <para>Атрибуты <link linkend="element_lookup" id="element_tL_lookup">lookup</link>:</para>
          <informaltable frame="none" pgwide="0" align="left">
            <tgroup cols="4" colsep="1" rowsep="1" align="left"><colspec colname="c1"/><colspec colname="c2"/><colspec colname="c3"/><colspec colname="c4"/>c <tbody>
                <row><entry align="left">
                    <link linkend="attr_captionProperty">captionProperty</link>
                  </entry>editable<entry align="left">
                    <link linkend="attr_lookupScreen">lookupScreen</link>
                  </entry><entry align="left">
                    <link linkend="attr_optionsDatasource">optionsDatasource</link>
                  </entry><entry/></row>
                <row><entry>
                    <link linkend="attr_filterMode">filterMode</link>
                  </entry><entry align="left">
                    <sgmltag>multiselect</sgmltag>
                  </entry>required<entry/><entry/></row>
                <row>
                  <entry align="left">
                    <link linkend="attr_lookup">lookup</link>
                  </entry>
                  <entry align="left">
                    <link linkend="attr_openType">openType</link>
                  </entry>
                  <entry/>
                  <entry/>
                </row>
              </tbody></tgroup>
          </informaltable>
          <para>Атрибуты <link linkend="element_button" id="element_tL_button">button</link>:</para>
          <informaltable frame="none" pgwide="0" align="left">
            <tgroup cols="4" colsep="1" rowsep="1" align="left"><colspec colname="c1"/><colspec colname="c2"/><colspec colname="c3"/><colspec colname="c4"/>c <tbody>
                <row><entry align="left">
                    <link linkend="attr_caption">caption</link>
                  </entry>editable</row>
                <row><entry>
                    <link linkend="attr_icon">icon</link>
                  </entry>required</row>
              </tbody></tgroup>
          </informaltable>
        </section>
        <section id="gui_Table">
          <title>Table</title>
          <para>Таблица (<code>Table</code>)  дает возможность выводить двухмерную информацию, расположенную в виде строк и столбцов, настраивать и сортировать данные, управлять заголовками таблицы и ее выделенными элементами.</para>
          <figure>
            <title/>
            <mediaobject>
              <imageobject>
                <imagedata contentwidth="300" align="center" fileref="img/gui_table.png"/>
              </imageobject>
            </mediaobject>
          </figure>
          <para>XML-имя компонента: <sgmltag>table</sgmltag></para>
          <figure>
            <title/>
            <mediaobject>
              <imageobject>
                <imagedata contentwidth="90%" align="center" fileref="img/gui_Table_dia.png"/>
              </imageobject>
            </mediaobject>
          </figure>
          <para>Классы простых таблиц существуют как для веб-приложений, так  и для десктоп-приложений.  Интерфейс <code>Table</code>,  наследуется от интерфейса  <code>ListComponent</code> − базового интерфейса компонентов, предназначенных для работы с коллекциями <glossterm linkend="entity">сущностей</glossterm>.</para>
          <para>Для того чтобы создать простую таблицу, необходимо в <glossterm linkend="screen_xml_glossentry">xml-дескрипторе</glossterm> задать <link linkend="datasources">источник данных</link> и определить описание таблицы:</para>
          <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/section_gui/table/table.txt" encoding="UTF-8" parse="text"/></programlisting>
          <warning>
            <para>Обязательными для таблицы являются элементы <link linkend="element_table_columns">columns</link> и  <link linkend="element_table_rows">rows</link>.</para>
          </warning>
          <para>Атрибут <sgmltag id="attr_presentations">presentations</sgmltag> управляет механизмом <link linkend="gui_Table_presentations">представлений</link>. Значение по умолчанию равно <literal>false</literal>. Когда значение атрибута равно <literal>true</literal>, то в верхнем правом углу таблицы появляется значок <inlinemediaobject>
              <imageobject>
                <imagedata fileref="img/gui_presentation.png"/>
              </imageobject>
            </inlinemediaobject>.</para>
          <para>Атрибут <sgmltag id="attr_sortable">sortable</sgmltag> разрешает или запрещает сортировку в таблице. По умолчанию имеет значение <literal>true</literal>. Если сортировка разрешена, то при нажатии на название колонки справа от названия появляется значок <inlinemediaobject>
              <imageobject>
                <imagedata fileref="img/gui_sortable_down.png"/>
              </imageobject>
            </inlinemediaobject>/<inlinemediaobject>
              <imageobject>
                <imagedata fileref="img/gui_sortable_up.png"/>
              </imageobject>
            </inlinemediaobject>.</para>
          <para>Существует возможность использования для колонок функций <link linkend="gui_Table_aggregation">агрегирования</link> без модификации <link linkend="datasources">источника данных</link> с помощью атрибута <sgmltag id="attr_aggregatable">aggregatable</sgmltag>. По умолчанию атрибут  имеет значение <literal>false</literal>.</para>
          <para>Атрибут <sgmltag id="attr_showTotalAggregation">showTotalAggregation</sgmltag> разрешает или запрещает отображение строки итоговой агрегации в таблице. По умолчанию имеет значение <literal>true</literal>.</para>
          <para>Можно задать множественное выделение строк в таблице с помощью присваивания атрибуту <sgmltag id="attr_table_multiselect">multiselect</sgmltag>  значения <literal>true</literal>. По умолчанию значение атрибута равно <literal>false</literal>.</para>
          <para>С помощью элемента <sgmltag id="element_table_actions">actions</sgmltag> возможно определять набор действий (<link linkend="gui_Action">action</link>). Кроме описания произвольного действия возможно использование стандартных действий, определяемых перечислением <code>ListActionType</code>: <code>create</code>, <code>edit</code>, <code>remove</code>, <code>refresh</code>, <code>add</code>, <code>exclude</code>, <code>excel</code>.</para>
          <para><sgmltag id="attr_rowsCount">rowsCount</sgmltag> − необязательный элемент, создающий для таблицы компонент <code>RowsCount</code>, который позволяет загружать в таблицу данные постранично.</para>
          <para>Элемент <sgmltag id="element_table_rows">rows</sgmltag> является обязательным. В этом элементе необходимо объявить используемый <link linkend="datasources">источник данных</link>.</para>
          <para>Атрибут <sgmltag id="attr_headerMode">headerMode</sgmltag> элемента <sgmltag>rows</sgmltag> задает вариант отображения заголовков рядов:</para>
          <itemizedlist>
            <listitem>
              <para><literal>NONE</literal> − нет заголовков</para>
            </listitem>
            <listitem>
              <para><literal>ICON</literal> − пиктограмма</para>
            </listitem>
          </itemizedlist>
          <para>Следующим обязательным элементом для таблицы является элемент <sgmltag id="element_table_columns">columns</sgmltag>. Он определяет набор колонок (<sgmltag>column</sgmltag>) таблицы.</para>
          <para><sgmltag id="element_table_columns_column_1">column</sgmltag>  − элемент, задающий опции для колонки таблицы. Может содержать следующие атрибуты:</para>
          <itemizedlist>
            <listitem>
              <para><sgmltag id="attr_table_column_id">id</sgmltag> − обязательный атрибут, содержит название атрибута <glossterm linkend="entity">сущности</glossterm>, выводимого в колонке.</para>
            </listitem>
            <listitem>
              <para><sgmltag id="attr_table_column_collapsed">collapsed</sgmltag> − необязательный атрибут, скрывает/показывает колонку. По умолчанию имеет значение <literal>false</literal>.</para>
            </listitem>
            <listitem>
              <para><sgmltag id="attr_table_column_caption">caption</sgmltag> − необязательный атрибут, содержит заголовок колонки.</para>
            </listitem>
            <listitem>
              <para><sgmltag id="attr_table_column_width">width</sgmltag> − необязательный атрибут, отвечает за изначальную ширину колонки.</para>
            </listitem>
            <listitem>
              <para><sgmltag id="attr_table_column_calculatable">calculatable</sgmltag> − необязательный атрибут, используется только в редактируемой таблице. Буквально означает, что значения в данной колонке являются вычислимыми и зависят от значений других колонок.</para>
            </listitem>
            <listitem>
              <para><link linkend="attr_editable" id="attr_table_column_editable">editable</link> − необязательный атрибут, разрешает/запрещает редактирование данного атрибута в редактируемой таблице.</para>
            </listitem>
          </itemizedlist>
          <para>Для таблицы можно задать стиль отображения ячеек таблицы. Для этого в <glossterm linkend="screen_controller_glossentry">контроллере</glossterm> экрана нужно задать для таблицы <code>StyleProvider</code> реализовав интерфейс <code>com.haulmont.cuba.gui.components.StyleProvider.</code></para>
          <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/section_gui/table/tableStyle.txt" encoding="UTF-8" parse="text"/></programlisting>
          <para>Далее нужно определить в теме приложения стили для строк и столбцов (подробную информацию о том, как создать тему приложения, смотрите <xref linkend="gui_themes"/>):</para>
          <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/section_gui/table/tableStylecss.txt" encoding="UTF-8" parse="text"/></programlisting>
          <figure>
            <title/>
            <mediaobject>
              <imageobject>
                <imagedata contentwidth="381" align="center" fileref="img/gui_table_Style.png"/>
              </imageobject>
            </mediaobject>
          </figure>
          <para>В таблице существует возможность задавать собственное представление данных в колонке. Для этого необходимо использовать метод <code>Table.addGeneratedColumn</code>. В методе нужно создать CUBA-компонент с использованием класса <code>ComponentsFactory</code>. Пример:</para>
          <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/section_gui/table/tableGeneratedColumn.txt" encoding="UTF-8" parse="text"/></programlisting>
          <figure>
            <title/>
            <mediaobject>
              <imageobject>
                <imagedata contentwidth="501" align="center" fileref="img/gui_tableGenerated.png"/>
              </imageobject>
            </mediaobject>
          </figure>
          <para>Атрибуты <sgmltag>table</sgmltag>:</para>
          <informaltable frame="none" pgwide="0" align="left">
            <tgroup cols="4" colsep="1" rowsep="1" align="left"><colspec colname="c1"/><colspec colname="c2"/><colspec colname="c3"/><colspec colname="c4"/>c <tbody>
                <row><entry align="left">
                    <link linkend="attr_aggregatable">aggregatable</link>
                  </entry>editable<entry align="left">margin</entry><entry align="left">
                    <link linkend="attr_sortable">sortable</link>
                  </entry><entry/></row>
                <row>
                  <entry>
                    <link linkend="attr_editable">editable</link>
                  </entry>
                  <entry align="left">
                    <link linkend="attr_table_multiselect">multiselect</link>
                  </entry>
                  <entry>
                    <link linkend="attr_stylename">styleName</link>
                  </entry>
                  <entry/>
                </row>
                <row>
                  <entry align="left">
                    <link linkend="attr_height">height</link>
                  </entry>
                  <entry align="left">
                    <link linkend="attr_presentations">presentations</link>
                  </entry>
                  <entry>
                    <link linkend="attr_visible">visible</link>
                  </entry>
                  <entry/>
                </row>
                <row>
                  <entry align="left">
                    <link linkend="attr_id">id</link>
                  </entry>
                  <entry align="left">
                    <link linkend="attr_showTotalAggregation">showTotalAggregation</link>
                  </entry>
                  <entry>
                    <link linkend="attr_width">width</link>
                  </entry>
                  <entry/>
                </row>
              </tbody></tgroup>
          </informaltable>
          <para>Элементы <sgmltag>table</sgmltag>:</para>
          <informaltable frame="none" pgwide="0" align="left">
            <tgroup cols="1" colsep="1" rowsep="1" align="left">
              <colspec colname="c1"/>
              <tbody>
                <row>
                  <entry>
                    <link linkend="element_table_actions">actions</link>
                  </entry>
                </row>
                <row>buttonsPanel<entry>
                    <link linkend="gui_ButtonsPanel">buttonsPanel</link>
                  </entry></row>
                <row>
                  <entry>
                    <link linkend="attr_rowsCount">rowsCount</link>
                  </entry>
                </row>
                <row>
                  <entry>
                    <link linkend="element_t_columns">columns</link>
                  </entry>
                </row>
                <row>
                  <entry>
                    <link linkend="element_t_rows">rows</link>
                  </entry>
                </row>
              </tbody>
            </tgroup>
          </informaltable>
          <para>Атрибуты элемента <link linkend="element_table_columns" id="element_t_columns">columns</link> <link linkend="element_table_columns_column_1">column</link>:</para>
          <informaltable frame="none" pgwide="0" align="left">
            <tgroup cols="4" colsep="1" rowsep="1" align="left"><colspec colname="c1"/><colspec colname="c2"/><colspec colname="c3"/><colspec colname="c4"/>c <tbody>
                <row><entry align="left">
                    <link linkend="gui_Table_aggregation">aggregation</link>
                  </entry>editable<entry align="left">
                    <link linkend="attr_clickAction">clickAction</link>
                  </entry><entry align="left">
                    <link linkend="attr_table_column_id">id</link>
                  </entry><entry>
                    <link linkend="attr_resolution">resolution</link>
                  </entry></row>
                <row>
                  <entry>
                    <link linkend="attr_table_column_calculatable">calculatable</link>
                  </entry>
                  <entry align="left">
                    <link linkend="attr_table_column_collapsed">collapsed</link>
                  </entry>
                  <entry>
                    <link linkend="attr_optionsDatasource">optionsDatasource</link>
                  </entry>
                  <entry>
                    <link linkend="attr_visible">visible</link>
                  </entry>
                </row>
                <row>
                  <entry align="left">
                    <link linkend="attr_table_column_caption">caption</link>
                  </entry>
                  <entry align="left">
                    <link linkend="attr_dateFormat">dateFormat</link>
                  </entry>
                  <entry>
                    <link linkend="attr_required">required</link>
                  </entry>
                  <entry>
                    <link linkend="attr_table_column_width">width</link>
                  </entry>
                </row>
                <row>
                  <entry align="left">
                    <link linkend="attr_captionProperty">captionProperty</link>
                  </entry>
                  <entry align="left">
                    <link linkend="attr_table_column_editable">editable</link>
                  </entry>
                  <entry>
                    <link linkend="attr_requiredMessage">requiredMessage</link>
                  </entry>
                  <entry/>
                </row>
              </tbody></tgroup>
          </informaltable>
          <para>Атрибуты <link linkend="element_table_rows" id="element_t_rows">rows</link>:</para>
          <informaltable frame="none" pgwide="0" align="left">
            <tgroup cols="4" colsep="1" rowsep="1" align="left"><colspec colname="c1"/><colspec colname="c2"/><colspec colname="c3"/><colspec colname="c4"/>c <tbody>
                <row><entry align="left">
                    <link linkend="attr_datasource">datasource</link>
                  </entry>editable</row>
                <row>
                  <entry>
                    <link linkend="attr_headerMode">headerMode</link>
                  </entry>
                </row>
              </tbody></tgroup>
          </informaltable>
        </section>
        <section id="gui_TreeTable">
          <title>TreeTable</title>
          <para>Таблица с иерархией  (<code>TreeTable</code>)   − таблица, отображающая иерархию <glossterm linkend="entity">сущностей</glossterm>.</para>
          <figure>
            <title/>
            <mediaobject>
              <imageobject>
                <imagedata contentwidth="321" align="center" fileref="img/gui_treeTable.png"/>
              </imageobject>
            </mediaobject>
          </figure>
          <para>XML-имя компонента: <sgmltag>treeTable</sgmltag></para>
          <figure>
            <title/>
            <mediaobject>
              <imageobject>
                <imagedata contentwidth="90%" align="center" fileref="img/gui_TreeTable_dia.png"/>
              </imageobject>
            </mediaobject>
          </figure>
          <para>Существует два класса иерархичных таблиц: для веб-приложений  и для десктоп-приложений.</para>
          <para>Для того чтобы создать иерархическую таблицу, необходимо в <glossterm linkend="screen_xml_glossentry">xml-дескрипторе</glossterm> задать иерархический <link linkend="datasources">источник данных</link> и определить описание таблицы:</para>
          <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/section_gui/treeTable/treeTable.txt" encoding="UTF-8" parse="text"/></programlisting>
          <warning>
            <para>Обязательными для иерархической таблицы являются элементы <link linkend="element_table_columns">columns</link> и  <link linkend="element_table_rows">rows</link>.</para>
          </warning>
        </section>
        <section id="gui_GroupTable">
          <title>GroupTable</title>
          <para><link linkend="gui_Table">Таблица</link> с возможностью динамической группировки по любому полю. Для того чтобы сгруппировать таблицу по какому-либо столбцу, нужно в шапке таблицы перетащить этот столбец перед знаком <inlinemediaobject>
              <imageobject>
                <imagedata fileref="img/gui_groupTableIcon.png"/>
              </imageobject>
            </inlinemediaobject>. Сгруппированные значения можно разворачивать и сворачивать с помощью знаков <inlinemediaobject>
              <imageobject>
                <imagedata fileref="img/gui_groupBox_plus.png"/>
              </imageobject>
            </inlinemediaobject>/<inlinemediaobject>
              <imageobject>
                <imagedata fileref="img/gui_groupBox_minus.png"/>
              </imageobject>
            </inlinemediaobject>.</para>
          <figure>
            <title/>
            <mediaobject>
              <imageobject>
                <imagedata contentwidth="357" align="center" fileref="img/gui_groupTableDragColumn.png"/>
              </imageobject>
            </mediaobject>
          </figure>
          <para>XML-имя компонента: <sgmltag>groupTable</sgmltag>.</para>
          <figure>
            <title/>
            <mediaobject>
              <imageobject>
                <imagedata contentwidth="80%" align="center" fileref="img/gui_GroupTable_dia.png"/>
              </imageobject>
            </mediaobject>
          </figure>
          <para>Существует два класса таблиц с группировкой: для веб-приложений  и для десктоп-приложений.</para>
          <para>Для правильного функционирования <code>GroupTable</code> должна быть соединена с <link linkend="datasources">GroupDatasource</link>.</para>
          <para>Пример использования:</para>
          <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/section_gui/groupTable/groupTable.txt" encoding="UTF-8" parse="text"/></programlisting>
          <para>Элемент <sgmltag>group</sgmltag> − необязательный элемент, может в единственном экземпляре находиться внутри <link linkend="element_table_columns">columns</link>. Содержит набор элементов <link linkend="element_table_columns_column_1">column</link>, по которым будет выполняться первоначальная группировка.</para>
        </section>
        <section id="gui_Tree">
          <title>Tree</title>
          <para>Компонент <code>Tree</code> представляет иерархическую структуру данных, отображая ее в виде дерева.</para>
          <figure>
            <title/>
            <mediaobject>
              <imageobject>
                <imagedata contentwidth="100" align="center" fileref="img/Tree.png"/>
              </imageobject>
            </mediaobject>
          </figure>
          <para>XML-имя компонента: <sgmltag>tree</sgmltag></para>
          <figure>
            <title/>
            <mediaobject>
              <imageobject>
                <imagedata contentwidth="80%" align="center" fileref="img/gui_tree_dia.png"/>
              </imageobject>
            </mediaobject>
          </figure>
          <para>Существует два класса деревьев: для веб-приложений  и для десктоп-приложений.</para>
          <para>Для того чтобы создать компонент дерева, создайте в <glossterm linkend="screen_xml_glossentry">xml-дескрипторе</glossterm> следующий код:</para>
          <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/section_gui/tree/tree.txt" encoding="UTF-8" parse="text"/></programlisting>
          <warning>
            <para>Обязательными для дерева являются элемент <sgmltag>treechildren</sgmltag>.</para>
          </warning>
          <para>Элемент <sgmltag id="element_treechildren">treechildren</sgmltag>  декларирует используемый <link linkend="datasources">источник данных</link>. </para>
          <para>Атрибуты <sgmltag>tree</sgmltag>:</para>
          <informaltable frame="none" pgwide="0" align="left">
            <tgroup cols="4" colsep="1" rowsep="1" align="left"><colspec colname="c1"/><colspec colname="c2"/><colspec colname="c3"/><colspec colname="c4"/>c <tbody>
                <row><entry align="left">
                    <link linkend="attr_height">height</link>
                  </entry>editable</row>
                <row><entry>
                    <link linkend="attr_id">id</link>
                  </entry>required<entry/></row>
                <row>
                  <entry align="left">
                    <link linkend="attr_table_multiselect">multiselect</link>
                  </entry>
                </row>
                <row>
                  <entry align="left">
                    <link linkend="attr_width">width</link>
                  </entry>
                </row>
              </tbody></tgroup>
          </informaltable>
          <para>Элементы <sgmltag>tree</sgmltag>:</para>
          <informaltable frame="none" pgwide="0" align="left">
            <tgroup cols="1" colsep="1" rowsep="1" align="left"><colspec colname="c1"/>c <tbody>
                <row><entry align="left">
                    <link linkend="element_treechildren">treechildren</link>
                  </entry>editable</row>
                <row><entry>
                    <link linkend="element_table_actions">actions</link>
                  </entry>required</row>
              </tbody></tgroup>
          </informaltable>
          <para>Атрибуты <sgmltag>treechildren</sgmltag>:</para>
          <informaltable frame="none" pgwide="0" align="left">
            <tgroup cols="4" colsep="1" rowsep="1" align="left"><colspec colname="c1"/><colspec colname="c2"/><colspec colname="c3"/><colspec colname="c4"/>c <tbody>
                <row><entry align="left">
                    <link linkend="attr_captionProperty">captionProperty</link>
                  </entry>editable</row>
                <row><entry>
                    <link linkend="attr_datasource">datasource</link>
                  </entry>required</row>
                <row>
                  <entry align="left">
                    <sgmltag>hierarchyProperty</sgmltag>
                  </entry>
                </row>
              </tbody></tgroup>
          </informaltable>
        </section>
        <section id="gui_ProgressBar">
          <title>ProgressBar</title>
          <para>Индикатор прогресса (<code>ProgressBar</code>) наглядно демонстрирует пользователю, на каком этапе выполнения находится некий процесс, так что пользователь сможет понять, как долго остается ждать его завершения. Индикатор выводится на
экран в виде непрерывно меняющейся полосы. Может отображать конкретное значение прогресса, например, 30%, а может отображать неопределенное состояние.</para>
          <figure>
            <title/>
            <mediaobject>
              <imageobject>
                <imagedata align="center" fileref="img/gui_progressBar.png"/>
              </imageobject>
            </mediaobject>
          </figure>
          <para>XML-имя компонента: <sgmltag>progressBar</sgmltag></para>
          <figure>
            <title/>
            <mediaobject>
              <imageobject>
                <imagedata contentwidth="80%" align="center" fileref="img/gui_progressBar_dia.png"/>
              </imageobject>
            </mediaobject>
          </figure>
          <para>Существует два класса индикатора прогресса: для веб-приложений и для десктоп-приложений.</para>
          <para>Для создания индикатора необходимо в <glossterm linkend="screen_xml_glossentry">xml-дескрипторе</glossterm> определить его описание:</para>
          <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/section_gui/progressBar/progressBar.txt" encoding="UTF-8" parse="text"/></programlisting>
          <para>С помощью атрибута <sgmltag id="attr_indeterminate">indeterminate</sgmltag> можно задать отображение неопределенного состояния индикатора. Если значение атрибута равно <literal>true</literal>, то индикатор отображает неопределенное состояние. Значение атрибута по умолчанию равно <literal>true</literal>.</para>
          <para>Значения прогресса задачи для индикатора прогресса следует передавать в  значениях типа <code>Float</code> в диапазоне от 0.0 до 1.0.</para>
          <para>Атрибуты <sgmltag>progressBar</sgmltag>:</para>
          <informaltable frame="none" pgwide="0" align="left">
            <tgroup cols="4" colsep="1" rowsep="1" align="left"><colspec colname="c1"/><colspec colname="c2"/><colspec colname="c3"/><colspec colname="c4"/>c <tbody>
                <row><entry align="left">
                    <link linkend="attr_align">align</link>
                  </entry>editable<entry align="left">
                    <link linkend="attr_height">height</link>
                  </entry><entry align="left">
                    <link linkend="attr_stylename">stylename</link>
                  </entry><entry/></row>
                <row>
                  <entry>
                    <link linkend="attr_editable">editable</link>
                  </entry>
                  <entry align="left">
                    <link linkend="attr_id">id</link>
                  </entry>
                  <entry>
                    <link linkend="attr_visible">visible</link>
                  </entry>
                  <entry/>
                </row>
                <row>
                  <entry align="left">
                    <link linkend="attr_enable">enable</link>
                  </entry>
                  <entry align="left">
                    <link linkend="attr_indeterminate">indeterminate</link>
                  </entry>
                  <entry>
                    <link linkend="attr_width">width</link>
                  </entry>
                  <entry/>
                </row>
              </tbody></tgroup>
          </informaltable>
        </section>
        <section id="gui_FileUploadField">
          <title>FileUploadField</title>
          <para>Компонент загрузки файлов (<code>FileUploadField</code>) позволяет пользователю загружать файлы на сервер. Компонент представляет собой кнопку, при нажатии на которую на экране отображается окно загрузки файла, содержащее список файлов некоторой директории. В списке можно выбрать только один файл для загрузки.</para>
          <figure>
            <title/>
            <mediaobject>
              <imageobject>
                <imagedata align="center" fileref="img/gui_upload.png"/>
              </imageobject>
            </mediaobject>
          </figure>
          <para>XML-имя компонента: <sgmltag>upload</sgmltag>.</para>
          <figure>
            <title/>
            <mediaobject>
              <imageobject>
                <imagedata contentwidth="80%" align="center" fileref="img/gui_FileUploadField_dia.png"/>
              </imageobject>
            </mediaobject>
          </figure>
          <para>Существует два класса компонентов загрузки файлов: для веб-приложений  и для десктоп-приложений.</para>
          <para>Ниже расположен пример, содержащий обработчик загрузки файла. В этом обработчике написан программный код, обеспечивающий вывод на экран сообщения об успешной или не успешной загрузке файла, а также вывод названия файла в компоненте  <link linkend="gui_Label">надписи</link>.</para>
          <para>Для начала определим описание компонента в <glossterm linkend="screen_xml_glossentry">xml-дескрипторе</glossterm>:</para>
          <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/section_gui/upload/upload.txt" encoding="UTF-8" parse="text"/></programlisting>
          <para>Программный код <glossterm linkend="screen_controller_glossentry">контроллера</glossterm> выглядит следующим образом:</para>
          <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/section_gui/upload/uploadContr.txt" encoding="UTF-8" parse="text"/></programlisting>
          <figure>
            <title/>
            <mediaobject>
              <imageobject>
                <imagedata align="center" fileref="img/gui_uploadRez.png"/>
              </imageobject>
            </mediaobject>
          </figure>
          <para>Атрибуты <sgmltag>upload</sgmltag>:</para>
          <informaltable frame="none" pgwide="0" align="left">
            <tgroup cols="4" colsep="1" rowsep="1" align="left"><colspec colname="c1"/><colspec colname="c2"/><colspec colname="c3"/><colspec colname="c4"/>c <tbody>
                <row><entry align="left">
                    <link linkend="attr_caption">caption</link>
                  </entry>editable<entry align="left">
                    <link linkend="attr_id">id</link>
                  </entry><entry align="left">
                    <link linkend="attr_width">width</link>
                  </entry><entry/></row>
                <row>
                  <entry>
                    <link linkend="attr_description">description</link>
                  </entry>
                  <entry align="left">
                    <link linkend="attr_stylename">stylename</link>
                  </entry>
                  <entry/>
                  <entry/>
                </row>
                <row>
                  <entry align="left">
                    <link linkend="attr_height">height</link>
                  </entry>
                  <entry align="left">
                    <link linkend="attr_visible">visible</link>
                  </entry>
                  <entry/>
                  <entry/>
                </row>
              </tbody></tgroup>
          </informaltable>
        </section>
        <section id="gui_FileMultiUploadField">
          <title>FileMultiUploadField</title>
          <para>Компонент для множественной загрузки файлов позволяет пользователю загружать файлы на сервер. Компонент представляет собой кнопку, при нажатии на которую на экране отображается окно загрузки файлов, содержащее список файлов некоторой директории. В списке можно выбрать сразу несколько файлов для загрузки.</para>
          <figure>
            <title/>
            <mediaobject>
              <imageobject>
                <imagedata align="center" fileref="img/gui_multipleUpload.png"/>
              </imageobject>
            </mediaobject>
          </figure>
          <para>XML-имя компонента: <sgmltag>multiupload</sgmltag>.</para>
          <figure>
            <title/>
            <mediaobject>
              <imageobject>
                <imagedata contentwidth="80%" align="center" fileref="img/gui_FileMultiUploadField_dia.png"/>
              </imageobject>
            </mediaobject>
          </figure>
          <para>Существует два класса компонентов множественной загрузки файлов: для веб-приложений  и для десктоп-приложений.</para>
          <para>Ниже расположен пример, содержащий обработчик загрузки файлов. В этом обработчике написан программный код, обеспечивающий вывод на экран сообщения об успешной или не успешной загрузке файлов, а также вывод названий файлов в <link linkend="gui_TextField">текстовое поле</link>.</para>
          <para>Для начала определим описание компонента в <glossterm linkend="screen_xml_glossentry">xml-дескрипторе</glossterm>:</para>
          <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/section_gui/multipleUpload/multipleUpload.txt" encoding="UTF-8" parse="text"/></programlisting>
          <para>Программный код <glossterm linkend="screen_controller_glossentry">контроллера</glossterm> выглядит следующим образом:</para>
          <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/section_gui/multipleUpload/multipleUploadContr.txt" encoding="UTF-8" parse="text"/></programlisting>
          <figure>
            <title/>
            <mediaobject>
              <imageobject>
                <imagedata align="center" fileref="img/gui_multipleUploadRez.png"/>
              </imageobject>
            </mediaobject>
          </figure>
          <para>Атрибуты <sgmltag>multiupload</sgmltag>:</para>
          <informaltable frame="none" pgwide="0" align="left">
            <tgroup cols="4" colsep="1" rowsep="1" align="left"><colspec colname="c1"/><colspec colname="c2"/><colspec colname="c3"/><colspec colname="c4"/>c <tbody>
                <row><entry align="left">
                    <link linkend="attr_caption">caption</link>
                  </entry>editable<entry align="left">
                    <link linkend="attr_id">id</link>
                  </entry><entry align="left">
                    <link linkend="attr_width">width</link>
                  </entry><entry/></row>
                <row>
                  <entry>
                    <link linkend="attr_description">description</link>
                  </entry>
                  <entry align="left">
                    <link linkend="attr_stylename">stylename</link>
                  </entry>
                  <entry/>
                  <entry/>
                </row>
                <row>
                  <entry align="left">
                    <link linkend="attr_height">height</link>
                  </entry>
                  <entry align="left">
                    <link linkend="attr_visible">visible</link>
                  </entry>
                  <entry/>
                  <entry/>
                </row>
              </tbody></tgroup>
          </informaltable>
        </section>
        <section id="gui_Filter">
          <title>Generic Filter</title>
          <para>Универсальный фильтр (<code>Filter</code>) − компонент для организации поиска данных, предназначен для отбора информации, отображаемой в таблице экземпляров <glossterm linkend="entity">сущностей</glossterm>.</para>
          <para>Типичный фильтр имеет следующий вид:</para>
          <figure>
            <title/>
            <mediaobject>
              <imageobject>
                <imagedata align="center" fileref="img/gui_filter_descr.png"/>
              </imageobject>
            </mediaobject>
          </figure>
          <para>Для того чтобы создать фильтр, нажмите на кнопку <guibutton>Фильтр</guibutton> и выберите значение <guilabel>Создать</guilabel>. На экране отобразится  панель редактора фильтра.</para>
          <figure>
            <title/>
            <mediaobject>
              <imageobject>
                <imagedata align="center" fileref="img/gui_filter_editor.png"/>
              </imageobject>
            </mediaobject>
          </figure>
          <para>В поле <guilabel>Имя</guilabel> следует ввести имя фильтра, это имя будет отображаться в списке доступных для текущего экрана фильтров.</para>
          <para>В таблице содержатся условия фильтра. Условия можно менять местами с помощью кнопок <inlinemediaobject>
              <imageobject>
                <imagedata fileref="img/gui_filter_cond_down.png"/>
              </imageobject>
            </inlinemediaobject>/<inlinemediaobject>
              <imageobject>
                <imagedata fileref="img/gui_filter_cond_up.png"/>
              </imageobject>
            </inlinemediaobject>. Созданные условия можно удалять с помощью кнопки <inlinemediaobject>
              <imageobject>
                <imagedata fileref="img/gui_filter_remove.png"/>
              </imageobject>
            </inlinemediaobject></para>
          <para>С помощью флажков можно сделать выбранное в таблице условие скрытым для пользователя (колонка <guilabel>Скрытый</guilabel>) или обязательным для заполнения (колонка <guilabel>Обязательный</guilabel>). В колонке <guilabel>Операция</guilabel> следует для <emphasis role="bold">каждого</emphasis> условия выбрать операцию из списка доступных операций.</para>
          <para>Фильтр можно сделать <firstterm>глобальным</firstterm> (то есть доступным для всех пользователей) с помощью установки флажка <guilabel>Общий для всех пользователей</guilabel>, или установить текущий фильтр в качестве фильтра по умолчанию с помощью установки флажка <guilabel>По умолчанию</guilabel>.</para>
          <para>Чтобы добавить новое условие, следует нажать кнопку <guibutton>Добавить условие</guibutton> в редакторе фильтра. На экране отобразится окно выбора условий. </para>
          <figure>
            <title/>
            <mediaobject>
              <imageobject>
                <imagedata align="center" fileref="img/gui_filter_conditions.png"/>
              </imageobject>
            </mediaobject>
          </figure>
          <para>Условия разделяются по группам условий. Группа <guilabel>Атрибуты</guilabel> − это те условия, которые перечислены в элементах <sgmltag>properties</sgmltag> и  <sgmltag>property</sgmltag> компонента фильтра. Группа <guilabel>Специальные условия</guilabel> − это пользовательские условия, заданные в элементе <sgmltag>custom</sgmltag>. Группы <guilabel>Группы</guilabel>, <guilabel>Динамический атрибут...</guilabel> и <guilabel>Создать новое...</guilabel> доступны для выбора всегда.</para>
          <para/>
          <para>XML-имя компонента: <sgmltag>filter</sgmltag>.</para>
          <figure>
            <title/>
            <mediaobject>
              <imageobject>
                <imagedata contentwidth="80%" align="center" fileref="img/gui_filter_dia.png"/>
              </imageobject>
            </mediaobject>
          </figure>
          <para>Существует два класса компонентов фильтра: для веб-приложений  и для десктоп-приложений.</para>
          <para>Компонент фильтра имеет следующие атрибуты, перечисленные ниже.</para>
          <para><sgmltag id="applyTo_attr">applyTo</sgmltag> − необязательный атрибут, содержит <link linkend="attr_id">идентификатор</link> компонента, с которым связан фильтр. Используется в случае, когда необходимо иметь доступ к <link linkend="gui_Table_presentations">представлениям</link> связного компонента. Например, сохраняя фильтр как <link linkend="search_folder">папку поиска</link> или как <link linkend="application_folder">папку приложения</link>, можно указать, какое представление будет применятся при просмотре этой папки.</para>
          <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/section_gui/filter/filter.txt" encoding="UTF-8" parse="text"/></programlisting>
          <figure>
            <title/>
            <mediaobject>
              <imageobject>
                <imagedata align="center" fileref="img/gui_filter_apply_to.png"/>
              </imageobject>
            </mediaobject>
          </figure>
          <para><sgmltag id="useMaxResults_attr">useMaxResults</sgmltag> − необязательный атрибут, при указании значения <literal>false</literal> фильтр не будет отображать флажок <guilabel>Показывать N строк</guilabel>. По умолчанию флажок отображается, если есть специфическое разрешение <property>cuba.gui.filter.maxResults</property> (подробнее о специфических разрешениях смотрите в <productname>Руководстве по безопасности платформы <trademark>CUBA</trademark></productname> (<ulink url="http://docs.haulmont.com/cuba/">http://docs.haulmont.com/cuba/</ulink>)). Если атрибут <sgmltag>useMaxResults</sgmltag> не указан или значение атрибута равно <literal>true</literal>, а разрешение <property>cuba.gui.filter.maxResults</property> запрещено, фильтр будет принудительно отбирать только первые N строк без возможности пользователя отключить это. Число N определяется параметрами <literal>FetchUI</literal>, <literal>DefaultFetchUI</literal>, задаваемыми в <code>PersistenceManager</code>.</para>
          <figure>
            <title>Вид фильтра со значением атрибута <code>useMaxResults=&quot;true&quot;</code>, запретом специфического разрешения <property>cuba.gui.filter.maxResults</property> и параметром <code>DefaultFetchUI=2</code></title>
            <mediaobject>
              <imageobject>
                <imagedata align="center" fileref="img/gui_filter_useMaxRezult.png"/>
              </imageobject>
            </mediaobject>
          </figure>
          <para><sgmltag id="manualApplyRequired_attr">manualApplyRequired</sgmltag> − необязательный атрибут. Определяет, как будет   применяться фильтр. Если значение атрибута равно <literal>false</literal>, то фильтр будет применяться сразу при открытии экрана списка. Если значение атрибута равно true, то фильтр будет применяться только после нажатия на кнопку <guibutton>Применить</guibutton>. Данный атрибут имеет приоритет над общесистемным <link linkend="app_properties_glossentry">свойством</link>  <property>cuba.gui.genericFilterManualApplyRequired</property>.</para>
          <para>Если значение атрибута <sgmltag id="required_filter_attr">required</sgmltag> равно <literal>true</literal>, то  в списке фильтров значение <literal>&lt;без фильтрации&gt;</literal> не отображается, и должен быть выбран один из доступных фильтров. Если для экрана не установлен фильтр по умолчанию, то в списке выбора фильтра автоматически устанавливается первый созданный фильтр.</para>
          <para>Если значение атрибута <sgmltag id="editable_filter_attr">editable</sgmltag> равно <literal>false</literal>, то кнопка <guibutton>Фильтр</guibutton> скрывается.</para>
          <para>Компонент  <sgmltag>filter</sgmltag> может содержать следующие элементы:</para>
          <variablelist>
            <varlistentry>
              <term>
                <sgmltag>properties</sgmltag>
              </term>
              <listitem>
                <para>Элемент, определяющий набор атрибутов <glossterm linkend="entity">сущности</glossterm>, заданной <link linkend="datasources">источником данных</link>. В качестве названий атрибутов используются <glossterm linkend="localization">локализованные имена атрибутов сущностей</glossterm>. Атрибуты:</para>
                <itemizedlist>
                  <listitem>
                    <para><sgmltag id="include_filter_attr">include</sgmltag> − обязательный атрибут, содержит регулярное выражение для включения атрибутов сущности. Атрибуты-коллекции не включаются независимо от данного регулярного выражения.</para>
                    <para>Чтобы включить все атрибуты сущности, используйте значение атрибута <literal>.*</literal> </para>
                  </listitem>
                  <listitem>
                    <para><sgmltag id="exclude_filter_attr">exclude</sgmltag> − необязательный атрибут, содержит регулярное выражение для исключения атрибутов сущности из предварительно включенных с помощью <link linkend="include_filter_attr">include</link>.</para>
                    <para>Чтобы исключить несколько атрибутов, перечислите их в значении атрибута <link linkend="exclude_filter_attr">exclude</link>, разделяя символом <literal>|</literal></para>
                  </listitem>
                </itemizedlist>
                <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/section_gui/filter/filter_properties.txt" encoding="UTF-8" parse="text"/></programlisting>
                <figure>
                  <title/>
                  <mediaobject>
                    <imageobject>
                      <imagedata align="center" fileref="img/gui_filter_properties.png"/>
                    </imageobject>
                  </mediaobject>
                </figure>
              </listitem>
            </varlistentry>
            <varlistentry>
              <term>
                <sgmltag>property</sgmltag>
              </term>
              <listitem>
                <para>Элемент, определяющий один атрибут сущности. Атрибуты:</para>
                <itemizedlist>
                  <listitem>
                    <para><sgmltag id="name_filter_property_attr">name</sgmltag> − имя атрибута сущности. Может быть путем (через &quot;.&quot;) по графу <glossterm linkend="entity">сущностей</glossterm>.</para>
                    <warning>
                      <para>Если в качестве имени атрибута указан путь по графу сущностей, обязательно указание значения для атрибута <link linkend="caption_filter_attr">caption</link>.</para>
                    </warning>
                  </listitem>
                  <listitem>
                    <para><sgmltag id="caption_filter_attr">caption</sgmltag> −  атрибут для задания локализованного названия имени параметра</para>
                    <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/section_gui/filter/filter_property_caption.txt" encoding="UTF-8" parse="text"/></programlisting>
                    <figure>
                      <title/>
                      <mediaobject>
                        <imageobject>
                          <imagedata align="center" fileref="img/gui_filter_property_caption.png"/>
                        </imageobject>
                      </mediaobject>
                    </figure>
                  </listitem>
                  <listitem>
                    <para><sgmltag id="paramWhere_filter_attr">paramWhere</sgmltag> − необязательный атрибут для задания фильтра на список значений параметра-<glossterm linkend="entity">сущности</glossterm>. </para>
                    <para>Например, можно ограничить список предлагаемых пользователю  моделей автомобилей только моделями марки <literal>Audi</literal>.</para>
                    <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/section_gui/filter/filter_paramWhere.txt" encoding="UTF-8" parse="text"/></programlisting>
                    <figure>
                      <title/>
                      <mediaobject>
                        <imageobject>
                          <imagedata align="center" fileref="img/gui_filter_paramWhere.png"/>
                        </imageobject>
                      </mediaobject>
                    </figure>
                  </listitem>
                  <listitem>
                    <para><sgmltag id="paramView_filter_attr">paramView</sgmltag> − необязательный атрибут для задания <link linkend="views">представления</link>, с которым будут загружаться список значений параметра-<glossterm linkend="entity">сущности</glossterm>. Например, <literal>_local</literal>.</para>
                  </listitem>
                </itemizedlist>
              </listitem>
            </varlistentry>
            <varlistentry>
              <term>
                <sgmltag>custom</sgmltag>
              </term>
              <listitem>
                <para>Элемент, определяющий произвольное условие. Содержимым элемента должно быть выражение на <glossterm linkend="jpql">JPQL</glossterm> (возможно использование JPQL Macros), которое будет добавлено в условие <code>where</code> результирующего запроса. Параметр (если он есть) обозначается символом <literal>?</literal>. </para>
                <para>Пример фильтра с произвольными условиями:</para>
                <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/section_gui/filter/filter_custom.txt" encoding="UTF-8" parse="text"/></programlisting>
                <para>Созданные произвольные условия попадают в раздел <guilabel>Специальные условия</guilabel> в редакторе условий.</para>
                <figure>
                  <title/>
                  <mediaobject>
                    <imageobject>
                      <imagedata align="center" fileref="img/gui_filter_custom.png"/>
                    </imageobject>
                  </mediaobject>
                </figure>
                <para>Атрибуты элемента <sgmltag>custom</sgmltag>:</para>
                <itemizedlist>
                  <listitem>
                    <para><sgmltag id="name_filter_custom_attr">name</sgmltag> − имя условия</para>
                  </listitem>
                  <listitem>
                    <para><sgmltag id="caption_filter_custom_attr">caption</sgmltag> − <link linkend="localization">локализованное</link> название условия</para>
                  </listitem>
                  <listitem>
                    <para><sgmltag id="paramClass_filter_attr">paramClass</sgmltag> или <sgmltag>class</sgmltag> − класс параметра условия</para>
                  </listitem>
                  <listitem>
                    <para><sgmltag id="inExpr_filter_attr">inExpr</sgmltag> − значение должно быть равно <literal>true</literal>, если выражение <glossterm linkend="jpql">JPQL</glossterm> содержит условие <code>in (?)</code></para>
                  </listitem>
                  <listitem>
                    <para><sgmltag id="join_filter_attr">join</sgmltag> − необязательный атрибут для задания строки, которая будет добавлена в секцию <literal>join</literal> запроса.</para>
                  </listitem>
                  <listitem>
                    <para><sgmltag>paramWhere</sgmltag> − необязательный атрибут для задания фильтра на список значений параметра-сущности.</para>
                  </listitem>
                  <listitem>
                    <para><sgmltag>paramView</sgmltag> − необязательный атрибут для задания <link linkend="views">представления</link>, с которым будут загружаться список значений параметра-<glossterm linkend="entity">сущности</glossterm>. Например,  <literal>_local</literal>.</para>
                  </listitem>
                </itemizedlist>
              </listitem>
            </varlistentry>
          </variablelist>
          <para>Атрибут <sgmltag>paramWhere</sgmltag> − необязательный атрибут для задания фильтра на список значений параметра-сущности. Содержит условие в формате <glossterm linkend="jpql">JPQL</glossterm> без слова <literal>where</literal>. Алиас сущности можно задавать любым.

Можно использовать параметры экрана, атрибуты сессии, а также <link linkend="component_filter_name_caution">компоненты</link> экрана, в том числе отображающие другие параметры.</para>
          <caution id="component_filter_name_caution">
            <title>Подсказка</title>
            <para>Как узнать имя компонента, отображающего параметр?</para>
            <para>Для этого нужно в редакторе фильтра правой кнопкой мыши вызвать контекстное меню в строке таблицы условий и выбрать в нем значение <guilabel>Показать имя компонента</guilabel>. После этого на экране отобразится окно, содержащее имя компонента.</para>
            <figure>
              <title/>
              <mediaobject>
                <imageobject>
                  <imagedata align="center" fileref="img/gui_filter_component_name.png"/>
                </imageobject>
              </mediaobject>
            </figure>
          </caution>
          <para><emphasis role="bold">Права пользователей</emphasis></para>
          <itemizedlist>
            <listitem>
              <para>Для создания/изменения/удаления глобальных фильтров пользователь должен иметь разрешение <property>cuba.gui.filter.global</property> </para>
            </listitem>
            <listitem>
              <para>Для создания/изменения новых условий пользователь должен иметь разрешение <property>cuba.gui.filter.customConditions</property></para>
            </listitem>
            <listitem>
              <para>Для возможности изменять значение флажка <guilabel>Show first N rows</guilabel> пользователь должен иметь разрешение <property>cuba.gui.filter.maxResults</property></para>
            </listitem>
          </itemizedlist>
          <para>Информацию о том, как настраивать  специфические разрешения, смотрите в <productname>Руководстве по безопасности платформы <trademark>CUBA</trademark></productname> (<ulink url="http://docs.haulmont.com/cuba/">http://docs.haulmont.com/cuba/</ulink>)</para>
          <para><emphasis role="bold">Общесистемные параметры</emphasis></para>
          <para>В системе предусмотрены следующие <glossterm linkend="app_properties_glossentry">параметры</glossterm>, влияющие на поведение фильтров:</para>
          <itemizedlist>
            <listitem>
              <para><property>cuba.gui.genericFilterManualApplyRequired</property>  − означает, что фильтр будет применяться только после нажатия пользователем соответствующей кнопки <guibutton>Применить</guibutton>. Значение по умолчанию равно <literal>true</literal>. Если выставлено значение <literal>false</literal>, то фильтр будет применяться сразу при открытии экрана списка. При открытии  экрана списка с помощью <link linkend="application_folder">папки приложения</link> или <link linkend="search_folder">папки поиска</link> значение <property>cuba.gui.genericFilterManualApplyRequired</property> не учитывается. По умолчанию в этом случае  в экране поиска фильтр будет применяться. Фильтр не применится, если значение атрибута <code>applyDefault</code> у папки явно установлено в <literal>false</literal>.</para>
            </listitem>
            <listitem>
              <para><property>cuba.gui.genericFilterChecking</property> − означает, что перед применением фильтра будет выполняться проверка его условий. Если фильтр не имеет ни одного заданного условия, то применяться он не будет. Значение по умолчанию равно <literal>true</literal>. Если значение равно  <literal>false</literal>, то проверка не производится.</para>
            </listitem>
            <listitem>
              <para><property>cuba.gui.genericFilterTreeConditionSelect</property> − включает выбор условий в древовидной структуре с возможностью обхода свойств связанных сущностей. Значение по умолчанию равно <literal>true</literal>. В случае задания значения <literal>false</literal> выбор условий осуществляется в плоском выпадающем списке из описателей условий, заданных в дескрипторе экрана.</para>
            </listitem>
            <listitem>
              <para><property>cuba.allowQueryFromSelected</property> служит для включения механизма  <link linkend="sequential_filter_para">последовательного наложения фильтров</link>. Значение по умолчанию равно <literal>true</literal>.</para>
            </listitem>
          </itemizedlist>
          <para><emphasis role="bold">Параметры вызова экрана</emphasis></para>
          <para>Существует возможность указать при вызове экрана, какой фильтр и с какими параметрами применить. Фильтр должен быть заранее создан в базе данных  и иметь заполненное поле <database>code</database>.</para>
          <para>Для указания кода фильтра в экран следует передать параметр с именем, равным <link linkend="attr_id">идентификатору</link> компонента фильтра в экране. Значение параметра − код фильтра, который нужно применить.</para>
          <para>Для установки значений параметров фильтра нужно передать параметры с именами, равными <link linkend="component_filter_name_caution">именам параметров</link>, и значения в виде строк.</para>
          <para>Пример установки фильтра из главного меню:</para>
          <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/section_gui/filter/filter_from_menu.txt" encoding="UTF-8" parse="text"/></programlisting>
          <para>Следует отметить, что фильтр с установленным полем <database>code</database> обладает особыми свойствами:</para>
          <itemizedlist>
            <listitem>
              <para>Его не могут редактировать пользователи</para>
            </listitem>
            <listitem>
              <para>Название такого фильтра локализуется − в <glossterm linkend="main_message_pack_glossentry">главном пакете сообщений</glossterm> приложения должна быть строка с ключом, равным коду фильтра.</para>
            </listitem>
          </itemizedlist>
          <para id="sequential_filter_para"><emphasis role="bold">Последовательное наложение фильтров</emphasis></para>
          <para>При включенном <glossterm linkend="app_properties_glossentry">параметре</glossterm> <property>cuba.allowQueryFromSelected</property> в пользовательском интерфейсе компонента можно закреплять последний примененный фильтр и текущие результаты фильтрации. После этого можно выбрать другой фильтр или параметры и применить их на уже выбранных записях.</para>
          <para>Данный подход позволяет решить две проблемы:</para>
          <itemizedlist>
            <listitem>
              <para>Декомпозировать сложные фильтры.</para>
            </listitem>
            <listitem>
              <para>Применять фильтры на записи, отобранные с помощью папок <link linkend="application_folder">приложения</link> или <link linkend="search_folder">поиска</link>.</para>
            </listitem>
          </itemizedlist>
          <para>Чтобы применить этот механизм в пользовательском интерфейсе, выберите и примените один из фильтров. Затем нажмите на кнопку <inlinemediaobject>
              <imageobject>
                <imagedata fileref="img/gui_filter_add.png"/>
              </imageobject>
            </inlinemediaobject>. Фильтр закрепится в нижней части панели фильтра. Далее можно применить к выбранным записям другой фильтр. Так последовательно можно накладывать друг на друга любое количество фильтров. Также фильтры можно удалять последовательно с помощью кнопки <inlinemediaobject>
              <imageobject>
                <imagedata fileref="img/gui_filter_remove.png"/>
              </imageobject>
            </inlinemediaobject></para>
          <figure>
            <title/>
            <mediaobject>
              <imageobject>
                <imagedata align="center" fileref="img/gui_filter_sequential.png"/>
              </imageobject>
            </mediaobject>
          </figure>
          <para>Механизм последовательного наложения фильтров работает следующим образом:</para>
          <itemizedlist>
            <listitem>
              <para>При наличии закрепленных фильтров результаты предыдущего запроса (точнее только <link linkend="attr_id">идентификаторы</link> отобранных <glossterm linkend="entity">сущностей</glossterm>) помещаются в таблицу <database>SYS_QUERY_RESULT</database>. Данная таблица содержит колонки, отделяющие результаты запросов для различных пользователей по идентификатору сессии и ключу серии запросов.</para>
            </listitem>
            <listitem>
              <para>К запросу текущего применяемого фильтра добавляется объединение с таблицей <database>SYS_QUERY_RESULT</database>, что ограничивает результаты текущего фильтра предыдущими отобранными записями.</para>
            </listitem>
          </itemizedlist>
          <para>Таблицу <database>SYS_QUERY_RESULT</database> необходимо периодически чистить от ненужных результатов запросов, оставленных завершенными пользовательскими сессиями. Для этого предназначен метод <code>deleteForInactiveSessions</code> бина <code>QueryResultsManagerAPI</code>. В прикладном проекте с включенным параметром <property>cuba.allowQueryFromSelected</property> необходимо вызывать этот метод либо из <link linkend="scheduled_tasks">назначенных заданий</link>, либо из стандартного <link linkend="scheduled_tasks">планировщика</link> <application>Spring</application>, например:</para>
          <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/section_gui/filter/filter_scheduler.txt" encoding="UTF-8" parse="text"/></programlisting>
          <para>Атрибуты <sgmltag>filter</sgmltag>:</para>
          <informaltable frame="none" pgwide="0" align="left">
            <tgroup cols="4" colsep="1" rowsep="1" align="left"><colspec colname="c1"/><colspec colname="c2"/><colspec colname="c3"/><colspec colname="c4"/>c <tbody>
                <row><entry align="left">
                    <link linkend="applyTo_attr">applyTo</link>
                  </entry>editable<entry align="left">
                    <link linkend="attr_id">id</link>
                  </entry><entry align="left">
                    <link linkend="attr_stylename">stylename</link>
                  </entry></row>
                <row>
                  <entry>
                    <link linkend="attr_datasource">datasource</link>
                  </entry>
                  <entry align="left">
                    <link linkend="manualApplyRequired_attr">manualApplyRequired</link>
                  </entry>
                  <entry>
                    <link linkend="useMaxResults_attr">useMaxResults</link>
                  </entry>
                </row>
                <row>
                  <entry align="left">
                    <link linkend="editable_filter_attr">editable</link>
                  </entry>
                  <entry align="left">
                    <link linkend="required_filter_attr">required</link>
                  </entry>
                  <entry>
                    <link linkend="attr_visible">visible</link>
                  </entry>
                </row>
              </tbody></tgroup>
          </informaltable>
          <para>Атрибуты элемента <sgmltag>properties</sgmltag>:</para>
          <informaltable frame="none" pgwide="0" align="left">
            <tgroup cols="1" colsep="1" rowsep="1" align="left"><colspec colname="c1"/>c <tbody>
                <row><entry align="left">
                    <link linkend="include_filter_attr">include</link>
                  </entry>editable</row>
                <row>
                  <entry>
                    <link linkend="exclude_filter_attr">exclude</link>
                  </entry>
                </row>
              </tbody></tgroup>
          </informaltable>
          <para>Атрибуты элемента <sgmltag>property</sgmltag>:</para>
          <informaltable frame="none" pgwide="0" align="left">
            <tgroup cols="4" colsep="1" rowsep="1" align="left"><colspec colname="c1"/><colspec colname="c2"/><colspec colname="c3"/><colspec colname="c4"/>c <tbody>
                <row><entry align="left">
                    <link linkend="caption_filter_attr">caption</link>
                  </entry>editable<entry align="left">
                    <link linkend="paramView_filter_attr">paramView</link>
                  </entry></row>
                <row>
                  <entry>
                    <link linkend="name_filter_property_attr">name</link>
                  </entry>
                  <entry align="left">
                    <link linkend="paramWhere_filter_attr">paramWhere</link>
                  </entry>
                </row>
              </tbody></tgroup>
          </informaltable>
          <para>Атрибуты элемента <sgmltag>custom</sgmltag>:</para>
          <informaltable frame="none" pgwide="0" align="left">
            <tgroup cols="4" colsep="1" rowsep="1" align="left"><colspec colname="c1"/><colspec colname="c2"/><colspec colname="c3"/><colspec colname="c4"/>c <tbody>
                <row><entry align="left">
                    <link linkend="caption_filter_custom_attr">caption</link>
                  </entry>editable<entry align="left">operatorType</entry><entry align="left">
                    <link linkend="paramWhere_filter_attr">paramWhere</link>
                  </entry></row>
                <row>
                  <entry>
                    <link linkend="join_filter_attr">join</link>
                  </entry>
                  <entry align="left">
                    <link linkend="paramClass_filter_attr">paramClass</link>
                  </entry>
                </row>
                <row>
                  <entry align="left">
                    <link linkend="name_filter_custom_attr">name</link>
                  </entry>
                  <entry align="left">
                    <link linkend="paramView_filter_attr">paramView</link>
                  </entry>
                </row>
              </tbody></tgroup>
          </informaltable>
        </section>
      </section>
      <section id="gui_layouts">
        <title>Контейнеры</title>
        <para><link linkend="gui_BoxLayout">BoxLayout</link></para>
        <para><link linkend="gui_ButtonsPanel">ButtonsPanel</link></para>
        <para><link linkend="gui_GridLayout">GridLayout</link></para>
        <para><link linkend="gui_ScrollBoxLayout">ScrollBoxLayout</link></para>
        <para><link linkend="gui_SplitPanel">SplitPanel</link></para>
        <para><link linkend="gui_GroupBoxLayout">GroupBoxLayout</link></para>
        <para><link linkend="gui_Tabsheet">Tabsheet</link></para>
        <para><link linkend="gui_IFrame">IFrame</link></para>
        <section id="gui_BoxLayout">
          <title>BoxLayout</title>
          <para><code>BoxLayout</code> представляет собой контейнер с последовательным размещением компонентов.</para>
          <para>Существует 3 типа <code>BoxLayout</code>, определяемых именем XML-элемента:</para>
          <itemizedlist>
            <listitem>
              <para><sgmltag>hbox</sgmltag> − горизонтальное расположение компонентов</para>
              <figure>
                <title/>
                <mediaobject>
                  <imageobject>
                    <imagedata align="center" fileref="img/gui_hbox.png"/>
                  </imageobject>
                </mediaobject>
              </figure>
              <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/section_gui/box/hbox.txt" encoding="UTF-8" parse="text"/></programlisting>
            </listitem>
            <listitem>
              <para><sgmltag>vbox</sgmltag> − вертикальное расположение компонентов. <sgmltag>vbox</sgmltag> имеет 100% ширину по умолчанию</para>
              <figure>
                <title/>
                <mediaobject>
                  <imageobject>
                    <imagedata contentwidth="182" contentdepth="245" align="center" fileref="img/gui_vbox.png"/>
                  </imageobject>
                </mediaobject>
              </figure>
              <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/section_gui/box/vbox.txt" encoding="UTF-8" parse="text"/></programlisting>
            </listitem>
            <listitem>
              <para><sgmltag>flowbox</sgmltag> − горизонтальное расположение компонентов с переносом вниз. При недостатке места по горизонтали непомещающиеся компоненты будут перенесены &quot;на следующую строку&quot; (поведение аналогично <application>Swing</application> <code>FlowLayout</code>)</para>
              <figure>
                <title/>
                <mediaobject>
                  <imageobject>
                    <imagedata align="center" fileref="img/gui_flowbox.png"/>
                  </imageobject>
                </mediaobject>
              </figure>
              <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/section_gui/box/flowbox.txt" encoding="UTF-8" parse="text"/></programlisting>
            </listitem>
          </itemizedlist>
          <para>Могут быть использованы следующие XML-атрибуты:</para>
          <informaltable frame="none" pgwide="0" align="left">
            <tgroup cols="4" colsep="1" rowsep="1" align="left"><colspec colname="c1"/><colspec colname="c2"/><colspec colname="c3"/><colspec colname="c4"/>c <tbody>
                <row><entry align="left">
                    <link linkend="attr_align">align</link>
                  </entry>editable<entry align="left">
                    <link linkend="attr_id">id</link>
                  </entry><entry>
                    <link linkend="attr_stylename">stylename</link>
                  </entry></row>
                <row>
                  <entry>
                    <link linkend="attr_expand">expand</link>
                  </entry>
                  <entry align="left">
                    <link linkend="attr_margin">margin</link>
                  </entry>
                  <entry>
                    <link linkend="attr_visible">visible</link>
                  </entry>
                </row>
                <row>
                  <entry align="left">
                    <link linkend="attr_height">height</link>
                  </entry>
                  <entry>
                    <link linkend="attr_spacing">spacing</link>
                  </entry>
                  <entry>
                    <link linkend="attr_width">width</link>
                  </entry>
                </row>
              </tbody></tgroup>
          </informaltable>
        </section>
        <section id="gui_ButtonsPanel">
          <title>ButtonsPanel</title>
          <para>Компонент, унифицирующий использование и размещение кнопок для управления данными в таблице.</para>
          <figure>
            <title/>
            <mediaobject>
              <imageobject>
                <imagedata contentwidth="272" align="center" fileref="img/gui_buttonsPanel.png"/>
              </imageobject>
            </mediaobject>
          </figure>
          <para>XML-имя компонента: <sgmltag>buttonsPanel</sgmltag>.</para>
          <para>Для создания панели с кнопками нужно определить ее описание в <glossterm linkend="screen_xml_glossentry">xml-дескрипторе</glossterm>.</para>
          <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/section_gui/buttonsPanel/buttonsPanel.txt" encoding="UTF-8" parse="text"/></programlisting>
          <para>Атрибут <sgmltag id="attr_alwaysVisible">alwaysVisible</sgmltag> служит для управления видимостью панели с кнопками при открытии окна списка в режиме поиска (например, при открытии окна списка из компонента <link linkend="gui_PickerField">PickerField</link>). Если значение атрибута равно <literal>true</literal>, то панель с кнопками не скрывается. По умолчанию значение атрибута равно <literal>false</literal>.</para>
          <para>Элементами панели с кнопками являются элементы <link linkend="gui_Button">button</link>.</para>
          <para>Атрибуты <sgmltag>buttonsPanel</sgmltag>:</para>
          <informaltable frame="none" pgwide="0" align="left">
            <tgroup cols="4" colsep="1" rowsep="1" align="left"><colspec colname="c1"/><colspec colname="c2"/><colspec colname="c3"/><colspec colname="c4"/>c <tbody>
                <row>
                  <entry align="left">
                    <link linkend="attr_align">align</link>
                  </entry>
                  <entry align="left">
                    <link linkend="attr_id">id</link>
                  </entry>
                </row>
                <row>
                  <entry>
                    <link linkend="attr_alwaysVisible">alwaysVisible</link>
                  </entry>
                  <entry align="left">
                    <link linkend="attr_stylename">styleName</link>
                  </entry>
                </row>
                <row>
                  <entry align="left">
                    <link linkend="attr_expand">expand</link>
                  </entry>
                  <entry align="left">
                    <link linkend="attr_visible">visible</link>
                  </entry>
                </row>
                <row>
                  <entry align="left">
                    <link linkend="attr_height">height</link>
                  </entry>
                  <entry align="left">
                    <link linkend="attr_width">width</link>
                  </entry>
                </row>
              </tbody></tgroup>
          </informaltable>
        </section>
        <section id="gui_GridLayout">
          <title>GridLayout</title>
          <para>Контейнер, располагающий компоненты по сетке.</para>
          <figure>
            <title/>
            <mediaobject>
              <imageobject>
                <imagedata align="center" fileref="img/gui_gridlayout.png"/>
              </imageobject>
            </mediaobject>
          </figure>
          <para>XML-имя компонента: <sgmltag>grid</sgmltag>.</para>
          <para>Для создания контейнера с табличным расположением нужно определить его описание в <glossterm linkend="screen_xml_glossentry">xml-дескрипторе</glossterm>.</para>
          <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/section_gui/grid/grid.txt" encoding="UTF-8" parse="text"/></programlisting>
          <warning>
            <para>Обязательными вложенными элементами являются элементы <sgmltag>columns</sgmltag> и <sgmltag>rows</sgmltag>. </para>
          </warning>
          <para><sgmltag id="attr_layout_rows">rows</sgmltag> − обязательный элемент, содержит последовательность строк (<sgmltag>row</sgmltag>). Хотя бы один элемент строки является обязательным.</para>
          <para><sgmltag id="attr_layout_row">row</sgmltag> − элемент строки, контейнер для содержимого ряда. Состоит из контейнеров или  компонентов.</para>
          <para><sgmltag id="attr_grid_flex_row">flex</sgmltag> − необязательный атрибут для элемента <sgmltag>row</sgmltag>, задает соотношение высот рядов сетки.</para>
          <para><sgmltag id="attr_grid_columns">columns</sgmltag> − обязательный элемент, содержит последовательность <sgmltag>column</sgmltag>.</para>
          <para>Атрибут <sgmltag id="attr_grid_count">count</sgmltag> − необязательный атрибут, задает количество колонок, если не заданы элементы <sgmltag>column</sgmltag>.</para>
          <para><sgmltag id="attr_grid_column">column</sgmltag> − необязательный элемент для элемента <link linkend="attr_grid_columns">columns</link>, декларирует атрибуты колонок сетки.</para>
          <para>Атрибут <sgmltag id="attr_grid_flex_column">flex</sgmltag> − необязательный атрибут, задает соотношение ширин колонок.</para>
          <para>Атрибуты <sgmltag>grid</sgmltag>:</para>
          <informaltable frame="none" pgwide="0" align="left">
            <tgroup cols="4" colsep="1" rowsep="1" align="left"><colspec colname="c1"/><colspec colname="c2"/><colspec colname="c3"/><colspec colname="c4"/>c <tbody>
                <row><entry align="left">
                    <link linkend="attr_height">height</link>
                  </entry>editable<entry align="left">
                    <link linkend="attr_spacing">spacing</link>
                  </entry><entry>
                    <link linkend="attr_width">width</link>
                  </entry></row>
                <row>
                  <entry>
                    <link linkend="attr_id">id</link>
                  </entry>
                  <entry align="left">
                    <link linkend="attr_stylename">styleName</link>
                  </entry>
                </row>
                <row>
                  <entry align="left">
                    <link linkend="attr_margin">margin</link>
                  </entry>
                  <entry>
                    <link linkend="attr_visible">visible</link>
                  </entry>
                </row>
              </tbody></tgroup>
          </informaltable>
          <para>Элементы <sgmltag>grid</sgmltag>:</para>
          <informaltable frame="none" pgwide="0" align="left">
            <tgroup cols="4" colsep="1" rowsep="1" align="left"><colspec colname="c1"/><colspec colname="c2"/><colspec colname="c3"/><colspec colname="c4"/>c <tbody>
                <row><entry align="left">
                    <link linkend="attr_grid_columns">columns</link>
                  </entry>editable</row>
                <row>
                  <entry>
                    <link linkend="attr_layout_rows">rows</link>
                  </entry>
                </row>
              </tbody></tgroup>
          </informaltable>
          <para>Атрибуты <sgmltag>columns</sgmltag>:</para>
          <informaltable frame="none" pgwide="0" align="left">
            <tgroup cols="4" colsep="1" rowsep="1" align="left"><colspec colname="c1"/><colspec colname="c2"/><colspec colname="c3"/><colspec colname="c4"/>c <tbody>
                <row><entry align="left">
                    <link linkend="attr_grid_count">count</link>
                  </entry>editable</row>
              </tbody></tgroup>
          </informaltable>
          <para>Атрибуты <sgmltag>row</sgmltag>:</para>
          <informaltable frame="none" pgwide="0" align="left">
            <tgroup cols="4" colsep="1" rowsep="1" align="left"><colspec colname="c1"/><colspec colname="c2"/><colspec colname="c3"/><colspec colname="c4"/>c <tbody>
                <row><entry align="left">
                    <link linkend="attr_align">align</link>
                  </entry>editable</row>
                <row>
                  <entry>
                    <link linkend="attr_grid_flex_row">flex</link>
                  </entry>
                </row>
                <row>
                  <entry>
                    <link linkend="attr_spacing">spacing</link>
                  </entry>
                </row>
                <row>
                  <entry>
                    <link linkend="attr_visible">visible</link>
                  </entry>
                </row>
              </tbody></tgroup>
          </informaltable>
        </section>
        <section id="gui_ScrollBoxLayout">
          <title>ScrollBoxLayout</title>
          <para><code>ScrollBoxLayout</code> − контейнер, который позволяет прокручивать свое содержимое.</para>
          <figure>
            <title/>
            <mediaobject>
              <imageobject>
                <imagedata align="center" fileref="img/gui_scrollBox.png"/>
              </imageobject>
            </mediaobject>
          </figure>
          <para>XML-имя компонента: <sgmltag>scrollBox</sgmltag></para>
          <para>Для создания контейнера с табличным расположением нужно определить его описание в <glossterm linkend="screen_xml_glossentry">xml-дескрипторе</glossterm>.</para>
          <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/section_gui/scrollBox/scrollBox.txt" encoding="UTF-8" parse="text"/></programlisting>
          <para>С помощью атрибута <sgmltag id="attr_scroll_orientation">orientation</sgmltag> можно задавать направление расположения вложенных компонентов − <literal>horizontal</literal> или <literal>vertical</literal>. По умолчанию значением атрибута является <literal>vertical</literal>.</para>
          <warning>
            <para>Вложенные в <sgmltag>scrollBox</sgmltag> компоненты должны иметь фиксированные размеры или размеры по умолчанию. Нельзя устанавливать <code>height=&quot;100%&quot;</code> или <code>width=&quot;100%&quot;</code>.</para>
          </warning>
          <para>Атрибуты <sgmltag>scrollBox</sgmltag>:</para>
          <informaltable frame="none" pgwide="0" align="left">
            <tgroup cols="4" colsep="1" rowsep="1" align="left"><colspec colname="c1"/><colspec colname="c2"/><colspec colname="c3"/><colspec colname="c4"/>c <tbody>
                <row><entry align="left">
                    <link linkend="attr_align">align</link>
                  </entry><entry>
                    <link linkend="attr_scroll_orientation">orientation</link>
                  </entry>editable</row>
                <row>
                  <entry>
                    <link linkend="attr_height">height</link>
                  </entry>
                  <entry>
                    <link linkend="attr_spacing">spacing</link>
                  </entry>
                </row>
                <row>
                  <entry>
                    <link linkend="attr_id">id</link>
                  </entry>
                  <entry>
                    <link linkend="attr_stylename">stylename</link>
                  </entry>
                </row>
                <row>
                  <entry>
                    <link linkend="attr_margin">margin</link>
                  </entry>
                  <entry>
                    <link linkend="attr_width">width</link>
                  </entry>
                </row>
              </tbody></tgroup>
          </informaltable>
        </section>
        <section id="gui_SplitPanel">
          <title>SplitPanel</title>
          <para>Панель с разделителем (<code>SplitPanel</code>) − контейнер, разбитый на две области, размер которых по одному из направлений (горизонтали либо вертикали) можно менять путем перемещения разделителя. На рисунке показан пример разбивки области окна на три панели. Во внешней панели формируется горизонтальная граница, которая отделяет нижнюю панель от верхней. Верхняя панель разделяется по вертикали.</para>
          <figure>
            <title/>
            <mediaobject>
              <imageobject>
                <imagedata align="center" fileref="img/gui_splitPanel.png"/>
              </imageobject>
            </mediaobject>
          </figure>
          <para>XML-имя компонента: <sgmltag>split</sgmltag>.</para>
          <para>Для создания панели с разделителем нужно определить ее описание в <glossterm linkend="screen_xml_glossentry">xml-дескрипторе</glossterm>.</para>
          <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/section_gui/split/split.txt" encoding="UTF-8" parse="text"/></programlisting>
          <para>При создании панели с разделителем нужно указать ориентацию разделителя с помощью атрибута <sgmltag id="attr_layout_orientation">orientation</sgmltag>. По умолчанию значение атрибута равно <literal>vertical</literal>.</para>
          <para id="attr_layout_pos"><sgmltag>pos</sgmltag> − необязательный атрибут, определяет процентное соотношение областей. Например, <code>pos=&quot;30%&quot;</code> означает соотношение областей 30/70. По умолчанию соотношение областей составляет 50/50.</para>
          <warning>
            <para>Обязательными вложенными элементами являются два контейнера или компонента.</para>
          </warning>
          <para>Атрибуты <sgmltag>split</sgmltag>:</para>
          <informaltable frame="none" pgwide="0" align="left">
            <tgroup cols="4" colsep="1" rowsep="1" align="left"><colspec colname="c1"/><colspec colname="c2"/><colspec colname="c3"/><colspec colname="c4"/>c <tbody>
                <row><entry align="left">
                    <link linkend="attr_id">id</link>
                  </entry>editable<entry align="left">
                    <link linkend="attr_layout_pos">pos</link>
                  </entry></row>
                <row>
                  <entry>
                    <link linkend="attr_height">height</link>
                  </entry>
                  <entry align="left">
                    <link linkend="attr_width">width</link>
                  </entry>
                </row>
                <row>
                  <entry align="left">
                    <link linkend="attr_layout_orientation">orientation</link>
                  </entry>
                </row>
              </tbody></tgroup>
          </informaltable>
        </section>
        <section id="gui_GroupBoxLayout">
          <title>GroupBox</title>
          <para>Контейнер, позволяющий выделить рамкой группу объектов, задать им общий заголовок и описание. Кроме того, он умеет сворачивать свое содержимое.</para>
          <figure>
            <title/>
            <mediaobject>
              <imageobject>
                <imagedata contentwidth="188" contentdepth="270" align="center" fileref="img/gui_groupBox.png"/>
              </imageobject>
            </mediaobject>
          </figure>
          <para>XML-имя компонента: <sgmltag>groupBox</sgmltag>.</para>
          <para>Для создания контейнера с названием и рамкой нужно определить его описание в <glossterm linkend="screen_xml_glossentry">xml-дескрипторе</glossterm>.</para>
          <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/section_gui/groupBox/groupBox.txt" encoding="UTF-8" parse="text"/></programlisting>
          <para>Атрибут <sgmltag id="attr_group_orientation">orientation</sgmltag>  задает направление расположения вложенных компонентов − <literal>horizontal</literal> или <literal>vertical</literal>. По умолчанию значением атрибута является <literal>vertical</literal>.</para>
          <para><sgmltag id="attr_group_collapsable">collapsable</sgmltag> − необязательный атрибут, в значении <literal>true</literal> компонент может сворачивать свое содержимое. В верхнем нижнем углу контейнера появляется значок <inlinemediaobject>
              <imageobject>
                <imagedata fileref="img/gui_groupBox_minus.png"/>
              </imageobject>
            </inlinemediaobject>/<inlinemediaobject>
              <imageobject>
                <imagedata fileref="img/gui_groupBox_plus.png"/>
              </imageobject>
            </inlinemediaobject>.</para>
          <para><sgmltag id="attr_group_collapsed">collapsed</sgmltag> − необязательный атрибут, в значении <literal>true</literal> компонент будет свернут по умолчанию.</para>
          <figure>
            <title/>
            <mediaobject>
              <imageobject>
                <imagedata contentwidth="80%" align="center" fileref="img/gui_groupBox_collapsed.png"/>
              </imageobject>
            </mediaobject>
          </figure>
          <para>Атрибуты <sgmltag>groupBox</sgmltag>:</para>
          <informaltable frame="none" pgwide="0" align="left">
            <tgroup cols="4" colsep="1" rowsep="1" align="left"><colspec colname="c1"/><colspec colname="c2"/><colspec colname="c3"/><colspec colname="c4"/>c <tbody>
                <row><entry align="left">
                    <link linkend="attr_caption">caption</link>
                  </entry>editable<entry align="left">
                    <link linkend="attr_description">description</link>
                  </entry><entry>
                    <link linkend="attr_id">id</link>
                  </entry><entry>
                    <link linkend="attr_stylename">stylename</link>
                  </entry></row>
                <row>
                  <entry>
                    <link linkend="attr_group_collapsable">collapsable</link>
                  </entry>
                  <entry align="left">
                    <link linkend="attr_expand">expand</link>
                  </entry>
                  <entry>
                    <link linkend="attr_orientation">orientation</link>
                  </entry>
                  <entry>
                    <link linkend="attr_width">width</link>
                  </entry>
                </row>
                <row>
                  <entry align="left">
                    <link linkend="attr_group_collapsed">collapsed</link>
                  </entry>
                  <entry>
                    <link linkend="attr_height">height</link>
                  </entry>
                  <entry>
                    <link linkend="attr_spacing">spacing</link>
                  </entry>
                </row>
              </tbody></tgroup>
          </informaltable>
        </section>
        <section id="gui_Tabsheet">
          <title>Tabsheet</title>
          <para>Панель с вкладками (<code>Tabsheet</code>) позволяет выводить на экран вкладки (<sgmltag>tabs</sgmltag>) − панели, имеющие название. При нажатии пользователем на названии вкладки <code>Tabsheet</code> выводит на экран соответствующие выбранной вкладке элементы пользовательского интерфейса.</para>
          <figure>
            <title/>
            <mediaobject>
              <imageobject>
                <imagedata align="center" fileref="img/gui_tabsheet.png"/>
              </imageobject>
            </mediaobject>
          </figure>
          <para>XML-имя компонента: <sgmltag>tabsheet</sgmltag>.</para>
          <para>Для создания панели с вкладками нужно определить ее описание в <glossterm linkend="screen_xml_glossentry">xml-дескрипторе</glossterm>.</para>
          <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/section_gui/tabsheet/tabsheet.txt" encoding="UTF-8" parse="text"/></programlisting>
          <para>Как видно, компонент <sgmltag>tabsheet</sgmltag> состоит из элементов <sgmltag>tab</sgmltag>.</para>
          <para>Элемент <sgmltag>tab</sgmltag> может содержать как другой <link linkend="gui_layouts">контейнер</link>, так и <link linkend="gui_components">компонент</link>.</para>
          <para>Атрибут <link linkend="attr_id" id="attr_tabsheet_id">id</link> является идентификатором вкладки. Следует отметить, что вкладка не является компонентом, и данный идентификатор используется только в рамках <code>Tabsheet</code>.</para>
          <para>Атрибут <sgmltag id="attr_tabsheet_lazy">lazy</sgmltag> задает отложенную загрузку содержимого вкладки. При открытии экрана <sgmltag>lazy</sgmltag>-вкладки не загружают свое содержимое, что приводит к созданию меньшего количества компонентов в памяти и, как следствие, к меньшему количеству запросов к БД. Компоненты вкладки загружаются только в тот момент, когда пользователь выбирает данную вкладку. Значение по умолчанию равно <literal>false</literal>. Если компоненты <sgmltag>lazy</sgmltag>-вкладки требуют инициализации, проводить ее нужно не напрямую в методе <code>init()</code> <glossterm linkend="screen_controller_glossentry">контроллера</glossterm>, а в слушателе на переключение вкладок <code>Tabsheet.TabChangeListener.</code></para>
          <para>В десктоп-приложении есть возможность открывать вкладки в новом окне. Для этого нужно атрибуту <sgmltag id="attr_detachable">detachable</sgmltag> присвоить значение <literal>true</literal>.</para>
          <figure>
            <title>Вид отделяемой вкладки</title>
            <mediaobject>
              <imageobject>
                <imagedata contentwidth="80%" align="center" fileref="img/gui_tabsheetDetachable.png"/>
              </imageobject>
            </mediaobject>
          </figure>
          <para>Атрибуты <sgmltag>tabsheet</sgmltag>:</para>
          <informaltable frame="none" pgwide="0" align="left">
            <tgroup cols="4" colsep="1" rowsep="1" align="left"><colspec colname="c1"/><colspec colname="c2"/><colspec colname="c3"/><colspec colname="c4"/>c <tbody>
                <row><entry align="left">
                    <link linkend="attr_height">height</link>
                  </entry>editable<entry align="left">
                    <link linkend="attr_visible">visible</link>
                  </entry></row>
                <row>
                  <entry>
                    <link linkend="attr_id">id</link>
                  </entry>
                  <entry align="left">
                    <link linkend="attr_width">width</link>
                  </entry>
                </row>
                <row>
                  <entry align="left">
                    <link linkend="attr_stylename">stylename</link>
                  </entry>
                </row>
              </tbody></tgroup>
          </informaltable>
          <para>Атрибуты элемента  <sgmltag>tab</sgmltag>:</para>
          <informaltable frame="none" pgwide="0" align="left">
            <tgroup cols="4" colsep="1" rowsep="1" align="left"><colspec colname="c1"/><colspec colname="c2"/><colspec colname="c3"/><colspec colname="c4"/>c <tbody>
                <row><entry align="left">
                    <link linkend="attr_caption">caption</link>
                  </entry>editable<entry align="left">
                    <link linkend="attr_expand">expand</link>
                  </entry><entry>
                    <link>margin</link>
                  </entry></row>
                <row>
                  <entry>
                    <link linkend="attr_detachable">detachable</link>
                  </entry>
                  <entry align="left">
                    <link linkend="attr_tabsheet_id">id</link>
                  </entry>
                  <entry>
                    <link linkend="attr_spacing">spacing</link>
                  </entry>
                </row>
                <row>
                  <entry align="left">
                    <link linkend="attr_enable">enable</link>
                  </entry>
                  <entry>
                    <link linkend="attr_tabsheet_lazy">lazy</link>
                  </entry>
                </row>
              </tbody></tgroup>
          </informaltable>
        </section>
        <section id="gui_IFrame">
          <title>IFrame</title>
          <para>Фреймы предназначены для декомпозиции и многократного использования частей экранов.</para>
          <para>Фрейм включается в экран с помощью элемента <sgmltag>iframe</sgmltag>.</para>
          <para>Для включения фрейма в экран необходимо в <glossterm linkend="screen_xml_glossentry">xml-дескрипторе</glossterm> определить его описание:</para>
          <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/section_gui/iframe/iframe.txt" encoding="UTF-8" parse="text"/></programlisting>
          <para>Атрибут <sgmltag id="attr_frame_src">src</sgmltag> − путь к <glossterm linkend="screen_xml_glossentry">XML-дескриптору</glossterm> фрейма. </para>
          <para>Если фрейм зарегистрирован в файле <filename>screens.xml</filename>, то можно указать идентификатор фрейма в атрибуте <sgmltag id="attr_frame_screen">screen</sgmltag>.</para>
          <warning>
            <para>Обязательно должен быть указан один из атрибутов: <link linkend="attr_frame_src">src</link> или <link linkend="attr_frame_screen">screen</link>.</para>
          </warning>
          <para>Дескриптор фрейма идентичен <glossterm linkend="screen_xml_glossentry">xml-дескриптору</glossterm> экрана и может содержать собственный <sgmltag>metadataContext</sgmltag>, <sgmltag>dsContext</sgmltag>, <sgmltag>messagesPack</sgmltag>. Кроме того, фрейм может иметь собственный <glossterm linkend="screen_controller_glossentry">контроллер</glossterm>.</para>
          <para>Правила взаимодействия экрана и вложенного в него фрейма:</para>
          <itemizedlist>
            <listitem>
              <para>Из экрана обращаться к компонентам фрейма можно через точку: <code>frame_id.component_id</code></para>
            </listitem>
            <listitem>
              <para>Из контроллера фрейма получить компонент экрана  можно обычным вызовом <code>getComponent(component_id)</code>, но только в том случае, если компонент с таким именем не объявлен в самом фрейме. То есть компоненты фрейма маскируют компоненты экрана.</para>
            </listitem>
            <listitem>
              <para>Из фрейма получить <link linkend="datasources">источник данных</link> экрана можно простым вызовом <code>getDsContext().get(ds_id)</code> либо в запросе <code>ds$ds_id</code>, но только в том случае, если источник данных с таким именем не объявлен в самом фрейме (аналогично компонентам).</para>
            </listitem>
            <listitem>
              <para>Из экрана получить источник данных фрейма можно только через итерацию по <code>getDsContext().getChildren()</code></para>
            </listitem>
          </itemizedlist>
          <para>При коммите экрана вызывается также коммит измененных источников  данных фрейма.</para>
          <para>Атрибуты <sgmltag>iframe</sgmltag>:</para>
          <informaltable frame="none" pgwide="0" align="left">
            <tgroup cols="4" colsep="1" rowsep="1" align="left"><colspec colname="c1"/><colspec colname="c2"/><colspec colname="c3"/><colspec colname="c4"/>c <tbody>
                <row><entry align="left">
                    <link linkend="attr_align">align</link>
                  </entry>editable<entry align="left">
                    <link linkend="attr_frame_screen">screen</link>
                  </entry><entry>
                    <link linkend="attr_visible">visible</link>
                  </entry></row>
                <row>
                  <entry>
                    <link linkend="attr_height">height</link>
                  </entry>
                  <entry align="left">
                    <link linkend="attr_frame_src">src</link>
                  </entry>
                  <entry>
                    <link linkend="attr_width">width</link>
                  </entry>
                </row>
                <row>
                  <entry align="left">
                    <link linkend="attr_id">id</link>
                  </entry>
                  <entry>
                    <link linkend="attr_stylename">stylename</link>
                  </entry>
                </row>
              </tbody></tgroup>
          </informaltable>
        </section>
      </section>
      <section>
        <title>Разное</title>
        <section>
          <title>AccessControl</title>
          <para>Компонент <code>accessControl</code> предназначен для декларативного управления доступом к частям экрана. Он представляет собой контейнер, который никак не отображает себя на экране, а только управляет атрибутами <parameter>visible</parameter> и <parameter>editable</parameter> входящих в него компонентов.</para>
          <para>Состояние управляемых компонентов определяется на основе двух элементов, вложенных в <code>accessControl</code>: <parameter>visible</parameter> и <parameter>editable</parameter>.</para>
          <para>Соответствующее значение принимается либо из скрипта, возвращающего <type>boolean</type>, либо из свойства объекта <code>AccessData</code>, связанного с компонентом (см. ниже).
Скрипт задается либо атрибутом <parameter>script</parameter>, либо in-place в тексте элемента. 
Свойство объекта <code>AccessData</code> задается атрибутом <parameter>property</parameter> и имеет больший приоритет, чем скрипт.</para>
          <warning>
            <para>В случае <parameter>visible=false</parameter> вложенные компоненты вообще не создаются, поэтому будьте осторожны при обращении к ним из контроллера.</para>
          </warning>
          <para>
                <programlisting>&lt;tab id=&quot;mainTab&quot; caption=&quot;msg://mainTab&quot;&gt;
            &lt;accessControl data=&quot;workflow.client.web.ui.card.CardAccessData&quot; param=&quot;accessData&quot;&gt;
            &lt;editable property=&quot;notStarted&quot;/&gt;

            &lt;vbox margin=&quot;true&quot; expand=&quot;attachmentsPane&quot;&gt;
                ...</programlisting>
            </para>
          <section>
            <title>Объект AccessData</title>
            <para>В связи с тем, что одни и те же параметры доступа могут многократно потребоваться в разных частях экрана и в коде контроллера, компонент <code>accessControl</code> может быть связан с объектом Java|Groovy, вычисляющим и хранящим эти параметры. Т.о. дорогостоящая инициализация параметра доступа производится только один раз, и затем доступна на протяжении жизни экрана.</para>
            <para>Для связи компонента с данными доступа создайте класс, унаследованный от <code>AbstractAccessData</code>, и задайте следующие атрибуты компонента <code>accessControl</code>:</para>
            <itemizedlist>
              <listitem>
                <para><emphasis role="bold">data</emphasis> − имя класса <code>AccessData</code></para>
              </listitem>
              <listitem>
                <para><emphasis role="bold">param</emphasis> − имя параметра экрана, в котором будет сохранен объект <code>AccessData</code></para>
              </listitem>
            </itemizedlist>
            <para>В момент создания экрана загрузчик компонента <code>accessControl</code> проверяет наличие экземпляра <code>AccessData</code> в указанном параметре, и если его там нет, создает новый экземпляр.</para>
            <para>В дальнейшем в коде контроллера можно получить экземпляр <code>AccessData</code> из параметров экрана, например:</para>
            <programlisting>AbstractWfAccessData accessData = getContext().getParamValue(&quot;accessData&quot;);</programlisting>
            <para>При создании класса <code>AccessData</code> следует иметь в виду, что в параметры экрана-редактора всегда передается параметр <parameter>param$item</parameter>, содержащий текущий редактируемый экземпляр сущности. Однако этот экземпляр загружен по view вызывающего экрана, а не по view редактора.</para>
            <para>Свойства <code>AccessData</code>, на которые можно ссылаться из компонента <code>accessControl</code>, должны быть реализованы по стандарту JavaBeans: методами с сигнатурой boolean <methodname>getXxx()</methodname></para>
            <para>
            <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/section_gui/CardAccessData.java" encoding="UTF-8" parse="text"/></programlisting>
            </para>
          </section>
        </section>
        <section id="gui_Action">
          <title>Action</title>
          <para><code>Action</code> − интерфейс, абстрагирующий действие от визуального компонента.</para>
          <para>Визуальный компонент, содержащий одно действие, реализует интерфейс <interface>Component.ActionOwner</interface>. Это, например, <code>Button</code>.</para>
          <para>Визуальный компонент, содержащий несколько действий, реализует интерфейс <interface>Component.ActionsHolder</interface>. Это <code>Window</code>, <code>IFrame</code>, <code>Table</code> и ее наследники, <code>Tree</code>, <code>PopupButton</code>, <code>PickerField</code>, <code>LookupPickerField</code>.</para>
          <section>
            <title>Декларативное создание действий</title>
            <para>В дескрипторе экрана может быть задан набор действий для некоторого <code>ActionsHolder</code>.</para>
            <itemizedlist>
              <title>Доступные атрибуты действия</title>
              <listitem>
                <para><parameter>id</parameter> − идентификатор, должен быть уникален в рамках данного <code>ActionsHolder</code></para>
              </listitem>
              <listitem>
                <para>caption</para>
              </listitem>
              <listitem>
                <para>icon</para>
              </listitem>
              <listitem>
                <para>enable</para>
              </listitem>
              <listitem>
                <para>visible − в отличие от компонентов Groovy-выражения не поддерживаются</para>
              </listitem>
              <listitem>
                <para><parameter>invoke</parameter> − имя вызываемого метода контроллера. Метод должен быть <code>public</code>, не возвращать результата, и либо не иметь аргументов, либо иметь один аргумент типа <code>Component</code>. Если метод имеет аргумент <code>Component</code>, то при вызове в него будет передан экземпляр визуального компонента, запустившего данное действие.</para>
              </listitem>
              <listitem>
                <para><parameter>shortcut</parameter> − доступен только для действий, задаваемых в окне или фрейме. Задает комбинацию клавиш для вызова.</para>
              </listitem>
            </itemizedlist>
            <para>Примеры:</para>
            <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/section_gui/action/example1.txt" encoding="UTF-8" parse="text"/></programlisting>
            <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/section_gui/action/example2.txt" encoding="UTF-8" parse="text"/></programlisting>
            <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/section_gui/action/example3.txt" encoding="UTF-8" parse="text"/></programlisting>
          </section>
          <section>
            <title>Использование в кнопках</title>
            <para>Действия, заданные для некоторого <code>ActionsHolder</code>, могут быть использованы в компонентах <code>ActionOwner</code>, например в <code>Button</code>. Для этого достаточно указать полное имя действия в соотв. атрибуте. Например:</para>
            <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/section_gui/action/example4.txt" encoding="UTF-8" parse="text"/></programlisting>
            <para>При этом Button возьмет значения атрибутов caption, icon, enable, visible из назначенного действия.</para>
          </section>
          <section>
            <title>Стандартные действия</title>
            <para>Для наследников ListComponent (это Table и Tree) существует набор стандартных действий, определяемых перечислением ListActionType. Для таких действий не нужно определять никаких атрибутов, кроме идентификатора. Например:</para>
            <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/section_gui/action/example5.txt" encoding="UTF-8" parse="text"/></programlisting>
            <para>Для компонентов PickerField и LookupPickerField существует набор стандартных действий, определяемых перечислением PickerField.ActionType. Для таких действий не нужно определять никаких атрибутов, кроме идентификатора. Например:</para>
            <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/section_gui/action/example6.txt" encoding="UTF-8" parse="text"/></programlisting>
          </section>
          <section>
            <title>Программное создание и управление действиями</title>
            <para>Базовым классом реализации действий является <code>AbstractAction</code>. Пример использования:</para>
            <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/section_gui/action/example7.txt" encoding="UTF-8" parse="text"/></programlisting>
            <para>При выполнении метода <methodname>addAction()</methodname> реализация <code>ActionsHolder</code> проверяет, нет ли уже в нем действия с таким же идентификатором. Если есть, то имеющееся действие будет заменено на новое переданное. Поэтому можно безопасно, например, декларировать стандартное действие в дескрипторе экрана, а затем в контроллере создать новое с переопределенными методами, и добавить в <code>ActionsHolder</code>.</para>
            <para>Кроме создания наследников <code>AbstractAction</code> или стандартных действий, возможно конфигурирование декларативно созданных действий путем получения их в контроллере и установки атрибутов. Например:</para>
            <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/section_gui/action/example8.txt" encoding="UTF-8" parse="text"/></programlisting>
            <para>При этом во всех визуальных компонентах, связанных с данным действием, значение соответствующего атрибута также изменится.</para>
          </section>
        </section>
        <section id="gui_Table_aggregation">
          <title>Aggregation</title>
          <para>Механизм задания агрегаций для колонок в Table.</para>
          <itemizedlist>
            <title>Атрибуты aggregation</title>
            <listitem>
              <para>type −  функция агрегирования:</para>
              <itemizedlist>
                <listitem>
                  <para>SUM − сумма</para>
                </listitem>
                <listitem>
                  <para>AVG − среднее значение</para>
                </listitem>
                <listitem>
                  <para>COUNT − количество</para>
                </listitem>
                <listitem>
                  <para>MIN − минимальное значение</para>
                </listitem>
                <listitem>
                  <para>MAX − максимальное значение</para>
                </listitem>
              </itemizedlist>
            </listitem>
            <listitem>
              <para>formatter − задает формат вывода агрегированного значения.</para>
            </listitem>
          </itemizedlist>
          <para>Логика применения форматирования к агрегированному значению следующая: если в элементе <code>aggregation</code> указан <parameter>formatter</parameter>, то применяется он; иначе применяется <parameter>formatter</parameter> соответствующего агрегированному значению <parameter>datatype</parameter>.</para>
          <para>
          <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/section_gui/aggregation/example1.txt" encoding="UTF-8" parse="text"/></programlisting>
          </para>
        </section>
        <section id="gui_Table_presentations">
          <title>Presentation </title>
        </section>
        <section id="gui_themes">
          <title>Создание темы приложения</title>
        </section>
      </section>
      <section>
        <title>Атрибуты</title>
        <variablelist>
          <varlistentry>
            <term>align</term>
            <listitem>
              <para>Атрибут, задающий расположение компонента относительно вышестоящего контейнера.</para>
              <para>Возможные значения:</para>
              <itemizedlist>
                <listitem>
                  <para>TOP_RIGHT</para>
                </listitem>
                <listitem>
                  <para>TOP_LEFT</para>
                </listitem>
                <listitem>
                  <para>TOP_CENTER</para>
                </listitem>
                <listitem>
                  <para>MIDDLE_RIGHT</para>
                </listitem>
                <listitem>
                  <para>MIDDLE_LEFT</para>
                </listitem>
                <listitem>
                  <para>MIDDLE_CENTER</para>
                </listitem>
                <listitem>
                  <para>BOTTOM_RIGHT</para>
                </listitem>
                <listitem>
                  <para>BOTTOM_LEFT</para>
                </listitem>
                <listitem>
                  <para id="attr_align">BOTTOM_CENTER</para>
                </listitem>
              </itemizedlist>
            </listitem>
          </varlistentry>
          <varlistentry id="attr_caption">
            <term>caption</term>
            <listitem>
              <para>XML-атрибут, устанавливающий заголовок для визуального компонента.</para>
              <para>Значением атрибута должна быть либо собственно строка сообщения, либо ключ в пакете сообщений. В случае ключа значение должно начинаться с префикса msg://</para>
              <para>Способы задания ключа:</para>
              <itemizedlist>
                <listitem>
                  <para>Короткий ключ − при этом сообщение ищется в пакете, заданном для данного экрана:</para>
                  <programlisting>caption=&quot;msg://infoFieldCaption&quot;</programlisting>
                </listitem>
                <listitem>
                  <para>Полный ключ, с заданием пакета:</para>
                  <programlisting>caption=&quot;msg://com.haulmont.refapp.gui.app/infoFieldCaption&quot;</programlisting>
                </listitem>
              </itemizedlist>
            </listitem>
          </varlistentry>
          <varlistentry id="attr_captionProperty">
            <term>captionProperty</term>
            <listitem>
              <para>XML-атрибут визуального компонента, реализующего интерфейс <code>OptionsField</code>.</para>
              <para>Задает имя атрибута сущности, которую содержит <link linkend="datasources">источник данных</link>, используемый для формирования списка опций (<link linkend="attr_optionsDatasource">optionsDatasource</link>).</para>
              <para>Если данный атрибут не задан, список опций будет содержать Instance Name экземпляров, содержащихся в списке.</para>
            </listitem>
          </varlistentry>
          <varlistentry id="attr_clickAction">
            <term>clickAction</term>
            <listitem>
              <para>Атрибут содержит описание действия, которое будет выполнено при клике в ячейке или в поле (для компонента <link linkend="gui_FieldGroup">FieldGroup</link>). Возможны два типа действий:</para>
              <itemizedlist>
                <listitem>
                  <para><code>open</code> − открывает для <glossterm linkend="entity">сущности</glossterm>, отображаемой в ячейке, экран редактирования с указанным именем, например: <code>clickAction=&quot;open:sec$User.edit&quot;</code>. Имя сущности отображается в виде ссылки:</para>
                  <figure>
                    <title/>
                    <mediaobject>
                      <imageobject>
                        <imagedata contentwidth="40%" align="center" fileref="img/gui_clickAction_open.png"/>
                      </imageobject>
                    </mediaobject>
                  </figure>
                </listitem>
                <listitem>
                  <para><code>invoke</code> − вызывает метод <glossterm linkend="screen_controller_glossentry">контроллера</glossterm> экрана с указанным именем, например: <code>clickAction=&quot;invoke:onClick&quot;</code>. Метод должен иметь единственный параметр типа <type>Object</type>, в который будет передан экземпляр сущности, отображаемой в ячейке.</para>
                </listitem>
              </itemizedlist>
            </listitem>
          </varlistentry>
          <varlistentry id="attr_datasource">
            <term>datasource</term>
            <listitem>
              <para>XML-атрибут компонента, реализующего интерфейс <code>DatasourceComponent</code>.</para>
              <para>Предназначен для задания <link linkend="datasources">источника данных</link> и должен содержать имя источника данных, описанного в секции <parameter>dsContext</parameter> <link linkend="screen_xml_glossentry">дескриптора</link> экрана.</para>
              <para>Атрибут property является обязательным, иначе возникает ошибка java.lang.IllegalStateException: Can&apos;t set assign datasource &apos;sampleDs&apos; for component &apos;labelInfo&apos; due &apos;property&apos; attribute is not defined. </para>
              <para>Смотрите также атрибут property.</para>
            </listitem>
          </varlistentry>
          <varlistentry id="attr_description">
            <term>description</term>
            <listitem>
              <para>Атрибут, задающий текст подсказки для компонента.</para>
            </listitem>
          </varlistentry>
          <varlistentry id="attr_editable">
            <term>editable</term>
            <listitem>
              <para>XML-атрибут, указывающий на возможность редактирования содержимого (не путать с <link linkend="attr_enable">enable</link>).</para>
              <para>Возможные значения − true, false. По умолчанию true.</para>
            </listitem>
            <listitem>На возможность редактирования содержимого для компонента, связанного с данными (наследника DatasourceComponent или List), влияет также Security. Если по данным security данный компонент должен быть недоступен для редактирования, значение атрибута editable не принимается во внимание.</listitem>
          </varlistentry>
          <varlistentry id="attr_enable">
            <term>enable</term>
            <listitem>
              <para>Атрибут компонента, устанавливающий его состояние &quot;enabled/disabled&quot; − доступен/недоступен.</para>
              <para>Если компонент недоступен, то он не принимает фокус ввода. Недоступность контейнера приводит к тому, что все его компоненты также становятся недоступными.

Возможные значения − true, false.

По умолчанию у всех компонентов enable = true.</para>
            </listitem>
          </varlistentry>
          <varlistentry id="attr_expand">
            <term>expand</term>
            <listitem>
              <para>Атрибут контейнера для управления его внутренней компоновкой.</para>
              <para>Задает компонент внутри контейнера, который необходимо &quot;развернуть&quot;, т.е. установить ему максимально возможную высоту и ширину.</para>
            </listitem>
          </varlistentry>
          <varlistentry id="attr_height">
            <term>height</term>
            <listitem>
              <para>Атрибут, устанавливающий высоту компонента.</para>
              <para>Может быть задана в пикселях либо в процентах от высоты вышестоящего контейнера. Например: 100px, 100%, 50. Если единица измерения не указана, подразумевается высота в пикселях.</para>
              <para>Простановка значения в % означает, что компонент по высоте займет соответствующую часть пространства, предоставляемого контейнером более высокого уровня.</para>
            </listitem>
          </varlistentry>
          <varlistentry id="attr_icon">
            <term>icon</term>
            <listitem>
              <para>XML-атрибут, устанавливающий пиктограмму для визуального компонента.</para>
              <para>Значением атрибута должен быть путь к файлу пиктограммы относительно каталога темы. Например:</para>
              <programlisting>icon=&quot;icons/create.png&quot;</programlisting>
              <para>Если пиктограмма должна быть выбрана в зависимости от языка пользователя, можно указать путь к ней в пакете сообщений, а в атрибуте icon − ключ сообщения, например:</para>
              <programlisting>icon=&quot;msg://addIcon&quot;</programlisting>
            </listitem>
          </varlistentry>
          <varlistentry id="attr_id">
            <term>id</term>
            <listitem>
              <para>Идентификатор компонента.</para>
              <para>Возможное значение − любой допустимый Java-идентификатор. Рекомендуется использовать только camelСase, например, <code>userGrid</code>, <code>filterPanel</code>.

Может быть указан для любого компонента и должен быть уникальным в пределах экрана.</para>
            </listitem>
          </varlistentry>
          <varlistentry id="attr_margin">
            <term>margin</term>
            <listitem>
              <para>Атрибут margin устанавливает наличие отступа между внешними границами и содержимым контейнера.</para>
              <para>Может иметь 2 вида значений:</para>
              <itemizedlist>
                <listitem>
                  <para>margin=&quot;true&quot; − установить отступ со всех сторон сразу</para>
                </listitem>
                <listitem>
                  <para>margin=&quot;true;false;true;false;&quot; −  установить отступ только сверху и снизу (формат значения &quot;сверху,справа,снизу,слева&quot;)</para>
                </listitem>
              </itemizedlist>
              <para>По умолчанию отступы отсутствуют.</para>
            </listitem>
          </varlistentry>
          <varlistentry id="attr_optionsDatasource">
            <term>optionsDatasource</term>
            <listitem>
              <para>XML-атрибут визуального компонента, реализующего интерфейс <code>OptionsField</code>.</para>
              <para>Задает имя <link linkend="datasources">источника данных</link>, используемого для формирования списка опций.</para>
              <para>Совместно с optionsDatasource может использоваться атрибут <link linkend="attr_captionProperty">captionProperty</link>.</para>
            </listitem>
          </varlistentry>
          <varlistentry id="attr_property">
            <term>property</term>
            <listitem>
              <para>XML-атрибут компонента, реализующего интерфейс <code>DatasourceComponent</code>.</para>
              <para>Предназначен для задания имени атрибута сущности, значение которого будет отображаться/редактироваться данным визуальным компонентом.</para>
              <para>Используется всегда совместно с атрибутом <link linkend="attr_datasource">datasource</link>.</para>
            </listitem>
          </varlistentry>
          <varlistentry id="attr_required">
            <term>required</term>
            <listitem>
              <para>XML-атрибут визуального компонента, реализующего интерфейс Field. Указывает, что в данное поле обязательно должно быть введено значение.</para>
              <para>Возможные значения атрибута − true, false. По умолчанию false.</para>
              <para>Совместно с required может использоваться атрибут requiredMessage.</para>
            </listitem>
          </varlistentry>
          <varlistentry id="attr_requiredMessage">
            <term>requiredMessage</term>
            <listitem>
              <para>XML-атрибут, используемый совместно с атрибутом <link linkend="attr_required">required</link>. Позволяет установить сообщение, выводимое пользователю в случае нарушения требования <link linkend="attr_required">required</link>.</para>
              <para>Атрибут должен содержать ключ сообщения в пакете, например: requiredMessage=&quot;msg://infoTextField.requiredMessage&quot;</para>
            </listitem>
          </varlistentry>
          <varlistentry id="attr_spacing">
            <term>spacing</term>
            <listitem>
              <para>Атрибут spacing устанавливает наличие отступов между компонентами внутри контейнера.</para>
              <para>Возможные значения − true, false.</para>
              <para>По умолчанию отступы отсутствуют.</para>
            </listitem>
          </varlistentry>
          <varlistentry id="attr_stylename">
            <term>stylename</term>
            <listitem>
              <para>Атрибут, задающий имя стиля компонента.</para>
              <para>Для веб-клиента стиль задается в CSS.</para>
            </listitem>
          </varlistentry>
          <varlistentry id="attr_visible">
            <term>visible</term>
            <listitem>
              <para>Атрибут   либо элемент видимости компонента.</para>
              <para>Возможные значения − true, false, либо выражение Groovy с boolean-результатом. Если выражение длинное, имеет смысл использовать не атрибут, а элемент visible внутри текущего компонента − эффект тот же. Если контейнер невидим, не видны и все его компоненты. По умолчанию все компоненты видимы.</para>
            </listitem>
          </varlistentry>
          <varlistentry id="attr_width">
            <term>width</term>
            <listitem>
              <para>Атрибут, устанавливающий ширину компонента.</para>
              <para>Значение может быть задано в пикселях или в процентах от ширины вышестоящего контейнера. Например: 100px, 100%, 50. Если единица измерения не указана, подразумевается ширина в пикселях. Простановка значения в % означает, что компонент по ширине займет соответствующую часть пространства, предоставляемого контейнером более высокого уровня.</para>
            </listitem>
          </varlistentry>
        </variablelist>
      </section>
      <section>
        <title>Элементы</title>
        <variablelist>
          <varlistentry id="element_formatter">
            <term>formatter</term>
            <listitem>
              <para>XML-элемент formatter задает класс, который будет применен для преобразования значения в строку.</para>
              <para>Атрибуты:</para>
              <itemizedlist>
                <listitem>
                  <para>class − имя класса, реализующего интерфейс <code>com.haulmont.cuba.gui.components.Formatter</code></para>
                </listitem>
              </itemizedlist>
            </listitem>
          </varlistentry>
          <varlistentry id="element_validator">
            <term>validator</term>
            <listitem>
              <para>XML-элемент для задания механизма валидации значений, введенных в визуальном компоненте.</para>
              <para>Атрибуты:</para>
              <itemizedlist>
                <listitem>
                  <para>script − путь к скрипту Groovy, осуществляющему валидацию</para>
                </listitem>
                <listitem>
                  <para>class − имя класса Java, реализующего интерфейс <code>Field.Validator</code></para>
                </listitem>
                <listitem>
                  <para>message − сообщение, выводимое пользователю в случае ошибки валидации. Атрибут должен содержать ключ сообщения в пакете, например, message=&quot;msg://infoTextField.validationMsg&quot;</para>
                </listitem>
              </itemizedlist>
              <para>Выбор механизма валидации осуществляется следующим образом:</para>
              <itemizedlist>
                <listitem>
                  <para>Если не указано значение атрибута script, и сам элемент validator не содержит текста выражения Groovy, то в качестве валидатора используется класс, указанный в атрибуте class.</para>
                </listitem>
                <listitem>
                  <para>Если элемент validator содержит текст, то он будет использован как выражение Groovy и выполнен с помощью <link linkend="scripting">Scripting</link>.</para>
                </listitem>
                <listitem>
                  <para>В противном случае с помощью <link linkend="scripting">Scripting</link> будет выполнен скрипт Groovy, указанный в атрибуте script.</para>
                </listitem>
              </itemizedlist>
              <para>В выражение или скрипт Groovy будет передана одна переменная value, содержащая значение, введенное в визуальном компоненте.</para>
              <para>Выражение или скрипт должны вернуть boolean значение: true − valid, false − not valid.</para>
              <para>CUBA уже содержит несколько реализаций наиболее часто используемых валидаторов (см. пакет <package>com.haulmont.cuba.gui.components.validators</package>), которые можно применять в своих проектах:</para>
              <itemizedlist>
                <listitem>
                  <para><code>DateValidator</code></para>
                </listitem>
                <listitem>
                  <para><code>DoubleValidator</code></para>
                </listitem>
                <listitem>
                  <para><code>EmailValidator</code></para>
                </listitem>
                <listitem>
                  <para><code>IntegerValidator</code></para>
                </listitem>
                <listitem>
                  <para><code>LongValidator</code></para>
                </listitem>
                <listitem>
                  <para><code>PatternValidator</code></para>
                </listitem>
                <listitem>
                  <para><code>ScriptValidator</code></para>
                </listitem>
              </itemizedlist>
              <para>Примеры использования:</para>
              <programlisting>&lt;field id=&quot;imei&quot;&gt;
    &lt;validator class=&quot;com.haulmont.cuba.gui.components.validators.PatternValidator&quot;
               pattern=&quot;\d{15}&quot;
               message=&quot;msg://general.imeiValidationFailed&quot;/&gt;
&lt;/field&gt;

&lt;field id=&quot;maxCountOfVisits&quot;&gt;
    &lt;validator class=&quot;com.haulmont.cuba.gui.components.validators.IntegerValidator&quot;/&gt;
&lt;/field&gt;</programlisting>
            </listitem>
          </varlistentry>
        </variablelist>
      </section>
    </section>
    <section id="datasources">
      <title>Источники данных</title>
      <para>Предназначен для реализации связанных с данными компонентов.</para>
      <para>Существуют следующие интерфейсы источников данных:</para>
      <itemizedlist>
        <listitem>
          <para><code>Datasource</code> − предназначен для работы с одним экземпляром сущности.</para>
          <itemizedlist>
            <listitem>
              <para><code>RuntimePropsDatasource</code> − предназначен для работы с динамическими свойствами сущностей.</para>
            </listitem>
          </itemizedlist>
        </listitem>
        <listitem>
          <para><code>CollectionDatasource</code> − предназначен для работы с коллекцией сущностей</para>
          <itemizedlist>
            <listitem>
              <para><code>HierarchicalDatasource</code> − предназначен для работы с компонентами <code>Tree</code>, <code>TreeTable</code>.</para>
            </listitem>
            <listitem>
              <para><code>GroupDatasource</code> − предназначен для работы с компонентом <code>GroupTable</code>.</para>
            </listitem>
          </itemizedlist>
        </listitem>
      </itemizedlist>
      <para>Как правило, источники данных объявляются декларативно в секции <parameter>dsContext</parameter> <glossterm linkend="screen_xml_glossentry">дескриптора экрана</glossterm>.</para>
    </section>
    <section id="background_tasks">
      <title>Фоновые задачи</title>
      <para><emphasis role="bold">Предназначение</emphasis></para>
      <para>Фоновые задачи используются на клиентском уровне для выполнения длительных процессов без заморозки пользовательского интерфейса. </para>
      <para>В платформе реализован объект <code>BackgroundWorker</code>, который предоставляется окружением и управляет фоновыми задачами</para>
      <programlisting>BackgroundWorker backgroundWorker = AppConfig.getBackgroundWorker();</programlisting>
      <para><emphasis role="bold">Использование</emphasis></para>
      <orderedlist>
        <listitem>
          <para>Задача описывается как наследник абстрактного класса <code>BackgroundTask</code>. Для нее необходимо задать окно, которому принадлежит задача, и описать главный метод <methodname>run()</methodname>.</para>
        </listitem>
        <listitem>
          <para>Создается объект управления задачей − <code>BackgroundTaskHandler</code>. Для этого задачу необходимо передать классу <code>BackgroundWorker</code>.</para>
        </listitem>
        <listitem>
          <para>Выполняется запуск задачи</para>
          <programlisting>// Задача с ограничением 10 секунд и с текущим окном в качестве родителя
final BackgroundTask&lt;Integer, Void&gt; progressIndicator = new BackgroundTask&lt;Integer, Void&gt;(10, this) {
    @Override
    public Void run(TaskLifeCycle&lt;T&gt; taskLifeCycle) {
        // 1 2 3 4 5 :-)
        for (int i = 0; i &lt; 5; i++) {
            Long res;
            try {
                TimeUnit.SECONDS.sleep(1);
            } catch (InterruptedException ignored) {
                return null;
            }
            // Оглашаем прогресс
            taskLifeCycle.publish(i);
        }
        return null;
    }

    @Override
    public void canceled() {
        // отменено
    }

    @Override
    public void done(Void result) {
        // завершено
    }

    @Override
    public void progress(List&lt;Integer&gt; changes) {
        // индикация прогресса
    }

    @Override
    public Map&lt;String, Object&gt; getParams() {
        // передаём параметры
        return Collections.emptyMap();
    }
};

// Получение управляющего объекта и запуск
BackgroundTaskHandler taskHandler = backgroundWorker.handle(progressIndicator);
taskHandler.execute();</programlisting>
        </listitem>
      </orderedlist>
      <para><emphasis role="bold">Объект задачи</emphasis></para>
      <para><code>BackgroundTask&lt;T, V&gt;</code> − параметризованный класс:</para>
      <itemizedlist>
        <listitem>
          <para><code>T</code> − тип объектов, показывающих прогресс задачи. Они передаются в метод <methodname>progress()</methodname> при вызове <methodname>publish()</methodname> в рабочем потоке</para>
        </listitem>
        <listitem>
          <para><code>V</code> − тип результата задачи, его можно получить после выполнения задачи или вызвать синхронно <methodname>getResult()</methodname> для ожидания.</para>
        </listitem>
      </itemizedlist>
      <para>Метод <methodname>canceled()</methodname> вызывается только в случае управляемой отмены задачи (то есть при вызове <methodname>cancel()</methodname> у <code>TaskHandler</code>).</para>
      <para>Если у задачи истек таймаут, или было закрыто окно, в котором она исполнялась, то задача будет завершена без уведомлений.</para>
      <warning>
        <para>Следует помнить, что в Java невозможно прервать поток, если он не использует операций, выбрасывающих <errorname>InterrruptedException</errorname>. Никогда не перехватывайте это исключение или все исключения с целью тихо завершить операцию. Хорошим тоном является проверка флага <code>isInterrupted()</code> у объекта <code>TaskLifeCycle</code> в различных циклических операциях, для того чтобы вовремя отменить выполнение при прерывании задачи.</para>
      </warning>
      <para>Объекты <code>BackgroundTask</code> не имеют состояния. Если придерживаться этого подхода и не заводить полей для хранения промежуточных данных, то можно использовать множество параллельно работающих задач, используя всего один объект задачи.</para>
      <para>Объект <code>BackgroundHandler</code> можно запускать всего один раз; если требуется частый перезапуск задач, то используйте <code>BackgroundTaskWrapper</code></para>
      <para><emphasis role="bold">Отображение фоновых действий для пользователя</emphasis></para>
      <para>Иногда необходимо показывать пользователю окно с прогрессом и кнопкой <guibutton>Отмена</guibutton>. Для этого есть <code>BackgroundWorkWindow&lt;T,V&gt;</code> с набором статических методов.
В окне можно отображать статус задачи и разрешать/запрещать отмену фонового процесса.</para>
      <para><emphasis role="bold">Отслеживание исполнения задач</emphasis></para>
      <para>Если Вы хотите использовать параметры из UI компонентов, то необходимо переопределить метод <methodname>Map&lt;String, Object&gt; getParams()</methodname> . Он выполняется один раз при запуске задачи в потоке UI. В методе <methodname>run</methodname> они доступны в объекте <code>TaskLifeCycle</code>, аксессор − <methodname>getParams()</methodname>.</para>
      <para>При возникновении исключительных ситуаций вызывается метод <methodname>handleException</methodname>, в котором можно отобразить ошибку на UI.</para>
      <para>Для отмены и удаления зависших задач предусмотрены следующие меры:</para>
      <orderedlist>
        <listitem>
          <para><code>WatchDog</code> − поток, постоянно проверяющий задачи на истечение таймаута. Зависшие задачи прерываются и удаляются из обработки</para>
        </listitem>
        <listitem>
          <para>При закрытии родительского окна задачи она прерывается</para>
        </listitem>
        <listitem>
          <para>По истечению сессии пользователя все его задачи прерываются.
Для этого в <filename>web.xml</filename> указать:</para>
          <programlisting>&lt;listener&gt;
    &lt;listener-class&gt;com.haulmont.cuba.web.gui.utils.BackgroundWorkerListener&lt;/listener-class&gt;
&lt;/listener&gt;</programlisting>
        </listitem>
      </orderedlist>
      <para><emphasis role="bold">Объявление WatchDog</emphasis></para>
      <para>В <filename>app-web-spring.xml</filename> и <filename>app-desktop-spring.xml</filename> добавить объявление задачи по расписанию:</para>
      <programlisting>&lt;bean id=&quot;backgroundWorkerScheduler&quot; class=&quot;org.springframework.scheduling.concurrent.ThreadPoolTaskScheduler&quot;&gt;
    &lt;property name=&quot;daemon&quot; value=&quot;true&quot;/&gt;
    &lt;property name=&quot;poolSize&quot; value=&quot;1&quot;/&gt;
&lt;/bean&gt;

&lt;task:scheduled-tasks scheduler=&quot;backgroundWorkerScheduler&quot;&gt;
    &lt;task:scheduled ref=&quot;cuba_BackgroundWorker_WatchDog&quot; method=&quot;cleanupTasks&quot; fixed-delay=&quot;2000&quot;/&gt;
&lt;/task:scheduled-tasks&gt; </programlisting>
      <para><emphasis role="bold">Настройки</emphasis></para>
      <para>Для Web слоя в WebConfig настраивается частота проверки изменений на стороне клиента (браузера): <parameter>cuba.backgroundWorker.uiCheckInterval</parameter> (По умолчанию 2000 мс)</para>
    </section>
    <section>
      <title>Таймеры</title>
      <para>TODO</para>
    </section>
  </section>
  <section>
    <title>Механизмы платформы</title>
    <section id="db_update">
      <title>Обновление базы данных</title>
      <para>TODO</para>
    </section>
    <section id="email_sending">
      <title>Отсылка email</title>
      <para>TODO</para>
    </section>
    <section id="scheduled_tasks">
      <title>Выполнение задач по расписанию</title>
      <para>TODO</para>
    </section>
    <section id="runtime_properties">
      <title>Динамические атрибуты</title>
      <para>TODO</para>
    </section>
    <section>
      <title>Пессимистичная блокировка</title>
      <para>TODO</para>
    </section>
    <section>
      <title>Статистика сущностей</title>
      <para>TODO</para>
    </section>
    <section id="audit">
      <title>Аудит изменений сущностей</title>
      <para>TODO</para>
    </section>
    <section id="entity_snapshots">
      <title>Снимки сущностей</title>
      <para>TODO</para>
    </section>
    <section id="rest_api">
      <title>REST API</title>
      <para>TODO</para>
    </section>
    <section>
      <title>Хранилище файлов</title>
      <para>TODO</para>
    </section>
    <section id="objects_cache">
      <title>Организация кэшей данных</title>
      <para>TODO</para>
    </section>
    <section id="queryRunner">
      <title>Выполнение SQL с помощью QueryRunner</title>
      <para>TODO</para>
    </section>
    <section>
      <title>Интеграция с MyBatis</title>
      <para>TODO</para>
    </section>
    <section id="folders_pane">
      <title>Панель папок</title>
      <para>Папки поиска</para>
      <para>Папки данной категории могут быть созданы и настроены пользователем (за
исключением подкатегории &quot;Системные&quot;). Подкатегория &quot;Системные&quot; содержит
предустановленные папки поиска, которые доступны всем
пользователям системы.</para>
      <para>Папки поиска обладают следующими особенностями:</para>
      <itemizedlist>
        <listitem>
          <para>отображают экраны с generic-фильтром;</para>
        </listitem>
        <listitem>
          <para>создаются пользователем из любого отображенного экрана с generic-фильтром;</para>
        </listitem>
        <listitem>
          <para>пользователь может изменить иерархию, название, либо переопределить фильтр поиска. </para>
        </listitem>
      </itemizedlist>
      <para>Папки приложения</para>
      <para>Папки данной категории содержат задачи, по которым требуются
действия пользователя.</para>
      <para>Обладают следующими особенностями:</para>
      <itemizedlist>
        <listitem>
          <para>отображают предопределенные экраны с фильтром или без;</para>
        </listitem>
        <listitem>
          <para>набор папок зависит от ролей пользователя; </para>
        </listitem>
        <listitem>
          <para>пользователь не может изменить настройки папок;</para>
        </listitem>
        <listitem>
          <para>в заголовке папки может отображаться текущее количество входящих в нее записей;</para>
        </listitem>
        <listitem>
          <para>периодически обновляются по таймеру.</para>
        </listitem>
      </itemizedlist>
      <section id="search_folder">
        <title>Папки поиска</title>
      </section>
      <section id="application_folder">
        <title>Папки приложения</title>
      </section>
    </section>
    <section>
      <title>Инспектор сущностей</title>
      <para>TODO</para>
    </section>
    <section>
      <title>Информация об используемом ПО</title>
      <para>TODO</para>
    </section>
  </section>
  <section id="extension">
    <title>Расширение функциональности </title>
    <para>TODO</para>
    <section id="entity_extension">
      <title>Расширение сущностей</title>
      <para>TODO</para>
    </section>
  </section>
</chapter>
