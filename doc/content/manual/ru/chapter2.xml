<?xml version='1.0' encoding='UTF-8'?>
<!-- This document was created with Syntext Serna Free. --><chapter lang="ru" id="chapter2_architecture">
  <title>Устройство платформы</title>
  <para>В данной главе описываются различные аспекты архитектуры платформы <trademark>CUBA</trademark> и приложений на ее основе.</para>
  <section>
    <title>Структура CUBA-приложения</title>
    <para>На диаграмме ниже приведена структура развернутого приложения, созданного на базе платформы. </para>
    <figure>
      <title>Структура CUBA-приложения</title>
      <mediaobject>
        <imageobject>
          <imagedata align="center" fileref="img/DeploymentStructure.png" contentwidth="80%"/>
        </imageobject>
      </mediaobject>
    </figure>
    <para>В приведенном варианте приложение обеспечивает отсутствие единой точки отказа, балансировку нагрузки и подключение различных типов клиентов. В простейшем случае приложение может быть развернуто на одном сервере, в том числе, содержащем и базу данных. Стрелками изображено направление запросов &quot;от пользователя к данным&quot;.</para>
    <para>Приложение, основанное на платформе, физически состоит из нескольких <firstterm>уровней</firstterm> (tiers):</para>
    <variablelist>
      <varlistentry>
        <term>Middleware</term>
        <listitem>
          <para>Средний слой, содержащий основную бизнес-логику приложения. Представляет собой отдельное веб-приложение под управлением стандартного контейнера <glossterm linkend="glossary_java_web_profile">Java EE Web Profile</glossterm>.</para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term>Web Client</term>
        <listitem>
          <para>Основной клиентский уровень, как правило, содержащий полнофункциональный интерфейс для Intranet-пользователей. Представляет собой отдельное веб-приложение под управлением стандартного контейнера <glossterm linkend="glossary_java_web_profile">Java EE Web Profile</glossterm>. Реализация пользовательского интерфейса основана на фреймворке <glossterm linkend="glossary_vaadin">Vaadin</glossterm>.</para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term>Web Portal</term>
        <listitem>
          <para>Дополнительный клиентский уровень, содержащий интерфейс для внешних (Internet) пользователей. Может использоваться для интеграции с мобильными устройствами или сторонними приложениями. Представляет собой отдельное веб-приложение под управлением стандартного контейнера <glossterm linkend="glossary_java_web_profile">Java EE Web Profile</glossterm>. Реализация пользовательского интерфейса основана на фреймворке <link linkend="text_spring">Spring</link> MVC.</para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term>Desktop Client</term>
        <listitem>
          <para>Дополнительный клиентский уровень, содержащий интерфейс для Intranet-пользователей. Представляет собой десктопное Java-приложение, реализация пользовательского интерфейса основана на фреймворке <glossterm linkend="glossary_swing">Java Swing</glossterm>.</para>
        </listitem>
      </varlistentry>
    </variablelist>
    <para><emphasis role="bold">REST API</emphasis> − компонент <link linkend="section_middleware_id">среднего слоя (Middleware)</link>, обеспечивающий интеграцию системы со сторонними приложениями.</para>
    <para>Физически CUBA-приложение всегда состоит как минимум из двух частей:</para>
    <itemizedlist>
      <listitem>
        <para>Веб-приложения <link linkend="section_middleware_id">среднего слоя (Middleware)</link></para>
      </listitem>
      <listitem>
        <para>Веб-приложения веб-клиента (Web Client)</para>
      </listitem>
    </itemizedlist>
    <para>Оба этих веб-приложения  могут быть развернуты на любом веб-сервере <application>Java</application>. По умолчанию используется <application>Apache Tomcat</application>. </para>
    <para>Веб и десктоп клиенты взаимодействуют со средним слоем одинаковым образом посредством протокола <application>HTTP</application>, что позволяет размещать средний слой произвольным образом, в том числе за сетевым экраном. Следует отметить, что при развертывании в простейшем случае среднего слоя и веб-клиента на одном сервере между ними организуется локальное взаимодействие в обход сетевого стека для снижения накладных расходов.</para>
  </section>
  <section>
    <title>Структура проекта</title>
    <para id="text_module_id">Функционально проект приложения содержит зависимости от <firstterm>проектов</firstterm>, входящих в состав платформы. Проект − это структурная единица, содержащая программный код. Каждый проект имеет определенное предназначение. Диаграмма зависимостей проектов платформы изображена на рисунке.</para>
    <figure>
      <title>Диаграмма зависимостей проектов платформы</title>
      <mediaobject>
        <imageobject>
          <imagedata align="center" fileref="img/projectStructure.png"/>
        </imageobject>
      </mediaobject>
    </figure>
    <para>Сплошными линиями изображены обязательные зависимости, пунктирными − опциональные.</para>
    <para>Рассмотрим проекты платформы более подробно.</para>
    <para><emphasis role="bold">Проект cuba</emphasis></para>
    <para>Это базовый проект, обязательная часть любого приложения.  Содержит функциональность для работы с базой данных, набор <link linkend="section_services_id">сервисов (Services)</link> <link linkend="section_middleware_id">среднего слоя (Middleware)</link>, <link linkend="section_gui_framework">фреймворк графического интерфейса пользователя (Generic User Interface Framework)</link>, функциональность управления пользователями и их доступом к данным <footnote>
        <para>Описание функциональности управления пользователями и их доступом к данным содержится в <productname>Руководстве подсистемы безопасности платформы <trademark>CUBA</trademark></productname></para>
      </footnote>. Данный проект может быть собран как полноценное независимое приложение.</para>
    <para><emphasis role="bold">Проект workflow</emphasis></para>
    <para>Опциональный проект для работы с <glossterm linkend="glossary_process_id">бизнес-процессами</glossterm>.</para>
    <para><emphasis role="bold">Проект fts</emphasis></para>
    <para>Опциональный проект  <link linkend="section_fts">полнотекстового поиска</link>.</para>
    <para><emphasis role="bold">Проект charts</emphasis></para>
    <para>Опциональный проект для <link linkend="section_charts">отображения диаграмм</link> в веб-клиенте.</para>
    <para><emphasis role="bold">Проект ccpayments</emphasis></para>
    <para>Опциональный проект для <link linkend="section_ccpayments">приема платежей по картам</link>.</para>
    <para><emphasis role="bold">Проект reports</emphasis></para>
    <para>Опциональный проект подсистемы генерации отчетов<footnote>
        <para>Информация о создании отчетов с помощью платформы находится в <productname>Руководстве по созданию отчетов</productname></para>
      </footnote>.</para>
  </section>
  <section id="section_structure_folders_files">
    <title>Структура и назначение каталогов и файлов проекта</title>
    <para>Рассмотрим структуру классов и других файлов в проекте.</para>
    <para>В корне проекта расположены скрипты сборки <filename>build.gradle</filename>, <filename>settings.gradle</filename> и проектные файлы <application>IntelliJ IDEA</application>.</para>
    <para id="text_module_id">В каталоге <filename>modules</filename> расположены подкаталоги <firstterm id="text_modules">модулей</firstterm> проекта − <structname>global</structname>, <structname>core</structname>, <structname>gui</structname>, <structname>web</structname>. Модуль – это элемент проекта, в котором хранится программный код.</para>
    <itemizedlist>
      <listitem>
        <para><structname>global</structname></para>
      </listitem>
      <listitem>
        <para><structname>core</structname></para>
      </listitem>
      <listitem>
        <para><structname>gui</structname></para>
      </listitem>
      <listitem>
        <para><structname>client</structname></para>
      </listitem>
      <listitem>
        <para><structname>web</structname></para>
      </listitem>
      <listitem>
        <para><structname>web-portal</structname></para>
      </listitem>
      <listitem>
        <para><structname>desktop</structname></para>
      </listitem>
    </itemizedlist>
    <para>Модуль <structname>global</structname> определяет компоненты, доступные как <link linkend="section_middleware_id">среднему слою (Middleware)</link>, так и <link linkend="section_client_id">клиентскому коду</link>.</para>
    <itemizedlist>
      <listitem>
        <para>В пакете <package>com.haulmont.shop.core.app</package> создаются интерфейсы <link linkend="section_services_id">сервисов</link> <link linkend="section_middleware_id"> среднего слоя (Middleware)</link>. </para>
      </listitem>
      <listitem>
        <para>В пакете <package>com.haulmont.shop.core.entity</package> создаются классы <glossterm linkend="glossary_entity">сущностей</glossterm> и <glossterm linkend="glossary_localized_folders_id">файлы локализованных сообщений</glossterm>  <filename>messages.properties</filename> для задания названий сущностей и их атрибутов.</para>
      </listitem>
      <listitem>
        <para>В файле <filename>shop-persistence.xml</filename>  регистрируются новые классы сущностей.</para>
      </listitem>
      <listitem>
        <para>В файле <filename>shop-metadata.xml</filename>  может быть задано <link linkend="section_extending_funct">замещение</link> стандартных сущностей новыми.</para>
      </listitem>
    </itemizedlist>
    <figure>
      <title>Структура каталогов и файлов проекта</title>
      <mediaobject>
        <imageobject>
          <imagedata align="center" fileref="img/ch2_structure.png" contentwidth="55%"/>
        </imageobject>
      </mediaobject>
    </figure>
    <para>Модуль <structname>core</structname> определяет компоненты <link linkend="section_middleware_id">среднего слоя (Middleware)</link> системы.</para>
    <itemizedlist>
      <listitem>
        <para>Каталог <filename>db</filename> содержит sql-скрипты создания и <link linkend="section_database_update">изменения</link> базы данных в подкаталогах <filename>init</filename> и <filename>update</filename> соответственно.</para>
      </listitem>
      <listitem>
        <para>В пакете <package>com.haulmont.shop.core.app</package> создаются классы реализации <link linkend="section_services_id">сервисов (Services)</link><link linkend="section_middleware_id"> среднего слоя (Middleware)</link>, а также другие компоненты бизнес-логики приложения.</para>
      </listitem>
      <listitem>
        <para>Файл <filename>shop-app.properties</filename> содержит <glossterm linkend="glossary_conf_parameter_id">конфигурационные параметры</glossterm> среднего слоя:</para>
        <para><parameter>cuba.springContextConfig</parameter> − определяет набор конфигурационных файлов <link linkend="text_spring">Spring</link>-фреймворка;</para>
        <para><parameter>cuba.persistenceConfig</parameter> − определяет набор конфигурационных файлов <link linkend="text_additionally_ORM">ORM</link>;</para>
        <para><parameter>cuba.viewsConfig</parameter> − задает набор конфигурационных файлов <link linkend="section_views_id">представлений</link>;</para>
      </listitem>
      <listitem>
        <para>В файле <filename>shop-spring.xml</filename> при необходимости можно подменить реализацию стандартных сервисов или других управляемых фреймворком <link linkend="text_additionally_spring">Spring</link> компонентов, а также зарегистрировать создаваемые <glossterm linkend="glossary_jmx_id">JMX</glossterm>-компоненты.</para>
      </listitem>
      <listitem>
        <para>Файл <filename>shop-views.xml</filename> содержит описание <link linkend="section_views_id">представлений</link>. Механизм представлений  обеспечивает извлечение из БД и передачу клиенту графов сущностей, ограниченных в глубину и/или по атрибутам.</para>
      </listitem>
      <listitem>
        <para>Файл <filename>web\META-INF\context.xml</filename> содержит настройки подключения к базе данных.</para>
      </listitem>
      <listitem>
        <para>Файл <filename>web\WEB-INF\web.xml</filename> − это дескриптор веб-приложения <link linkend="section_middleware_id">среднего слоя (Middleware)</link>. Среди прочего содержит список <glossterm linkend="glossary_app_properties_id">конфигурационных файлов</glossterm> <filename>*-app.properties</filename>, используемых данным приложением.</para>
      </listitem>
    </itemizedlist>
    <para>Модуль <structname>gui</structname> определяет компоненты <link linkend="section_gui_framework">графического пользовательского интерфейса</link>. Этот модуль доступен всем типам клиентов. Модуль <structname>gui</structname> содержит универсальные экраны: классы <glossterm linkend="glossary_controller_id">контроллеров</glossterm>, <glossterm linkend="glossary_xml_descriptor_id">XML-дескрипторы</glossterm> экранов, файлы <glossterm linkend="glossary_localized_folders_id">локализованных сообщений</glossterm>.</para>
    <itemizedlist>
      <listitem>
        <para>В пакете <package>com.haulmont.shop.gui.ui</package> создаются экраны приложения.</para>
      </listitem>
      <listitem>
        <para>В файле <filename>shop-screens.xml</filename> регистрируются экраны приложения.</para>
      </listitem>
    </itemizedlist>
    <para>Модуль <structname>web</structname> определяет компоненты веб-клиента. Зависит от модулей <structname>gui</structname> и <structname>global</structname>. Содержит специфические экраны и/или <glossterm>компаньоны</glossterm> и файлы конфигурации.</para>
    <itemizedlist>
      <listitem>
        <para>Класс  <classname>com.haulmont.shop.App.java</classname> определяет главное окно приложения.</para>
      </listitem>
      <listitem>
        <para>Файл <filename>shop-web-app.properties</filename> содержит конфигурационные параметры веб-клиента:</para>
        <para><parameter>cuba.windowConfig</parameter> − в этом свойстве указывается набор файлов конфигурации экранов приложения;</para>
        <para><parameter>cuba.menuConfig</parameter> содержит список файлов, описывающих меню приложения;</para>
        <para><parameter>cuba.appConfig.messagesPack</parameter>  задает список имен <glossterm linkend="glossary_localized_folders_id">пакетов сообщений</glossterm>, формирующих <glossterm linkend="glossary_main_localized_folder_id">главный пакет</glossterm>, используемый главным меню и другими общими компонентами системы;</para>
      </listitem>
      <listitem>
        <para>Файл <filename>shop-web-menu.xml</filename> содержит описание пунктов главного меню приложения.</para>
      </listitem>
      <listitem>
        <para>В файле <filename>shop-web-screens.xml</filename> регистрируются экраны приложения.</para>
      </listitem>
    </itemizedlist>
  </section>
  <section>
    <title>Описание основных gradle tasks</title>
    <para>TODO</para>
  </section>
  <section id="section_middleware_id">
    <title>Архитектура среднего слоя</title>
    <para>На следующем рисунке приведены основные компоненты среднего слоя CUBA-приложения.</para>
    <figure>
      <title>Архитектура среднего слоя</title>
      <mediaobject>
        <imageobject>
          <imagedata align="center" fileref="img/Middleware.png"/>
        </imageobject>
      </mediaobject>
    </figure>
    <para>Компоненты сгруппированы по двум <link linkend="text_modules">модулям</link>: <structname>core</structname> и <structname>global</structname>. В <structname>global</structname> расположены компоненты, доступные как коду <link linkend="section_middleware_id">Middleware</link>, так и <link linkend="section_client_id">клиентскому коду</link>. В <structname>core</structname> расположены компоненты ядра <link linkend="section_middleware_id">Middleware</link>.</para>
    <para>Рассмотрим элементы диаграммы более подробно.</para>
    <para><link linkend="section_services_id">Services</link> – управляемые <glossterm linkend="glossary_conteiner_id">контейнером</glossterm> компоненты, формирующие <glossterm linkend="glossary_app_boundary_id">границу приложения</glossterm> и предоставляющие интерфейс клиентам <link linkend="section_middleware_id">Middleware</link>. Сервисы могут содержать бизнес-логику сами, либо делегировать выполнение <link linkend="section_managed_beans_id">Managed Beans</link>.</para>
    <para><link linkend="section_managed_beans_id">Managed Beans</link> – управляемые <glossterm linkend="glossary_conteiner_id">контейнером</glossterm> компоненты, содержащие бизнес-логику приложения. Вызываются <link linkend="section_services_id">сервисами</link>, другими бинами или через опциональный <glossterm linkend="glossary_jmx_id">JMX</glossterm> интерфейс.</para>
    <para>Entity Classes – классы, моделирующие предметную область приложения.  Представляют собой аннотированные <glossterm linkend="glossary_pojo_id">POJO</glossterm>. Аннотации используются для задания соответствий между столбцами таблицы базы данных и полями объектов с помощью <link linkend="text_additionally_JPA">OpenJPA</link>, а также для формирования метаданных в <link linkend="section_metadata_framework">Metadata Framework</link>.</para>
    <para><emphasis role="bold">Persistence</emphasis> −  центральный интерфейс для доступа к функциональности хранения данных. Позволяет получать ссылки на интерфейсы <classname>EntityManager</classname> и <classname>Transaction</classname>.</para>
    <para><emphasis role="bold">Transaction</emphasis> − интерфейс управления <link linkend="section_transaction_id">транзакциями</link> <link linkend="section_middleware_id">Middleware</link>.</para>
    <para><emphasis role="bold">Entity Manager</emphasis> − интерфейс для работы с данными на уровне <link linkend="section_middleware_id">Middleware</link>. Позволяет извлекать <glossterm linkend="glossary_entity">сущности</glossterm> из базы данных по идентификатору и по запросу, а также сохранять и удалять их.</para>
    <para><link linkend="section_metadata_framework">Metadata Framework</link> позволяет создавать описание предметной области в терминах классов, атрибутов и отношений между классами. Метаданные (модель данных) существенно упрощают создание универсальных механизмов работы с данными. Исходной информацией для построения модели являются аннотированные классы сущностей.</para>
    <para><link linkend="section_infrastructure_interfaces_id">Global Infrastructure Interfaces</link> (интерфейсы инфраструктуры) предоставляют доступ к общей часто используемой функциональности. Реализованы в платформе аналогично <link linkend="section_managed_beans_id">Managed Beans</link>.

Все интерфейсы инфраструктуры имеют соответствующие <firstterm>статические фасады</firstterm> − классы со статическими методами, позволяющие иметь доступ к нужной функциональности из статического контекста (при невозможности использовать <link>dependency injection</link>). Статические фасады имеют имена, заканчивающиеся на <classname>*Provider</classname>.</para>
    <para><link linkend="text_additionally_spring">Spring Framework</link> − основа среднего слоя. Используются следующие возможности <link linkend="text_additionally_spring">Spring</link> Framework: </para>
    <itemizedlist>
      <listitem>
        <para>Инверсия управления (IoC container)</para>
      </listitem>
      <listitem>
        <para>Аспектно-ориентированное программирование (AOP)</para>
      </listitem>
      <listitem>
        <para>Управление транзакциями</para>
      </listitem>
      <listitem>
        <para>Remoting − доступ к сервисам среднего слоя по протоколу HTTP</para>
      </listitem>
      <listitem>
        <para>Реализация веб-сервисов и <link>REST API</link></para>
      </listitem>
    </itemizedlist>
    <para><link linkend="text_additionally_JPA">OpenJPA Framework</link> − реализация <link linkend="text_additionally_ORM">ORM</link> по стандарту JPA. Позволяет работать с таблицами базы данных как с объектами Java и создавать запросы на языке <link>JPQL</link>.</para>
    <section id="section_services_id">
      <title>Сервисы</title>
      <para>Сервисы представляют собой слой  компонентов, формирующих <glossterm linkend="glossary_app_boundary_id">границу приложения</glossterm>. Сервисы определяют множество операций, предоставляемых ими для интерфейсных клиентских слоев кода. Сервисы инкапсулируют бизнес-логику приложения, управляют транзакциями и координируют реакции на действия.</para>
      <para>Основные задачи сервисов:</para>
      <itemizedlist>
        <listitem>
          <para>Обеспечить выполнение каждого метода в отдельной <link linkend="section_transaction_id">транзакции</link>. </para>
        </listitem>
        <listitem>
          <para>Обеспечивать запись исключений в журнал.</para>
        </listitem>
        <listitem>
          <para>Обеспечивать <firstterm>отказоустойчивость</firstterm> (failover) в <link linkend="section_cluster_middleware">кластере</link>  для удаленных клиентов.</para>
        </listitem>
        <listitem>
          <para>В бизнес-методах сервисов могут проверяться права пользователя на доступ к данным</para>
        </listitem>
      </itemizedlist>
      <para>Диаграмма классов, входящих в состав сервиса:</para>
      <figure>
        <title>Диаграмма классов, входящих в состав сервиса</title>
        <mediaobject>
          <imageobject>
            <imagedata align="center" fileref="img/MiddlewareServices.png" contentwidth="80%"/>
          </imageobject>
        </mediaobject>
      </figure>
      <para>Каждый вызов сервиса перехватывается с помощью <link linkend="text_additionally_spring">Spring AOP</link>  и обрамляется вызовом <classname>ServiceInterceptor.aroundInvoke()</classname>.</para>
      <para>Подробная информация о создании сервисов содержится в главе <xref linkend="section_services_realization" xrefstyle="select: labelnumber title"/> </para>
    </section>
    <section id="section_managed_beans_id">
      <title>Управляемые бины</title>
      <para><firstterm>Управляемые бины (Managed Beans)</firstterm> − это программные компоненты, реализующие бизнес-логику приложения и создаваемые в соответствии с принципами <link linkend="text_injection_IoC">Inversion of Control</link>. <glossterm linkend="glossary_conteiner_id">Контейнером</glossterm> для бинов служит <link linkend="text_springFramework">Spring Framework.</link></para>
      <para>Managed Bean представляет собой <firstterm>singleton</firstterm>, то есть всегда используется один экземпляр данного класса. Соответственно, если создаваемый Вами бин содержит изменяемые данные в полях (имеет состояние), то необходимо синхронизировать обращение к таким данным.</para>
      <para>В простейшем случае Managed Bean может быть просто Java-классом, аннотированным как <literal>@ManagedBean</literal>. Однако рекомендуется придерживаться  правил создания бинов, содержащихся в главе <xref linkend="section_managed_beans_realization" xrefstyle="select: labelnumber title"/></para>
    </section>
    <section id="section_MBean_id">
      <title>Мбины</title>
      <para><firstterm>МБин</firstterm> − программный компонент, реализующий бизнес-логику, и имеющий <glossterm linkend="glossary_jmx_id">JMX</glossterm>-интерфейс. Как правило, имеет внутреннее состояние (например, кэш, конфигурационные данные или статистику), к которому нужно обеспечить доступ через JMX.</para>
      <para>МБин является расширенным вариантом <link linkend="section_managed_beans_id">управляемого бина</link>.</para>
      <figure>
        <title/>
        <mediaobject>
          <imageobject>
            <imagedata align="center" fileref="img/MBeans.png"/>
          </imageobject>
        </mediaobject>
      </figure>
      <para>Как видно из диаграммы, МБин имеет два набора методов, разделенных по интерфейсам <interfacename>...MBean</interfacename> и <interfacename>...API</interfacename>. Первый из них служит для управления через JMX, а второй − для вызова из программного кода.</para>
      <para>Вызовы JMX-интерфейса МБина перехватываются специальным классом − <glossterm linkend="glossary_interceptor_id">интерцептором</glossterm> <methodname>MBeanInterceptor.aroundInvoke()</methodname> (с помощью <link linkend="text_springAOP">Spring AOP</link>), который обеспечивает журналирование неперехваченных исключений и установку правильного контекстного <classname>ClassLoader</classname>.</para>
      <para>Информация о том, как создать Мбин, содержится в главе <xref linkend="section_mbeans_realization" xrefstyle="select: labelnumber title"/></para>
    </section>
    <section id="section_infrastructure_interfaces_id">
      <title>Интерфейсы инфраструктуры</title>
      <para>Интерфейсы инфраструктуры обеспечивают доступ к часто используемой функциональности платформы. Некоторые из этих интерфейсов расположены в модуле <structname>global</structname> и могут быть использованы как из <link linkend="section_middleware_id">среднего слоя (Middleware)</link>, так и из любого клиентского кода, другие доступны только коду среднего слоя.</para>
      <para>Интерфейсы инфраструктуры реализуются управляемыми компонентами <link linkend="text_springFramework">Spring</link>, поэтому зависимости от интерфейсов могут быть <glossterm linkend="glossary_injection_id">внедрены</glossterm> в любые другие управляемые компоненты (<link linkend="section_managed_beans_id">управляемые бины (Managed Beans)</link>, <link linkend="section_services_id">сервисы среднего слоя (MiddlewareServices)</link>, <glossterm linkend="glossary_controller_id">контроллеры</glossterm> экранов (Screen Controllers)).</para>
      <para>Все интерфейсы инфраструктуры имеют соответствующие &quot;статические фасады&quot;, которые называются <firstterm>провайдерами</firstterm>, и могут быть использованы в неуправляемых компонентах (<glossterm linkend="glossary_pojo_id">POJO</glossterm>, вспомогательных классах и так далее).</para>
      <para><emphasis role="bold">Глобальные интерфейсы инфраструктуры</emphasis></para>
      <simpara><emphasis role="bold">TimeSource</emphasis>. Обеспечивает получение текущего времени. Применение <classname>new Date()</classname> и т.п. запрещено. Статический фасад − <classname>TimeProvider</classname>.</simpara>
      <simpara><emphasis role="bold">UuidSource</emphasis>. Обеспечивает получение значений <classname>UUID</classname>, в том числе для идентификаторов сущностей. Статический фасад − <classname>UuidProvider</classname>.</simpara>
      <simpara><emphasis role="bold">UserSessionSource</emphasis>. Обеспечивает получение объекта сессии текущего пользователя. Статический фасад − <classname>UserSessionProvider</classname>.</simpara>
      <simpara><emphasis role="bold">Security</emphasis>. Содержит методы проверки прав текущего пользователя. Не имеет соответствующего статического фасада. При необходимости в статическом контексте можно получить через <classname>UserSessionProvider</classname> объект пользовательской сессии и вызвать соответствующие методы у него.</simpara>
      <simpara><emphasis role="bold">Metadata</emphasis>. Обеспечивает доступ к сессии <link linkend="section_metadata_framework">метаданных</link> и ViewRepository. Статический фасад − <classname>MetadataProvider</classname>.</simpara>
      <simpara><emphasis role="bold">Messages</emphasis>. Интерфейс <interface>Messages</interface> обеспечивает получение локализованных строк сообщений. Статический фасад − <classname>MessageProvider</classname>.</simpara>
      <simpara><emphasis role="bold">Configuration</emphasis>. Является фасадом к фреймворку работы с конфигурационными параметрами. Статический фасад − <classname>ConfigProvider</classname>.</simpara>
      <simpara><emphasis role="bold">Resources</emphasis>. Обеспечивает загрузку ресурсов из конфигурационного каталога приложения или из <code>classpath</code>, а также по явно указанному URL.</simpara>
      <simpara><emphasis role="bold">Scripting</emphasis>. Интерфейс <interface>Scripting</interface> обеспечивает возможность динамической компиляции и выполнения прикладного кода на Groovy и Java. Статический фасад − <interface>ScriptingProvider</interface>.</simpara>
      <para><emphasis role="bold">Интерфейсы инфраструктуры среднего слоя</emphasis></para>
      <simpara><emphasis role="bold">Persistence</emphasis>. Обеспечивает доступ к интерфейсам <interface>Transaction</interface>, <interface>EntityManager</interface>, и некоторые сервисные функции, относящиеся к хранению данных. Статический фасад − <classname>PersistenceProvider</classname>.</simpara>
    </section>
    <section>
      <title>ORM</title>
      <variablelist>
        <varlistentry>
          <term>Преимущества</term>
          <listitem>
            <itemizedlist>
              <listitem>
                <para>Позволяет работать с  данными реляционной СУБД, манипулируя простыми объектами Java (POJO)</para>
              </listitem>
              <listitem>
                <para>Упрощает программирование, избавляя от рутины написания тривиальных SQL</para>
              </listitem>
              <listitem>
                <para>Упрощает программирование, позволяя извлекать и сохранять целые графы объектов одной командой</para>
              </listitem>
              <listitem>
                <para>Обеспечивает легкое портирование приложения на различные СУБД</para>
              </listitem>
              <listitem>
                <para>Лаконичный язык запросов JPQL</para>
              </listitem>
              <listitem>
                <para>Оптимизирует количество выполняемых SQL на insert/update</para>
              </listitem>
            </itemizedlist>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term>Недостатки</term>
          <listitem>
            <itemizedlist>
              <listitem>
                <para>Требует понимания особенностей работы с ORM</para>
              </listitem>
              <listitem>
                <para>Не позволяет напрямую оптимизировать SQL или использовать особенности СУБД, что приводит к снижению производительности</para>
              </listitem>
            </itemizedlist>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term>Реализация</term>
          <listitem>
            <itemizedlist>
              <listitem>
                <para>JPA – Java Persistence API</para>
              </listitem>
              <listitem>
                <para>OpenJPA – фреймворк, реализующий JPA. Используется у нас, а также в некоторых high-end серверах приложения, например, IBM WebSphere. На данный момент используем версию 1.2.</para>
              </listitem>
            </itemizedlist>
          </listitem>
        </varlistentry>
      </variablelist>
      <variablelist>
        <title>ORM – основные понятия</title>
        <varlistentry>
          <term>Entity</term>
          <listitem>
            <para>Аннотированный POJO. Обычно соответствует таблице СУБД.</para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term>EntityManager</term>
          <listitem>
            <para>Интерфейс для управления сущностями.
Получается  вызовом <classname>PersistenceProvider.getEntityManager()</classname>.
Экземпляр <classname>EntityManager</classname> всегда привязан к одной транзакции. Более того, все вызовы <classname>PersistenceProvider.getEntityManager()</classname> в рамках одной транзакции возвращают один и тот же экземпляр <classname>EntityManager</classname>. После завершения транзакции обращения к данному экземпляру невозможны.
Экземпляр <classname>EntityManager</classname> содержит в себе &quot;персистентный контекст&quot; – набор экземпляров сущностей, загруженных из БД или только что созданных. Персистентный контекст является кэшем данных в рамках данной транзакции.
<classname>EntityManager</classname> автоматически сбрасывает в БД все изменения, сделанные в своем персистентном контексте, в момент коммита транзакции, либо явным вызовом <classname>flush()</classname>.</para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term>Enhancing</term>
          <listitem>
            <para>Модификация байт-кода классов сущностей для обеспечения возможности работы ORM. 
В нашем случае производится в момент сборки проекта (см. цель compile-module модуля global)
IDEA может затереть enhanced версии классов, поэтому пакет entity лучше исключить из компиляции среды разработки.</para>
          </listitem>
        </varlistentry>
      </variablelist>
      <variablelist>
        <title>ORM – жизненный цикл сущности</title>
        <varlistentry>
          <term>New</term>
          <listitem>
            <para>Только что созданный экземпляр, например: Car car = new Car();
может быть передан в EntityManager.persist() для сохранения в БД. При этом переходит в состояние Managed</para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term>Managed</term>
          <listitem>
            <para>Загруженный из БД или новый переданный в persist() экземпляр; 
принадлежит некоторому эккземпляру EntityManager, другими словами находится в его персистентном контексте;
любые изменения в состоянии Managed экземпляра будут сохранены в БД в случае коммита транзакции, к которой принадлежит данный EntityManager</para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term>Detached</term>
          <listitem>
            <para>Экземпляр, загруженный из БД и отсоединенный от своего персистентного контекста (вследствие закрытия транзакции или сериализации);
изменения, вносимые в Detached экземпляр, запоминаются в самом этом экземпляре (с помощью полей, добавленных enhancing&apos;ом);
изменения в Detached экземпляре будут сохранены в БД, только если он будет снова переведен в состояние Managed путем передачи в метод EntityManager.merge(); EntityManager.merge() выполняет следующее – загружает из БД экземпляр с тем же идентификатором, переносит в него состояние переданного Detached экземпляра, и возвращает загруженный Managed экземпляр. Далее надо работать именно с возвращенным Managed экземпляром!</para>
          </listitem>
        </varlistentry>
      </variablelist>
      <itemizedlist>
        <title>ORM – lazy loading</title>
        <listitem>
          <para>Позволяет загружать связанные сущности по требованию, т.е. только в момент первого обращения к их свойствам</para>
        </listitem>
        <listitem>
          <para>Работает только для экземпляра в состоянии Managed, т.е. внутри транзакции, загрузившей данный экземпляр</para>
        </listitem>
        <listitem>
          <para>Lazy loading  в сумме порождает больше запросов к БД, чем eager fetching, однако нагрузка при этом растянута во времени</para>
          <itemizedlist>
            <listitem>
              <para>Например, при извлечении списка N экземпляров сущности A, содержащих ссылку на экземпляр сущности B, в случае lazy loading будет выполнено N+1 запросов к БД.</para>
            </listitem>
            <listitem>
              <para>Для минимизации времени отклика и снижения нагрузки необходимо стремиться к меньшему количеству обращений к БД. Для этого  у нас используется механизм views, с помощью которого в вышеописанном случае ORM сформирует 1 запрос к БД с объединением таблиц.</para>
            </listitem>
            <listitem>
              <para>Если A содержит коллекцию B, в случае eager fetching ORM сформирует SQL запрос, возвращающий произведение строк A и B. </para>
            </listitem>
            <listitem>
              <para>Если A содержит 2 и более коллекции B, C…, в случае eager fetching ORM может выдать ошибку (проблема в OpenJPA 1.2.2, предположительно будет исправлена в 1.2.3). В этом случае необходимо задать только одну коллекцию eager, остальные lazy.</para>
            </listitem>
            <listitem>
              <para>Иногда lazy loading с точки зрения производительности предпочтительнее, чем eager fetching. Например, когда работает асинхронный процесс, выполняющий некую бизнес-логику, общее время выполнения некритично и желательно размазать нагрузку на БД по времени.</para>
            </listitem>
          </itemizedlist>
        </listitem>
      </itemizedlist>
    </section>
    <section id="section_metadata_framework">
      <title>Metadata Framework</title>
      <para>Metadata Framework позволяет создавать описание предметной области в терминах метаданных.</para>
      <figure>
        <title>Структура метаданных</title>
        <mediaobject>
          <imageobject>
            <imagedata align="center" fileref="img/Metadata Framework.png"/>
          </imageobject>
        </mediaobject>
      </figure>
      <itemizedlist>
        <title>Назначение метаданных</title>
        <listitem>
          <para>предоставляют удобный интерфейс для получения информации о сущностях, атрибутах и отношениях между сущностями; для навигации по ссылкам</para>
        </listitem>
        <listitem>
          <para>служат более удобной в использовании и более функциональной альтернативой Java Reflection</para>
        </listitem>
        <listitem>
          <para>регламентируют допустимые типы данных и отношений между сущностями</para>
        </listitem>
        <listitem>
          <para>позволяют создавать универсальные механизмы работы с данными</para>
        </listitem>
      </itemizedlist>
      <para>Точка входа: Metadata.getSession().
Возвращается объект Session, через который можно получать модели и классы.
Развертывание метаданных происходит при первом обращении к Session.
Источниками метаданных служат:
Классы персистентных сущностей, заданные в файлах *-persistence.xml,
Классы неперсистентных сущностей, заданные в файлах *-metadata.xml</para>
      <variablelist>
        <varlistentry>
          <term>MetaClass</term>
          <listitem>
            <itemizedlist>
              <listitem>
                <para>name – имя, по соглашению первой частью имени до знака $ является namespace, например, sec$User</para>
              </listitem>
              <listitem>
                <para>properties – список объектов MetaProperty, описывающих атрибуты объекта</para>
              </listitem>
              <listitem>
                <para>javaClass – класс сущности, которой соответствует данный MetaClass</para>
              </listitem>
              <listitem>
                <para>annotations – коллекция аннотаций. Аннотация представляет собой произвольный именованный объект, который добавляется в MetaClass на этапе развертывания метаданных. Например, с помощью аннотаций в метаданных хранится длина строковых полей.</para>
              </listitem>
            </itemizedlist>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term>MetaProperty</term>
          <listitem>
            <itemizedlist>
              <listitem>
                <para>name – имя свойства, соответствует имени атрибута сущности</para>
              </listitem>
              <listitem>
                <para>domain – MetaClass, которому принадлежит данное свойство</para>
              </listitem>
              <listitem>
                <para>type – тип свойства: DATATYPE, ENUM, ASSOCIATION, AGGREGATION</para>
              </listitem>
              <listitem>
                <para>range – интерфейс к свойствам MetaProperty</para>
              </listitem>
              <listitem>
                <para>mandatory – true если атрибут сущности должен быть не null</para>
              </listitem>
              <listitem>
                <para>readOnly – true если атрибут нельзя изменять</para>
              </listitem>
              <listitem>
                <para>inverse – ссылка на обратную сторону ассоциации между сущностями</para>
              </listitem>
              <listitem>
                <para>annotatedElement – Field или Method, соответствующие данному атрибуту сущности</para>
              </listitem>
              <listitem>
                <para>javaType – java-класс атрибута сущности</para>
              </listitem>
              <listitem>
                <para>declaringClass – java-класс, декларирующий данный атрибут (содержащий данный annotatedElement)</para>
              </listitem>
            </itemizedlist>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term>Range</term>
          <listitem>
            <itemizedlist>
              <listitem>
                <para>isDatatype – true если MetaProperty.type == DATATYPE</para>
              </listitem>
              <listitem>
                <para>isEnum – true если MetaProperty.type == DATATYPE</para>
              </listitem>
              <listitem>
                <para>isClass – true если MetaProperty.type == ASSOCIATION or AGGREGATION</para>
              </listitem>
              <listitem>
                <para>ordered – true если свойство представляет собой упорядоченную коллекцию (List)</para>
              </listitem>
              <listitem>
                <para>cardinality – вид отношения, если свойство isClass: ONE_TO_ONE, MANY_TO_ONE, ONE_TO_MANY, MANY_TO_MANY</para>
              </listitem>
            </itemizedlist>
          </listitem>
        </varlistentry>
      </variablelist>
    </section>
    <section id="section_views_id">
      <title>Представления</title>
      <para>Механизм представлений обеспечивает извлечение из БД и передачу клиенту графов сущностей, ограниченных в глубину и/или по атрибутам.</para>
      <para>Представление всегда должно быть задано при запросе данных у <glossterm linkend="glossary_middleware_id">middleware</glossterm>. Получив выборку данных по представлению, клиентский код может быть уверен, что все запрошенные атрибуты и связанные сущности получены, и их можно использовать без опаски получить <errorname role="italic">NullPointerException</errorname> или исключение типа <errorname role="italic">LazyInitializationException</errorname>. Представление решает и обратную задачу − ненужные атрибуты не извлекаются из БД, что снижает нагрузку в случае &quot;широких&quot; сущностей (содержащих большое число атрибутов).</para>
      <para>Для каждой сущности по умолчанию доступны два типа представления с именами <filename>_local</filename> и <filename>_minimal</filename></para>
      <itemizedlist>
        <listitem>
          <para><filename>_local</filename> определяет все локальные атрибуты сущности (т.е. все, кроме ссылок на другие сущности);</para>
        </listitem>
        <listitem>
          <para><filename>_minimal</filename> определяет атрибуты, входящие в <varname>InstanceName</varname>. Если <varname>InstanceName</varname> не задано, данное представление определяет только системные атрибуты (<varname>id</varname>, <varname>createTs</varname> и пр.).</para>
        </listitem>
      </itemizedlist>
      <para>Представления нужно определять в файле <filename>ext-views.xml</filename> модуля <structname>core</structname>.</para>
      <warning>
        <title>Внимание</title>
        <para>Имя представления должно быть уникально в пределах сущности. При этом рекомендуется давать более  &quot;описательные&quot; имена. Например, не &quot;browse&quot;, а &quot;nameOfEntityBrowse&quot;. Это упрощает поиск XML-описателей представлений по имени. </para>
      </warning>
      <para>Пример представления для сущности <classname>User</classname>, которое должно выбирать все простые поля и ссылку на группу:</para>
      <programlisting>&lt;view entity=&quot;sec$User&quot; name=&quot;user.browse&quot; extends=&quot;_local&quot;&gt;
     &lt;property name=&quot;group&quot; view=&quot;_local&quot;/&gt;
&lt;/view&gt;</programlisting>
    </section>
    <section id="section_transaction_id">
      <title>Управление транзакциями</title>
      <para>Транзакция Middleware напрямую отображается на транзакцию БД.</para>
      <para>Управление транзакциями производится только  на уровне сервисов или ниже. 
</para>
      <para>Любой клиент, вызывая методы сервиса, должен понимать, что каждый метод будет выполняться в отдельной транзакции.
Используется только ручное (не декларативное) управление транзакциями.</para>
      <para>Управление транзакциями является частью бизнес-логики.
При использовании ORM изменения в БД производятся при коммите транзакции, который в случае декларативного управления происходит за рамками прикладного кода (в интерцепторах контейнера), что крайне неудобно при отладке приложения.</para>
      <para>При использовании ORM доменные объекты ведут себя принципиально по-разному внутри и вне транзакции</para>
      <para>Рекомендации по управлению транзакциями содержатся в главе <xref linkend="section_transactions_realization" xrefstyle="select: labelnumber title"/></para>
    </section>
    <section id="section_cluster_middleware">
      <title id="section_cluster_middleware">Кластер среднего слоя</title>
      <para>TODO</para>
    </section>
  </section>
  <section id="section_client_id">
    <title>Архитектура клиента</title>
    <figure>
      <title/>
      <mediaobject>
        <imageobject>
          <imagedata align="center" fileref="img/ClientStructure.png"/>
        </imageobject>
      </mediaobject>
    </figure>
    <para>TODO</para>
  </section>
  <section>
    <title>Механизмы платформы</title>
    <section id="section_extending_funct">
      <title>Механизмы расширения функциональности</title>
      <para>TODO</para>
    </section>
    <section id="section_fts">
      <title>Механизм полнотекстового поиска</title>
      <para>Полнотекстовый поиск предоставляет возможность неструктурированного поиска по всем атрибутам <glossterm linkend="glossary_entity">сущностей</glossterm> и по содержимому вложенных файлов.</para>
      <para>FTS содержит два взаимосвязанных механизма − индексирование и  поиск.</para>
      <para><emphasis role="bold">Индексирование</emphasis>. Изменения сущностей отслеживаются на уровне <glossterm linkend="glossary_entityManager_id">EntityManager</glossterm>&apos;а. Если изменился атрибут сущности, подлежащий индексированию, информация о сущности записывается в таблицу <database>SYS_FTS_QUEUE</database> с помощью <classname>FtsSenderBean</classname>. Отдельный асинхронный процесс извлекает ссылки на изменившиеся сущности из очереди, загружает сущности и индексирует их. </para>
      <para>Под индексируемыми атрибутами понимаются атрибуты данной сущности и  ссылающихся на нее сущностей, объявленные в <glossterm linkend="glossary_descriptor_fts_id">дескрипторе FTS</glossterm>.</para>
      <para><emphasis role="bold">Поиск</emphasis>. Поиск ведется по совпадению искомой строки с началом слов индексированных данных.

При включенном FTS главное окно приложения содержит поле поиска. Поиск производится с помощью <classname>FtsServiceBean</classname> и результаты отображаются в окне <filename>search-results.xml</filename>.

</para>
      <para>Дескриптор <glossterm linkend="glossary_fts_id">FTS</glossterm> представляет собой XML файл, содержащий настройки механизма полнотекстового поиска. Элементы дескриптора:</para>
      <itemizedlist>
        <listitem>
          <para><parameter>include</parameter>. Включение содержимого другого дескриптора. Атрибут <property>file</property> − путь к включаемому файлу относительно каталога конфигурации.</para>
        </listitem>
        <listitem>
          <para><parameter>entities</parameter>. Список сущностей, подлежащих индексированию и поиску.</para>
          <itemizedlist>
            <listitem>
              <para><parameter>entity</parameter>. Описание индексируемой сущности. 
Атрибуты:</para>
              <itemizedlist>
                <listitem>
                  <para><property>class</property> − java класс <glossterm linkend="glossary_entity">сущности</glossterm>;</para>
                </listitem>
                <listitem>
                  <para><property>show</property> (true/false) − должна ли данная сущность показываться в результатах поиска самостоятельно. False используется для сущностей-связей, которые нужны, например, для связи  файлов и карточек;</para>
                </listitem>
              </itemizedlist>
            </listitem>
            <listitem>
              <para><parameter>include</parameter> − включить атрибут сущности в индекс. 
Атрибуты:</para>
              <itemizedlist>
                <listitem>
                  <para><property>re</property> − регулярное выражение для отбора атрибутов по имени. Отбираются только атрибуты следующих типов: строка, число, дата, перечисление;</para>
                </listitem>
                <listitem>
                  <para><property>name</property> − имя атрибута, может быть путем по ссылочным атрибутам. Тип не проверяется, однако если имя является путем, то конечный атрибут должен быть сущностью, а не простым типом (атрибут простого типа не имеет здесь смысла, он должен индексироваться в своей сущности);</para>
                </listitem>
              </itemizedlist>
            </listitem>
            <listitem>
              <para><parameter>exclude</parameter> − исключить ранее включенный атрибут. Возможные атрибуты такие же как в элементе <parameter>include</parameter>;</para>
            </listitem>
            <listitem>
              <para><parameter>searchables</parameter> − <classname>Groovy</classname>-скрипт для добавления в очередь на индексирование произвольных сущностей, связанных с измененной. Скрипт оперирует двумя переменными:</para>
              <para><varname>searchables</varname> − список сущностей;</para>
              <para><varname>entity</varname> − текущая сущность, помещаемая в очередь автоматически;</para>
            </listitem>
            <listitem>
              <para><parameter>searchableIf</parameter> − <classname>Groovy</classname>-скрипт для ограничения помещения в очередь некоторых экземпляров индексируемой сущности. 
Скрипт оперирует переменной <varname>entity</varname> (текущая сущность, которую нужно проверить).</para>
            </listitem>
          </itemizedlist>
        </listitem>
      </itemizedlist>
      <para>Пример дескриптора:</para>
      <para><programlisting>&lt;fts-config&gt;
  &lt;include file=&quot;cuba/fts-config.xml&quot;/&gt;
  &lt;entities&gt;
    &lt;entity class=&quot;com.haulmont.workflow.core.entity.CardAttachment&quot; show=&quot;false&quot;&gt;
      &lt;include re=&quot;.*&quot;/&gt;
      &lt;exclude name=&quot;card&quot;/&gt;
      &lt;searchables&gt;
        searchables.add(entity.card)
      &lt;/searchables&gt;
    &lt;/entity&gt;

    &lt;entity class=&quot;com.haulmont.workflow.core.entity.AssignmentAttachment&quot; show=&quot;false&quot;&gt;
      &lt;include re=&quot;.*&quot;/&gt;
      &lt;exclude name=&quot;assignment&quot;/&gt;
      &lt;searchables&gt;
        searchables.add(entity.assignment.card)
      &lt;/searchables&gt;
    &lt;/entity&gt;

    &lt;entity class=&quot;com.haulmont.taskman.core.entity.ProjectGroup&quot;&gt;
      &lt;include name=&quot;name&quot;/&gt;
    &lt;/entity&gt;

    &lt;entity class=&quot;com.haulmont.taskman.core.entity.Project&quot;&gt;
      &lt;include re=&quot;.*&quot;/&gt;
    &lt;/entity&gt;

    &lt;entity class=&quot;com.haulmont.taskman.core.entity.Task&quot;&gt;
      &lt;include re=&quot;.*&quot;/&gt;
      &lt;include name=&quot;attachments.file&quot;/&gt;
      &lt;include name=&quot;assignments.attachments.file&quot;/&gt;
      &lt;exclude name=&quot;parentCard&quot;/&gt;
      &lt;exclude name=&quot;subCards&quot;/&gt;
      &lt;exclude name=&quot;timeUnit&quot;/&gt;
    &lt;/entity&gt;

    &lt;entity class=&quot;com.haulmont.docflow.core.entity.Contract&quot;&gt;
      &lt;include re=&quot;.*&quot;/&gt;
      &lt;include name=&quot;attachments.file&quot;/&gt;
      &lt;include name=&quot;assignments.attachments.file&quot;/&gt;
      &lt;exclude name=&quot;parentCard&quot;/&gt;
      &lt;exclude name=&quot;subCards&quot;/&gt;
      &lt;searchableIf&gt;
        entity.versionOf == null
      &lt;/searchableIf&gt;
    &lt;/entity&gt;
  &lt;/entities&gt;
&lt;/fts-config&gt;</programlisting></para>
    </section>
    <section id="section_database_update">
      <title>Механизм автоматического обновления базы данных</title>
      <para>TODO</para>
    </section>
    <section id="section_charts">
      <title>Механизм отображения диаграмм</title>
      <para>TODO</para>
    </section>
    <section id="section_scheduled_tasks">
      <title>Механизм реализации назначенных заданий</title>
      <para>TODO</para>
    </section>
    <section id="section_runtime_properties">
      <title>Динамические атрибуты</title>
      <para>TODO</para>
    </section>
    <section id="section_objects_cache">
      <title>Механизм организации кэшей данных</title>
      <para>TODO</para>
    </section>
    <section id="section_audit">
      <title>Механизм ведения журнала аудита изменений сущностей и сохранения версий</title>
      <para>TODO</para>
    </section>
  </section>
  <section id="section_gui_framework">
    <title>Графический интерфейс пользователя</title>
    <section>
      <title>Библиотека визуальных компонентов</title>
      <section>
        <title>ButtonsPanel</title>
        <para>Унифицирует использование и размещение кнопок для управления данными в таблице.</para>
        <para>XML-имя компонента: <parameter>buttonsPanel</parameter>.</para>
        <para>Атрибуты <parameter>buttonsPanel</parameter>:</para>
        <itemizedlist>
          <listitem>
            <para>id</para>
          </listitem>
          <listitem>
            <para>visible</para>
          </listitem>
          <listitem>
            <para>align</para>
          </listitem>
          <listitem>
            <para>expandable</para>
          </listitem>
          <listitem>
            <para>width</para>
          </listitem>
          <listitem>
            <para>height</para>
          </listitem>
        </itemizedlist>
      </section>
      <section>
        <title>DateField</title>
        <para>Поле для редактирования даты и времени.</para>
        <para>XML-имя компонента: <parameter>dateField</parameter>.</para>
        <para>Атрибуты <parameter>dateField</parameter>:</para>
        <itemizedlist>
          <listitem>
            <para>id</para>
          </listitem>
          <listitem>
            <para>stylename</para>
          </listitem>
          <listitem>
            <para>height</para>
          </listitem>
          <listitem>
            <para>width</para>
          </listitem>
          <listitem>
            <para>visible</para>
          </listitem>
          <listitem>
            <para>enable</para>
          </listitem>
          <listitem>
            <para>expandable</para>
          </listitem>
          <listitem>
            <para>datasource</para>
          </listitem>
          <listitem>
            <para>property</para>
          </listitem>
          <listitem>
            <para>caption</para>
          </listitem>
          <listitem>
            <para>description</para>
          </listitem>
          <listitem>
            <para>editable</para>
          </listitem>
          <listitem>
            <para>required</para>
          </listitem>
          <listitem>
            <para>requiredMessage</para>
          </listitem>
          <listitem>
            <para><property>dateFormat</property> − формат представления даты/времени по правилам <ulink url="http://docs.oracle.com/javase/6/docs/api/java/text/SimpleDateFormat.html">SimpleDateFormat</ulink>. Значением атрибута может быть либо строка формата, либо ключ в <glossterm linkend="glossary_localized_folders_id">пакете сообщений</glossterm> (если строка начинается с msg://)</para>
          </listitem>
          <listitem>
            <para><property>resolution</property> − точность представления даты/времени (день, час и т.д.). Значение атрибута должно соответствовать перечислению <classname>DateField.Resolution</classname> − <classname>MSEC</classname>, <classname>SEC</classname>, <classname>MIN</classname>, <classname>HOUR</classname>, <classname>DAY</classname>, <classname>MONTH</classname>, <classname>YEAR</classname>. По умолчанию точность определяется по аннотации <literal>javax.persistence.Temporal</literal> соответствующего атрибута сущности.</para>
            <para>Если <property>resolution=&quot;DAY&quot;</property> и не указан атрибут <property>dateFormat</property>, то в качестве формата будет взят формат, указанный в главном пакете сообщений с ключом <property>dateFormat</property>.</para>
            <para>Если <property>resolution=&quot;MIN&quot;</property> и не указан атрибут <property>dateFormat</property>, то в качестве формата будет взят формат, указанный в главном пакете сообщений с ключом <property>dateTimeFormat</property>.</para>
          </listitem>
        </itemizedlist>
        <para>Элементы <parameter>dateField</parameter>:</para>
        <itemizedlist>
          <listitem>
            <para>validator</para>
          </listitem>
        </itemizedlist>
      </section>
      <section>
        <title>GridLayout</title>
        <para>Контейнер, располагающий компоненты по сетке.</para>
        <para>XML-имя компонента: <parameter>grid</parameter>.</para>
        <para>Атрибуты <parameter>grid</parameter>:</para>
        <itemizedlist>
          <listitem>
            <para><property>id</property></para>
          </listitem>
          <listitem>
            <para><property>visible</property></para>
          </listitem>
          <listitem>
            <para><property>spacing</property></para>
          </listitem>
          <listitem>
            <para><property>margin</property></para>
          </listitem>
          <listitem>
            <para><property>width</property></para>
          </listitem>
          <listitem>
            <para><property>height</property></para>
          </listitem>
          <listitem>
            <para><property>expandable</property></para>
          </listitem>
          <listitem>
            <para><property>align</property></para>
          </listitem>
          <listitem>
            <para><property>column</property> − необязательный элемент, декларирует атрибуты колонок сетки. Атрибуты:</para>
            <itemizedlist>
              <listitem>
                <para><property>flex</property> − необязательный атрибут, задает соотношение ширин колонок.</para>
              </listitem>
            </itemizedlist>
          </listitem>
          <listitem>
            <para><property>columns</property> − обязательный элемент, содержит последовательность <property>column</property>. Атрибуты:</para>
            <itemizedlist>
              <listitem>
                <para><property>count</property> − необязательный атрибут, задает количество колонок, если не заданы элементы <property>column</property>.</para>
              </listitem>
            </itemizedlist>
          </listitem>
          <listitem>
            <para><property>rows</property> − обязательный элемент, содержит последовательность <property>row</property>.</para>
          </listitem>
          <listitem>
            <para><property>row</property> − обязательный элемент, контейнер для содержимого ряда.</para>
            <itemizedlist>
              <listitem>
                <para><property>flex</property> − необязательный атрибут, задает соотношение высот рядов сетки.</para>
              </listitem>
              <listitem>
                <para><property>visible</property></para>
              </listitem>
              <listitem>
                <para><property>spacing</property></para>
              </listitem>
              <listitem>
                <para><property>align</property></para>
              </listitem>
            </itemizedlist>
          </listitem>
        </itemizedlist>
        <para>Пример использования компонента в <glossterm linkend="glossary_xml_descriptor_id">XML-дескрипторе</glossterm>:</para>
        <para><programlisting>&lt;grid spacing=&quot;true&quot; expandable=&quot;false&quot;&gt;
   &lt;columns&gt;
       &lt;column flex=&quot;1&quot;/&gt;
       &lt;column flex=&quot;1&quot;/&gt;
   &lt;/columns&gt;
   &lt;rows&gt;
       &lt;row&gt;
           &lt;label value=&quot;msg://name&quot;/&gt;
           &lt;textField id=&quot;name&quot; datasource=&quot;fileDs&quot; 
                      property=&quot;name&quot;
                      width=&quot;200px&quot;/&gt;
       &lt;/row&gt;
       &lt;row&gt;
           &lt;label value=&quot;msg://extension&quot;/&gt;
           &lt;label id=&quot;extension&quot; datasource=&quot;fileDs&quot; 
                  property=&quot;extension&quot;/&gt;
       &lt;/row&gt;
   &lt;/rows&gt;
&lt;/grid&gt;</programlisting></para>
      </section>
      <section>
        <title>GroupBox</title>
        <para>Контейнер, позволяющий выделить рамкой группу объектов, задать им общий заголовок и описание. Кроме того, он умеет сворачивать свое содержимое.</para>
        <para>XML-имя компонента: <parameter>groupBox</parameter>.</para>
        <para>Атрибуты <parameter>groupBox</parameter>:</para>
        <itemizedlist>
          <listitem>
            <para><property>id</property></para>
          </listitem>
          <listitem>
            <para><property>stylename</property></para>
          </listitem>
          <listitem>
            <para><property>height</property></para>
          </listitem>
          <listitem>
            <para><property>width</property></para>
          </listitem>
          <listitem>
            <para><property>visible</property></para>
          </listitem>
          <listitem>
            <para><property>enable</property></para>
          </listitem>
          <listitem>
            <para><property>expandable</property></para>
          </listitem>
          <listitem>
            <para><property>collapsable</property> − необязательный атрибут. Может принимать значение <property>true</property>, в этом случае компонент может сворачивать свое содержимое, или значение <property>false</property>.</para>
          </listitem>
          <listitem>
            <para><property>collapsed</property> − необязательный атрибут, принимающий значение <property>true</property> или <property>false</property>. В значении <property>true</property> компонент будет свернут по умолчанию.</para>
          </listitem>
        </itemizedlist>
        <para>Элементы <parameter>groupBox</parameter>:</para>
        <itemizedlist>
          <listitem>
            <para><property>caption</property> − необязательный элемент, его атрибут <property>label</property> содержит заголовок компонента.</para>
          </listitem>
          <listitem>
            <para><property>description</property> − необязательный элемент, его атрибут <property>label</property> содержит описание.</para>
          </listitem>
          <listitem>
            <para>обязательный элемент − контейнер, содержащий вложенные компоненты (vbox, hbox, grid, flowbox).</para>
          </listitem>
        </itemizedlist>
        <para>Пример использование компонента в <glossterm linkend="glossary_xml_descriptor_id">XML-дескрипторе</glossterm>:</para>
        <para><programlisting>&lt;groupBox collapsable=&quot;true&quot; stylename=&quot;edit-area&quot;&gt;
   &lt;caption label=&quot;msg://Caption&quot;/&gt;
   &lt;description label=&quot;msg://Description&quot;/&gt;
   &lt;vbox expandable=&quot;false&quot;&gt;
       &lt;twinColumn id=&quot;twinColGroups&quot; optionsDatasource=&quot;groups&quot; captionProperty=&quot;name&quot;
                   expandable=&quot;false&quot; rows=&quot;10&quot; columns=&quot;15&quot;/&gt;
       &lt;button enable=&quot;false&quot; caption=&quot;msg://Button&quot;/&gt;
   &lt;/vbox&gt;
&lt;/groupBox&gt;</programlisting></para>
      </section>
      <section>
        <title>LookupField</title>
        <para>Компонент, реализующий выпадающий список. Он реализует фильтрацию значений в реальном времени (по мере ввода имени опции пользователем) и постраничный вывод доступных опций.</para>
        <para>XML-имя компонента: <parameter>lookupField</parameter>.</para>
        <para>Атрибуты <parameter>lookupField</parameter>: </para>
        <itemizedlist>
          <listitem>
            <para>id</para>
          </listitem>
          <listitem>
            <para>stylename</para>
          </listitem>
          <listitem>
            <para>height</para>
          </listitem>
          <listitem>
            <para>width</para>
          </listitem>
          <listitem>
            <para>visible</para>
          </listitem>
          <listitem>
            <para>enable</para>
          </listitem>
          <listitem>
            <para>expandable</para>
          </listitem>
          <listitem>
            <para>datasource</para>
          </listitem>
          <listitem>
            <para>property</para>
          </listitem>
          <listitem>
            <para>caption</para>
          </listitem>
          <listitem>
            <para>editable</para>
          </listitem>
          <listitem>
            <para>required</para>
          </listitem>
          <listitem>
            <para>requiredMessage</para>
          </listitem>
          <listitem>
            <para>optionsDatasource</para>
          </listitem>
          <listitem>
            <para>captionProperty</para>
          </listitem>
          <listitem>
            <para><property>nullName</property> − идентификатор опции, выбор которой будет равносилен установке значения в <property>null</property>.</para>
          </listitem>
          <listitem>
            <para><property>filterMode</property> − тип фильтрации опций:</para>
            <itemizedlist>
              <listitem>
                <para><property>NO</property> − нет фильтрации.</para>
              </listitem>
              <listitem>
                <para><property>STARTS_WITH</property> − по началу фразы.</para>
              </listitem>
              <listitem>
                <para><property>CONTAINS</property> − по любому вхождению.</para>
              </listitem>
            </itemizedlist>
          </listitem>
          <listitem>
            <para>validator</para>
          </listitem>
        </itemizedlist>
        <para>Пример использования компонента в <glossterm linkend="glossary_xml_descriptor_id">XML-дескрипторе</glossterm>:</para>
        <para><programlisting>&lt;lookupField id=&quot;docClass&quot; datasource=&quot;docType&quot; property=&quot;docClass&quot;
             optionsDatasource=&quot;docClasses&quot; captionProperty=&quot;name&quot;
             required=&quot;true&quot; width=&quot;300px&quot;/&gt;</programlisting></para>
      </section>
      <section>
        <title>PickerField</title>
        <para><parameter>PickerField</parameter> позволяет отображать экземпляр <glossterm linkend="glossary_entity">сущности</glossterm> в текстовом поле и выполнять действия нажатием на кнопки справа.</para>
        <para>XML-имя компонента: <parameter>pickerField</parameter>.</para>
        <para>Атрибуты и элементы <parameter>pickerField</parameter>:</para>
        <itemizedlist>
          <listitem>
            <para>id</para>
          </listitem>
          <listitem>
            <para>stylename</para>
          </listitem>
          <listitem>
            <para>height</para>
          </listitem>
          <listitem>
            <para>width</para>
          </listitem>
          <listitem>
            <para>visible</para>
          </listitem>
          <listitem>
            <para>enable</para>
          </listitem>
          <listitem>
            <para>expandable</para>
          </listitem>
          <listitem>
            <para>datasource</para>
          </listitem>
          <listitem>
            <para>property</para>
          </listitem>
          <listitem>
            <para>caption</para>
          </listitem>
          <listitem>
            <para>editable</para>
          </listitem>
          <listitem>
            <para>required</para>
          </listitem>
          <listitem>
            <para>requiredMessage</para>
          </listitem>
          <listitem>
            <para><property>captionProperty</property> − при отображении экземпляра сущности задает имя атрибута, значение которого выводится в текстовом поле. Если данный атрибут не задан, компонент будет содержать <classname>Instance Name</classname> экземпляра.</para>
          </listitem>
          <listitem>
            <para><property>metaClass</property> − если не установлен атрибут <property>datasource</property>, задает тип сущности, с которой будет работать компонент.</para>
          </listitem>
          <listitem>
            <para><property>actions</property> − необязательный элемент, определяющий набор действий (кнопок справа)</para>
            <itemizedlist>
              <listitem>
                <para><property>action</property> − элемент, определяющий действие. Кроме описания произвольного действия возможно использование стандартных действий, определяемых перечислением <classname>PickerField.ActionType</classname>: <classname>lookup</classname>, <classname>clear</classname>, <classname>open</classname>.</para>
              </listitem>
            </itemizedlist>
          </listitem>
        </itemizedlist>
        <para>Если при объявлении компонента никаких действий не задано, загрузчик XML определит для него действия <classname>lookup</classname> и <classname>clear</classname>.</para>
        <para>Пример использования компонента в <glossterm linkend="glossary_xml_descriptor_id">XML-дескрипторе</glossterm>:</para>
        <para><programlisting>&lt;pickerField id=&quot;pickerField1&quot; datasource=&quot;carDs&quot; 
             property=&quot;model&quot;  width=&quot;250px&quot;&gt;
    &lt;actions&gt;
        &lt;action id=&quot;clear&quot;/&gt;
        &lt;action id=&quot;pickerAction1&quot; 
                caption=&quot;&quot; 
                icon=&quot;pickerfield/img/lookup-btn.png&quot; 
                invoke=&quot;someActionMethod1&quot;/&gt;
        &lt;action id=&quot;pickerAction2&quot; 
                caption=&quot;&quot; 
                icon=&quot;pickerfield/img/lookup-btn.png&quot; 
                invoke=&quot;someActionMethod2&quot;/&gt;
    &lt;/actions&gt;
&lt;/pickerField&gt;</programlisting></para>
      </section>
      <section>
        <title>Table</title>
        <para>Служит для отображения данных в табличном виде.</para>
        <para>Возможности:</para>
        <itemizedlist>
          <listitem>
            <para>Выделение и множественное выделение строк в таблице.</para>
          </listitem>
          <listitem>
            <para>Сортировка по одной из колонок.</para>
          </listitem>
          <listitem>
            <para>Задание уникального стиля отображения для каждой ячейки.</para>
          </listitem>
          <listitem>
            <para>Применение форматирования для колонок.</para>
          </listitem>
          <listitem>
            <para>Использование для колонок функций агрегирования без модификации datasource.</para>
          </listitem>
          <listitem>
            <para>Возможность скрывать/показывать колонки таблицы.</para>
          </listitem>
          <listitem>
            <para>Возможность изменять порядок отображения колонок в таблице.</para>
          </listitem>
          <listitem>
            <para>Возможность самостоятельно задавать представление данных в ячейке.</para>
          </listitem>
          <listitem>
            <para>Возможность управлять настройками отображения посредством механизма представлений.</para>
          </listitem>
        </itemizedlist>
        <para>XML-имя компонента: <parameter>table</parameter>.</para>
        <para>Атрибуты <parameter>table</parameter>:</para>
        <itemizedlist>
          <listitem>
            <para>id</para>
          </listitem>
          <listitem>
            <para>visible</para>
          </listitem>
          <listitem>
            <para>styleName</para>
          </listitem>
          <listitem>
            <para>width</para>
          </listitem>
          <listitem>
            <para>height</para>
          </listitem>
          <listitem>
            <para>expandable</para>
          </listitem>
          <listitem>
            <para>editable</para>
          </listitem>
          <listitem>
            <para>presentations − необязательный атрибут, включение/выключение поддержки механизма представлений.</para>
          </listitem>
          <listitem>
            <para>sortable −  необязательный атрибут, разрешает/запрещает сортировку в таблице. По умолчанию имеет значение true.</para>
          </listitem>
          <listitem>
            <para>aggregatable − необязательный атрибут, разрешает/запрещает агрегацию в таблице. По умолчанию имеет значение false.</para>
          </listitem>
          <listitem>
            <para>showTotalAggregation − необязательный атрибут, разрешает/запрещает отображение строки итоговой агрегации в таблице. По умолчанию имеет значение true.</para>
          </listitem>
          <listitem>
            <para>multiselect − необязательный атрибут, разрешает/запрещает множественное выделение. По умолчанию имеет значение false.</para>
          </listitem>
          <listitem>
            <para>actions − необязательный элемент, определяющий набор действий (кнопок справа)</para>
            <itemizedlist>
              <listitem>
                <para>action − элемент, определяющий действие</para>
              </listitem>
            </itemizedlist>
          </listitem>
          <listitem>
            <para>buttonsPanel</para>
          </listitem>
          <listitem>
            <para>rowsCount − необязательный элемент, создающий для таблицы компонент <classname>RowsCount</classname>, который позволяет загружать в таблицу данные постранично.</para>
          </listitem>
          <listitem>
            <para>columns − обязательный элемент, определяет набор колонок таблицы.</para>
            <itemizedlist>
              <listitem>
                <para>column − элемент, задающий опции для колонки таблицы. Может содержать следующие атрибуты:</para>
                <itemizedlist>
                  <listitem>
                    <para>id − обязательный атрибут, содержит название атрибута сущности, выводимого в колонке.</para>
                  </listitem>
                  <listitem>
                    <para>collapsed − необязательный атрибут, скрывает/показывает колонку. По умолчанию имеет значение false.</para>
                  </listitem>
                  <listitem>
                    <para>caption − необязательный атрибут, содержит заголовок колонки.</para>
                  </listitem>
                  <listitem>
                    <para>width − необязательный атрибут, отвечает за изначальную ширину колонки.</para>
                  </listitem>
                  <listitem>
                    <para>calculatable − необязательный атрибут, используется только в редактируемой таблице. Означает, что значения в данной колонке являются вычислимыми и зависят от значений других колонок.</para>
                  </listitem>
                  <listitem>
                    <para>clickAction − необязательный атрибут; содержит описание действия, которое будет выполнено при клике в ячейке.</para>
                  </listitem>
                  <listitem>
                    <para>editable − необязательный атрибут, разрешает/запрещает редактирование данного атрибута в редактируемой таблице.</para>
                  </listitem>
                  <listitem>
                    <para>formatter</para>
                  </listitem>
                  <listitem>
                    <para>aggregation</para>
                  </listitem>
                  <listitem>
                    <para>validator</para>
                  </listitem>
                </itemizedlist>
              </listitem>
            </itemizedlist>
          </listitem>
          <listitem>
            <para>rows −  обязательный элемент, декларирует иcпользуемый datasource, его атрибуты:</para>
            <itemizedlist>
              <listitem>
                <para>datasource attribute</para>
              </listitem>
              <listitem>
                <para>headerMode − необязательный атрибут, вариант отображения заголовков рядов:</para>
                <itemizedlist>
                  <listitem>
                    <para>NONE - нет заголовков</para>
                  </listitem>
                  <listitem>
                    <para>ICON - пиктограмма</para>
                  </listitem>
                </itemizedlist>
              </listitem>
            </itemizedlist>
          </listitem>
        </itemizedlist>
        <para>Пример использования компонента в <glossterm linkend="glossary_xml_descriptor_id">XML-дескрипторе</glossterm>:</para>
        <para><programlisting>&lt;table id=&quot;users&quot; editable=&quot;false&quot;&gt;
    &lt;columns&gt;
        &lt;column id=&quot;login&quot; caption=&quot;msg://login&quot; clickAction=&quot;open:sec$User.edit&quot;/&gt;
        &lt;column id=&quot;name&quot; caption=&quot;msg://name&quot;/&gt;
        &lt;column id=&quot;position&quot; caption=&quot;msg://position&quot;/&gt;
        &lt;column id=&quot;group&quot; caption=&quot;msg://group&quot;/&gt;
        &lt;column id=&quot;email&quot; caption=&quot;msg://email&quot;/&gt;
        &lt;column id=&quot;active&quot; caption=&quot;msg://active&quot;/&gt;
    &lt;/columns&gt;
    &lt;rows datasource=&quot;users&quot;/&gt;
&lt;/table&gt;</programlisting></para>
      </section>
      <section>
        <title>Tabsheet</title>
        <para>Контейнер, содержащий закладки (<parameter>tabs</parameter>).</para>
        <para>XML-имя компонента: <parameter>tabsheet</parameter>.</para>
        <para>Атрибуты <parameter>tabsheet</parameter>:</para>
        <itemizedlist>
          <listitem>
            <para>id</para>
          </listitem>
          <listitem>
            <para>stylename</para>
          </listitem>
          <listitem>
            <para>height</para>
          </listitem>
          <listitem>
            <para>width</para>
          </listitem>
          <listitem>
            <para>visible</para>
          </listitem>
          <listitem>
            <para>expandable</para>
          </listitem>
        </itemizedlist>
        <para><parameter>tabsheet</parameter> должен содержать элементы <parameter>tab</parameter>, определяющие содержимое закладок. Каждый элемент <parameter>tab</parameter> может содержать следующие атрибуты:</para>
        <itemizedlist>
          <listitem>
            <para><property>id</property> − идентификатор закладки. Следует отметить, что закладка не является компонентом, и данный идентификатор используется только в рамках <parameter>Tabsheet</parameter>.</para>
          </listitem>
          <listitem>
            <para><property>caption</property> − заголовок закладки. Атрибут должен содержать ключ сообщения в <glossterm linkend="glossary_localized_folders_id">локализованном пакете сообщений</glossterm>.</para>
          </listitem>
          <listitem>
            <para><property>enable</property>. Это состояние закладки. Может иметь значение <property>true</property> (доступна) или <property>false</property> (недоступна). По умолчанию <property>enable = &quot;true&quot;</property>.</para>
          </listitem>
          <listitem>
            <para><property>lazy</property>. Задает отложенную загрузку содержимого закладки. Может иметь значение <property>true</property> или <property>false</property>. При отображении экрана lazy-закладки не загружают свое содержимого, что приводит к созданию меньшего количества компонентов в памяти и  к меньшему количеству запросов к БД. Компоненты закладки загружаются только в тот момент, когда пользователь выбирает данную закладку.
Если компоненты lazy-закладки требуют инициализации, проводить ее нужно не напрямую в методе <methodname>init()</methodname> <glossterm linkend="glossary_controller_id">контроллера</glossterm>, а в слушателе на переключение закладок <classname>Tabsheet.TabChangeListener</classname>.</para>
          </listitem>
        </itemizedlist>
      </section>
    </section>
    <section id="section_datasource">
      <title>Источники данных</title>
      <para>Предназначен для реализации связанных с данными компонентов.</para>
      <para>Существуют следующие интерфейсы источников данных:</para>
      <itemizedlist>
        <listitem>
          <para><interfacename>Datasource</interfacename> − предназначен для работы с одним экземпляром сущности.</para>
          <itemizedlist>
            <listitem>
              <para><interfacename>RuntimePropsDatasource</interfacename> − предназначен для работы с динамическими свойствами сущностей.</para>
            </listitem>
          </itemizedlist>
        </listitem>
        <listitem>
          <para><interfacename>CollectionDatasource</interfacename> − предназначен для работы с коллекцией сущностей</para>
          <itemizedlist>
            <listitem>
              <para><interfacename>HierarchicalDatasource</interfacename> − предназначен для работы с компонентами <classname>Tree</classname>, <classname>TreeTable</classname>.</para>
            </listitem>
            <listitem>
              <para><interfacename>GroupDatasource</interfacename> − предназначен для работы с компонентом <classname>GroupTable</classname>.</para>
            </listitem>
          </itemizedlist>
        </listitem>
      </itemizedlist>
      <para>Как правило, источники данных объявляются декларативно в секции <parameter>dsContext</parameter> <glossterm linkend="glossary_xml_descriptor_id">дескриптора экрана</glossterm>.</para>
    </section>
    <section id="section_localization">
      <title>Пакеты локализованных сообщений</title>
      <para>Содержит файлы локализованных сообщений  для задания названий сущностей, атрибутов сущностей, папок, заголовков закладок и так далее. Правила создания файлов локализованных сообщений:</para>
      <itemizedlist>
        <listitem>
          <para>Файл по умолчанию имеет имя <filename>messages.properties</filename>, для конкретного языка − <filename>messages_ru.properties</filename> и т.д. При отсутствии файла конкретного языка или при отсутствии искомого ключа в файле конкретного языка будет использовано сообщение из файла по умолчанию.</para>
        </listitem>
        <listitem>
          <para>Кодировка <code>UTF-8</code>.</para>
        </listitem>
        <listitem>
          <para>Можно включать другие файлы сообщений с помощью ключа <literal>@include</literal>. При этом если некоторый ключ встречается и во включаемом файле, и в текущем, будет использовано сообщение из текущего (переопределение). Пример включения файла:<programlisting>@include=com.haulmont.cuba.web

actions.Create=Create
actions.Edit=Edit
...</programlisting></para>
        </listitem>
        <listitem>
          <para>Полным именем пакета сообщений считается имя Java-пакета, содержащего языковые файлы. Например, именем пакета сообщений, расположенного в <filename>/com/haulmont/cuba/web/app/ui/security/user/messages.properties</filename> является строка <package>com.haulmont.cuba.web.app.ui.security.user</package></para>
        </listitem>
      </itemizedlist>
    </section>
    <section id="section_appFolders">
      <title>Панель папок</title>
      <para>Папки поиска</para>
      <para>Папки данной категории могут быть созданы и настроены пользователем (за
исключением подкатегории &quot;Системные&quot;). Подкатегория &quot;Системные&quot; содержит
предустановленные папки поиска, которые доступны всем
пользователям системы.</para>
      <para>Папки поиска обладают следующими особенностями:</para>
      <itemizedlist>
        <listitem>
          <para>отображают экраны с <glossterm linkend="glossary_filter_id">generic-фильтром</glossterm>;</para>
        </listitem>
        <listitem>
          <para>создаются пользователем из любого отображенного экрана с generic-фильтром;</para>
        </listitem>
        <listitem>
          <para>пользователь может изменить иерархию, название, либо переопределить фильтр поиска. </para>
        </listitem>
      </itemizedlist>
      <para>Папки приложения</para>
      <para>Папки данной категории содержат задачи, по которым требуются
действия пользователя.</para>
      <para>Обладают следующими особенностями:</para>
      <itemizedlist>
        <listitem>
          <para>отображают предопределенные экраны с <glossterm linkend="glossary_filter_id">фильтром</glossterm> или без;</para>
        </listitem>
        <listitem>
          <para>набор папок зависит от ролей пользователя; </para>
        </listitem>
        <listitem>
          <para>пользователь не может изменить настройки папок;</para>
        </listitem>
        <listitem>
          <para>в заголовке папки может отображаться текущее количество входящих в нее записей;</para>
        </listitem>
        <listitem>
          <para>периодически обновляются по таймеру.</para>
        </listitem>
      </itemizedlist>
    </section>
    <section id="section_backgroundtasks">
      <title>Фоновые задачи</title>
      <para><emphasis role="bold">Предназначение</emphasis></para>
      <para>Фоновые задачи используются на клиентском уровне для выполнения длительных процессов без заморозки пользовательского интерфейса. </para>
      <para>В платформе реализован объект <classname>BackgroundWorker</classname>, который предоставляется окружением и управляет фоновыми задачами</para>
      <programlisting>BackgroundWorker backgroundWorker = AppConfig.getBackgroundWorker();</programlisting>
      <para><emphasis role="bold">Использование</emphasis></para>
      <orderedlist>
        <listitem>
          <para>Задача описывается как наследник абстрактного класса <classname>BackgroundTask</classname>. Для нее необходимо задать окно, которому принадлежит задача и описать главный метод <methodname>run()</methodname>.</para>
        </listitem>
        <listitem>
          <para>Создается объект управления задачей − <classname>BackgroundTaskHandler</classname>. Для этого задачу необходимо передать классу <classname>BackgroundWorker</classname>.</para>
        </listitem>
        <listitem>
          <para>Выполняется запуск задачи</para>
          <programlisting>// Задача с ограничением 10 секунд и с текущим окном в качестве родителя
final BackgroundTask&lt;Integer, Void&gt; progressIndicator = new BackgroundTask&lt;Integer, Void&gt;(10, this) {
    @Override
    public Void run(TaskLifeCycle&lt;T&gt; taskLifeCycle) {
        // 1 2 3 4 5 :-)
        for (int i = 0; i &lt; 5; i++) {
            Long res;
            try {
                TimeUnit.SECONDS.sleep(1);
            } catch (InterruptedException ignored) {
                return null;
            }
            // Оглашаем прогресс 
            taskLifeCycle.publish(i);
        }
        return null;
    }

    @Override
    public void canceled() {
        // отменено
    }

    @Override
    public void done(Void result) {
        // завершено
    }

    @Override
    public void progress(List&lt;Integer&gt; changes) {
        // индикация прогресса
    }
    
    @Override
    public Map&lt;String, Object&gt; getParams() {
        // передаём параметры
        return Collections.emptyMap();
    }
};

// Получение управляющего объекта и запуск
BackgroundTaskHandler taskHandler = backgroundWorker.handle(progressIndicator);
taskHandler.execute();</programlisting>
        </listitem>
      </orderedlist>
      <para><emphasis role="bold">Объект задачи</emphasis></para>
      <para><classname>BackgroundTask&lt;T, V&gt;</classname> − параметризованный класс:</para>
      <itemizedlist>
        <listitem>
          <para><classname>T</classname> − тип объектов, показывающих прогресс задачи. Они передаются в метод <methodname>progress()</methodname> при вызове <methodname>publish()</methodname> в рабочем потоке</para>
        </listitem>
        <listitem>
          <para><classname>V</classname> − тип результата задачи, его можно получить после выполнения задачи или вызвать синхронно <methodname>getResult()</methodname> для ожидания.</para>
        </listitem>
      </itemizedlist>
      <para>Метод <methodname>canceled()</methodname> вызывается только в случае управляемой отмены задачи (то есть при вызове <methodname>cancel()</methodname> у <classname>TaskHandler</classname>).</para>
      <para>Если у задачи истек таймаут, или было закрыто окно, в котором она исполнялась, то задача будет завершена без уведомлений.</para>
      <warning>
        <para>Следует помнить, что в Java невозможно прервать поток, если он не использует операций, выбрасывающих <errorname>InterrruptedException</errorname>. Никогда не перехватывайте это исключение или все исключения с целью тихо завершить операцию. Хорошим тоном является проверка флага <classname>isInterrupted()</classname> у объекта <classname>TaskLifeCycle</classname> в различных циклических операциях, для того чтобы вовремя отменить выполнение при прерывании задачи.</para>
      </warning>
      <para>Объекты <classname>BackgroundTask</classname> не имеют состояния. Если придерживаться этого подхода и не заводить полей для хранения промежуточных данных, то можно использовать множество параллельно работающих задач, используя всего один объект задачи.</para>
      <para>Объект <classname>BackgroundHandler</classname> можно запускать всего один раз; если требуется частый перезапуск задач, то используйте <classname>BackgroundTaskWrapper</classname></para>
      <para><emphasis role="bold">Отображение фоновых действий для пользователя</emphasis></para>
      <para>Иногда необходимо показывать пользователю окно с прогрессом и кнопкой <guibutton>Отмена</guibutton>. Для этого есть <classname>BackgroundWorkWindow&lt;T,V&gt;</classname> с набором статических методов.
В окне можно отображать статус задачи и разрешать/запрещать отмену фонового процесса.</para>
      <para><emphasis role="bold">Отслеживание исполнения задач</emphasis></para>
      <para>Если Вы хотите использовать параметры из UI компонентов, то необходимо переопределить метод <methodname>Map&lt;String, Object&gt; getParams()</methodname> . Он выполняется один раз при запуске задачи в потоке UI. В методе <methodname>run</methodname> они доступны в объекте <classname>TaskLifeCycle</classname>, аксессор − <methodname>getParams()</methodname>.</para>
      <para>При возникновении исключительных ситуаций вызывается метод <methodname>handleException</methodname>, в котором можно отобразить ошибку на UI.</para>
      <para>Для отмены и удаления зависших задач предусмотрены следующие меры:</para>
      <orderedlist>
        <listitem>
          <para><classname>WatchDog</classname> − поток, постоянно проверяющий задачи на истечение таймаута. Зависшие задачи прерываются и удаляются из обработки</para>
        </listitem>
        <listitem>
          <para>При закрытии родительского окна задачи она прерывается</para>
        </listitem>
        <listitem>
          <para>По истечению сессии пользователя все его задачи прерываются.
Для этого в <filename>web.xml</filename> указать:</para>
          <programlisting>&lt;listener&gt;
    &lt;listener-class&gt;com.haulmont.cuba.web.gui.utils.BackgroundWorkerListener&lt;/listener-class&gt;
&lt;/listener&gt;</programlisting>
        </listitem>
      </orderedlist>
      <para><emphasis role="bold">Объявление WatchDog</emphasis></para>
      <para>В <filename>app-web-spring.xml</filename> и <filename>app-desktop-spring.xml</filename> добавить объявление задачи по расписанию:</para>
      <programlisting>&lt;bean id=&quot;backgroundWorkerScheduler&quot; class=&quot;org.springframework.scheduling.concurrent.ThreadPoolTaskScheduler&quot;&gt;
    &lt;property name=&quot;daemon&quot; value=&quot;true&quot;/&gt;
    &lt;property name=&quot;poolSize&quot; value=&quot;1&quot;/&gt;
&lt;/bean&gt;

&lt;task:scheduled-tasks scheduler=&quot;backgroundWorkerScheduler&quot;&gt;
    &lt;task:scheduled ref=&quot;cuba_BackgroundWorker_WatchDog&quot; method=&quot;cleanupTasks&quot; fixed-delay=&quot;2000&quot;/&gt;
&lt;/task:scheduled-tasks&gt; </programlisting>
      <para><emphasis role="bold">Настройки</emphasis></para>
      <para>Для Web слоя в WebConfig настраивается частота проверки изменений на стороне клиента (браузера): <parameter>cuba.backgroundWorker.uiCheckInterval</parameter> ( По умолчанию 2000 мс )</para>
    </section>
    <section>
      <title>Создание экранов</title>
      <section id="section_controller">
        <title>Контроллер экрана</title>
        <para><classname>Java</classname> или <classname>Groovy</classname> класс,  в котором можно реализовывать бизнес-логику и управлять поведением компонентов, описанных в <glossterm linkend="glossary_xml_descriptor_id">xml-дескрипторе</glossterm>, с помощью различных событий. Контроллер должен быть унаследован от одного из следующих базовых классов:</para>
        <itemizedlist>
          <listitem>
            <para><classname>AbstractFrame</classname> − реализует интерфейс <interfacename>IFrame</interfacename> и предназначен для реализации фреймов − многократно используемых компонентов экранов.</para>
          </listitem>
          <listitem>
            <para><classname>AbstractWindow</classname> − реализует интерфейc <interfacename>Window</interfacename> и предназначен для реализации любых экранов.</para>
          </listitem>
          <listitem>
            <para><classname>AbstractLookup</classname> − реализует интерфейс <interfacename>Lookup</interfacename> и предназначен для реализации <glossterm linkend="glossary_browser_id">браузеров</glossterm> с возможностью выбора элемента списка для использования его в вызывающем экране.</para>
          </listitem>
          <listitem>
            <para><classname>AbstractEditor</classname> − реализует интерфейс <interfacename>Editor</interfacename> и предназначен для реализации экранов редактирования экземпляра сущности.</para>
          </listitem>
        </itemizedlist>
        <para>Основной метод контроллера − <methodname>init()</methodname>. Этот метод вызывается после создания класса окна и всего дерева компонентов, описанного XML-дескриптором. Контроллер может в этом методе произвести инициализацию экрана перед его открытием (например, создать обработчики нажатий на кнопки и пр.).</para>
        <para>В метод <methodname>init()</methodname> из вызывающего кода передается коллекция параметров, состоящая из пар «ключ − значение». Вызывающим кодом может быть как контроллер другого экрана, так и пункт главного меню, либо прямая ссылка на экран извне приложения. Каждый параметр передается в коллекции в двух экземплярах − с простым именем и с тем же именем с префиксом param$.</para>
        <para>Класс контроллера должен быть зарегистрирован в XML-дескрипторе экрана в атрибуте <parameter>class</parameter> корневого элемента.</para>
        <section id="section_AbstractEditor">
          <title>AbstractEditor</title>
          <para><classname>AbstractEditor</classname> − базовый класс контроллеров экранов редактирования экземпляра сущности.</para>
          <para>При создании конкретного класса контроллера рекомендуется параметризовать <classname>AbstractEditor</classname> типом редактируемой сущности. При этом методы <methodname>getItem</methodname> и <methodname>initItem</methodname> будут работать с конкретным типом сущности и прикладному коду не потребуется дополнительных приведений типов. Например:</para>
          <programlisting>public class UserEditor extends AbstractEditor&lt;User&gt; {
...
    @Override
    protected void initItem(User item) {
    ...</programlisting>
          <para>Помимо общего для всех <glossterm linkend="glossary_controller_id">контроллеров</glossterm> метода <methodname>init</methodname> в контроллере экрана редактирования можно переопределить следующие:</para>
          <itemizedlist>
            <listitem>
              <para>Методы инициализации:</para>
              <itemizedlist>
                <listitem>
                  <para><methodname>initItem</methodname></para>
                </listitem>
                <listitem>
                  <para><methodname>postInit</methodname></para>
                </listitem>
              </itemizedlist>
            </listitem>
            <listitem>
              <para>Методы завершения:</para>
              <itemizedlist>
                <listitem>
                  <para><methodname>postValidate</methodname></para>
                </listitem>
                <listitem>
                  <para><methodname>preCommit</methodname></para>
                </listitem>
                <listitem>
                  <para><methodname>postCommit</methodname></para>
                </listitem>
              </itemizedlist>
            </listitem>
          </itemizedlist>
          <para><emphasis role="bold">Диаграммы последовательностей</emphasis></para>
          <figure>
            <title>Инициализация экрана</title>
            <mediaobject>
              <imageobject>
                <imagedata align="center" fileref="img/EditorInit.png"/>
              </imageobject>
            </mediaobject>
          </figure>
          <figure>
            <title>Коммит и закрытие экрана с фреймом editWindowActions</title>
            <mediaobject>
              <imageobject>
                <imagedata align="center" fileref="img/EditorCommit.png"/>
              </imageobject>
            </mediaobject>
          </figure>
          <figure>
            <title>Коммит экрана с фреймом extendedEditWindowActions</title>
            <mediaobject>
              <imageobject>
                <imagedata align="center" fileref="img/ExtendedEditorCommit.png"/>
              </imageobject>
            </mediaobject>
          </figure>
          <figure>
            <title>Коммит и закрытие экрана с фреймом extendedEditWindowActions</title>
            <mediaobject>
              <imageobject>
                <imagedata align="center" fileref="img/ExtendedEditorCommitAndClose.png"/>
              </imageobject>
            </mediaobject>
          </figure>
        </section>
      </section>
      <section>
        <title>XML-дескриптор</title>
        <para>Описывает <glossterm linkend="glossary_datasource_id">источники данных</glossterm> и расположение визуальных компонентов экрана.</para>
        <para>XML-дескриптор содержит следующие элементы:</para>
        <itemizedlist>
          <listitem>
            <para><parameter>window</parameter> − корневой элемент. Атрибуты:</para>
            <orderedlist>
              <listitem>
                <para><property>xmlns</property>=&quot;http://www.haulmont.com/schema/cuba/gui/window.xsd&quot; − схема XML</para>
              </listitem>
              <listitem>
                <para><property>class</property> − имя класса <glossterm linkend="glossary_controller_id">контроллера</glossterm></para>
              </listitem>
              <listitem>
                <para><property>messagesPack</property> − имя <glossterm linkend="glossary_localized_folders_id">пакета сообщений</glossterm>. Фактически это имя Java-пакета, содержащего файл  <filename>messages.properties</filename></para>
              </listitem>
              <listitem>
                <para><property>caption</property> − заголовок экрана, должен содержать ссылку на сообщение из вышеуказанного пакета, например, <programlisting>caption=&quot;msg://caption&quot;</programlisting></para>
              </listitem>
              <listitem>
                <para><property>focusComponent</property> − идентификатор компонента, который получит фокус ввода при отображениее экрана (необязательно).</para>
              </listitem>
            </orderedlist>
          </listitem>
          <listitem>
            <para><parameter>metadataContext</parameter> − опциональный элемент для инициализации <glossterm linkend="glossary_view_ru_id">представлений</glossterm> (views). Предпочтительным является определение всех представлений в одном общем файле <filename>ext-views.xml</filename>  модуля <structname>core</structname>. </para>
          </listitem>
          <listitem>
            <para><parameter>dsContext</parameter> − элемент, определяющий <glossterm linkend="glossary_datasource_id">источники данных</glossterm> данного экрана. Источники данных предназначены для реализации связанных с данными  компонентов.</para>
          </listitem>
          <listitem>
            <para><parameter>layout</parameter> − элемент, определяющий компоновку экрана.</para>
          </listitem>
        </itemizedlist>
      </section>
      <section id="section_registration_screens">
        <title>Регистрация экранов</title>
        <para>Все экраны, доступные в приложении, регистрируются в  файлах <filename>*-screens.xml</filename>.</para>
        <para>Набор файлов <filename>*-screens.xml</filename> конкретного проекта указывается в <glossterm linkend="glossary_app_properties_id">свойстве приложения</glossterm> <parameter>cuba.windowConfig</parameter>.</para>
        <itemizedlist>
          <title>Элементы XML</title>
          <listitem>
            <para><emphasis role="bold">screen-config</emphasis> − корневой элемент</para>
          </listitem>
          <listitem>
            <para><emphasis role="bold">include</emphasis> − включение другого <filename>*-screens.xml</filename>. Вместо включения рекомендуется использовать комбинацию файлов в <glossterm linkend="glossary_app_properties_id">свойстве приложения</glossterm> <parameter>cuba.windowConfig</parameter>. Атрибуты:</para>
            <itemizedlist>
              <listitem>
                <para><emphasis role="bold">file</emphasis> − путь к файлу, начиная от каталога конфигурации приложения <filename>WEB-INF/conf</filename></para>
              </listitem>
            </itemizedlist>
          </listitem>
          <listitem>
            <para><emphasis role="bold">screen</emphasis> − регистрация экрана. Атрибуты:</para>
            <itemizedlist>
              <listitem>
                <para><emphasis role="bold">id</emphasis> − идентификатор  экрана, по которому   производится обращение</para>
              </listitem>
              <listitem>
                <para><emphasis role="bold">template</emphasis> − путь к <glossterm linkend="glossary_xml_descriptor_id">дескриптору</glossterm> экрана. Сначала будет произведена попытка найти дескриптор в каталоге конфигурации приложения <filename>WEB-INF/conf</filename>. Если его там нет, то будет произведен поиск в <filename>classpath</filename>.</para>
              </listitem>
              <listitem>
                <para><emphasis role="bold">class</emphasis> − имя класса. Элемент может быть использован вместо <emphasis role="bold">template</emphasis>. Класс должен реализовывать либо интерфейс <interface>Callable</interface>, либо интерфейс <interface>Runnable</interface>. В случае реализации интерфейса <interface>Callable</interface> метод <methodname>call()</methodname> должен возвращать экземпляр созданного <classname>Window</classname>, который будет возвращен как результат вызова <methodname>WindowManager.openWindow()</methodname>. Класс может содержать конструктор с параметрами для передачи ему строковых значений, заданных атрибутом <emphasis role="bold">param</emphasis>.</para>
              </listitem>
            </itemizedlist>
          </listitem>
          <listitem>
            <para><emphasis role="bold">params</emphasis> − задает параметры вызова экрана. Элемент используется внутри элемента <emphasis role="bold">screen</emphasis>. Параметры вызова позволяют задать несколько идентификаторов одному дескриптору экрана. Параметры будут переданы <glossterm linkend="glossary_controller_id">контроллеру</glossterm> экрана в мапе на входе <methodname>init()</methodname>, либо в конструктор класса, если задан <emphasis role="bold">class</emphasis>.</para>
          </listitem>
          <listitem>
            <para><emphasis role="bold">param</emphasis> − задает параметр внутри элемента <emphasis role="bold">params</emphasis>. Атрибуты:</para>
            <itemizedlist>
              <listitem>
                <para><emphasis role="bold">name</emphasis> − имя параметра</para>
              </listitem>
              <listitem>
                <para><emphasis role="bold">value</emphasis> − значение параметра. Если значение содержит строку &quot;true&quot; или &quot;false&quot;, в параметры экрана будет передано соответствующее значение типа <classname>Boolean</classname>.</para>
              </listitem>
            </itemizedlist>
          </listitem>
        </itemizedlist>
      </section>
    </section>
  </section>
  <section id="section_restapi">
    <title>Интеграция со сторонними приложениями</title>
    <para>TODO</para>
  </section>
  <section>
    <title>Описание конфигурационных файлов</title>
    <variablelist>
      <varlistentry id="text_context_xml">
        <term>context.xml</term>
        <listitem>
          <para>В данном конфигурационном файле задается <link linkend="section_dbms_types">тип используемой СУБД</link>, а также использование <classname>PersistenceManager</classname>.</para>
          <para>Пример файла <filename>context.xml</filename> для приложения <link linkend="section_quick_start_data_model">Магазин</link>:</para>
          <programlisting language="xml"><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/context.xml" encoding="UTF-8" parse="text"/></programlisting>
        </listitem>
      </varlistentry>
      <varlistentry id="text_web_xml_core">
        <term>web.xml</term>
        <listitem>
          <para>Файл <filename>web.xml</filename> модуля <structname>core</structname> приложения <link linkend="section_quick_start_data_model">Магазин</link>:</para>
          <programlisting language="xml"><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/web.xml" encoding="UTF-8" parse="text"/></programlisting>
        </listitem>
      </varlistentry>
    </variablelist>
    <para>TODO</para>
  </section>
  <section id="section_dbms_types">
    <title>Поддерживаемые СУБД</title>
    <para>Тип используемой СУБД определяется <glossterm linkend="glossary_app_properties_id">параметром</glossterm> <link linkend="section_middleware_id">среднего слоя</link> <parameter>cuba.dbmsType</parameter> и настройкой источника данных в <application>Tomcat</application>.</para>
    <variablelist>
      <varlistentry>
        <term>PostgreSQL</term>
        <listitem>
          <para>Поддерживается всеми проектами платформы: CUBA, Workflow, FTS, Charts, CCPayments, RefApp.</para>
          <para><emphasis role="bold">Настройка</emphasis></para>
          <para>Параметр среднего слоя:</para>
          <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/cuba_dbmstype_postgres.txt" encoding="UTF-8" parse="text"/></programlisting>
          <para>Источник данных в <link linkend="text_context_xml">context.xml</link>:</para>
          <programlisting language="xml"><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/context_postgres.xml" encoding="UTF-8" parse="text"/></programlisting>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term>Microsoft SQL Server</term>
        <listitem>
          <para>Поддерживается проектами: CUBA, Workflow, FTS, RefApp.</para>
          <para><emphasis role="bold">Настройка</emphasis></para>
          <para>Параметр среднего слоя:</para>
          <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/cuba_dbmstype_mssql.txt" encoding="UTF-8" parse="text"/></programlisting>
          <para>Источник данных в <link linkend="text_context_xml">context.xml</link>:</para>
          <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/context_mssql.xml" encoding="UTF-8" parse="text"/></programlisting>
          <para>В настройках MS SQL надо включить возможность логина для пользователя sa и задать для него пароль из context.xml. Это можно сделать из MS SQL Management Studio, в окне Object Explorer.

Instance - ваш SQL Server.</para>
          <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/instance_mssql.txt" encoding="UTF-8" parse="text"/></programlisting>
          <para>Включить сетевую аутентификацию:</para>
          <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/instance1_mssql.txt" encoding="UTF-8" parse="text"/></programlisting>
          <para>Разрешить доступ по TCP/IP можно из Sql Server Configuration Manager</para>
          <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="source/instance2_mssql.txt" encoding="UTF-8" parse="text"/></programlisting>
        </listitem>
      </varlistentry>
    </variablelist>
  </section>
</chapter>
