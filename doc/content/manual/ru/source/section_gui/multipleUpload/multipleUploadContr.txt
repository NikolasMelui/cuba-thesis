public class UploadSample extends AbstractWindow {

    @Inject
    private TimeSource timeSource;

    @Inject
    private TextField textFieldInfo;

    @Inject
    private FileMultiUploadField uploadTemplateAttachment;
	
	@Inject
    private FileUploading fileUploading;//класс,реализующий управление файлами в хранилище

    private FileDescriptor fd;

    @Override
    public void init(Map<String, Object> params) {
        super.init(params);

        uploadTemplateAttachment.addListener(new FileMultiUploadField.UploadListener() {
            @Override
            public void queueUploadComplete() {
                //код обработки успешной загрузки
                textFieldInfo.setValue("");
                String val = "";
                //загрузка мапы идентификаторов файлов и названий имен файлов
                Map<UUID, String> uploadMap = uploadTemplateAttachment.getUploadsMap();
                for (UUID fileId : uploadMap.keySet()) {
                    long length = fileUploading.getFile(fileId).length();
                    //создание дескриптора файла
                    FileDescriptor fd = new FileDescriptor();
                    //установка значений в дескриптор из мапы
                    fd.setName(uploadMap.get(fileId));
                    fd.setExtension(fd.getFileExt());
                    fd.setSize((int) length);
                    fd.setCreateDate(timeSource.currentTimestamp());
                    //запись файла в хранилище файлов
                    try {
                        fileUploading.putFileIntoStorage(fileId, fd);
                        val = val + fd.getName() + "\n";
                    } catch (FileStorageException e) {
                        new RuntimeException(e);
                    }
                }
                if (val != "") {
                    textFieldInfo.setValue(val);
                }
                showNotification(getMessage("files"), IFrame.NotificationType.HUMANIZED);
                uploadTemplateAttachment.getUploadsMap().clear();
            }

            @Override
            public void errorNotify(String fileName, String message, int errorCode) {
                showNotification(getMessage("template.edit.uploadTemplateAttachmentsUnsuccess"), IFrame.NotificationType.ERROR);
            }
        });
    }
}
